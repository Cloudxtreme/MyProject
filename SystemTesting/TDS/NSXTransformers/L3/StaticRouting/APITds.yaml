{% include 'TDS/NSXTransformers/L3/StaticRouting/AutoGeneratedWorkloads.yaml' %}

tds_template: &tds_template
    AutomationLevel: Automated
    Category: L3
    Component: StaticRouting
    Developer: miriyalak
    Duration: null
    ExpectedResult: PASS
    FullyAutomatable: Y
    PartnerFacing: N
    PMT: null
    Product: NSXTransformers
    QCPath: ESX
    Status: Execution Ready
    TCMSId: null
    TestcaseLevel: Product
    TestcaseType: Functional
    Version: 2

p0_template: &p0_template
    <<: *tds_template
    Priority: P0

AddStaticRoutesPlr:
    <<: *p0_template
    Tags: cat,api,nsxtransformers,l3
    Procedure:
        - Create an overlay transport zone
        - Create a logical switch
        - Create a logical switch port
        - Create a logical router
        - Map logical router port to switch port
        - Configure static routes on logical router
        - Verify static routes configured on nsx manager
        - Cleanup the setup
    Summary: Test RUD for static routing
    TestbedSpec:
        nsxmanager:
            '[1]':
                ip: none
    TestName: AddStaticRoutesPlr
    WORKLOADS:
        Sequence:
             - - CreateTZ-1
             - - CreateLS-1
             - - CreateLSP-1_LS-1
             - - CreateLR-1
             - - CreateLRP-1_IP-192.168.1.1_LSP-1
             - - UpdateStaticRoutes
             - - VerifyStaticRoutes
        ExitSequence:
             - - DeleteStaticRoutesOnLR-1
             - - DeleteLRP-1
             - - DeleteLR-1
             - - DeleteLSP-1
             - - DeleteLS-1

        UpdateStaticRoutes:
            Type: Router
            TestRouter: nsxmanager.[1].logicalrouter.[1]
            lrstaticroutes:
                '[1]':
                    staticroutes:
                        - name: static-route-1
                          summary: Static route for 192.168.30.0/24
                          next_hops:
                              - 192.168.1.2
                              - 192.168.1.3
                          network: 192.168.30.0/24
                          lr_port_id: nsxmanager.[1].logicalrouterport.[1]->id
                        - name: static-route-2
                          summary: Static route for 192.168.40.0/24
                          next_hops:
                              - 192.168.1.2
                              - 192.168.1.3
                              - 192.168.1.4
                          network: 192.168.40.0/24
                          lr_port_id: nsxmanager.[1].logicalrouterport.[1]->id
        VerifyStaticRoutes:
            TestRouter: nsxmanager.[1].logicalrouter.[1]
            Type: Router
            get_static_routes[?]contain_once:
                staticroutes:
                    - name: static-route-1
                      summary: Static route for 192.168.30.0/24
                      next_hops:
                          - 192.168.1.2
                          - 192.168.1.3
                      network: 192.168.30.0/24
                      lr_port_id: nsxmanager.[1].logicalrouterport.[1]->id
                    - name: static-route-2
                      summary: Static route for 192.168.40.0/24
                      next_hops:
                          - 192.168.1.2
                          - 192.168.1.3
                          - 192.168.1.4
                      network: 192.168.40.0/24
