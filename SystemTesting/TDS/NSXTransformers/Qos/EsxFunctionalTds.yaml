!include ../Common/Topo_Clusters.yaml
!include ../Common/Topo_1LS_2LP_2HV.yaml
!include TestbedSpecs.yaml
!include AutoGeneratedWorkloads.yaml
!include TdsTags.yaml

##### P0

QosProfileManagementAndPropagationBasic:
    <<: *BumblebeeP0Tags
    QCPath: Unknown\ESX
    TestName: QosProfileManagementAndPropagationBasic
    Summary: Verify custom QoS Profile can be defined in Manager. Exercise
        basic field values. Verify Manager association of profiles to LSwitch
        and LPort. Verify configuration push to the LPort Transport Node.
    Status: Development
    Developer: dliang, jschmidt
    TestbedSpec: *Testbed_2ESX_2VM
    WORKLOADS:
        <<: *AutoGeneratedWorkloads
        <<: *Topo_1MP_1CCP
        <<: *Topo_1LS_2LP_2HV
        Sequence:
            # Setup and verify NSX MP and CCP clusters, L2 topology, tenant traffic
            - - 'ClusterSetup'
            - - 'ClusterVerification'
            - - 'LogicalSetup'
            - - 'TNSetup--ESX'
            - - 'VMSetup--ESX'
            - - 'L2Traffic--ESX'
            # Create and verify a Qos profile with default values.
            - - 'CreateQosProfile-1_DISCOVER-true_NAME-nsx-default-qos-switching-profile'
            # Create a Qos profile with custom values, associate with LPort.
            - - 'CreateQosProfile-2_NAME-QosProfile2_DESCRIPTION-Qos profile with system default values.'
            - - 'VerifyManagerQosProfile-2_NAME-QosProfile2_DESCRIPTION-Qos profile with system default values._DSCPPRIORITY-0_DSCPMODE-TRUSTED'
            - - 'DeleteQosProfile-2'
            # Create a Qos profile with custom values, associate with LSwitch.
            - - 'CreateQosProfile-3_NAME-QosProfile3_DESCRIPTION-Qos profile with custom values._DSCPPRIORITY-0_DSCPMODE-TRUSTED_COS-0_INGRESSENABLED-true_INGRESSAVERAGE-200000_INGRESSPEAK-400000_INGRESSBURST-2147483647'
            - - 'VerifyManagerQosProfile-3_NAME-QosProfile3_DESCRIPTION-Qos profile with custom values._DSCPPRIORITY-0_DSCPMODE-TRUSTED_COS-0_INGRESSENABLED-true_INGRESSAVERAGE-200000_INGRESSPEAK-400000_INGRESSBURST-2147483647'
            - - 'AssociateQosProfile-3_LP-1'
            - - 'VerifyAssociationQosProfile-3_LP-1'
            - - 'VerifyHostPortConfigQosProfile-3_ESX-1_LP-1_DSCPPRIORITY-0_DSCPMODE-TRUSTED_COS-0_INGRESSAVERAGE-25000000_INGRESSPEAK-50000000_INGRESSBURST-2147483647'
            # Create a Qos profile with custom values, associate with LSwitch.
            - - 'CreateQosProfile-4_NAME-QosProfile4_DESCRIPTION-Qos profile with custom values._DSCPPRIORITY-0_DSCPMODE-TRUSTED_COS-0_INGRESSENABLED-true_INGRESSAVERAGE-200000_INGRESSPEAK-400000_INGRESSBURST-2147483647'
            - - 'VerifyManagerQosProfile-4_NAME-QosProfile4_DESCRIPTION-Qos profile with custom values._DSCPPRIORITY-0_DSCPMODE-TRUSTED_COS-0_INGRESSENABLED-true_INGRESSAVERAGE-200000_INGRESSPEAK-400000_INGRESSBURST-2147483647'
            - - 'AssociateQosProfile-4_LS-1'
            - - 'VerifyAssociationQosProfile-4_LS-1'
            - - 'VerifyAssociationQosProfile-4_LP-2'
            - - 'VerifyHostPortConfigQosProfile-4_ESX-2_LP-2_DSCPPRIORITY-0_DSCPMODE-TRUSTED_COS-0_INGRESSENABLED-true_INGRESSAVERAGE-25000000_INGRESSPEAK-50000000_INGRESSBURST-2147483647'
            # Delete profile associated with LPort, verify revert to
            # LSwitch profile.
            - - 'DeleteQosProfile-3_FORCE-true'
            - - 'VerifyAssociationQosProfile-4_LP-1'
            # Delete profile associated with LSwitch, verify revert to
            # system default profile.
            - - 'DeleteQosProfile-4_FORCE-true'
            - - 'VerifyAssociationQosProfile-1_LS-1'
            - - 'VerifyAssociationQosProfile-1_LP-1'
            - - 'VerifyAssociationQosProfile-1_LP-2'
            - - 'VerifyHostPortConfigQosProfile-1_ESX-1_LP-1_DSCPPRIORITY-ff_DSCPPRIORITY-trusted_COS-0'
            - - 'VerifyHostPortConfigQosProfile-1_ESX-2_LP-2_DSCPPRIORITY-ff_DSCPPRIORITY-trusted_COS-0'
        ExitSequence:
            # Cleanup VIF attachments, Cleanup L2 topology, Cleanup NSX MP and CCP clusters.
            - - 'VMCleanup--ESX'
            - - 'TNCleanup--ESX'
            - - 'LogicalCleanup'
            - - 'ClusterCleanup'

QosProfileSystemDefaultValuesAndAssociation:
    <<: *BumblebeeP0Tags
    QCPath: Unknown\ESX
    TestName: QosProfileSystemDefaultValuesAndAssociation
    Summary: Verify properties of the default QoS Profile and association with
        LSwitch and LPort.
    Status: Development
    Developer: dliang, jschmidt
    TestbedSpec: *Testbed_2ESX_2VM
    WORKLOADS:
        Sequence:
            - -
        ExitSequence:
            - -

QosDscpMarkingTrustedBasic:
    <<: *BumblebeeP0Tags
    QCPath: DSCPMarking\ESX
    TestName: QosDscpMarkingTrustedBasic
    Summary: Verify tenant Qos trusted DSCP marking.
    Status: Development
    Developer: dliang, jschmidt
    TestbedSpec: *Testbed_2ESX_2VM
    WORKLOADS:
        Sequence:
            - -
        ExitSequence:
            - -

QosClassOfServiceBasic:
    <<: *BumblebeeP0Tags
    QCPath: COS\ESX
    TestName: QosClassOfServiceBasic
    Summary: Verify class of service marking
    Status: Development
    Developer: dliang, jschmidt
    TestbedSpec: *Testbed_2ESX_2VM
    WORKLOADS:
        Sequence:
            - -
        ExitSequence:
            - -

QosTrafficShapingBasicDifferentHost:
    <<: *BumblebeeP0Tags
    QCPath: !!str Traffic Shaping - Max/Min/Shares\ESX
    TestName: QosTrafficShapingBasicDifferentHost
    Summary: Verify tenant traffic shaping functionality with average_bandwidth
        specification when tenants reside on different hosts.
    Status: Development
    Developer: dliang, jschmidt
    TestbedSpec: *Testbed_2ESX_2VM
    WORKLOADS:
        Sequence:
            - -
        ExitSequence:
            - -

QosTrafficShapingBasicSameHost:
    <<: *BumblebeeP0Tags
    QCPath: !!str Traffic Shaping - Max/Min/Shares\ESX
    TestName: QosTrafficShapingBasicSameHost
    Summary: Verify tenant traffic shaping functionality with average_bandwidth
        specification when tenants reside on the same host.
    Status: Development
    Developer: dliang, jschmidt
    TestbedSpec: *Testbed_2ESX_2VM
    WORKLOADS:
        Sequence:
            - -
        ExitSequence:
            - -

##### P1

QosProfileFailDeleteSystemDefault:
    <<: *BumblebeeP1Tags
    QCPath: Unknown\ESX
    TestName: QosProfileFailDeleteSystemDefault
    Summary: Verify default system QoS Profile can not be deleted.
    Status: Execution Ready
    Developer: dliang, jschmidt
    TestbedSpec: *Testbed_2ESX_2VM
    WORKLOADS:
        Sequence:
            - -
        ExitSequence:
            - -

QosProfileManagementErrorHandling:
    <<: *BumblebeeP1Tags
    QCPath: Unknown\ESX
    TestName: QosProfileManagementErrorHandling
    Summary: Verify custom QoS Profile defined with bad values are properly
        trapped with error responses by Manager.
    Status: Development
    Developer: dliang, jschmidt
    TestbedSpec: *Testbed_2ESX_2VM
    WORKLOADS:
        Sequence:
            - -
        ExitSequence:
            - -

##### P2

QosProfileManagementValidValuesRange:
    <<: *BumblebeeP2Tags
    QCPath: Unknown\ESX
    TestName: QosProfileManagementValidValuesRange
    Summary: Verify custom QoS Profile can be defined in Manager and
        propagated to LPort on Transport Node. Exercise full range of valid
        field values.
    Status: Development
    Developer: dliang, jschmidt
    TestbedSpec: *Testbed_2ESX_2VM
    WORKLOADS:
        Sequence:
            - -
        ExitSequence:
            - -
QosDscpMarkingValidValuesRange:
    <<: *BumblebeeP2Tags
    QCPath: DSCPMarking\ESX
    TestName: QosDscpMarkingValidValuesRange
    Summary: Verify tenant Qos trusted and untrusted DSCP marking for a range
        of normal and boundary marking values with Overlay and VLAN
        encapsulation.
    Status: Development
    Developer: dliang, jschmidt
    TestbedSpec: *Testbed_2ESX_2VM
    WORKLOADS:
        Sequence:
            - -
        ExitSequence:
            - -

QosClassOfServiceValidValuesRange:
    <<: *BumblebeeP2Tags
    QCPath: COS\ESX
    TestName: QosClassOfServiceValidValuesRange
    Summary: Verify class of service marking for a range of normal and boundary
        values.
    Status: Development
    Developer: dliang, jschmidt
    TestbedSpec: *Testbed_2ESX_2VM
    WORKLOADS:
        Sequence:
            - -
        ExitSequence:
            - -

QosCosMarkingOverlaySwitch:
    <<: *BumblebeeP2Tags
    QCPath: COS\ESX
    TestName: QosCosMarkingOverlaySwitch
    Summary: Verify tenant traffic success when CoS marking profile is applied
        on LPort attached to overlay-backed LSwitch. (BZ1397176)
    Status: Development
    Developer: dliang, jschmidt
    TestbedSpec: *Testbed_2ESX_2VM
    WORKLOADS:
        Sequence:
            - -
        ExitSequence:
            - -
