BfdKeepaliveBeforeConnected:
    <<: *TDS_COMMON_FIELDS_P1_CASE
    Component: "BFD functionality"
    TestName:  "BfdKeepaliveBeforeConnected"
    Developer: "mqing"
    TestbedSpec: *FUNCTIONAL_TOPOLOGY_2
    Summary: |
        First configure global keepalive interval, after TOR connected,
        verify its functions
    WORKLOADS:
        Sequence:
            # step 1: setup TOR simulators
            - ['SetupTORSimulator']
            - ['CreateTOROnVSM']
            - ["VerifyTORsNotConnected"]

            # step 2: configure PTEPs and configure global bfd keepalive
            # interval before TOR gateway connected
            - ['AddToPTEPCluster']
            - ['SetGlobalBfdKeepalive']
            - ['VerifyGlobalBfdKeepalive']
            # connect TOR gateway
            - ['TORGatewaySetController']
            - ['VerifyGlobalBfdKeepalive']

        ExitSequence:
            - ['RemoveFromPTEPCluster']
            - ['CleanupTORSimulator']

        SetupTORSimulator: *SETUP_TOR_SIMUATOR_2_GATEWAYS
        CreateTOROnVSM: *CREATE_2_TOR_ON_VSM
        VerifyTORsNotConnected: *VERIFY_2_TOR_INSTANCES_NOT_CONNECTED
        TORGatewaySetController: *TOR_GATEWAY_SET_CONTROLLER
        AddToPTEPCluster: *ADD_3_PTEPS_TO_CLUSTER
        SetGlobalBfdKeepalive: *SET_GLOBAL_BFD_NEW_KEEPALIVE
        VerifyGlobalBfdKeepalive: *VERIFY_GLOBAL_BFD_NEW_KEEPALIVE
        RemoveFromPTEPCluster: *REMOVE_FROM_PTEP_CLUSTER
        CleanupTORSimulator: *CLEANUP_TOR_SIMUATOR_2_GATEWAYS

BfdKeepaliveAfterConnected:
    <<: *TDS_COMMON_FIELDS_P1_CASE
    Component: "BFD functionality"
    TestName:  "BfdKeepaliveAfterConnected"
    Developer: "mqing"
    TestbedSpec: *FUNCTIONAL_TOPOLOGY_2
    Summary: |
        After TOR connected,configure global keepalive interval,
        verify its functions
    WORKLOADS:
        Sequence:
            # step 1: setup TOR simulators
            - ['SetupTORSimulator']
            - ['CreateTOROnVSM']
            - ["VerifyTORsNotConnected"]

            # step 2: first connect TOR gateway, then configure PTEPs and
            # configure global bfd keepalive
            # connect TOR gateway
            - ['TORGatewaySetController']
            - ['AddToPTEPCluster']
            - ['SetGlobalBfdKeepalive']
            - ['VerifyGlobalBfdKeepalive']

        ExitSequence:
            - ['RemoveFromPTEPCluster']
            - ['CleanupTORSimulator']

        SetupTORSimulator: *SETUP_TOR_SIMUATOR_2_GATEWAYS
        CreateTOROnVSM: *CREATE_2_TOR_ON_VSM
        VerifyTORsNotConnected: *VERIFY_2_TOR_INSTANCES_NOT_CONNECTED
        TORGatewaySetController: *TOR_GATEWAY_SET_CONTROLLER
        AddToPTEPCluster: *ADD_3_PTEPS_TO_CLUSTER
        SetGlobalBfdKeepalive: *SET_GLOBAL_BFD_NEW_KEEPALIVE
        VerifyGlobalBfdKeepalive: *VERIFY_GLOBAL_BFD_NEW_KEEPALIVE
        RemoveFromPTEPCluster: *REMOVE_FROM_PTEP_CLUSTER
        CleanupTORSimulator: *CLEANUP_TOR_SIMUATOR_2_GATEWAYS

BfdEnablePerTorBeforeConnected:
    <<: *TDS_COMMON_FIELDS_P1_CASE
    Component: "BFD functionality"
    TestName:  "BfdEnablePerTorBeforeConnected"
    Developer: "mqing"
    TestbedSpec: *FUNCTIONAL_TOPOLOGY_2
    Summary: |
        Verify after TOR connected, default BFD per TOR enabled
        operation is Enabled
    WORKLOADS:
        Sequence:
            # step 1: setup TOR simulators
            - ['SetupTORSimulator']
            - ['CreateTOROnVSM']
            - ["VerifyTORsNotConnected"]

            # step 2: configure PTEPs and verify/configure bfd per TOR
            # before TOR gateway connected
            - ['AddToPTEPCluster']
            - ['EnableGlobalBfd']
            - ['VerifyGlobalBfdEnabled']
            - ['Verify2TorInstancesBfdEnabled']
            - ['DisableBfdPerTOR']
            - ['Verify2TorInstancesBfdDisabled']
            - ['EnableBfdPerTOR']
            - ['Verify2TorInstancesBfdEnabled']
            # connect TOR gateway
            - ['TORGatewaySetController']
            - ['VerifyGlobalBfdEnabled']
            - ['Verify2TorInstancesBfdEnabled']

        ExitSequence:
            - ['RemoveFromPTEPCluster']
            - ['CleanupTORSimulator']

        SetupTORSimulator: *SETUP_TOR_SIMUATOR_2_GATEWAYS
        CreateTOROnVSM: *CREATE_2_TOR_ON_VSM
        VerifyTORsNotConnected: *VERIFY_2_TOR_INSTANCES_NOT_CONNECTED
        TORGatewaySetController: *TOR_GATEWAY_SET_CONTROLLER
        AddToPTEPCluster: *ADD_3_PTEPS_TO_CLUSTER
        EnableGlobalBfd: *ENABLE_GLOBAL_BFD
        EnableBfdPerTOR: *ENABLE_BFD_ON_TOR_1_2
        DisableBfdPerTOR: *DISABLE_BFD_ON_TOR_1_2
        VerifyGlobalBfdEnabled: *VERIFY_GLOBAL_BFD_ENABLED
        Verify2TorInstancesBfdEnabled: *VERIFY_2_TOR_INSTANCES_BFD_ENABLED
        Verify2TorInstancesBfdDisabled: *VERIFY_2_TOR_INSTANCES_BFD_DISABLED
        RemoveFromPTEPCluster: *REMOVE_FROM_PTEP_CLUSTER
        CleanupTORSimulator: *CLEANUP_TOR_SIMUATOR_2_GATEWAYS

BfdDisablePerTorBeforeConnected:
    <<: *TDS_COMMON_FIELDS_P1_CASE
    Component: "BFD functionality"
    TestName:  "BfdDisablePerTorBeforeConnected"
    Developer: "mqing"
    TestbedSpec: *FUNCTIONAL_TOPOLOGY_2
    Summary: |
        Verify before TOR connected, change the per TOR BFD enable param value
        to Disabled, after TOR connected, verify its functions
    WORKLOADS:
        Sequence:
            # step 1: setup TOR simulators
            - ['SetupTORSimulator']
            - ['CreateTOROnVSM']
            - ["VerifyTORsNotConnected"]

            # step 2: configure PTEPs and verify/configure bfd per TOR
            # before TOR gateway connected
            - ['AddToPTEPCluster']
            - ['EnableGlobalBfd']
            - ['VerifyGlobalBfdEnabled']
            - ['Verify2TorInstancesBfdEnabled']
            - ['DisableBfdPerTOR']
            - ['Verify2TorInstancesBfdDisabled']
            # connect TOR gateway
            - ['TORGatewaySetController']
            - ['VerifyGlobalBfdEnabled']
            - ['Verify2TorInstancesBfdDisabled']
            - ['EnableBfdPerTOR']
            - ['Verify2TorInstancesBfdEnabled']

        ExitSequence:
            - ['RemoveFromPTEPCluster']
            - ['CleanupTORSimulator']

        SetupTORSimulator: *SETUP_TOR_SIMUATOR_2_GATEWAYS
        CreateTOROnVSM: *CREATE_2_TOR_ON_VSM
        VerifyTORsNotConnected: *VERIFY_2_TOR_INSTANCES_NOT_CONNECTED
        TORGatewaySetController: *TOR_GATEWAY_SET_CONTROLLER
        AddToPTEPCluster: *ADD_3_PTEPS_TO_CLUSTER
        EnableGlobalBfd: *ENABLE_GLOBAL_BFD
        EnableBfdPerTOR: *ENABLE_BFD_ON_TOR_1_2
        DisableBfdPerTOR: *DISABLE_BFD_ON_TOR_1_2
        VerifyGlobalBfdEnabled: *VERIFY_GLOBAL_BFD_ENABLED
        Verify2TorInstancesBfdEnabled: *VERIFY_2_TOR_INSTANCES_BFD_ENABLED
        Verify2TorInstancesBfdDisabled: *VERIFY_2_TOR_INSTANCES_BFD_DISABLED
        RemoveFromPTEPCluster: *REMOVE_FROM_PTEP_CLUSTER
        CleanupTORSimulator: *CLEANUP_TOR_SIMUATOR_2_GATEWAYS

BfdDisablePerTorAfterConnected:
    <<: *TDS_COMMON_FIELDS_P1_CASE
    Component: "BFD functionality"
    TestName:  "BfdDisablePerTorAfterConnected"
    Developer: "mqing"
    TestbedSpec: *FUNCTIONAL_TOPOLOGY_2
    Summary: |
        Verify after TOR connected, change the per TOR BFD enable param value
        to Disabled, verify its functions
    WORKLOADS:
        Sequence:
            # step 1: setup TOR simulators
            - ['SetupTORSimulator']
            - ['CreateTOROnVSM']
            - ["VerifyTORsNotConnected"]

            # step 2: configure PTEPs and connect TOR gateway,
            # verify/configure bfd per TOR
            - ['AddToPTEPCluster']
            - ['EnableGlobalBfd']
            - ['VerifyGlobalBfdEnabled']
            - ['Verify2TorInstancesBfdEnabled']
            # connect TOR gateway
            - ['TORGatewaySetController']
            - ['VerifyGlobalBfdEnabled']
            - ['Verify2TorInstancesBfdEnabled']
            - ['DisableBfdPerTOR']
            - ['Verify2TorInstancesBfdDisabled']

        ExitSequence:
            - ['RemoveFromPTEPCluster']
            - ['CleanupTORSimulator']

        SetupTORSimulator: *SETUP_TOR_SIMUATOR_2_GATEWAYS
        CreateTOROnVSM: *CREATE_2_TOR_ON_VSM
        VerifyTORsNotConnected: *VERIFY_2_TOR_INSTANCES_NOT_CONNECTED
        TORGatewaySetController: *TOR_GATEWAY_SET_CONTROLLER
        AddToPTEPCluster: *ADD_3_PTEPS_TO_CLUSTER
        EnableGlobalBfd: *ENABLE_GLOBAL_BFD
        EnableBfdPerTOR: *ENABLE_BFD_ON_TOR_1_2
        DisableBfdPerTOR: *DISABLE_BFD_ON_TOR_1_2
        VerifyGlobalBfdEnabled: *VERIFY_GLOBAL_BFD_ENABLED
        Verify2TorInstancesBfdEnabled: *VERIFY_2_TOR_INSTANCES_BFD_ENABLED
        Verify2TorInstancesBfdDisabled: *VERIFY_2_TOR_INSTANCES_BFD_DISABLED
        RemoveFromPTEPCluster: *REMOVE_FROM_PTEP_CLUSTER
        CleanupTORSimulator: *CLEANUP_TOR_SIMUATOR_2_GATEWAYS

BfdAfterTorReconnect:
    <<: *TDS_COMMON_FIELDS_P1_CASE
    Component: "BFD functionality"
    TestName:  "BfdAfterTorReconnect"
    Developer: "mqing"
    TestbedSpec: *FUNCTIONAL_TOPOLOGY_2
    Summary: |
        Verify BFD function recovers after ToR disconnects from
        ToR agent and then reconnects
    WORKLOADS:
        Sequence:
            # step 1: setup TOR simulators
            - ['SetupTORSimulator']
            - ['CreateTOROnVSM']
            - ["VerifyTORsNotConnected"]

            # step 2: disconnect and reconnect TOR gateway
            - ['AddToPTEPCluster']
            # connect TOR gateway
            - ['TORGatewaySetController']
            - ["VerifyTORsConnected"]
            - ['VerifyGlobalBfdEnabled']
            - ['Verify2TorInstancesBfdEnabled']
            - ['StopVtepSimulator1']
            - ['StopVtepSimulator2']
            - ["VerifyTORsNotConnected"]
            - ['Verify2TorInstancesBfdEnabled']
            - ['StartVtepSimulator1']
            - ['StartVtepSimulator2']
            - ["VerifyTORsConnected"]
            - ['Verify2TorInstancesBfdEnabled']

        ExitSequence:
            - ['RemoveFromPTEPCluster']
            - ['CleanupTORSimulator']

        SetupTORSimulator: *SETUP_TOR_SIMUATOR_2_GATEWAYS
        CreateTOROnVSM: *CREATE_2_TOR_ON_VSM
        VerifyTORsNotConnected: *VERIFY_2_TOR_INSTANCES_NOT_CONNECTED
        VerifyTORsConnected: *VERIFY_2_TOR_INSTANCES_CONNECTED
        TORGatewaySetController: *TOR_GATEWAY_SET_CONTROLLER
        AddToPTEPCluster: *ADD_3_PTEPS_TO_CLUSTER
        EnableGlobalBfd: *ENABLE_GLOBAL_BFD
        VerifyGlobalBfdEnabled: *VERIFY_GLOBAL_BFD_ENABLED
        Verify2TorInstancesBfdEnabled: *VERIFY_2_TOR_INSTANCES_BFD_ENABLED
        StopVtepSimulator1: *STOP_VTEP_SIMULATOR_1
        StopVtepSimulator2: *STOP_VTEP_SIMULATOR_2
        StartVtepSimulator1: *START_VTEP_SIMULATOR_1
        StartVtepSimulator2: *START_VTEP_SIMULATOR_2
        RemoveFromPTEPCluster: *REMOVE_FROM_PTEP_CLUSTER
        CleanupTORSimulator: *CLEANUP_TOR_SIMUATOR_2_GATEWAYS

TorGatewayNotSupportBFD:
    <<: *TDS_COMMON_FIELDS_P1_CASE
    Component: "BFD functionality"
    TestName:  "TorGatewayNotSupportBFD"
    Developer: "mqing"
    TestbedSpec: *FUNCTIONAL_TOPOLOGY_2
    Summary: |
        Verify for certain version of TOR gateway, BFD feature is not
        supported. PTEPs will stop the BFD session.
    WORKLOADS:
        Sequence:
            # step 1: setup TOR simulators
            - ['SetupTORSimulator']
            - ['CreateTOROnVSM']
            - ["VerifyTORsNotConnected"]

            # step 2: when TOR gateway not supported, verify globalBFD and
            # BFD per TOR is disabled
            - ['AddToPTEPCluster']
            # connect TOR gateway
            - ['TORGatewaySetController']
            - ["VerifyTORsConnected"]
            - ['VerifyGlobalBfdDisabled']
            - ['Verify2TorInstancesBfdDisabled']

        ExitSequence:
            - ['RemoveFromPTEPCluster']
            - ['CleanupTORSimulator']

        SetupTORSimulator: *SETUP_TOR_SIMUATOR_2_GATEWAYS_NOT_SUPPORT_BFD
        CreateTOROnVSM: *CREATE_2_TOR_ON_VSM
        VerifyTORsNotConnected: *VERIFY_2_TOR_INSTANCES_NOT_CONNECTED
        VerifyTORsConnected: *VERIFY_2_TOR_INSTANCES_CONNECTED
        TORGatewaySetController: *TOR_GATEWAY_SET_CONTROLLER
        AddToPTEPCluster: *ADD_3_PTEPS_TO_CLUSTER
        VerifyGlobalBfdDisabled: *VERIFY_GLOBAL_BFD_DISABLED
        Verify2TorInstancesBfdDisabled: *VERIFY_2_TOR_INSTANCES_BFD_DISABLED
        RemoveFromPTEPCluster: *REMOVE_FROM_PTEP_CLUSTER
        CleanupTORSimulator: *CLEANUP_TOR_SIMUATOR_2_GATEWAYS

BfdStatusFromTorGateway:
    <<: *TDS_COMMON_FIELDS_P1_CASE
    Component: "BFD functionality"
    TestName:  "BfdStatusFromTorGateway"
    Developer: "mqing"
    TestbedSpec: *FUNCTIONAL_TOPOLOGY_2
    Summary: |
        verify BFD health status From TOR Gateway by REST API and UI
    WORKLOADS:
        Sequence:
            # step 1: setup TOR simulators
            - ['SetupTORSimulator']
            - ['CreateTOROnVSM']
            - ["VerifyTORsNotConnected"]

            # step 2: verify BFD status from both VSM and TOR gateway side
            - ['AddToPTEPCluster']
            # connect TOR gateway
            - ['TORGatewaySetController']
            - ['VerifyTORsConnected']
            - ['VerifyTorEmulatorBfdStatusEnabled']
            - ['DisableGlobalBfd']
            - ['VerifyGlobalBfdDisabled']
            - ['Verify2TorInstancesBfdDisabled']
            - ['VerifyTorEmulatorBfdStatusDisabled']

        ExitSequence:
            - ['RemoveFromPTEPCluster']
            - ['CleanupTORSimulator']

        SetupTORSimulator: *SETUP_TOR_SIMUATOR_2_GATEWAYS_NOT_SUPPORT_BFD
        CreateTOROnVSM: *CREATE_2_TOR_ON_VSM
        VerifyTORsNotConnected: *VERIFY_2_TOR_INSTANCES_NOT_CONNECTED
        VerifyTORsConnected: *VERIFY_2_TOR_INSTANCES_CONNECTED
        TORGatewaySetController: *TOR_GATEWAY_SET_CONTROLLER
        AddToPTEPCluster: *ADD_3_PTEPS_TO_CLUSTER
        DisableGlobalBfd: *DISABLE_GLOBAL_BFD
        VerifyGlobalBfdDisabled: *VERIFY_GLOBAL_BFD_DISABLED
        Verify2TorInstancesBfdDisabled: *VERIFY_2_TOR_INSTANCES_BFD_DISABLED
        VerifyTorEmulatorBfdStatusEnabled: *VERIFY_2_TOR_GATEWAYS_EMULATOR_BFD_STATUS_ENABLED
        VerifyTorEmulatorBfdStatusDisabled: *VERIFY_2_TOR_GATEWAYS_EMULATOR_BFD_STATUS_DISABLED
        RemoveFromPTEPCluster: *REMOVE_FROM_PTEP_CLUSTER
        CleanupTORSimulator: *CLEANUP_TOR_SIMUATOR_2_GATEWAYS

EndToEndBfdSessionDetection:
    <<: *TDS_COMMON_FIELDS_P1_CASE
    Component: "BFD functionality"
    TestName:  "EndToEndBfdSessionDetection"
    Developer: "mqing"
    TestbedSpec: *FUNCTIONAL_TOPOLOGY_2
    Summary: |
        when BFD tunnel works, block BFD connection between TOR gateway
        and PTEP, verify state of tunnel changed
    WORKLOADS:
        Sequence:
            # step 1: setup TOR simulators
            - ['SetupTORSimulator']
            - ['CreateTOROnVSM']
            - ["VerifyTORsNotConnected"]

            # step 2: verify the BFD session created succesffully
            - ['AddToPTEPCluster']
            # connect TOR gateway
            - ['TORGatewaySetController']
            - ['VerifyTORsConnected']
            - ['VerifyGlobalBfdEnabled']
            - ['Verify2TorInstancesBfdEnabled']
            - ['VerifyTorEmulatorBfdStatusEnabled']

            # step 3: block TOR gateway 1 BFD session to PTEPs,
            # keep TOR gateway 2 BFD session unblocked
            - ['BlockTorGateway1BfdTunnelToPteps']
            - ['VerifyGlobalBfdEnabled']
            - ['Verify2TorInstancesBfdEnabled']
            - ['VerifyTorEmulator1BfdStatusWhenTunnelBlocked']

            # step 4: block both TOR gateway 1 and 2 BFD session to PTEPs
            - ['BlockTorGateway2BfdTunnelToPteps']
            - ['VerifyGlobalBfdEnabled']
            - ['Verify2TorInstancesBfdEnabled']
            - ['VerifyTorEmulator2BfdStatusWhenTunnelBlocked']

            # step 5: unblock all the BFD session, check BFD recovers
            - ['UnblockTorGateway1BfdTunnelToPteps']
            - ['UnblockTorGateway2BfdTunnelToPteps']
            - ['VerifyGlobalBfdEnabled']
            - ['Verify2TorInstancesBfdEnabled']
            - ['VerifyTorEmulatorBfdStatusEnabled']

        ExitSequence:
            - ['RemoveFromPTEPCluster']
            - ['CleanupTORSimulator']

        SetupTORSimulator: *SETUP_TOR_SIMUATOR_2_GATEWAYS_NOT_SUPPORT_BFD
        CreateTOROnVSM: *CREATE_2_TOR_ON_VSM
        VerifyTORsNotConnected: *VERIFY_2_TOR_INSTANCES_NOT_CONNECTED
        VerifyTORsConnected: *VERIFY_2_TOR_INSTANCES_CONNECTED
        TORGatewaySetController: *TOR_GATEWAY_SET_CONTROLLER
        AddToPTEPCluster: *ADD_3_PTEPS_TO_CLUSTER
        VerifyGlobalBfdEnabled: *VERIFY_GLOBAL_BFD_ENABLED
        Verify2TorInstancesBfdEnabled: *VERIFY_2_TOR_INSTANCES_BFD_ENABLED
        VerifyTorEmulatorBfdStatusEnabled: *VERIFY_2_TOR_GATEWAYS_EMULATOR_BFD_STATUS_ENABLED
        VerifyTorEmulatorBfdStatusDisabled: *VERIFY_2_TOR_GATEWAYS_EMULATOR_BFD_STATUS_DISABLED
        VerifyTorEmulator1BfdStatusWhenTunnelBlocked: *VERIFY_TOR_GATEWAY_1_EMULATOR_BFD_STATUS_WHEN_TUNNEL_BLOCKED
        VerifyTorEmulator2BfdStatusWhenTunnelBlocked: *VERIFY_TOR_GATEWAY_2_EMULATOR_BFD_STATUS_WHEN_TUNNEL_BLOCKED
        BlockTorGateway1BfdTunnelToPteps: *BLOCK_TOR_GATEWAY_1_BFD_TUNNEL_TO_PTEPS
        BlockTorGateway2BfdTunnelToPteps: *BLOCK_TOR_GATEWAY_2_BFD_TUNNEL_TO_PTEPS
        UnblockTorGateway1BfdTunnelToPteps: *UNBLOCK_TOR_GATEWAY_1_BFD_TUNNEL_TO_PTEPS
        UnblockTorGateway2BfdTunnelToPteps: *UNBLOCK_TOR_GATEWAY_2_BFD_TUNNEL_TO_PTEPS
        RemoveFromPTEPCluster: *REMOVE_FROM_PTEP_CLUSTER
        CleanupTORSimulator: *CLEANUP_TOR_SIMUATOR_2_GATEWAYS

UnicastMtepModeSupport:
    <<: *TDS_COMMON_FIELDS_P1_CASE
    Component: "NSX Manager"
    TestName:  "UnicastMtepModeSupport"
    Developer: "mqing"
    TestbedSpec: *FUNCTIONAL_TOPOLOGY_2
    Summary: |
        verify TOR doesn’t support MTEP functionality, each TOR must be
        assigned a unique segment ID. The source hypervisor will replicate
        the packets to TORs directly.
    WORKLOADS:
        Sequence:
            # step 1: setup TOR simulators
            - ['SetupTORSimulator']
            - ['CreateTOROnVSM']
            - ['TORGatewaySetController']
            - ["VerifyTORsConnected"]

            # step 2: legacy virtualwires setup
            - ['CreateVirtualWires']
            - ['PlaceVMsOnVirtualWire1']
            - ['PoweronVM1','PoweronVM4','PoweronVM7','PoweronVM10']

            # step 3: configure TOR gateway related
            - ['AddToPTEPCluster']
            - ['CreateTORBinding']
            - ['CreateTORAttachmentToVirtualWire1']

            # step 4: TOR functions verification
            - ['VirtualWire1BroadcastTrafficWithTORAttachment']
            - ['VirtualWire1MulticastTrafficWithTORAttachment']
            - ['VirtualWire1UnknownUnicastTrafficWithTORAttachment']
            - ['VirtualWire1BroadcastTrafficWithTORAttachmentFromVM']
            - ['VirtualWire1MulticastTrafficWithTORAttachmentFromVM']
            - ['VirtualWire1UnknownUnicastTrafficWithTORAttachmentFromVM']

        ExitSequence:
            - ['DeleteVirtualWire1TORAttachment']
            - ["DeleteTOR"]
            - ["RemoveFromPTEPCluster"]

            - ['CleanupTORSimulator']
            - ['PoweroffVMs']
            - ['DeleteVM1Vnic1', 'DeleteVM4Vnic1', 'DeleteVM7Vnic1', 'DeleteVM10Vnic1']
            - ['DeleteAllVirtualWires']

        SetupTORSimulator: *SETUP_TOR_SIMUATOR_2_GATEWAYS
        TORGatewaySetController: *TOR_GATEWAY_SET_CONTROLLER
        VerifyTORsConnected: *VERIFY_2_TOR_INSTANCES_CONNECTED
        CreateVirtualWires: *CREATE_VIRTUALWIRES
        PlaceVMsOnVirtualWire1: *PLACE_VMS_ON_VIRTUAL_WIRE_1
        PoweronVM1: *POWER_ON_VM1
        PoweronVM4: *POWER_ON_VM4
        PoweronVM7: *POWER_ON_VM7
        PoweronVM10: *POWER_ON_VM10
        AddToPTEPCluster: *ADD_3_PTEPS_TO_CLUSTER
        CreateTOROnVSM: *CREATE_2_TOR_ON_VSM
        CreateTORBinding: *CREATE_4_TOR_BINDINGS
        CreateTORAttachmentToVirtualWire1: *CREATE_2_TOR_ATTACHMENTS_TO_VWIRE_1
        DeleteVirtualWire1TORAttachment: *DELETE_VWIRE1_2_TOR_ATTACHMENTS
        DeleteTOR: *DELETE_TOR_ON_VSM
        RemoveFromPTEPCluster: *REMOVE_FROM_PTEP_CLUSTER
        CleanupTORSimulator: *CLEANUP_TOR_SIMUATOR_2_GATEWAYS
        PoweroffVMs: *POWER_OFF_VMS
        DeleteVM1Vnic1: *DELETE_VM1_VNIC1
        DeleteVM4Vnic1: *DELETE_VM4_VNIC1
        DeleteVM7Vnic1: *DELETE_VM7_VNIC1
        DeleteVM10Vnic1: *DELETE_VM10_VNIC1
        DeleteAllVirtualWires: *DELETE_ALL_VIRTUALWIRES

        VirtualWire1BroadcastTrafficWithTORAttachment:
           Type:           "Traffic"
           toolname:       "ping"
           Routingscheme:  "broadcast"
           TestAdapter:    "torgateway.[1].pif.[3],
                            torgateway.[2].pif.[3]"
           SupportAdapter: "vm.[1].vnic.[1],vm.[4].vnic.[1],vm.[7].vnic.[1],vm.[10].vnic.[1]"
           TestDuration:   "30"

        VirtualWire1MulticastTrafficWithTORAttachment:
           Type:           "Traffic"
           RoutingScheme:  "Multicast"
           L3Protocol:     "ipv4"
           udpbandwidth:   *UDP_TRAFFIC_BANDWIDTH
           TestAdapter:    "torgateway.[1].pif.[3],
                            torgateway.[2].pif.[3]"
           SupportAdapter: "vm.[1].vnic.[1],vm.[4].vnic.[1],vm.[7].vnic.[1],vm.[10].vnic.[1]"
           TestDuration:   "60"

        VirtualWire1UnknownUnicastTrafficWithTORAttachment:
           Type: 'Traffic'
           toolName: 'scapy'
           TestAdapter:    "torgateway.[1].pif.[3],
                            torgateway.[2].pif.[3]"
           SupportAdapter: "vm.[1].vnic.[1],vm.[4].vnic.[1],vm.[7].vnic.[1],vm.[10].vnic.[1]"
           protocol: 'arp'
           DestinationAddress: '192.168.1.255'
           interval: *SCAPY_INTERVAL
           pktcount: 1
           connectivitytest: '0'

        VirtualWire1BroadcastTrafficWithTORAttachmentFromVM:
           Type:           "Traffic"
           toolname:       "ping"
           Routingscheme:  "broadcast"
           TestAdapter:    "vm.[1].vnic.[1],vm.[4].vnic.[1],vm.[7].vnic.[1],vm.[10].vnic.[1]"
           SupportAdapter: "torgateway.[1].pif.[3],
                            torgateway.[2].pif.[3]"
           TestDuration:   "30"

        VirtualWire1MulticastTrafficWithTORAttachmentFromVM:
           Type:           "Traffic"
           RoutingScheme:  "Multicast"
           L3Protocol:     "ipv4"
           udpbandwidth:   *UDP_TRAFFIC_BANDWIDTH
           TestAdapter:    "vm.[1].vnic.[1],vm.[4].vnic.[1],vm.[7].vnic.[1],vm.[10].vnic.[1]"
           SupportAdapter: "torgateway.[1].pif.[3],
                            torgateway.[2].pif.[3]"
           TestDuration:   "60"

        VirtualWire1UnknownUnicastTrafficWithTORAttachmentFromVM:
           Type:            'Traffic'
           toolName:        'scapy'
           TestAdapter:    "vm.[1].vnic.[1],vm.[4].vnic.[1],vm.[7].vnic.[1],vm.[10].vnic.[1]"
           SupportAdapter: "torgateway.[1].pif.[3],
                            torgateway.[2].pif.[3]"
           protocol:        'arp'
           DestinationAddress: '192.168.1.255'
           interval: *SCAPY_INTERVAL
           pktcount: 1
           connectivitytest: '0'

HybridMtepModeSupport:
    <<: *TDS_COMMON_FIELDS_P1_CASE
    Component: "NSX Manager"
    TestName:  "HybridMtepModeSupport"
    Developer: "mqing"
    TestbedSpec: *FUNCTIONAL_TOPOLOGY_2
    Summary: |
        TOR VTEP must be assigned a unique segment ID because 1) TOR
        doesn’t support MTEP functionality, and 2) TOR doesn’t join
        mcast group.
    WORKLOADS:
        Sequence:
            # step 1: setup TOR simulators
            - ['SetupTORSimulator']
            - ['CreateTOROnVSM']
            - ['TORGatewaySetController']
            - ["VerifyTORsConnected"]

            # step 2: legacy virtualwires setup
            - ['CreateVirtualWires']
            - ['PlaceVMsOnVirtualWire2']
            - ['PoweronVM2','PoweronVM5','PoweronVM8','PoweronVM11']

            # step 3: configure TOR gateway related
            - ['AddToPTEPCluster']
            - ['CreateTORBinding']
            - ['CreateTORAttachmentToVirtualWire2']

            # step 4: TOR functions verification
            - ['VirtualWire2BroadcastTrafficWithTORAttachment']
            - ['VirtualWire2MulticastTrafficWithTORAttachment']
            - ['VirtualWire2UnknownUnicastTrafficWithTORAttachment']
            - ['VirtualWire2BroadcastTrafficWithTORAttachmentFromVM']
            - ['VirtualWire2MulticastTrafficWithTORAttachmentFromVM']
            - ['VirtualWire2UnknownUnicastTrafficWithTORAttachmentFromVM']

        ExitSequence:
            - ['DeleteVirtualWire2TORAttachment']
            - ["DeleteTOR"]
            - ["RemoveFromPTEPCluster"]

            - ['CleanupTORSimulator']
            - ['PoweroffVMs']
            - ['DeleteVM2Vnic1', 'DeleteVM5Vnic1', 'DeleteVM8Vnic1', 'DeleteVM11Vnic1']
            - ['DeleteAllVirtualWires']

        SetupTORSimulator: *SETUP_TOR_SIMUATOR_2_GATEWAYS
        TORGatewaySetController: *TOR_GATEWAY_SET_CONTROLLER
        VerifyTORsConnected: *VERIFY_2_TOR_INSTANCES_CONNECTED
        CreateVirtualWires: *CREATE_VIRTUALWIRES
        PlaceVMsOnVirtualWire2: *PLACE_VMS_ON_VIRTUAL_WIRE_2
        PoweronVM2: *POWER_ON_VM2
        PoweronVM5: *POWER_ON_VM5
        PoweronVM8: *POWER_ON_VM8
        PoweronVM11: *POWER_ON_VM11
        AddToPTEPCluster: *ADD_3_PTEPS_TO_CLUSTER
        CreateTOROnVSM: *CREATE_2_TOR_ON_VSM
        CreateTORBinding: *CREATE_4_TOR_BINDINGS
        CreateTORAttachmentToVirtualWire2: *CREATE_2_TOR_ATTACHMENTS_TO_VWIRE_2
        DeleteVirtualWire2TORAttachment: *DELETE_VWIRE2_2_TOR_ATTACHMENTS
        DeleteTOR: *DELETE_TOR_ON_VSM
        RemoveFromPTEPCluster: *REMOVE_FROM_PTEP_CLUSTER
        CleanupTORSimulator: *CLEANUP_TOR_SIMUATOR_2_GATEWAYS
        PoweroffVMs: *POWER_OFF_VMS
        DeleteVM2Vnic1: *DELETE_VM2_VNIC1
        DeleteVM5Vnic1: *DELETE_VM5_VNIC1
        DeleteVM8Vnic1: *DELETE_VM8_VNIC1
        DeleteVM11Vnic1: *DELETE_VM11_VNIC1
        DeleteAllVirtualWires: *DELETE_ALL_VIRTUALWIRES

        VirtualWire2BroadcastTrafficWithTORAttachment:
           Type:           "Traffic"
           toolname:       "ping"
           Routingscheme:  "broadcast"
           TestAdapter:    "torgateway.[1].pif.[4],
                            torgateway.[2].pif.[4]"
           SupportAdapter: "vm.[2].vnic.[1],vm.[5].vnic.[1],vm.[8].vnic.[1],vm.[11].vnic.[1]"
           TestDuration:   "30"

        VirtualWire2MulticastTrafficWithTORAttachment:
           Type:           "Traffic"
           RoutingScheme:  "Multicast"
           L3Protocol:     "ipv4"
           udpbandwidth:   *UDP_TRAFFIC_BANDWIDTH
           TestAdapter:    "torgateway.[1].pif.[4],
                            torgateway.[2].pif.[4]"
           SupportAdapter: "vm.[2].vnic.[1],vm.[5].vnic.[1],vm.[8].vnic.[1],vm.[11].vnic.[1]"
           TestDuration:   "60"

        VirtualWire2UnknownUnicastTrafficWithTORAttachment:
           Type: 'Traffic'
           toolName: 'scapy'
           TestAdapter:     "torgateway.[1].pif.[4],
                             torgateway.[2].pif.[4]"
           SupportAdapter:  "vm.[2].vnic.[1]"
           protocol: 'arp'
           DestinationAddress: '192.168.1.255'
           interval: *SCAPY_INTERVAL
           pktcount: 1
           connectivitytest: '0'

        VirtualWire2BroadcastTrafficWithTORAttachmentFromVM:
           Type:           "Traffic"
           toolname:       "ping"
           Routingscheme:  "broadcast"
           TestAdapter:    "vm.[2].vnic.[1],vm.[5].vnic.[1],vm.[8].vnic.[1],vm.[11].vnic.[1]"
           SupportAdapter: "torgateway.[1].pif.[4],
                            torgateway.[2].pif.[4]"
           TestDuration:   "30"

        VirtualWire2MulticastTrafficWithTORAttachmentFromVM:
           Type:           "Traffic"
           RoutingScheme:  "Multicast"
           L3Protocol:     "ipv4"
           udpbandwidth:   *UDP_TRAFFIC_BANDWIDTH
           TestAdapter:    "vm.[2].vnic.[1],vm.[5].vnic.[1],vm.[8].vnic.[1],vm.[11].vnic.[1]"
           SupportAdapter: "torgateway.[1].pif.[4],
                            torgateway.[2].pif.[4]"
           TestDuration:   "60"

        VirtualWire2UnknownUnicastTrafficWithTORAttachmentFromVM:
           Type:            'Traffic'
           toolName:        'scapy'
           TestAdapter:     "vm.[2].vnic.[1]"
           SupportAdapter:  "torgateway.[1].pif.[4],
                             torgateway.[2].pif.[4]"
           protocol:        'arp'
           DestinationAddress: '192.168.1.255'
           interval: *SCAPY_INTERVAL
           pktcount: 1
           connectivitytest: '0'

TrafficRecoverAfterReconnect:
    <<: *TDS_COMMON_FIELDS_P1_CASE
    Component: "NSX Controller"
    TestName:  "TrafficRecoverAfterReconnect"
    Developer: "mqing"
    TestbedSpec: *FUNCTIONAL_TOPOLOGY_2
    Summary: |
        Verify current functionality recovers after ToR disconnects
        from ToR agent and then reconnects
    WORKLOADS:
        Sequence:
            # step 1: setup TOR simulators
            - ['SetupTORSimulator']
            - ['CreateTOROnVSM']
            - ['TORGatewaySetController']
            - ["VerifyTORsConnected"]

            # step 2: legacy virtualwires setup
            - ['CreateVirtualWires']
            - ['PlaceVMsOnVirtualWire1']
            - ['PlaceVMsOnVirtualWire2']
            - ['PoweronVM1','PoweronVM4','PoweronVM7','PoweronVM10']
            - ['PoweronVM2','PoweronVM5','PoweronVM8','PoweronVM11']

            # step 3: configure TOR gateway related
            - ['AddToPTEPCluster']
            - ['CreateTORBinding']
            - ['CreateTORAttachmentToVirtualWire1']
            - ['CreateTORAttachmentToVirtualWire2']

            # step 4: TOR functions verification
            - ['TrafficTestVirtualWire1FromTorToHosts']
            - ['TrafficTestVirtualWire2FromTorToHosts']
            - ['TrafficTestVirtualWire1FromVM']
            - ['TrafficTestVirtualWire2FromVM']

            # step 5: disconnect and reconnect TOR gateway
            - ['StopVtepSimulator1']
            - ['StopVtepSimulator2']
            - ['StartVtepSimulator1']
            - ['StartVtepSimulator2']

            # step 6: after recover, TOR functions verification
            - ['TrafficTestVirtualWire1FromTorToHosts']
            - ['TrafficTestVirtualWire2FromTorToHosts']
            - ['TrafficTestVirtualWire1FromVM']
            - ['TrafficTestVirtualWire2FromVM']

        ExitSequence:
            - ['DeleteVirtualWire1TORAttachment']
            - ['DeleteVirtualWire2TORAttachment']
            - ["DeleteTOR"]
            - ["RemoveFromPTEPCluster"]

            - ['CleanupTORSimulator']
            - ['PoweroffVMs']
            - ['DeleteVM1Vnic1', 'DeleteVM4Vnic1', 'DeleteVM7Vnic1', 'DeleteVM10Vnic1']
            - ['DeleteVM2Vnic1', 'DeleteVM5Vnic1', 'DeleteVM8Vnic1', 'DeleteVM11Vnic1']
            - ['DeleteAllVirtualWires']

        SetupTORSimulator: *SETUP_TOR_SIMUATOR_2_GATEWAYS
        TORGatewaySetController: *TOR_GATEWAY_SET_CONTROLLER
        VerifyTORsConnected: *VERIFY_2_TOR_INSTANCES_CONNECTED
        CreateVirtualWires: *CREATE_VIRTUALWIRES
        PlaceVMsOnVirtualWire1: *PLACE_VMS_ON_VIRTUAL_WIRE_1
        PlaceVMsOnVirtualWire2: *PLACE_VMS_ON_VIRTUAL_WIRE_2
        PlaceVMsOnVirtualWire3: *PLACE_VMS_ON_VIRTUAL_WIRE_3
        PoweronVM1: *POWER_ON_VM1
        PoweronVM2: *POWER_ON_VM2
        PoweronVM4: *POWER_ON_VM4
        PoweronVM5: *POWER_ON_VM5
        PoweronVM7: *POWER_ON_VM7
        PoweronVM8: *POWER_ON_VM8
        PoweronVM10: *POWER_ON_VM10
        PoweronVM11: *POWER_ON_VM11
        AddToPTEPCluster: *ADD_3_PTEPS_TO_CLUSTER
        CreateTOROnVSM: *CREATE_2_TOR_ON_VSM
        CreateTORBinding: *CREATE_4_TOR_BINDINGS
        CreateTORAttachmentToVirtualWire1: *CREATE_2_TOR_ATTACHMENTS_TO_VWIRE_1
        CreateTORAttachmentToVirtualWire2: *CREATE_2_TOR_ATTACHMENTS_TO_VWIRE_2
        StopVtepSimulator1: *STOP_VTEP_SIMULATOR_1
        StopVtepSimulator2: *STOP_VTEP_SIMULATOR_2
        StartVtepSimulator1: *START_VTEP_SIMULATOR_1
        StartVtepSimulator2: *START_VTEP_SIMULATOR_2
        DeleteVirtualWire1TORAttachment: *DELETE_VWIRE1_2_TOR_ATTACHMENTS
        DeleteVirtualWire2TORAttachment: *DELETE_VWIRE2_2_TOR_ATTACHMENTS
        DeleteTOR: *DELETE_TOR_ON_VSM
        RemoveFromPTEPCluster: *REMOVE_FROM_PTEP_CLUSTER
        CleanupTORSimulator: *CLEANUP_TOR_SIMUATOR_2_GATEWAYS
        PoweroffVMs: *POWER_OFF_VMS
        DeleteVM1Vnic1: *DELETE_VM1_VNIC1
        DeleteVM2Vnic1: *DELETE_VM2_VNIC1
        DeleteVM4Vnic1: *DELETE_VM4_VNIC1
        DeleteVM5Vnic1: *DELETE_VM5_VNIC1
        DeleteVM7Vnic1: *DELETE_VM7_VNIC1
        DeleteVM8Vnic1: *DELETE_VM8_VNIC1
        DeleteVM10Vnic1: *DELETE_VM10_VNIC1
        DeleteVM11Vnic1: *DELETE_VM11_VNIC1
        DeleteAllVirtualWires: *DELETE_ALL_VIRTUALWIRES

        TrafficTestVirtualWire1FromTorToHosts:
          Type:            "Traffic"
          toolName:        "ping"
          TestAdapter:     "torgateway.[1].pif.[3],
                            torgateway.[2].pif.[3]"
          SupportAdapter:  "vm.[1].vnic.[1],vm.[4].vnic.[1],vm.[7].vnic.[1],vm.[10].vnic.[1]"
          TestDuration:    "30"

        TrafficTestVirtualWire2FromTorToHosts:
          Type:            "Traffic"
          toolName:        "ping"
          TestAdapter:     "torgateway.[1].pif.[4],
                            torgateway.[2].pif.[4]"
          SupportAdapter: "vm.[2].vnic.[1],vm.[5].vnic.[1],vm.[8].vnic.[1],vm.[11].vnic.[1]"
          TestDuration:    "30"

        TrafficTestVirtualWire1FromVM:
          Type:            "Traffic"
          toolName:        "ping"
          TestAdapter:    "vm.[1].vnic.[1],vm.[4].vnic.[1],vm.[7].vnic.[1],vm.[10].vnic.[1]"
          SupportAdapter:  "torgateway.[1].pif.[3],
                            torgateway.[2].pif.[3]"
          TestDuration:    "30"

        TrafficTestVirtualWire2FromVM:
          Type:            "Traffic"
          toolName:        "ping"
          TestAdapter:    "vm.[2].vnic.[1],vm.[5].vnic.[1],vm.[8].vnic.[1],vm.[11].vnic.[1]"
          SupportAdapter:  "torgateway.[1].pif.[4],
                            torgateway.[2].pif.[4]"
          TestDuration:    "30"

ForceDeleteTorGateway:
    <<: *TDS_COMMON_FIELDS_P1_CASE
    Component: "NSX Manager"
    TestName:  "ForceDeleteTorGateway"
    Developer: "mqing"
    TestbedSpec: *FUNCTIONAL_TOPOLOGY_2
    Summary: |
        Verify that error is returned when we try to delete tor gateway that
        has tor bindings that are attached to virtual wire
    WORKLOADS:
        Sequence:
            # step 1: setup TOR simulators
            - ['SetupTORSimulator']
            - ['CreateTOROnVSM']
            - ['TORGatewaySetController']
            - ["VerifyTORsConnected"]

            # step 2: legacy virtualwires setup
            - ['CreateVirtualWires']
            - ['PlaceVMsOnVirtualWire1']
            - ['PlaceVMsOnVirtualWire2']
            - ['PoweronVM1','PoweronVM4','PoweronVM7','PoweronVM10']
            - ['PoweronVM2','PoweronVM5','PoweronVM8','PoweronVM11']

            # step 3: configure TOR gateway related
            - ['AddToPTEPCluster']
            - ['CreateTORBinding']
            - ['CreateTORAttachmentToVirtualWire1']
            - ['CreateTORAttachmentToVirtualWire2']

            # step 4: TOR functions verification
            - ['TrafficTestVirtualWire1FromTorToHosts']
            - ['TrafficTestVirtualWire2FromTorToHosts']

            # step 5: verify delete tor gateway that is used is not allowed
            - ["DeleteTORWhenUsed"]

        ExitSequence:
            - ['DeleteVirtualWire1TORAttachment']
            - ['DeleteVirtualWire2TORAttachment']
            - ["DeleteTOR"]
            - ["RemoveFromPTEPCluster"]

            - ['CleanupTORSimulator']
            - ['PoweroffVMs']
            - ['DeleteVM1Vnic1', 'DeleteVM4Vnic1', 'DeleteVM7Vnic1', 'DeleteVM10Vnic1']
            - ['DeleteVM2Vnic1', 'DeleteVM5Vnic1', 'DeleteVM8Vnic1', 'DeleteVM11Vnic1']
            - ['DeleteAllVirtualWires']

        SetupTORSimulator: *SETUP_TOR_SIMUATOR_2_GATEWAYS
        TORGatewaySetController: *TOR_GATEWAY_SET_CONTROLLER
        VerifyTORsConnected: *VERIFY_2_TOR_INSTANCES_CONNECTED
        CreateVirtualWires: *CREATE_VIRTUALWIRES
        PlaceVMsOnVirtualWire1: *PLACE_VMS_ON_VIRTUAL_WIRE_1
        PlaceVMsOnVirtualWire2: *PLACE_VMS_ON_VIRTUAL_WIRE_2
        PlaceVMsOnVirtualWire3: *PLACE_VMS_ON_VIRTUAL_WIRE_3
        PoweronVM1: *POWER_ON_VM1
        PoweronVM2: *POWER_ON_VM2
        PoweronVM4: *POWER_ON_VM4
        PoweronVM5: *POWER_ON_VM5
        PoweronVM7: *POWER_ON_VM7
        PoweronVM8: *POWER_ON_VM8
        PoweronVM10: *POWER_ON_VM10
        PoweronVM11: *POWER_ON_VM11
        AddToPTEPCluster: *ADD_3_PTEPS_TO_CLUSTER
        CreateTOROnVSM: *CREATE_2_TOR_ON_VSM
        CreateTORBinding: *CREATE_4_TOR_BINDINGS
        CreateTORAttachmentToVirtualWire1: *CREATE_2_TOR_ATTACHMENTS_TO_VWIRE_1
        CreateTORAttachmentToVirtualWire2: *CREATE_2_TOR_ATTACHMENTS_TO_VWIRE_2
        DeleteVirtualWire1TORAttachment: *DELETE_VWIRE1_2_TOR_ATTACHMENTS
        DeleteVirtualWire2TORAttachment: *DELETE_VWIRE2_2_TOR_ATTACHMENTS
        DeleteTOR: *DELETE_TOR_ON_VSM
        RemoveFromPTEPCluster: *REMOVE_FROM_PTEP_CLUSTER
        CleanupTORSimulator: *CLEANUP_TOR_SIMUATOR_2_GATEWAYS
        PoweroffVMs: *POWER_OFF_VMS
        DeleteVM1Vnic1: *DELETE_VM1_VNIC1
        DeleteVM2Vnic1: *DELETE_VM2_VNIC1
        DeleteVM4Vnic1: *DELETE_VM4_VNIC1
        DeleteVM5Vnic1: *DELETE_VM5_VNIC1
        DeleteVM7Vnic1: *DELETE_VM7_VNIC1
        DeleteVM8Vnic1: *DELETE_VM8_VNIC1
        DeleteVM10Vnic1: *DELETE_VM10_VNIC1
        DeleteVM11Vnic1: *DELETE_VM11_VNIC1
        DeleteAllVirtualWires: *DELETE_ALL_VIRTUALWIRES

        TrafficTestVirtualWire1FromTorToHosts:
          Type:            "Traffic"
          toolName:        "ping"
          TestAdapter:     "torgateway.[1].pif.[3],
                            torgateway.[2].pif.[3]"
          SupportAdapter:  "vm.[1].vnic.[1],vm.[4].vnic.[1],vm.[7].vnic.[1],vm.[10].vnic.[1]"
          TestDuration:    "30"

        TrafficTestVirtualWire2FromTorToHosts:
          Type:            "Traffic"
          toolName:        "ping"
          TestAdapter:     "torgateway.[1].pif.[4],
                            torgateway.[2].pif.[4]"
          SupportAdapter:  "vm.[2].vnic.[1],vm.[5].vnic.[1],vm.[8].vnic.[1],vm.[11].vnic.[1]"
          TestDuration:    "30"

        DeleteTORWhenUsed:
          Type: "NSX"
          TestNSX: "vsm.[1]"
          delete_tor: "vsm.[1].tor.[-1]"
          ExpectedResult: 'Fail'

BindingTorPortWithNoVlan:
    <<: *TDS_COMMON_FIELDS_P1_CASE
    Component: "NSX Manager"
    TestName:  "BindingTorPortWithNoVlan"
    Developer: "mqing"
    TestbedSpec: *FUNCTIONAL_TOPOLOGY_2
    Summary: |
        TOR switch add a TOR port without a vlan, but TOR binding with vlan,
        verify binding will success but traffic not works
    WORKLOADS:
        Sequence:
            # step 1: setup TOR simulators
            - ['SetupTORSimulatorWithPortsNoVLAN']
            - ['CreateTOROnVSM']
            - ['TORGatewaySetController']
            - ["VerifyTORsConnected"]

            # step 2: legacy virtualwires setup
            - ['CreateVirtualWires']
            - ['PlaceVMsOnVirtualWire1']
            - ['PlaceVMsOnVirtualWire2']
            - ['PoweronVM1','PoweronVM4','PoweronVM7','PoweronVM10']
            - ['PoweronVM2','PoweronVM5','PoweronVM8','PoweronVM11']

            # step 3: configure TOR gateway related
            - ['AddToPTEPCluster']
            - ['CreateTORBinding']
            - ['CreateTORAttachmentToVirtualWire1']
            - ['CreateTORAttachmentToVirtualWire2']

            # step 4: TOR functions verification, verify traffic fail
            - ['TrafficTestVirtualWire1FromTorToHostsFail']
            - ['TrafficTestVirtualWire2FromTorToHostsFail']

        ExitSequence:
            - ['DeleteVirtualWire1TORAttachment']
            - ['DeleteVirtualWire2TORAttachment']
            - ["DeleteTOR"]
            - ["RemoveFromPTEPCluster"]

            - ['CleanupTORSimulator']
            - ['PoweroffVMs']
            - ['DeleteVM1Vnic1', 'DeleteVM4Vnic1', 'DeleteVM7Vnic1', 'DeleteVM10Vnic1']
            - ['DeleteVM2Vnic1', 'DeleteVM5Vnic1', 'DeleteVM8Vnic1', 'DeleteVM11Vnic1']
            - ['DeleteAllVirtualWires']

        SetupTORSimulatorWithPortsNoVLAN: *SETUP_TOR_SIMUATOR_2_GATEWAYS_WITH_PORTS_NO_VLAN
        TORGatewaySetController: *TOR_GATEWAY_SET_CONTROLLER
        VerifyTORsConnected: *VERIFY_2_TOR_INSTANCES_CONNECTED
        CreateVirtualWires: *CREATE_VIRTUALWIRES
        PlaceVMsOnVirtualWire1: *PLACE_VMS_ON_VIRTUAL_WIRE_1
        PlaceVMsOnVirtualWire2: *PLACE_VMS_ON_VIRTUAL_WIRE_2
        PlaceVMsOnVirtualWire3: *PLACE_VMS_ON_VIRTUAL_WIRE_3
        PoweronVM1: *POWER_ON_VM1
        PoweronVM2: *POWER_ON_VM2
        PoweronVM4: *POWER_ON_VM4
        PoweronVM5: *POWER_ON_VM5
        PoweronVM7: *POWER_ON_VM7
        PoweronVM8: *POWER_ON_VM8
        PoweronVM10: *POWER_ON_VM10
        PoweronVM11: *POWER_ON_VM11
        AddToPTEPCluster: *ADD_3_PTEPS_TO_CLUSTER
        CreateTOROnVSM: *CREATE_2_TOR_ON_VSM
        CreateTORBinding: *CREATE_4_TOR_BINDINGS
        CreateTORAttachmentToVirtualWire1: *CREATE_2_TOR_ATTACHMENTS_TO_VWIRE_1
        CreateTORAttachmentToVirtualWire2: *CREATE_2_TOR_ATTACHMENTS_TO_VWIRE_2
        DeleteVirtualWire1TORAttachment: *DELETE_VWIRE1_2_TOR_ATTACHMENTS
        DeleteVirtualWire2TORAttachment: *DELETE_VWIRE2_2_TOR_ATTACHMENTS
        DeleteTOR: *DELETE_TOR_ON_VSM
        RemoveFromPTEPCluster: *REMOVE_FROM_PTEP_CLUSTER
        CleanupTORSimulator: *CLEANUP_TOR_SIMUATOR_2_GATEWAYS
        PoweroffVMs: *POWER_OFF_VMS
        DeleteVM1Vnic1: *DELETE_VM1_VNIC1
        DeleteVM2Vnic1: *DELETE_VM2_VNIC1
        DeleteVM4Vnic1: *DELETE_VM4_VNIC1
        DeleteVM5Vnic1: *DELETE_VM5_VNIC1
        DeleteVM7Vnic1: *DELETE_VM7_VNIC1
        DeleteVM8Vnic1: *DELETE_VM8_VNIC1
        DeleteVM10Vnic1: *DELETE_VM10_VNIC1
        DeleteVM11Vnic1: *DELETE_VM11_VNIC1
        DeleteAllVirtualWires: *DELETE_ALL_VIRTUALWIRES

        TrafficTestVirtualWire1FromTorToHostsFail:
          Type:            "Traffic"
          toolName:        "ping"
          TestAdapter:     "torgateway.[1].pif.[3],
                            torgateway.[2].pif.[3]"
          SupportAdapter:  "vm.[1].vnic.[1],vm.[4].vnic.[1],vm.[7].vnic.[1],vm.[10].vnic.[1]"
          TestDuration:    "30"
          ExpectedResult: 'Fail'

        TrafficTestVirtualWire2FromTorToHostsFail:
          Type:            "Traffic"
          toolName:        "ping"
          TestAdapter:     "torgateway.[1].pif.[4],
                            torgateway.[2].pif.[4]"
          SupportAdapter:  "vm.[2].vnic.[1],vm.[5].vnic.[1],vm.[8].vnic.[1],vm.[11].vnic.[1]"
          TestDuration:    "30"
          ExpectedResult: 'Fail'

BindingTorPortMismatchVlanBeforeConnect:
    <<: *TDS_COMMON_FIELDS_P1_CASE
    Component: "NSX Manager"
    TestName:  "BindingTorPortMismatchVlanBeforeConnect"
    Developer: "mqing"
    TestbedSpec: *FUNCTIONAL_TOPOLOGY_2
    Summary: |
        Before TOR gateway connected, TOR switch add a TOR port with vlan 10,
        but TOR binding with vlan 20 with the same port, verify binding
        will success but traffic not works
    WORKLOADS:
        Sequence:
            # step 1: setup TOR simulators
            - ['SetupTORSimulator']
            - ['CreateTOROnVSM']
            - ["VerifyTORsConnected"]

            # step 2: legacy virtualwires setup
            - ['CreateVirtualWires']
            - ['PlaceVMsOnVirtualWire1']
            - ['PlaceVMsOnVirtualWire2']
            - ['PoweronVM1','PoweronVM4','PoweronVM7','PoweronVM10']
            - ['PoweronVM2','PoweronVM5','PoweronVM8','PoweronVM11']

            # step 3: configure TOR gateway related
            - ['AddToPTEPCluster']
            - ['CreateTORBindingWithMismatchVLAN']
            - ['CreateTORAttachmentToVirtualWire1']
            - ['CreateTORAttachmentToVirtualWire2']

            # step 4: connect tor gateway
            - ['TORGatewaySetController']

            # step 5: TOR functions verification, verify traffic fail
            - ['TrafficTestVirtualWire1FromTorToHostsFail']
            - ['TrafficTestVirtualWire2FromTorToHostsFail']

        ExitSequence:
            - ['DeleteVirtualWire1TORAttachment']
            - ['DeleteVirtualWire2TORAttachment']
            - ["DeleteTOR"]
            - ["RemoveFromPTEPCluster"]

            - ['CleanupTORSimulator']
            - ['PoweroffVMs']
            - ['DeleteVM1Vnic1', 'DeleteVM4Vnic1', 'DeleteVM7Vnic1', 'DeleteVM10Vnic1']
            - ['DeleteVM2Vnic1', 'DeleteVM5Vnic1', 'DeleteVM8Vnic1', 'DeleteVM11Vnic1']
            - ['DeleteAllVirtualWires']

        SetupTORSimulator: *SETUP_TOR_SIMUATOR_2_GATEWAYS
        TORGatewaySetController: *TOR_GATEWAY_SET_CONTROLLER
        VerifyTORsConnected: *VERIFY_2_TOR_INSTANCES_CONNECTED
        CreateVirtualWires: *CREATE_VIRTUALWIRES
        PlaceVMsOnVirtualWire1: *PLACE_VMS_ON_VIRTUAL_WIRE_1
        PlaceVMsOnVirtualWire2: *PLACE_VMS_ON_VIRTUAL_WIRE_2
        PlaceVMsOnVirtualWire3: *PLACE_VMS_ON_VIRTUAL_WIRE_3
        PoweronVM1: *POWER_ON_VM1
        PoweronVM2: *POWER_ON_VM2
        PoweronVM4: *POWER_ON_VM4
        PoweronVM5: *POWER_ON_VM5
        PoweronVM7: *POWER_ON_VM7
        PoweronVM8: *POWER_ON_VM8
        PoweronVM10: *POWER_ON_VM10
        PoweronVM11: *POWER_ON_VM11
        AddToPTEPCluster: *ADD_3_PTEPS_TO_CLUSTER
        CreateTOROnVSM: *CREATE_2_TOR_ON_VSM
        CreateTORBindingWithMismatchVLAN: *CREATE_4_TOR_BINDINGS_WITH_MISMATCH_VLAN
        CreateTORAttachmentToVirtualWire1: *CREATE_2_TOR_ATTACHMENTS_TO_VWIRE_1
        CreateTORAttachmentToVirtualWire2: *CREATE_2_TOR_ATTACHMENTS_TO_VWIRE_2

        DeleteVirtualWire1TORAttachment: *DELETE_VWIRE1_2_TOR_ATTACHMENTS
        DeleteVirtualWire2TORAttachment: *DELETE_VWIRE2_2_TOR_ATTACHMENTS
        DeleteTOR: *DELETE_TOR_ON_VSM
        RemoveFromPTEPCluster: *REMOVE_FROM_PTEP_CLUSTER

        CleanupTORSimulator: *CLEANUP_TOR_SIMUATOR_2_GATEWAYS
        PoweroffVMs: *POWER_OFF_VMS
        DeleteVM1Vnic1: *DELETE_VM1_VNIC1
        DeleteVM2Vnic1: *DELETE_VM2_VNIC1
        DeleteVM4Vnic1: *DELETE_VM4_VNIC1
        DeleteVM5Vnic1: *DELETE_VM5_VNIC1
        DeleteVM7Vnic1: *DELETE_VM7_VNIC1
        DeleteVM8Vnic1: *DELETE_VM8_VNIC1
        DeleteVM10Vnic1: *DELETE_VM10_VNIC1
        DeleteVM11Vnic1: *DELETE_VM11_VNIC1
        DeleteAllVirtualWires: *DELETE_ALL_VIRTUALWIRES

        TrafficTestVirtualWire1FromTorToHostsFail:
          Type:            "Traffic"
          toolName:        "ping"
          TestAdapter:     "torgateway.[1].pif.[3],
                            torgateway.[2].pif.[3]"
          SupportAdapter:  "vm.[1].vnic.[1],vm.[4].vnic.[1],vm.[7].vnic.[1],vm.[10].vnic.[1]"
          TestDuration:    "30"
          ExpectedResult: 'Fail'

        TrafficTestVirtualWire2FromTorToHostsFail:
          Type:            "Traffic"
          toolName:        "ping"
          TestAdapter:     "torgateway.[1].pif.[4],
                            torgateway.[2].pif.[4]"
          SupportAdapter:  "vm.[2].vnic.[1],vm.[5].vnic.[1],vm.[8].vnic.[1],vm.[11].vnic.[1]"
          TestDuration:    "30"
          ExpectedResult: 'Fail'

BindingTorPortMismatchVlanAfterConnect:
    <<: *TDS_COMMON_FIELDS_P1_CASE
    Component: "NSX Manager"
    TestName:  "BindingTorPortMismatchVlanAfterConnect"
    Developer: "mqing"
    TestbedSpec: *FUNCTIONAL_TOPOLOGY_2
    Summary: |
        after TOR gateway connected, TOR switch add a TOR port with vlan 10,
        but TOR binding with vlan 20 with the same port, verify binding
        will success but traffic not works
    WORKLOADS:
        Sequence:
            # step 1: setup TOR simulators
            - ['SetupTORSimulator']
            - ['CreateTOROnVSM']
            - ["VerifyTORsConnected"]

            # step 2: legacy virtualwires setup
            - ['CreateVirtualWires']
            - ['PlaceVMsOnVirtualWire1']
            - ['PlaceVMsOnVirtualWire2']
            - ['PoweronVM1','PoweronVM4','PoweronVM7','PoweronVM10']
            - ['PoweronVM2','PoweronVM5','PoweronVM8','PoweronVM11']

            # step 3: connect tor gateway
            - ['TORGatewaySetController']

            # step 4: configure TOR gateway related
            - ['AddToPTEPCluster']
            - ['CreateTORBindingWithMismatchVLAN']
            - ['CreateTORAttachmentToVirtualWire1']
            - ['CreateTORAttachmentToVirtualWire2']

            # step 5: TOR functions verification, verify traffic fail
            - ['TrafficTestVirtualWire1FromTorToHostsFail']
            - ['TrafficTestVirtualWire2FromTorToHostsFail']

        ExitSequence:
            - ['DeleteVirtualWire1TORAttachment']
            - ['DeleteVirtualWire2TORAttachment']
            - ["DeleteTOR"]
            - ["RemoveFromPTEPCluster"]

            - ['CleanupTORSimulator']
            - ['PoweroffVMs']
            - ['DeleteVM1Vnic1', 'DeleteVM4Vnic1', 'DeleteVM7Vnic1', 'DeleteVM10Vnic1']
            - ['DeleteVM2Vnic1', 'DeleteVM5Vnic1', 'DeleteVM8Vnic1', 'DeleteVM11Vnic1']
            - ['DeleteAllVirtualWires']

        SetupTORSimulator: *SETUP_TOR_SIMUATOR_2_GATEWAYS
        TORGatewaySetController: *TOR_GATEWAY_SET_CONTROLLER
        VerifyTORsConnected: *VERIFY_2_TOR_INSTANCES_CONNECTED
        CreateVirtualWires: *CREATE_VIRTUALWIRES
        PlaceVMsOnVirtualWire1: *PLACE_VMS_ON_VIRTUAL_WIRE_1
        PlaceVMsOnVirtualWire2: *PLACE_VMS_ON_VIRTUAL_WIRE_2
        PlaceVMsOnVirtualWire3: *PLACE_VMS_ON_VIRTUAL_WIRE_3
        PoweronVM1: *POWER_ON_VM1
        PoweronVM2: *POWER_ON_VM2
        PoweronVM4: *POWER_ON_VM4
        PoweronVM5: *POWER_ON_VM5
        PoweronVM7: *POWER_ON_VM7
        PoweronVM8: *POWER_ON_VM8
        PoweronVM10: *POWER_ON_VM10
        PoweronVM11: *POWER_ON_VM11
        AddToPTEPCluster: *ADD_3_PTEPS_TO_CLUSTER
        CreateTOROnVSM: *CREATE_2_TOR_ON_VSM
        CreateTORBindingWithMismatchVLAN: *CREATE_4_TOR_BINDINGS_WITH_MISMATCH_VLAN
        CreateTORAttachmentToVirtualWire1: *CREATE_2_TOR_ATTACHMENTS_TO_VWIRE_1
        CreateTORAttachmentToVirtualWire2: *CREATE_2_TOR_ATTACHMENTS_TO_VWIRE_2

        DeleteVirtualWire1TORAttachment: *DELETE_VWIRE1_2_TOR_ATTACHMENTS
        DeleteVirtualWire2TORAttachment: *DELETE_VWIRE2_2_TOR_ATTACHMENTS
        DeleteTOR: *DELETE_TOR_ON_VSM
        RemoveFromPTEPCluster: *REMOVE_FROM_PTEP_CLUSTER

        CleanupTORSimulator: *CLEANUP_TOR_SIMUATOR_2_GATEWAYS
        PoweroffVMs: *POWER_OFF_VMS
        DeleteVM1Vnic1: *DELETE_VM1_VNIC1
        DeleteVM2Vnic1: *DELETE_VM2_VNIC1
        DeleteVM4Vnic1: *DELETE_VM4_VNIC1
        DeleteVM5Vnic1: *DELETE_VM5_VNIC1
        DeleteVM7Vnic1: *DELETE_VM7_VNIC1
        DeleteVM8Vnic1: *DELETE_VM8_VNIC1
        DeleteVM10Vnic1: *DELETE_VM10_VNIC1
        DeleteVM11Vnic1: *DELETE_VM11_VNIC1
        DeleteAllVirtualWires: *DELETE_ALL_VIRTUALWIRES

        TrafficTestVirtualWire1FromTorToHostsFail:
          Type:            "Traffic"
          toolName:        "ping"
          TestAdapter:     "torgateway.[1].pif.[3],
                            torgateway.[2].pif.[3]"
          SupportAdapter:  "vm.[1].vnic.[1],vm.[4].vnic.[1],vm.[7].vnic.[1],vm.[10].vnic.[1]"
          TestDuration:    "30"
          ExpectedResult: 'Fail'

        TrafficTestVirtualWire2FromTorToHostsFail:
          Type:            "Traffic"
          toolName:        "ping"
          TestAdapter:     "torgateway.[1].pif.[4],
                            torgateway.[2].pif.[4]"
          SupportAdapter:  "vm.[2].vnic.[1],vm.[5].vnic.[1],vm.[8].vnic.[1],vm.[11].vnic.[1]"
          TestDuration:    "30"
          ExpectedResult: 'Fail'

DeleteUsedTorBindings:
    <<: *TDS_COMMON_FIELDS_P1_CASE
    Component: "NSX Manager"
    TestName:  "DeleteUsedTorBindings"
    Developer: "mqing"
    TestbedSpec: *FUNCTIONAL_TOPOLOGY_2
    Summary: |
        Delete virtual wire that is attached to some TOR bindings,
        Check the delete operation will give errors.
    WORKLOADS:
        Sequence:
            # step 1: setup TOR simulators
            - ['SetupTORSimulator']
            - ['CreateTOROnVSM']
            - ['TORGatewaySetController']
            - ["VerifyTORsConnected"]

            # step 2: legacy virtualwires setup
            - ['CreateVirtualWires']
            - ['PlaceVMsOnVirtualWire1']
            - ['PlaceVMsOnVirtualWire2']
            - ['PoweronVM1','PoweronVM4','PoweronVM7','PoweronVM10']
            - ['PoweronVM2','PoweronVM5','PoweronVM8','PoweronVM11']

            # step 3: configure TOR gateway related
            - ['AddToPTEPCluster']
            - ['CreateTORBinding']
            - ['CreateTORAttachmentToVirtualWire1']
            - ['CreateTORAttachmentToVirtualWire2']

            # step 4: TOR functions verification
            - ['TrafficTestVirtualWire1FromTorToHosts']
            - ['TrafficTestVirtualWire2FromTorToHosts']

            # step 5: delete TOR bindings directly when used,
            # verify deletion will be failed
            - ['DeleteTORBindingFail']
        ExitSequence:
            - ['DeleteVirtualWire1TORAttachment']
            - ['DeleteVirtualWire2TORAttachment']
            - ["DeleteTOR"]
            - ["RemoveFromPTEPCluster"]

            - ['CleanupTORSimulator']
            - ['PoweroffVMs']
            - ['DeleteVM1Vnic1', 'DeleteVM4Vnic1', 'DeleteVM7Vnic1', 'DeleteVM10Vnic1']
            - ['DeleteVM2Vnic1', 'DeleteVM5Vnic1', 'DeleteVM8Vnic1', 'DeleteVM11Vnic1']
            - ['DeleteAllVirtualWires']

        SetupTORSimulator: *SETUP_TOR_SIMUATOR_2_GATEWAYS
        TORGatewaySetController: *TOR_GATEWAY_SET_CONTROLLER
        VerifyTORsConnected: *VERIFY_2_TOR_INSTANCES_CONNECTED
        CreateVirtualWires: *CREATE_VIRTUALWIRES
        PlaceVMsOnVirtualWire1: *PLACE_VMS_ON_VIRTUAL_WIRE_1
        PlaceVMsOnVirtualWire2: *PLACE_VMS_ON_VIRTUAL_WIRE_2
        PlaceVMsOnVirtualWire3: *PLACE_VMS_ON_VIRTUAL_WIRE_3
        PoweronVM1: *POWER_ON_VM1
        PoweronVM2: *POWER_ON_VM2
        PoweronVM4: *POWER_ON_VM4
        PoweronVM5: *POWER_ON_VM5
        PoweronVM7: *POWER_ON_VM7
        PoweronVM8: *POWER_ON_VM8
        PoweronVM10: *POWER_ON_VM10
        PoweronVM11: *POWER_ON_VM11
        AddToPTEPCluster: *ADD_3_PTEPS_TO_CLUSTER
        CreateTOROnVSM: *CREATE_2_TOR_ON_VSM
        CreateTORBinding: *CREATE_4_TOR_BINDINGS
        CreateTORAttachmentToVirtualWire1: *CREATE_2_TOR_ATTACHMENTS_TO_VWIRE_1
        CreateTORAttachmentToVirtualWire2: *CREATE_2_TOR_ATTACHMENTS_TO_VWIRE_2
        DeleteTORBindingFail: *DELETE_TOR_BINDINGS_FAIL
        DeleteVirtualWire1TORAttachment: *DELETE_VWIRE1_2_TOR_ATTACHMENTS
        DeleteVirtualWire2TORAttachment: *DELETE_VWIRE2_2_TOR_ATTACHMENTS
        DeleteTOR: *DELETE_TOR_ON_VSM
        RemoveFromPTEPCluster: *REMOVE_FROM_PTEP_CLUSTER
        CleanupTORSimulator: *CLEANUP_TOR_SIMUATOR_2_GATEWAYS
        PoweroffVMs: *POWER_OFF_VMS
        DeleteVM1Vnic1: *DELETE_VM1_VNIC1
        DeleteVM2Vnic1: *DELETE_VM2_VNIC1
        DeleteVM4Vnic1: *DELETE_VM4_VNIC1
        DeleteVM5Vnic1: *DELETE_VM5_VNIC1
        DeleteVM7Vnic1: *DELETE_VM7_VNIC1
        DeleteVM8Vnic1: *DELETE_VM8_VNIC1
        DeleteVM10Vnic1: *DELETE_VM10_VNIC1
        DeleteVM11Vnic1: *DELETE_VM11_VNIC1
        DeleteAllVirtualWires: *DELETE_ALL_VIRTUALWIRES

        TrafficTestVirtualWire1FromTorToHosts:
          Type:            "Traffic"
          toolName:        "ping"
          TestAdapter:     "torgateway.[1].pif.[3],
                            torgateway.[2].pif.[3]"
          SupportAdapter:  "vm.[1].vnic.[1],vm.[4].vnic.[1],vm.[7].vnic.[1],vm.[10].vnic.[1]"
          TestDuration:    "30"

        TrafficTestVirtualWire2FromTorToHosts:
          Type:            "Traffic"
          toolName:        "ping"
          TestAdapter:     "torgateway.[1].pif.[4],
                            torgateway.[2].pif.[4]"
          SupportAdapter:  "vm.[2].vnic.[1],vm.[5].vnic.[1],vm.[8].vnic.[1],vm.[11].vnic.[1]"
          TestDuration:    "30"

DeleteTorBindingOnTorDisconnect:
    <<: *TDS_COMMON_FIELDS_P1_CASE
    Component: "NSX Manager"
    TestName:  "DeleteTorBindingOnTorDisconnect"
    Developer: "mqing"
    TestbedSpec: *FUNCTIONAL_TOPOLOGY_2
    Summary: |
        after connectivity test between TOR hosts and VM, disconnect TOR gateway.
        delete tor binding when tor disconnected, after tor connected, verify
        TOR functionality
    WORKLOADS:
        Sequence:
            # step 1: setup TOR simulators
            - ['SetupTORSimulator']
            - ['CreateTOROnVSM']
            - ['TORGatewaySetController']
            - ["VerifyTORsConnected"]

            # step 2: legacy virtualwires setup
            - ['CreateVirtualWires']
            - ['PlaceVMsOnVirtualWire1']
            - ['PlaceVMsOnVirtualWire2']
            - ['PoweronVM1','PoweronVM4','PoweronVM7','PoweronVM10']
            - ['PoweronVM2','PoweronVM5','PoweronVM8','PoweronVM11']

            # step 3: configure TOR binding
            - ['AddToPTEPCluster']
            - ['CreateTORBinding']

            # step 4: disconnect tor simulator, and delete TOR binding
            - ['StopVtepSimulator1']
            - ['StopVtepSimulator2']
            - ['DeleteTORBinding']

            # step 5: reconnect tor simulator, and verify create attachment failed
            - ['StartVtepSimulator1']
            - ['StartVtepSimulator2']
            - ['CreateTORAttachmentToVirtualWire1Fail']
            - ['CreateTORAttachmentToVirtualWire2Fail']

            # step 6: reconfigure TOR gateway related
            - ['CreateTORBinding']
            - ['CreateTORAttachmentToVirtualWire1']
            - ['CreateTORAttachmentToVirtualWire2']

            # step 7: TOR functions verification
            - ['TrafficTestVirtualWire1FromTorToHosts']
            - ['TrafficTestVirtualWire2FromTorToHosts']

        ExitSequence:
            - ['DeleteVirtualWire1TORAttachment']
            - ['DeleteVirtualWire2TORAttachment']
            - ["DeleteTOR"]
            - ["RemoveFromPTEPCluster"]

            - ['CleanupTORSimulator']
            - ['PoweroffVMs']
            - ['DeleteVM1Vnic1', 'DeleteVM4Vnic1', 'DeleteVM7Vnic1', 'DeleteVM10Vnic1']
            - ['DeleteVM2Vnic1', 'DeleteVM5Vnic1', 'DeleteVM8Vnic1', 'DeleteVM11Vnic1']
            - ['DeleteAllVirtualWires']

        SetupTORSimulator: *SETUP_TOR_SIMUATOR_2_GATEWAYS
        TORGatewaySetController: *TOR_GATEWAY_SET_CONTROLLER
        VerifyTORsConnected: *VERIFY_2_TOR_INSTANCES_CONNECTED
        CreateVirtualWires: *CREATE_VIRTUALWIRES
        PlaceVMsOnVirtualWire1: *PLACE_VMS_ON_VIRTUAL_WIRE_1
        PlaceVMsOnVirtualWire2: *PLACE_VMS_ON_VIRTUAL_WIRE_2
        PlaceVMsOnVirtualWire3: *PLACE_VMS_ON_VIRTUAL_WIRE_3
        PoweronVM1: *POWER_ON_VM1
        PoweronVM2: *POWER_ON_VM2
        PoweronVM4: *POWER_ON_VM4
        PoweronVM5: *POWER_ON_VM5
        PoweronVM7: *POWER_ON_VM7
        PoweronVM8: *POWER_ON_VM8
        PoweronVM10: *POWER_ON_VM10
        PoweronVM11: *POWER_ON_VM11
        AddToPTEPCluster: *ADD_3_PTEPS_TO_CLUSTER
        CreateTOROnVSM: *CREATE_2_TOR_ON_VSM
        CreateTORBinding: *CREATE_4_TOR_BINDINGS
        CreateTORAttachmentToVirtualWire1: *CREATE_2_TOR_ATTACHMENTS_TO_VWIRE_1
        CreateTORAttachmentToVirtualWire2: *CREATE_2_TOR_ATTACHMENTS_TO_VWIRE_2
        CreateTORAttachmentToVirtualWire1Fail: *CREATE_2_TOR_ATTACHMENTS_TO_VWIRE_1_FAIL
        CreateTORAttachmentToVirtualWire2Fail: *CREATE_2_TOR_ATTACHMENTS_TO_VWIRE_2_FAIL
        DeleteTORBinding: *DELETE_TOR_BINDINGS
        DeleteTORBindingFail: *DELETE_TOR_BINDINGS_FAIL
        StopVtepSimulator1: *STOP_VTEP_SIMULATOR_1
        StopVtepSimulator2: *STOP_VTEP_SIMULATOR_2
        StartVtepSimulator1: *START_VTEP_SIMULATOR_1
        StartVtepSimulator2: *START_VTEP_SIMULATOR_2
        DeleteVirtualWire1TORAttachment: *DELETE_VWIRE1_2_TOR_ATTACHMENTS
        DeleteVirtualWire2TORAttachment: *DELETE_VWIRE2_2_TOR_ATTACHMENTS
        DeleteTOR: *DELETE_TOR_ON_VSM
        RemoveFromPTEPCluster: *REMOVE_FROM_PTEP_CLUSTER
        CleanupTORSimulator: *CLEANUP_TOR_SIMUATOR_2_GATEWAYS
        PoweroffVMs: *POWER_OFF_VMS
        DeleteVM1Vnic1: *DELETE_VM1_VNIC1
        DeleteVM2Vnic1: *DELETE_VM2_VNIC1
        DeleteVM4Vnic1: *DELETE_VM4_VNIC1
        DeleteVM5Vnic1: *DELETE_VM5_VNIC1
        DeleteVM7Vnic1: *DELETE_VM7_VNIC1
        DeleteVM8Vnic1: *DELETE_VM8_VNIC1
        DeleteVM10Vnic1: *DELETE_VM10_VNIC1
        DeleteVM11Vnic1: *DELETE_VM11_VNIC1
        DeleteAllVirtualWires: *DELETE_ALL_VIRTUALWIRES

        TrafficTestVirtualWire1FromTorToHosts:
          Type:            "Traffic"
          toolName:        "ping"
          TestAdapter:     "torgateway.[1].pif.[3],
                            torgateway.[2].pif.[3]"
          SupportAdapter:  "vm.[1].vnic.[1],vm.[4].vnic.[1],vm.[7].vnic.[1]"
          TestDuration:    "30"

        TrafficTestVirtualWire2FromTorToHosts:
          Type:            "Traffic"
          toolName:        "ping"
          TestAdapter:     "torgateway.[1].pif.[4],
                            torgateway.[2].pif.[4]"
          SupportAdapter:  "vm.[2].vnic.[1],vm.[5].vnic.[1],vm.[8].vnic.[1]"
          TestDuration:    "30"

ValidateTorStats:
    <<: *TDS_COMMON_FIELDS_P1_CASE
    Component: "NSX Manager"
    TestName:  "ValidateTorStats"
    Developer: "mqing"
    TestbedSpec: *FUNCTIONAL_TOPOLOGY_2
    Summary: |
        Display stats of ports on ToRs bounds to logical switches
    WORKLOADS:
        Sequence:
            # step 1: setup TOR simulators
            - ['SetupTORSimulator']
            - ['CreateTOROnVSM']
            - ['TORGatewaySetController']
            - ["VerifyTORsConnected"]

            # step 2: legacy virtualwires setup
            - ['CreateVirtualWires']
            - ['PlaceVMsOnVirtualWire1']
            - ['PlaceVMsOnVirtualWire2']
            - ['PoweronVM1','PoweronVM4','PoweronVM7','PoweronVM10']
            - ['PoweronVM2','PoweronVM5','PoweronVM8','PoweronVM11']

            # step 3: configure TOR gateway related
            - ['AddToPTEPCluster']
            - ['CreateTORBinding']
            - ['CreateTORAttachmentToVirtualWire1']
            - ['CreateTORAttachmentToVirtualWire2']

            # step 4: TOR functions verification
            - ['TrafficTestVirtualWire1FromTorToHosts']
            - ['TrafficTestVirtualWire2FromTorToHosts']

            # step 5: verify TOR stats info
            - ['VerifyTORSwitches']
            - ['VerifyTORSwitchPortNames']

        ExitSequence:
            - ['DeleteVirtualWire1TORAttachment']
            - ['DeleteVirtualWire2TORAttachment']
            - ["DeleteTOR"]
            - ["RemoveFromPTEPCluster"]

            - ['CleanupTORSimulator']
            - ['PoweroffVMs']
            - ['DeleteVM1Vnic1', 'DeleteVM4Vnic1', 'DeleteVM7Vnic1', 'DeleteVM10Vnic1']
            - ['DeleteVM2Vnic1', 'DeleteVM5Vnic1', 'DeleteVM8Vnic1', 'DeleteVM11Vnic1']
            - ['DeleteAllVirtualWires']

        SetupTORSimulator: *SETUP_TOR_SIMUATOR_2_GATEWAYS
        TORGatewaySetController: *TOR_GATEWAY_SET_CONTROLLER
        VerifyTORsConnected: *VERIFY_2_TOR_INSTANCES_CONNECTED
        CreateVirtualWires: *CREATE_VIRTUALWIRES
        PlaceVMsOnVirtualWire1: *PLACE_VMS_ON_VIRTUAL_WIRE_1
        PlaceVMsOnVirtualWire2: *PLACE_VMS_ON_VIRTUAL_WIRE_2
        PlaceVMsOnVirtualWire3: *PLACE_VMS_ON_VIRTUAL_WIRE_3
        PoweronVM1: *POWER_ON_VM1
        PoweronVM2: *POWER_ON_VM2
        PoweronVM4: *POWER_ON_VM4
        PoweronVM5: *POWER_ON_VM5
        PoweronVM7: *POWER_ON_VM7
        PoweronVM8: *POWER_ON_VM8
        PoweronVM10: *POWER_ON_VM10
        PoweronVM11: *POWER_ON_VM11
        AddToPTEPCluster: *ADD_3_PTEPS_TO_CLUSTER
        CreateTOROnVSM: *CREATE_2_TOR_ON_VSM
        CreateTORBinding: *CREATE_4_TOR_BINDINGS
        CreateTORAttachmentToVirtualWire1: *CREATE_2_TOR_ATTACHMENTS_TO_VWIRE_1
        CreateTORAttachmentToVirtualWire2: *CREATE_2_TOR_ATTACHMENTS_TO_VWIRE_2
        VerifyTORSwitches: *VERIFY_2_TOR_SWITCHNAMES
        VerifyTORSwitchPortNames: *VERIFY_2_TOR_4_SWITCH_PORTNAMES
        DeleteVirtualWire1TORAttachment: *DELETE_VWIRE1_2_TOR_ATTACHMENTS
        DeleteVirtualWire2TORAttachment: *DELETE_VWIRE2_2_TOR_ATTACHMENTS
        DeleteTOR: *DELETE_TOR_ON_VSM
        RemoveFromPTEPCluster: *REMOVE_FROM_PTEP_CLUSTER
        CleanupTORSimulator: *CLEANUP_TOR_SIMUATOR_2_GATEWAYS
        PoweroffVMs: *POWER_OFF_VMS
        DeleteVM1Vnic1: *DELETE_VM1_VNIC1
        DeleteVM2Vnic1: *DELETE_VM2_VNIC1
        DeleteVM4Vnic1: *DELETE_VM4_VNIC1
        DeleteVM5Vnic1: *DELETE_VM5_VNIC1
        DeleteVM7Vnic1: *DELETE_VM7_VNIC1
        DeleteVM8Vnic1: *DELETE_VM8_VNIC1
        DeleteVM10Vnic1: *DELETE_VM10_VNIC1
        DeleteVM11Vnic1: *DELETE_VM11_VNIC1
        DeleteAllVirtualWires: *DELETE_ALL_VIRTUALWIRES

        TrafficTestVirtualWire1FromTorToHosts:
          Type:            "Traffic"
          toolName:        "ping"
          TestAdapter:     "torgateway.[1].pif.[3],
                            torgateway.[2].pif.[3]"
          SupportAdapter:  "vm.[1].vnic.[1],vm.[4].vnic.[1],vm.[7].vnic.[1]"
          TestDuration:    "30"

        TrafficTestVirtualWire2FromTorToHosts:
          Type:            "Traffic"
          toolName:        "ping"
          TestAdapter:     "torgateway.[1].pif.[4],
                            torgateway.[2].pif.[4]"
          SupportAdapter:  "vm.[2].vnic.[1],vm.[5].vnic.[1],vm.[8].vnic.[1]"
          TestDuration:    "30"

AttachmentBeforeTorConnected:
    <<: *TDS_COMMON_FIELDS_P1_CASE
    Component: "NSX Manager"
    TestName:  "AttachmentBeforeTorConnected"
    Developer: "mqing"
    TestbedSpec: *FUNCTIONAL_TOPOLOGY_2
    Summary: |
        before TOR gateway connected, attach a TOR gateway to a virtual wire,
        after TOR gateway connected, verify TOR attachment function works
        correctly
    WORKLOADS:
        Sequence:
            # step 1: setup TOR simulators
            - ['SetupTORSimulator']
            - ['CreateTOROnVSM']

            # step 2: legacy virtualwires setup
            - ['CreateVirtualWires']
            - ['PlaceVMsOnVirtualWire1']
            - ['PlaceVMsOnVirtualWire2']
            - ['PoweronVM1','PoweronVM4','PoweronVM7','PoweronVM10']
            - ['PoweronVM2','PoweronVM5','PoweronVM8','PoweronVM11']

            # step 3: configure TOR gateway related
            - ['AddToPTEPCluster']
            - ['CreateTORBinding']
            - ['CreateTORAttachmentToVirtualWire1']
            - ['CreateTORAttachmentToVirtualWire2']

            # step 4: connect TOR gateway with TOR agent
            - ['TORGatewaySetController']
            - ["VerifyTORsConnected"]

            # step 5: TOR functions verification
            - ['TrafficTestVirtualWire1FromTorToHosts']
            - ['TrafficTestVirtualWire2FromTorToHosts']

        ExitSequence:
            - ['DeleteVirtualWire1TORAttachment']
            - ['DeleteVirtualWire2TORAttachment']
            - ["DeleteTOR"]
            - ["RemoveFromPTEPCluster"]

            - ['CleanupTORSimulator']
            - ['PoweroffVMs']
            - ['DeleteVM1Vnic1', 'DeleteVM4Vnic1', 'DeleteVM7Vnic1', 'DeleteVM10Vnic1']
            - ['DeleteVM2Vnic1', 'DeleteVM5Vnic1', 'DeleteVM8Vnic1', 'DeleteVM11Vnic1']
            - ['DeleteAllVirtualWires']

        SetupTORSimulator: *SETUP_TOR_SIMUATOR_2_GATEWAYS
        TORGatewaySetController: *TOR_GATEWAY_SET_CONTROLLER
        VerifyTORsConnected: *VERIFY_2_TOR_INSTANCES_CONNECTED
        CreateVirtualWires: *CREATE_VIRTUALWIRES
        PlaceVMsOnVirtualWire1: *PLACE_VMS_ON_VIRTUAL_WIRE_1
        PlaceVMsOnVirtualWire2: *PLACE_VMS_ON_VIRTUAL_WIRE_2
        PlaceVMsOnVirtualWire3: *PLACE_VMS_ON_VIRTUAL_WIRE_3
        PoweronVM1: *POWER_ON_VM1
        PoweronVM2: *POWER_ON_VM2
        PoweronVM4: *POWER_ON_VM4
        PoweronVM5: *POWER_ON_VM5
        PoweronVM7: *POWER_ON_VM7
        PoweronVM8: *POWER_ON_VM8
        PoweronVM10: *POWER_ON_VM10
        PoweronVM11: *POWER_ON_VM11
        AddToPTEPCluster: *ADD_3_PTEPS_TO_CLUSTER
        CreateTOROnVSM: *CREATE_2_TOR_ON_VSM
        CreateTORBinding: *CREATE_4_TOR_BINDINGS
        CreateTORAttachmentToVirtualWire1: *CREATE_2_TOR_ATTACHMENTS_TO_VWIRE_1
        CreateTORAttachmentToVirtualWire2: *CREATE_2_TOR_ATTACHMENTS_TO_VWIRE_2
        DeleteVirtualWire1TORAttachment: *DELETE_VWIRE1_2_TOR_ATTACHMENTS
        DeleteVirtualWire2TORAttachment: *DELETE_VWIRE2_2_TOR_ATTACHMENTS
        DeleteTOR: *DELETE_TOR_ON_VSM
        RemoveFromPTEPCluster: *REMOVE_FROM_PTEP_CLUSTER
        CleanupTORSimulator: *CLEANUP_TOR_SIMUATOR_2_GATEWAYS
        PoweroffVMs: *POWER_OFF_VMS
        DeleteVM1Vnic1: *DELETE_VM1_VNIC1
        DeleteVM2Vnic1: *DELETE_VM2_VNIC1
        DeleteVM4Vnic1: *DELETE_VM4_VNIC1
        DeleteVM5Vnic1: *DELETE_VM5_VNIC1
        DeleteVM7Vnic1: *DELETE_VM7_VNIC1
        DeleteVM8Vnic1: *DELETE_VM8_VNIC1
        DeleteVM10Vnic1: *DELETE_VM10_VNIC1
        DeleteVM11Vnic1: *DELETE_VM11_VNIC1
        DeleteAllVirtualWires: *DELETE_ALL_VIRTUALWIRES

        TrafficTestVirtualWire1FromTorToHosts:
          Type:            "Traffic"
          toolName:        "ping"
          TestAdapter:     "torgateway.[1].pif.[3],
                            torgateway.[2].pif.[3]"
          SupportAdapter:  "vm.[1].vnic.[1],vm.[4].vnic.[1],vm.[7].vnic.[1]"
          TestDuration:    "30"

        TrafficTestVirtualWire2FromTorToHosts:
          Type:            "Traffic"
          toolName:        "ping"
          TestAdapter:     "torgateway.[1].pif.[4],
                            torgateway.[2].pif.[4]"
          SupportAdapter:  "vm.[2].vnic.[1],vm.[5].vnic.[1],vm.[8].vnic.[1]"
          TestDuration:    "30"

DetachmentOnTorDisconnect:
    <<: *TDS_COMMON_FIELDS_P1_CASE
    Component: "NSX Manager"
    TestName:  "DetachmentOnTorDisconnect"
    Developer: "mqing"
    TestbedSpec: *FUNCTIONAL_TOPOLOGY_2
    Summary: |
        after TOR gateway disconnected, detach a TOR gateway to a virtualwire,
        after TOR gateway reconnected, verify TOR detachment function works correctly.
    WORKLOADS:
        Sequence:
            # step 1: setup TOR simulators
            - ['SetupTORSimulator']
            - ['CreateTOROnVSM']
            - ['TORGatewaySetController']
            - ["VerifyTORsConnected"]

            # step 2: legacy virtualwires setup
            - ['CreateVirtualWires']
            - ['PlaceVMsOnVirtualWire1']
            - ['PlaceVMsOnVirtualWire2']
            - ['PoweronVM1','PoweronVM4','PoweronVM7','PoweronVM10']
            - ['PoweronVM2','PoweronVM5','PoweronVM8','PoweronVM11']

            # step 3: configure TOR gateway related
            - ['AddToPTEPCluster']
            - ['CreateTORBinding']
            - ['CreateTORAttachmentToVirtualWire1']
            - ['CreateTORAttachmentToVirtualWire2']

            # step 4: TOR functions verification
            - ['TrafficTestVirtualWire1FromTorToHosts']
            - ['TrafficTestVirtualWire2FromTorToHosts']

            # step 5: disconnect tor simulator
            - ['StopVtepSimulator1']
            - ['StopVtepSimulator2']

            # step 6: detach TOR gateway from virtual wires
            - ['DeleteVirtualWire1TORAttachment']
            - ['DeleteVirtualWire2TORAttachment']

            # step 7: reconnect tor simulator
            - ['StartVtepSimulator1']
            - ['StartVtepSimulator2']

            # step 8: TOR functions verification fail
            - ['TrafficTestVirtualWire1FromTorToHostsFail']
            - ['TrafficTestVirtualWire2FromTorToHostsFail']

            # step 9: reconfigure TOR gateway related
            - ['CreateTORBinding']
            - ['CreateTORAttachmentToVirtualWire1']
            - ['CreateTORAttachmentToVirtualWire2']

            # step 10: TOR functions verification
            - ['TrafficTestVirtualWire1FromTorToHosts']
            - ['TrafficTestVirtualWire2FromTorToHosts']

        ExitSequence:
            - ['DeleteVirtualWire1TORAttachment']
            - ['DeleteVirtualWire2TORAttachment']
            - ["DeleteTOR"]
            - ["RemoveFromPTEPCluster"]

            - ['CleanupTORSimulator']
            - ['PoweroffVMs']
            - ['DeleteVM1Vnic1', 'DeleteVM4Vnic1', 'DeleteVM7Vnic1', 'DeleteVM10Vnic1']
            - ['DeleteVM2Vnic1', 'DeleteVM5Vnic1', 'DeleteVM8Vnic1', 'DeleteVM11Vnic1']
            - ['DeleteAllVirtualWires']

        SetupTORSimulator: *SETUP_TOR_SIMUATOR_2_GATEWAYS
        TORGatewaySetController: *TOR_GATEWAY_SET_CONTROLLER
        VerifyTORsConnected: *VERIFY_2_TOR_INSTANCES_CONNECTED
        CreateVirtualWires: *CREATE_VIRTUALWIRES
        PlaceVMsOnVirtualWire1: *PLACE_VMS_ON_VIRTUAL_WIRE_1
        PlaceVMsOnVirtualWire2: *PLACE_VMS_ON_VIRTUAL_WIRE_2
        PlaceVMsOnVirtualWire3: *PLACE_VMS_ON_VIRTUAL_WIRE_3
        PoweronVM1: *POWER_ON_VM1
        PoweronVM2: *POWER_ON_VM2
        PoweronVM4: *POWER_ON_VM4
        PoweronVM5: *POWER_ON_VM5
        PoweronVM7: *POWER_ON_VM7
        PoweronVM8: *POWER_ON_VM8
        PoweronVM10: *POWER_ON_VM10
        PoweronVM11: *POWER_ON_VM11
        AddToPTEPCluster: *ADD_3_PTEPS_TO_CLUSTER
        CreateTOROnVSM: *CREATE_2_TOR_ON_VSM
        CreateTORBinding: *CREATE_4_TOR_BINDINGS
        CreateTORAttachmentToVirtualWire1: *CREATE_2_TOR_ATTACHMENTS_TO_VWIRE_1
        CreateTORAttachmentToVirtualWire2: *CREATE_2_TOR_ATTACHMENTS_TO_VWIRE_2
        DeleteTORBindingFail: *DELETE_TOR_BINDINGS_FAIL
        StopVtepSimulator1: *STOP_VTEP_SIMULATOR_1
        StopVtepSimulator2: *STOP_VTEP_SIMULATOR_2
        StartVtepSimulator1: *START_VTEP_SIMULATOR_1
        StartVtepSimulator2: *START_VTEP_SIMULATOR_2
        DeleteVirtualWire1TORAttachment: *DELETE_VWIRE1_2_TOR_ATTACHMENTS
        DeleteVirtualWire2TORAttachment: *DELETE_VWIRE2_2_TOR_ATTACHMENTS
        DeleteTOR: *DELETE_TOR_ON_VSM
        RemoveFromPTEPCluster: *REMOVE_FROM_PTEP_CLUSTER
        CleanupTORSimulator: *CLEANUP_TOR_SIMUATOR_2_GATEWAYS
        PoweroffVMs: *POWER_OFF_VMS
        DeleteVM1Vnic1: *DELETE_VM1_VNIC1
        DeleteVM2Vnic1: *DELETE_VM2_VNIC1
        DeleteVM4Vnic1: *DELETE_VM4_VNIC1
        DeleteVM5Vnic1: *DELETE_VM5_VNIC1
        DeleteVM7Vnic1: *DELETE_VM7_VNIC1
        DeleteVM8Vnic1: *DELETE_VM8_VNIC1
        DeleteVM10Vnic1: *DELETE_VM10_VNIC1
        DeleteVM11Vnic1: *DELETE_VM11_VNIC1
        DeleteAllVirtualWires: *DELETE_ALL_VIRTUALWIRES

        TrafficTestVirtualWire1FromTorToHosts:
          Type:            "Traffic"
          toolName:        "ping"
          TestAdapter:     "torgateway.[1].pif.[3],
                            torgateway.[2].pif.[3]"
          SupportAdapter:  "vm.[1].vnic.[1],vm.[4].vnic.[1],vm.[7].vnic.[1]"
          TestDuration:    "30"

        TrafficTestVirtualWire2FromTorToHosts:
          Type:            "Traffic"
          toolName:        "ping"
          TestAdapter:     "torgateway.[1].pif.[4],
                            torgateway.[2].pif.[4]"
          SupportAdapter:  "vm.[2].vnic.[1],vm.[5].vnic.[1],vm.[8].vnic.[1]"
          TestDuration:    "30"

        TrafficTestVirtualWire1FromTorToHostsFail:
          Type:            "Traffic"
          toolName:        "ping"
          TestAdapter:     "torgateway.[1].pif.[3],
                            torgateway.[2].pif.[3]"
          SupportAdapter:  "vm.[1].vnic.[1],vm.[4].vnic.[1],vm.[7].vnic.[1]"
          TestDuration:    "30"
          ExpectedResult:  'Fail'

        TrafficTestVirtualWire2FromTorToHostsFail:
          Type:            "Traffic"
          toolName:        "ping"
          TestAdapter:     "torgateway.[1].pif.[4],
                            torgateway.[2].pif.[4]"
          SupportAdapter:  "vm.[2].vnic.[1],vm.[5].vnic.[1],vm.[8].vnic.[1]"
          TestDuration:    "30"
          ExpectedResult:  'Fail'

PtepLoadBalancingAndPrimaryDownUp:
    <<: *TDS_COMMON_FIELDS_P1_CASE
    Component: "PTEP"
    TestName:  "PtepLoadBalancingAndPrimaryDownUp"
    Developer: "mqing"
    TestbedSpec: *FUNCTIONAL_TOPOLOGY_2
    Summary: |
        PtepLoadBalancing: Verify different TOR gateway may choose different
                           PTEP for BUM traffic
        PtepPrimaryDown: Shut down the primary PTEP for one TOR gateway,
                         verify this TOR gateway will choose another PTEP as
                         the new primary PTEP
        PtepPrimaryRestart: Restart the primary PTEP for one TOR gateway,
                            verify after this PTEP recovery,functionality still
                            works.
    WORKLOADS:
        Sequence:
            # step 1: setup TOR simulators
            - ['SetupTORSimulator']
            - ['CreateTOROnVSM']
            - ['TORGatewaySetController']
            - ["VerifyTORsConnected"]

            # step 2: legacy virtualwires setup
            - ['CreateVirtualWires']
            - ['PlaceVMsOnVirtualWire1']
            - ['PlaceVMsOnVirtualWire2']
            - ['PoweronVM1','PoweronVM4','PoweronVM7','PoweronVM10']
            - ['PoweronVM2','PoweronVM5','PoweronVM8','PoweronVM11']

            # step 3: configure TOR gateway related
            - ['AddToPTEPCluster']
            - ['CreateTORBinding']
            - ['CreateTORAttachmentToVirtualWire1']
            - ['CreateTORAttachmentToVirtualWire2']

            # step 4: TOR functions verification
            - ['VirtualWire1BroadcastTrafficWithTORAttachment']
            - ['VirtualWire2MulticastTrafficWithTORAttachment']
            - ['VirtualWire2UnknownUnicastTrafficWithTORAttachment']

            # step 5: we cannot shutdown PTEP since it is a host, but we can do it
            # by restarting it and send traffic in parallel, we can send traffic
            # during PTEP recover to simulate the shutdown behaviour
            # check current traffic not affected
            - ['RebootPTEP4', 'VirtualWire1BroadcastTrafficWithTORAttachment',
               'RebootPTEP5', 'VirtualWire2MulticastTrafficWithTORAttachment']

            # step 6: Poweroff PTEP5 and PTEP6, make sure PTEP4 must be the primary
            # for both
            - ['RebootPTEP5', 'VirtualWire1BroadcastTrafficWithTORAttachment',
               'RebootPTEP6', 'VirtualWire2MulticastTrafficWithTORAttachment']

            # step 7: make another TOR BUM traffic test
            - ['VirtualWire1BroadcastTrafficWithTORAttachment']
            - ['VirtualWire2MulticastTrafficWithTORAttachment']
            - ['VirtualWire2UnknownUnicastTrafficWithTORAttachment']

        ExitSequence:
            - ['DeleteVirtualWire1TORAttachment']
            - ['DeleteVirtualWire2TORAttachment']
            - ["DeleteTOR"]
            - ["RemoveFromPTEPCluster"]

            - ['CleanupTORSimulator']
            - ['PoweroffVMs']
            - ['DeleteVM1Vnic1', 'DeleteVM4Vnic1', 'DeleteVM7Vnic1', 'DeleteVM10Vnic1']
            - ['DeleteVM2Vnic1', 'DeleteVM5Vnic1', 'DeleteVM8Vnic1', 'DeleteVM11Vnic1']
            - ['DeleteAllVirtualWires']

        SetupTORSimulator: *SETUP_TOR_SIMUATOR_2_GATEWAYS
        TORGatewaySetController: *TOR_GATEWAY_SET_CONTROLLER
        VerifyTORsConnected: *VERIFY_2_TOR_INSTANCES_CONNECTED
        CreateVirtualWires: *CREATE_VIRTUALWIRES
        PlaceVMsOnVirtualWire1: *PLACE_VMS_ON_VIRTUAL_WIRE_1
        PlaceVMsOnVirtualWire2: *PLACE_VMS_ON_VIRTUAL_WIRE_2
        PlaceVMsOnVirtualWire3: *PLACE_VMS_ON_VIRTUAL_WIRE_3
        PoweronVM1: *POWER_ON_VM1
        PoweronVM2: *POWER_ON_VM2
        PoweronVM4: *POWER_ON_VM4
        PoweronVM5: *POWER_ON_VM5
        PoweronVM7: *POWER_ON_VM7
        PoweronVM8: *POWER_ON_VM8
        PoweronVM10: *POWER_ON_VM10
        PoweronVM11: *POWER_ON_VM11
        AddToPTEPCluster: *ADD_3_PTEPS_TO_CLUSTER
        CreateTOROnVSM: *CREATE_2_TOR_ON_VSM
        CreateTORBinding: *CREATE_4_TOR_BINDINGS
        CreateTORAttachmentToVirtualWire1: *CREATE_2_TOR_ATTACHMENTS_TO_VWIRE_1
        CreateTORAttachmentToVirtualWire2: *CREATE_2_TOR_ATTACHMENTS_TO_VWIRE_2
        RebootPTEP4: *REBOOT_PTEP_4
        RebootPTEP5: *REBOOT_PTEP_5
        RebootPTEP6: *REBOOT_PTEP_6
        DeleteVirtualWire1TORAttachment: *DELETE_VWIRE1_2_TOR_ATTACHMENTS
        DeleteVirtualWire2TORAttachment: *DELETE_VWIRE2_2_TOR_ATTACHMENTS
        DeleteTOR: *DELETE_TOR_ON_VSM
        RemoveFromPTEPCluster: *REMOVE_FROM_PTEP_CLUSTER
        CleanupTORSimulator: *CLEANUP_TOR_SIMUATOR_2_GATEWAYS
        PoweroffVMs: *POWER_OFF_VMS
        DeleteVM1Vnic1: *DELETE_VM1_VNIC1
        DeleteVM2Vnic1: *DELETE_VM2_VNIC1
        DeleteVM4Vnic1: *DELETE_VM4_VNIC1
        DeleteVM5Vnic1: *DELETE_VM5_VNIC1
        DeleteVM7Vnic1: *DELETE_VM7_VNIC1
        DeleteVM8Vnic1: *DELETE_VM8_VNIC1
        DeleteVM10Vnic1: *DELETE_VM10_VNIC1
        DeleteVM11Vnic1: *DELETE_VM11_VNIC1
        DeleteAllVirtualWires: *DELETE_ALL_VIRTUALWIRES

        VirtualWire1BroadcastTrafficWithTORAttachment:
           Type:           "Traffic"
           toolname:       "ping"
           Routingscheme:  "broadcast"
           TestAdapter:    "torgateway.[1].pif.[3],
                            torgateway.[2].pif.[3]"
           SupportAdapter: "vm.[1].vnic.[1],vm.[4].vnic.[1],vm.[7].vnic.[1]"
           TestDuration:   "90"

        VirtualWire2MulticastTrafficWithTORAttachment:
           Type:           "Traffic"
           RoutingScheme:  "Multicast"
           L3Protocol:     "ipv4"
           udpbandwidth:   *UDP_TRAFFIC_BANDWIDTH
           TestAdapter:    "torgateway.[1].pif.[4],
                            torgateway.[2].pif.[4]"
           SupportAdapter: "vm.[2].vnic.[1],vm.[5].vnic.[1],vm.[8].vnic.[1]"
           TestDuration:   "90"

        VirtualWire2UnknownUnicastTrafficWithTORAttachment:
           Type: 'Traffic'
           toolName: 'scapy'
           TestAdapter:     "torgateway.[1].pif.[4],
                             torgateway.[2].pif.[4]"
           SupportAdapter:  "vm.[2].vnic.[1]"
           protocol: 'arp'
           DestinationAddress: '192.168.1.255'
           interval: *SCAPY_INTERVAL
           pktcount: 1
           connectivitytest: '0'

PtepClusterDownUp:
    <<: *TDS_COMMON_FIELDS_P1_CASE
    Component: "PTEP"
    TestName:  "PtepClusterDownUp"
    Developer: "mqing"
    TestbedSpec: *FUNCTIONAL_TOPOLOGY_2
    Summary: |
        PtepClusterDown: Shut down all the PTEPs in the cluster, verify the
                         existing traffic not affected.
                         But BUM traffic will not works.
        PtepClusterReboot: Reboot all the PTEPs in a cluster in the same time,
                           verify after reboot, functionality still works.
    WORKLOADS:
        Sequence:
            # step 1: setup TOR simulators
            - ['SetupTORSimulator']
            - ['CreateTOROnVSM']
            - ['TORGatewaySetController']
            - ["VerifyTORsConnected"]

            # step 2: legacy virtualwires setup
            - ['CreateVirtualWires']
            - ['PlaceVMsOnVirtualWire1']
            - ['PlaceVMsOnVirtualWire2']
            - ['PoweronVM1','PoweronVM4','PoweronVM7','PoweronVM10']
            - ['PoweronVM2','PoweronVM5','PoweronVM8','PoweronVM11']

            # step 3: configure TOR gateway related
            - ['AddToPTEPCluster']
            - ['CreateTORBinding']
            - ['CreateTORAttachmentToVirtualWire1']
            - ['CreateTORAttachmentToVirtualWire2']

            # step 4: TOR BUM traffic test
            - ['VirtualWire1BroadcastTrafficWithTORAttachment']
            - ['VirtualWire2MulticastTrafficWithTORAttachment']
            - ['VirtualWire2UnknownUnicastTrafficWithTORAttachment']

            # step 5: TOR functions verification
            - ['TrafficTestVirtualWire1FromTorToHosts']
            - ['TrafficTestVirtualWire2FromTorToHosts']

            # step 6: we cannot shutdown PTEP since it is a host, but we can do it
            # by restarting it and send traffic in parallel
            - ['RebootPTEP4', 'RebootPTEP5', 'RebootPTEP5',
               'VirtualWire1BroadcastTrafficWithTORAttachmentFail',
               'TrafficTestVirtualWire2FromTorToHosts']

            # step 7: after PTEP cluster recover, make another TOR BUM traffic test
            - ['VirtualWire1BroadcastTrafficWithTORAttachment']
            - ['VirtualWire2MulticastTrafficWithTORAttachment']
            - ['VirtualWire2UnknownUnicastTrafficWithTORAttachment']

            # step 8: make another TOR functions verification
            - ['TrafficTestVirtualWire1FromTorToHosts']
            - ['TrafficTestVirtualWire2FromTorToHosts']

        ExitSequence:
            - ['DeleteVirtualWire1TORAttachment']
            - ['DeleteVirtualWire2TORAttachment']
            - ["DeleteTOR"]
            - ["RemoveFromPTEPCluster"]

            - ['CleanupTORSimulator']
            - ['PoweroffVMs']
            - ['DeleteVM1Vnic1', 'DeleteVM4Vnic1', 'DeleteVM7Vnic1', 'DeleteVM10Vnic1']
            - ['DeleteVM2Vnic1', 'DeleteVM5Vnic1', 'DeleteVM8Vnic1', 'DeleteVM11Vnic1']
            - ['DeleteAllVirtualWires']

        SetupTORSimulator: *SETUP_TOR_SIMUATOR_2_GATEWAYS
        TORGatewaySetController: *TOR_GATEWAY_SET_CONTROLLER
        VerifyTORsConnected: *VERIFY_2_TOR_INSTANCES_CONNECTED
        CreateVirtualWires: *CREATE_VIRTUALWIRES
        PlaceVMsOnVirtualWire1: *PLACE_VMS_ON_VIRTUAL_WIRE_1
        PlaceVMsOnVirtualWire2: *PLACE_VMS_ON_VIRTUAL_WIRE_2
        PlaceVMsOnVirtualWire3: *PLACE_VMS_ON_VIRTUAL_WIRE_3
        PoweronVM1: *POWER_ON_VM1
        PoweronVM2: *POWER_ON_VM2
        PoweronVM4: *POWER_ON_VM4
        PoweronVM5: *POWER_ON_VM5
        PoweronVM7: *POWER_ON_VM7
        PoweronVM8: *POWER_ON_VM8
        PoweronVM10: *POWER_ON_VM10
        PoweronVM11: *POWER_ON_VM11
        AddToPTEPCluster: *ADD_3_PTEPS_TO_CLUSTER
        CreateTOROnVSM: *CREATE_2_TOR_ON_VSM
        CreateTORBinding: *CREATE_4_TOR_BINDINGS
        CreateTORAttachmentToVirtualWire1: *CREATE_2_TOR_ATTACHMENTS_TO_VWIRE_1
        CreateTORAttachmentToVirtualWire2: *CREATE_2_TOR_ATTACHMENTS_TO_VWIRE_2
        RebootPTEP4: *REBOOT_PTEP_4
        RebootPTEP5: *REBOOT_PTEP_5
        RebootPTEP6: *REBOOT_PTEP_6
        DeleteVirtualWire1TORAttachment: *DELETE_VWIRE1_2_TOR_ATTACHMENTS
        DeleteVirtualWire2TORAttachment: *DELETE_VWIRE2_2_TOR_ATTACHMENTS
        DeleteTOR: *DELETE_TOR_ON_VSM
        RemoveFromPTEPCluster: *REMOVE_FROM_PTEP_CLUSTER
        CleanupTORSimulator: *CLEANUP_TOR_SIMUATOR_2_GATEWAYS
        PoweroffVMs: *POWER_OFF_VMS
        DeleteVM1Vnic1: *DELETE_VM1_VNIC1
        DeleteVM2Vnic1: *DELETE_VM2_VNIC1
        DeleteVM4Vnic1: *DELETE_VM4_VNIC1
        DeleteVM5Vnic1: *DELETE_VM5_VNIC1
        DeleteVM7Vnic1: *DELETE_VM7_VNIC1
        DeleteVM8Vnic1: *DELETE_VM8_VNIC1
        DeleteVM10Vnic1: *DELETE_VM10_VNIC1
        DeleteVM11Vnic1: *DELETE_VM11_VNIC1
        DeleteAllVirtualWires: *DELETE_ALL_VIRTUALWIRES

        VirtualWire1BroadcastTrafficWithTORAttachment:
           Type:           "Traffic"
           toolname:       "ping"
           Routingscheme:  "broadcast"
           TestAdapter:    "torgateway.[1].pif.[3],
                            torgateway.[2].pif.[3]"
           SupportAdapter: "vm.[1].vnic.[1],vm.[4].vnic.[1],vm.[7].vnic.[1],vm.[10].vnic.[1]"
           TestDuration:   "90"

        VirtualWire1BroadcastTrafficWithTORAttachmentFail:
           Type:           "Traffic"
           toolname:       "ping"
           Routingscheme:  "broadcast"
           TestAdapter:    "torgateway.[1].pif.[3],
                            torgateway.[2].pif.[3]"
           SupportAdapter: "vm.[1].vnic.[1],vm.[4].vnic.[1],vm.[7].vnic.[1],vm.[10].vnic.[1]"
           TestDuration:   "90"
           ExpectedResult: 'Fail'

        VirtualWire2MulticastTrafficWithTORAttachment:
           Type:           "Traffic"
           RoutingScheme:  "Multicast"
           L3Protocol:     "ipv4"
           udpbandwidth:   *UDP_TRAFFIC_BANDWIDTH
           TestAdapter:    "torgateway.[1].pif.[4],
                            torgateway.[2].pif.[4]"
           SupportAdapter: "vm.[2].vnic.[1],vm.[5].vnic.[1],vm.[8].vnic.[1],vm.[11].vnic.[1]"
           TestDuration:   "90"

        VirtualWire2UnknownUnicastTrafficWithTORAttachment:
           Type: 'Traffic'
           toolName: 'scapy'
           TestAdapter:     "torgateway.[1].pif.[4],
                             torgateway.[2].pif.[4]"
           SupportAdapter:  "vm.[2].vnic.[1]"
           protocol: 'arp'
           DestinationAddress: '192.168.1.255'
           interval: *SCAPY_INTERVAL
           pktcount: 1
           connectivitytest: '0'

        TrafficTestVirtualWire1FromTorToHosts:
          Type:            "Traffic"
          toolName:        "ping"
          TestAdapter:     "torgateway.[1].pif.[3],
                            torgateway.[2].pif.[3]"
          SupportAdapter:  "vm.[1].vnic.[1],vm.[4].vnic.[1],vm.[7].vnic.[1],vm.[10].vnic.[1]"
          TestDuration:    "60"

        TrafficTestVirtualWire2FromTorToHosts:
          Type:            "Traffic"
          toolName:        "ping"
          TestAdapter:     "torgateway.[1].pif.[4],
                            torgateway.[2].pif.[4]"
          SupportAdapter:  "vm.[2].vnic.[1],vm.[5].vnic.[1],vm.[8].vnic.[1],vm.[11].vnic.[1]"
          TestDuration:    "60"

PtepVmConnectivityOnBridgedAndUnbridgedVirtualwire:
    <<: *TDS_COMMON_FIELDS_P1_CASE
    Component: "PTEP"
    TestName:  "PtepVmConnectivityOnBridgedAndUnbridgedVirtualwire"
    Developer: "mqing"
    TestbedSpec: *FUNCTIONAL_TOPOLOGY_2
    Summary: |
        PtepVmConnectivityOnBridgedVirtualWire: Using vm under PTEP host,
                 do normal traffic test. Verify that acting as a PTEP does
                 not affect the regular functionality of an ESX host that is
                 part of NSX.
        PtepVmConnectivityOnUnbridgedVirtualWire: Using vm under PTEP host,
                do normal traffic test. Verify that acting as a PTEP does not
                affect the regular functionality of an ESX host that is
                part of NSX.
        PtepVMJoinMulticastModeVwire: Verify PTEP VM can join in the multicast
                mode virtual wires.
    WORKLOADS:
        Sequence:
            # step 1: setup TOR simulators
            - ['SetupTORSimulator']
            - ['CreateTOROnVSM']
            # connect TOR gateway
            - ['TORGatewaySetController']
            - ["VerifyTORsConnected"]

            # step 2: legacy virtualwires setup
            - ['CreateVirtualWires']
            - ['PlaceVMsOnVirtualWire1']
            - ['PlaceVMsOnVirtualWire2']
            - ['PlaceVMsOnVirtualWire3']
            - ['PoweronVM1','PoweronVM4','PoweronVM7','PoweronVM10']
            - ['PoweronVM2','PoweronVM5','PoweronVM8','PoweronVM11']
            - ['PoweronVM3','PoweronVM6','PoweronVM9','PoweronVM12']
            - ['NetperfTestVirtualWire1']
            - ['NetperfTestVirtualWire2']
            - ['NetperfTestVirtualWire3']

            # step 3: configure TOR gateway related
            - ['AddToPTEPCluster']
            - ['CreateTORBinding']
            - ['CreateTORAttachmentToVirtualWire1']
            - ['CreateTORAttachmentToVirtualWire2']

            # step 4: TOR functions verification
            - ['NetperfTestVirtualWire1WithTORAttachment']
            - ['NetperfTestVirtualWire2WithTORAttachment']
            - ['NetperfTestVirtualWire3']

        ExitSequence:
            - ['DeleteVirtualWire1TORAttachment']
            - ['DeleteVirtualWire2TORAttachment']
            - ["DeleteTOR"]
            - ["RemoveFromPTEPCluster"]

            - ['CleanupTORSimulator']
            - ['PoweroffVMs']
            - ['DeleteVM1Vnic1', 'DeleteVM4Vnic1', 'DeleteVM7Vnic1', 'DeleteVM10Vnic1']
            - ['DeleteVM2Vnic1', 'DeleteVM5Vnic1', 'DeleteVM8Vnic1', 'DeleteVM11Vnic1']
            - ['DeleteVM3Vnic1', 'DeleteVM6Vnic1', 'DeleteVM9Vnic1', 'DeleteVM12Vnic1']
            - ['DeleteAllVirtualWires']

        SetupTORSimulator: *SETUP_TOR_SIMUATOR_2_GATEWAYS
        TORGatewaySetController: *TOR_GATEWAY_SET_CONTROLLER
        VerifyTORsConnected: *VERIFY_2_TOR_INSTANCES_CONNECTED
        CreateVirtualWires: *CREATE_VIRTUALWIRES
        PlaceVMsOnVirtualWire1: *PLACE_VMS_ON_VIRTUAL_WIRE_1
        PlaceVMsOnVirtualWire2: *PLACE_VMS_ON_VIRTUAL_WIRE_2
        PlaceVMsOnVirtualWire3: *PLACE_VMS_ON_VIRTUAL_WIRE_3
        PoweronVM1: *POWER_ON_VM1
        PoweronVM2: *POWER_ON_VM2
        PoweronVM3: *POWER_ON_VM3
        PoweronVM4: *POWER_ON_VM4
        PoweronVM5: *POWER_ON_VM5
        PoweronVM6: *POWER_ON_VM6
        PoweronVM7: *POWER_ON_VM7
        PoweronVM8: *POWER_ON_VM8
        PoweronVM9: *POWER_ON_VM9
        PoweronVM10: *POWER_ON_VM10
        PoweronVM11: *POWER_ON_VM11
        PoweronVM12: *POWER_ON_VM12
        AddToPTEPCluster: *ADD_3_PTEPS_TO_CLUSTER
        CreateTOROnVSM: *CREATE_2_TOR_ON_VSM
        CreateTORBinding: *CREATE_4_TOR_BINDINGS
        CreateTORAttachmentToVirtualWire1: *CREATE_2_TOR_ATTACHMENTS_TO_VWIRE_1
        CreateTORAttachmentToVirtualWire2: *CREATE_2_TOR_ATTACHMENTS_TO_VWIRE_2
        NetperfTestVirtualWire1: *NETPERF_TEST_VIRTUAL_WIRE_1
        NetperfTestVirtualWire2: *NETPERF_TEST_VIRTUAL_WIRE_2
        NetperfTestVirtualWire3: *NETPERF_TEST_VIRTUAL_WIRE_3
        DeleteVirtualWire1TORAttachment: *DELETE_VWIRE1_2_TOR_ATTACHMENTS
        DeleteVirtualWire2TORAttachment: *DELETE_VWIRE2_2_TOR_ATTACHMENTS
        DeleteTOR: *DELETE_TOR_ON_VSM
        RemoveFromPTEPCluster: *REMOVE_FROM_PTEP_CLUSTER
        CleanupTORSimulator: *CLEANUP_TOR_SIMUATOR_2_GATEWAYS
        PoweroffVMs: *POWER_OFF_VMS
        DeleteVM1Vnic1: *DELETE_VM1_VNIC1
        DeleteVM2Vnic1: *DELETE_VM2_VNIC1
        DeleteVM3Vnic1: *DELETE_VM3_VNIC1
        DeleteVM4Vnic1: *DELETE_VM4_VNIC1
        DeleteVM5Vnic1: *DELETE_VM5_VNIC1
        DeleteVM6Vnic1: *DELETE_VM6_VNIC1
        DeleteVM7Vnic1: *DELETE_VM7_VNIC1
        DeleteVM8Vnic1: *DELETE_VM8_VNIC1
        DeleteVM9Vnic1: *DELETE_VM9_VNIC1
        DeleteVM10Vnic1: *DELETE_VM10_VNIC1
        DeleteVM11Vnic1: *DELETE_VM11_VNIC1
        DeleteVM12Vnic1: *DELETE_VM12_VNIC1
        DeleteAllVirtualWires: *DELETE_ALL_VIRTUALWIRES

        NetperfTestVirtualWire1WithTORAttachment:
          Type:            "Traffic"
          toolName:        "iperf"
          L4Protocol:      "tcp"
          TestAdapter:     "torgateway.[1].pif.[3],
                            torgateway.[2].pif.[3]"
          SupportAdapter:  "vm.[1].vnic.[1],vm.[4].vnic.[1],vm.[7].vnic.[1],vm.[10].vnic.[1]"
          TestDuration:    "30"

        NetperfTestVirtualWire2WithTORAttachment:
          Type:            "Traffic"
          toolName:        "iperf"
          L4Protocol:      "udp"
          udpbandwidth:    *UDP_TRAFFIC_BANDWIDTH
          TestAdapter:     "torgateway.[1].pif.[4],
                            torgateway.[2].pif.[4]"
          SupportAdapter:  "vm.[2].vnic.[1],vm.[5].vnic.[1],vm.[8].vnic.[1],vm.[11].vnic.[1]"
          TestDuration:    "30"

PtepDisconnectionAndRecover:
    <<: *TDS_COMMON_FIELDS_P1_CASE
    Component: "PTEP"
    TestName:  "PtepDisconnectionAndRecover"
    Developer: "mqing"
    TestbedSpec: *FUNCTIONAL_TOPOLOGY_2
    Summary: |
        PtepDisconnection: TOR gateway will choose another PTEP when chosen
             PTEP disconnects from CCP
        PtepRecover: PTEP disconnects from CCP and then reconnects, verify
             PTEP function still works
    WORKLOADS:
        Sequence:
            # step 1: setup TOR simulators
            - ['SetupTORSimulator']
            - ['CreateTOROnVSM']
            # connect TOR gateway
            - ['TORGatewaySetController']
            - ["VerifyTORsConnected"]

            # step 2: legacy virtualwires setup
            - ['CreateVirtualWires']
            - ['PlaceVMsOnVirtualWire1']
            - ['PlaceVMsOnVirtualWire2']
            - ['PlaceVMsOnVirtualWire3']
            - ['PoweronVM1','PoweronVM4','PoweronVM7','PoweronVM10']
            - ['PoweronVM2','PoweronVM5','PoweronVM8','PoweronVM11']
            - ['PoweronVM3','PoweronVM6','PoweronVM9','PoweronVM12']
            - ['NetperfTestVirtualWire1']
            - ['NetperfTestVirtualWire2']
            - ['NetperfTestVirtualWire3']

            # step 3: configure TOR gateway related
            - ['AddToPTEPCluster']
            - ['CreateTORBinding']
            - ['CreateTORAttachmentToVirtualWire1']
            - ['CreateTORAttachmentToVirtualWire2']

            # step 4: TOR BUM traffic test
            - ['VirtualWire1BroadcastTrafficWithTORAttachment']
            - ['VirtualWire2MulticastTrafficWithTORAttachment']
            - ['VirtualWire2UnknownUnicastTrafficWithTORAttachment']

            # step 5: enable firewall on Ptep hosts
            - ['EnableFirewallOnPtep4', 'EnableFirewallOnPtep5', 'EnableFirewallOnPtep6']

            # step 5: Disconnect PTEP4, verify BUM traffic still works
            - ['DisconnectPtep4', 'VirtualWire1BroadcastTrafficWithTORAttachment',
               'VirtualWire2MulticastTrafficWithTORAttachment']
            - ['ReconnectPtep4']

            # step 6: Disconnect PTEP5, verify BUM traffic still works
            - ['DisconnectPtep5', 'VirtualWire1BroadcastTrafficWithTORAttachment',
               'VirtualWire2MulticastTrafficWithTORAttachment']
            - ['ReconnectPtep5']

            # step 7: Disconnect PTEP6, verify BUM traffic still works
            - ['DisconnectPtep6', 'VirtualWire1BroadcastTrafficWithTORAttachment',
               'VirtualWire2MulticastTrafficWithTORAttachment']
            - ['ReconnectPtep6']

            # step 8: verify basic traffic
            - ['NetperfTestVirtualWire1WithTORAttachment']
            - ['NetperfTestVirtualWire2WithTORAttachment']
            - ['NetperfTestVirtualWire3']

        ExitSequence:
            - ['DeleteVirtualWire1TORAttachment']
            - ['DeleteVirtualWire2TORAttachment']
            - ["DeleteTOR"]
            - ["RemoveFromPTEPCluster"]

            - ['CleanupTORSimulator']
            - ['PoweroffVMs']
            - ['DeleteVM1Vnic1', 'DeleteVM4Vnic1', 'DeleteVM7Vnic1', 'DeleteVM10Vnic1']
            - ['DeleteVM2Vnic1', 'DeleteVM5Vnic1', 'DeleteVM8Vnic1', 'DeleteVM11Vnic1']
            - ['DeleteVM3Vnic1', 'DeleteVM6Vnic1', 'DeleteVM9Vnic1', 'DeleteVM12Vnic1']
            - ['DeleteAllVirtualWires']
            - ['DisableFirewallOnPtep4', 'DisableFirewallOnPtep5', 'DisableFirewallOnPtep6']

        SetupTORSimulator: *SETUP_TOR_SIMUATOR_2_GATEWAYS
        TORGatewaySetController: *TOR_GATEWAY_SET_CONTROLLER
        VerifyTORsConnected: *VERIFY_2_TOR_INSTANCES_CONNECTED
        CreateVirtualWires: *CREATE_VIRTUALWIRES
        PlaceVMsOnVirtualWire1: *PLACE_VMS_ON_VIRTUAL_WIRE_1
        PlaceVMsOnVirtualWire2: *PLACE_VMS_ON_VIRTUAL_WIRE_2
        PlaceVMsOnVirtualWire3: *PLACE_VMS_ON_VIRTUAL_WIRE_3
        PoweronVM1: *POWER_ON_VM1
        PoweronVM2: *POWER_ON_VM2
        PoweronVM3: *POWER_ON_VM3
        PoweronVM4: *POWER_ON_VM4
        PoweronVM5: *POWER_ON_VM5
        PoweronVM6: *POWER_ON_VM6
        PoweronVM7: *POWER_ON_VM7
        PoweronVM8: *POWER_ON_VM8
        PoweronVM9: *POWER_ON_VM9
        PoweronVM10: *POWER_ON_VM10
        PoweronVM11: *POWER_ON_VM11
        PoweronVM12: *POWER_ON_VM12
        EnableFirewallOnPtep4: *ENABLE_FIREWALL_ON_HOST_4
        EnableFirewallOnPtep5: *ENABLE_FIREWALL_ON_HOST_5
        EnableFirewallOnPtep6: *ENABLE_FIREWALL_ON_HOST_6
        DisableFirewallOnPtep4: *DISABLE_FIREWALL_ON_HOST_4
        DisableFirewallOnPtep5: *DISABLE_FIREWALL_ON_HOST_5
        DisableFirewallOnPtep6: *DISABLE_FIREWALL_ON_HOST_6
        DisconnectPtep4: *BLOCK_CONNECTION_BETWEEN_CONTROLLER_AND_PTEP_4
        DisconnectPtep5: *BLOCK_CONNECTION_BETWEEN_CONTROLLER_AND_PTEP_5
        DisconnectPtep6: *BLOCK_CONNECTION_BETWEEN_CONTROLLER_AND_PTEP_6
        ReconnectPtep4: *UNBLOCK_CONNECTION_BETWEEN_CONTROLLER_AND_PTEP_4
        ReconnectPtep5: *UNBLOCK_CONNECTION_BETWEEN_CONTROLLER_AND_PTEP_5
        ReconnectPtep6: *UNBLOCK_CONNECTION_BETWEEN_CONTROLLER_AND_PTEP_6
        AddToPTEPCluster: *ADD_3_PTEPS_TO_CLUSTER
        CreateTOROnVSM: *CREATE_2_TOR_ON_VSM
        CreateTORBinding: *CREATE_4_TOR_BINDINGS
        CreateTORAttachmentToVirtualWire1: *CREATE_2_TOR_ATTACHMENTS_TO_VWIRE_1
        CreateTORAttachmentToVirtualWire2: *CREATE_2_TOR_ATTACHMENTS_TO_VWIRE_2
        NetperfTestVirtualWire1: *NETPERF_TEST_VIRTUAL_WIRE_1
        NetperfTestVirtualWire2: *NETPERF_TEST_VIRTUAL_WIRE_2
        NetperfTestVirtualWire3: *NETPERF_TEST_VIRTUAL_WIRE_3
        DeleteVirtualWire1TORAttachment: *DELETE_VWIRE1_2_TOR_ATTACHMENTS
        DeleteVirtualWire2TORAttachment: *DELETE_VWIRE2_2_TOR_ATTACHMENTS
        DeleteTOR: *DELETE_TOR_ON_VSM
        RemoveFromPTEPCluster: *REMOVE_FROM_PTEP_CLUSTER
        CleanupTORSimulator: *CLEANUP_TOR_SIMUATOR_2_GATEWAYS
        PoweroffVMs: *POWER_OFF_VMS
        DeleteVM1Vnic1: *DELETE_VM1_VNIC1
        DeleteVM2Vnic1: *DELETE_VM2_VNIC1
        DeleteVM3Vnic1: *DELETE_VM3_VNIC1
        DeleteVM4Vnic1: *DELETE_VM4_VNIC1
        DeleteVM5Vnic1: *DELETE_VM5_VNIC1
        DeleteVM6Vnic1: *DELETE_VM6_VNIC1
        DeleteVM7Vnic1: *DELETE_VM7_VNIC1
        DeleteVM8Vnic1: *DELETE_VM8_VNIC1
        DeleteVM9Vnic1: *DELETE_VM9_VNIC1
        DeleteVM10Vnic1: *DELETE_VM10_VNIC1
        DeleteVM11Vnic1: *DELETE_VM11_VNIC1
        DeleteVM12Vnic1: *DELETE_VM12_VNIC1
        DeleteAllVirtualWires: *DELETE_ALL_VIRTUALWIRES

        VirtualWire1BroadcastTrafficWithTORAttachment:
           Type:           "Traffic"
           toolname:       "ping"
           Routingscheme:  "broadcast"
           TestAdapter:    "torgateway.[1].pif.[3],
                            torgateway.[2].pif.[3]"
           SupportAdapter: "vm.[1].vnic.[1],vm.[4].vnic.[1],vm.[7].vnic.[1],vm.[10].vnic.[1]"
           TestDuration:   "30"

        VirtualWire2MulticastTrafficWithTORAttachment:
           Type:           "Traffic"
           RoutingScheme:  "Multicast"
           L3Protocol:     "ipv4"
           udpbandwidth:   *UDP_TRAFFIC_BANDWIDTH
           TestAdapter:    "torgateway.[1].pif.[4],
                            torgateway.[2].pif.[4]"
           SupportAdapter: "vm.[2].vnic.[1],vm.[5].vnic.[1],vm.[8].vnic.[1],vm.[11].vnic.[1]"
           TestDuration:   "60"

        VirtualWire2UnknownUnicastTrafficWithTORAttachment:
           Type: 'Traffic'
           toolName: 'scapy'
           TestAdapter:     "torgateway.[1].pif.[4],
                             torgateway.[2].pif.[4]"
           SupportAdapter:  "vm.[2].vnic.[1]"
           protocol: 'arp'
           DestinationAddress: '192.168.1.255'
           interval: *SCAPY_INTERVAL
           pktcount: 1
           connectivitytest: '0'

        NetperfTestVirtualWire1WithTORAttachment:
          Type:            "Traffic"
          toolName:        "iperf"
          L4Protocol:      "tcp"
          TestAdapter:     "torgateway.[1].pif.[3],
                            torgateway.[2].pif.[3]"
          SupportAdapter:  "vm.[1].vnic.[1],vm.[4].vnic.[1],vm.[7].vnic.[1],vm.[10].vnic.[1]"
          TestDuration:    "30"

        NetperfTestVirtualWire2WithTORAttachment:
          Type:            "Traffic"
          toolName:        "iperf"
          L4Protocol:      "udp"
          udpbandwidth:    *UDP_TRAFFIC_BANDWIDTH
          TestAdapter:     "torgateway.[1].pif.[4],
                            torgateway.[2].pif.[4]"
          SupportAdapter:  "vm.[2].vnic.[1],vm.[5].vnic.[1],vm.[8].vnic.[1],vm.[11].vnic.[1]"
          TestDuration:    "30"

PtepClusterDisconnection:
    <<: *TDS_COMMON_FIELDS_P1_CASE
    Component: "PTEP"
    TestName:  "PtepClusterDisconnection"
    Developer: "mqing"
    TestbedSpec: *FUNCTIONAL_TOPOLOGY_2
    Summary: |
        All PTEPs disconnect from CCP one by one
    WORKLOADS:
        Sequence:
            # step 1: setup TOR simulators
            - ['SetupTORSimulator']
            - ['CreateTOROnVSM']
            # connect TOR gateway
            - ['TORGatewaySetController']
            - ["VerifyTORsConnected"]

            # step 2: legacy virtualwires setup
            - ['CreateVirtualWires']
            - ['PlaceVMsOnVirtualWire1']
            - ['PlaceVMsOnVirtualWire2']
            - ['PlaceVMsOnVirtualWire3']
            - ['PoweronVM1','PoweronVM4','PoweronVM7','PoweronVM10']
            - ['PoweronVM2','PoweronVM5','PoweronVM8','PoweronVM11']
            - ['PoweronVM3','PoweronVM6','PoweronVM9','PoweronVM12']
            - ['NetperfTestVirtualWire1']
            - ['NetperfTestVirtualWire2']
            - ['NetperfTestVirtualWire3']

            # step 3: configure TOR gateway related
            - ['AddToPTEPCluster']
            - ['CreateTORBinding']
            - ['CreateTORAttachmentToVirtualWire1']
            - ['CreateTORAttachmentToVirtualWire2']

            # step 4: TOR BUM traffic test
            - ['VirtualWire1BroadcastTrafficWithTORAttachment']
            - ['VirtualWire2MulticastTrafficWithTORAttachment']
            - ['VirtualWire2UnknownUnicastTrafficWithTORAttachment']

            # step 5: enable firewall on Ptep hosts
            - ['EnableFirewallOnPtep4', 'EnableFirewallOnPtep5', 'EnableFirewallOnPtep6']

            # step 6: verify basic traffic
            - ['NetperfTestVirtualWire1WithTORAttachment']
            - ['NetperfTestVirtualWire2WithTORAttachment']
            - ['NetperfTestVirtualWire3']

            # step 7: Disconnect PTEP4, verify BUM traffic still works
            - ['DisconnectPtep4',
               'VirtualWire1BroadcastTrafficWithTORAttachment']

            # step 8: Disconnect PTEP5, verify BUM traffic will not work
            # because PTEP cluster lose majority
            - ['DisconnectPtep5',
               'VirtualWire1BroadcastTrafficWithTORAttachmentFail']

            # step 9: verify basic traffic still works
            - ['NetperfTestVirtualWire1WithTORAttachment']
            - ['NetperfTestVirtualWire2WithTORAttachment']
            - ['NetperfTestVirtualWire3']

            # step 10: Reconnect PTEP4-5, verify BUM traffic also recovers
            - ['ReconnectPtep4']
            - ['ReconnectPtep5']
            - ['VirtualWire1BroadcastTrafficWithTORAttachment']
            - ['VirtualWire2MulticastTrafficWithTORAttachment']
            - ['VirtualWire2UnknownUnicastTrafficWithTORAttachment']

        ExitSequence:
            - ['DeleteVirtualWire1TORAttachment']
            - ['DeleteVirtualWire2TORAttachment']
            - ["DeleteTOR"]
            - ["RemoveFromPTEPCluster"]

            - ['CleanupTORSimulator']
            - ['PoweroffVMs']
            - ['DeleteVM1Vnic1', 'DeleteVM4Vnic1', 'DeleteVM7Vnic1', 'DeleteVM10Vnic1']
            - ['DeleteVM2Vnic1', 'DeleteVM5Vnic1', 'DeleteVM8Vnic1', 'DeleteVM11Vnic1']
            - ['DeleteVM3Vnic1', 'DeleteVM6Vnic1', 'DeleteVM9Vnic1', 'DeleteVM12Vnic1']
            - ['DeleteAllVirtualWires']
            - ['DisableFirewallOnPtep4', 'DisableFirewallOnPtep5', 'DisableFirewallOnPtep6']

        SetupTORSimulator: *SETUP_TOR_SIMUATOR_2_GATEWAYS
        TORGatewaySetController: *TOR_GATEWAY_SET_CONTROLLER
        VerifyTORsConnected: *VERIFY_2_TOR_INSTANCES_CONNECTED
        CreateVirtualWires: *CREATE_VIRTUALWIRES
        PlaceVMsOnVirtualWire1: *PLACE_VMS_ON_VIRTUAL_WIRE_1
        PlaceVMsOnVirtualWire2: *PLACE_VMS_ON_VIRTUAL_WIRE_2
        PlaceVMsOnVirtualWire3: *PLACE_VMS_ON_VIRTUAL_WIRE_3
        PoweronVM1: *POWER_ON_VM1
        PoweronVM2: *POWER_ON_VM2
        PoweronVM3: *POWER_ON_VM3
        PoweronVM4: *POWER_ON_VM4
        PoweronVM5: *POWER_ON_VM5
        PoweronVM6: *POWER_ON_VM6
        PoweronVM7: *POWER_ON_VM7
        PoweronVM8: *POWER_ON_VM8
        PoweronVM9: *POWER_ON_VM9
        PoweronVM10: *POWER_ON_VM10
        PoweronVM11: *POWER_ON_VM11
        PoweronVM12: *POWER_ON_VM12
        EnableFirewallOnPtep4: *ENABLE_FIREWALL_ON_HOST_4
        EnableFirewallOnPtep5: *ENABLE_FIREWALL_ON_HOST_5
        EnableFirewallOnPtep6: *ENABLE_FIREWALL_ON_HOST_6
        DisableFirewallOnPtep4: *DISABLE_FIREWALL_ON_HOST_4
        DisableFirewallOnPtep5: *DISABLE_FIREWALL_ON_HOST_5
        DisableFirewallOnPtep6: *DISABLE_FIREWALL_ON_HOST_6
        DisconnectPtep4: *BLOCK_CONNECTION_BETWEEN_CONTROLLER_AND_PTEP_4
        DisconnectPtep5: *BLOCK_CONNECTION_BETWEEN_CONTROLLER_AND_PTEP_5
        DisconnectPtep6: *BLOCK_CONNECTION_BETWEEN_CONTROLLER_AND_PTEP_6
        ReconnectPtep4: *UNBLOCK_CONNECTION_BETWEEN_CONTROLLER_AND_PTEP_4
        ReconnectPtep5: *UNBLOCK_CONNECTION_BETWEEN_CONTROLLER_AND_PTEP_5
        ReconnectPtep6: *UNBLOCK_CONNECTION_BETWEEN_CONTROLLER_AND_PTEP_6
        AddToPTEPCluster: *ADD_3_PTEPS_TO_CLUSTER
        CreateTOROnVSM: *CREATE_2_TOR_ON_VSM
        CreateTORBinding: *CREATE_4_TOR_BINDINGS
        CreateTORAttachmentToVirtualWire1: *CREATE_2_TOR_ATTACHMENTS_TO_VWIRE_1
        CreateTORAttachmentToVirtualWire2: *CREATE_2_TOR_ATTACHMENTS_TO_VWIRE_2
        NetperfTestVirtualWire1: *NETPERF_TEST_VIRTUAL_WIRE_1
        NetperfTestVirtualWire2: *NETPERF_TEST_VIRTUAL_WIRE_2
        NetperfTestVirtualWire3: *NETPERF_TEST_VIRTUAL_WIRE_3
        DeleteVirtualWire1TORAttachment: *DELETE_VWIRE1_2_TOR_ATTACHMENTS
        DeleteVirtualWire2TORAttachment: *DELETE_VWIRE2_2_TOR_ATTACHMENTS
        DeleteTOR: *DELETE_TOR_ON_VSM
        RemoveFromPTEPCluster: *REMOVE_FROM_PTEP_CLUSTER
        CleanupTORSimulator: *CLEANUP_TOR_SIMUATOR_2_GATEWAYS
        PoweroffVMs: *POWER_OFF_VMS
        DeleteVM1Vnic1: *DELETE_VM1_VNIC1
        DeleteVM2Vnic1: *DELETE_VM2_VNIC1
        DeleteVM3Vnic1: *DELETE_VM3_VNIC1
        DeleteVM4Vnic1: *DELETE_VM4_VNIC1
        DeleteVM5Vnic1: *DELETE_VM5_VNIC1
        DeleteVM6Vnic1: *DELETE_VM6_VNIC1
        DeleteVM7Vnic1: *DELETE_VM7_VNIC1
        DeleteVM8Vnic1: *DELETE_VM8_VNIC1
        DeleteVM9Vnic1: *DELETE_VM9_VNIC1
        DeleteVM10Vnic1: *DELETE_VM10_VNIC1
        DeleteVM11Vnic1: *DELETE_VM11_VNIC1
        DeleteVM12Vnic1: *DELETE_VM12_VNIC1
        DeleteAllVirtualWires: *DELETE_ALL_VIRTUALWIRES

        VirtualWire1BroadcastTrafficWithTORAttachment:
           Type:           "Traffic"
           toolname:       "ping"
           Routingscheme:  "broadcast"
           TestAdapter:    "torgateway.[1].pif.[3],
                            torgateway.[2].pif.[3]"
           SupportAdapter: "vm.[1].vnic.[1],vm.[4].vnic.[1],vm.[7].vnic.[1],vm.[10].vnic.[1]"
           TestDuration:   "30"

        VirtualWire1BroadcastTrafficWithTORAttachmentFail:
           Type:           "Traffic"
           toolname:       "ping"
           Routingscheme:  "broadcast"
           TestAdapter:    "torgateway.[1].pif.[3],
                            torgateway.[2].pif.[3]"
           SupportAdapter: "vm.[1].vnic.[1],vm.[4].vnic.[1],vm.[7].vnic.[1],vm.[10].vnic.[1]"
           TestDuration:   "30"
           ExpectedResult: 'Fail'

        VirtualWire2MulticastTrafficWithTORAttachment:
           Type:           "Traffic"
           RoutingScheme:  "Multicast"
           L3Protocol:     "ipv4"
           udpbandwidth:   *UDP_TRAFFIC_BANDWIDTH
           TestAdapter:    "torgateway.[1].pif.[4],
                            torgateway.[2].pif.[4]"
           SupportAdapter: "vm.[2].vnic.[1],vm.[5].vnic.[1],vm.[8].vnic.[1],vm.[11].vnic.[1]"
           TestDuration:   "60"

        VirtualWire2UnknownUnicastTrafficWithTORAttachment:
           Type: 'Traffic'
           toolName: 'scapy'
           TestAdapter:     "torgateway.[1].pif.[4],
                             torgateway.[2].pif.[4]"
           SupportAdapter:  "vm.[2].vnic.[1]"
           protocol: 'arp'
           DestinationAddress: '192.168.1.255'
           interval: *SCAPY_INTERVAL
           pktcount: 1
           connectivitytest: '0'

        NetperfTestVirtualWire1WithTORAttachment:
          Type:            "Traffic"
          toolName:        "iperf"
          L4Protocol:      "tcp"
          TestAdapter:     "torgateway.[1].pif.[3],
                            torgateway.[2].pif.[3]"
          SupportAdapter:  "vm.[1].vnic.[1],vm.[4].vnic.[1],vm.[7].vnic.[1],vm.[10].vnic.[1]"
          TestDuration:    "30"

        NetperfTestVirtualWire2WithTORAttachment:
          Type:            "Traffic"
          toolName:        "iperf"
          L4Protocol:      "udp"
          udpbandwidth:    *UDP_TRAFFIC_BANDWIDTH
          TestAdapter:     "torgateway.[1].pif.[4],
                            torgateway.[2].pif.[4]"
          SupportAdapter:  "vm.[2].vnic.[1],vm.[5].vnic.[1],vm.[8].vnic.[1],vm.[11].vnic.[1]"
          TestDuration:    "30"

ControllerClusterSetupAndControllerDownUp:
    <<: *TDS_COMMON_FIELDS_P1_CASE
    Component: "VXLAN controller"
    TestName:  "ControllerClusterSetupAndControllerDownUp"
    Developer: "mqing"
    TestbedSpec: *FUNCTIONAL_TOPOLOGY_2
    Summary: |
        ControllerClusterSetup: Set up an environment with multiple controllers
        ControllerDownUp:       One controller in a cluster is down and then up
    WORKLOADS:
        Sequence:
            # step 1: setup TOR simulators
            - ['SetupTORSimulator']
            - ['CreateTOROnVSM']
            # connect TOR gateway
            - ['TORGatewaySetController']
            - ["VerifyTORsConnected"]

            # step 2: legacy virtualwires setup
            - ['CreateVirtualWires']
            - ['PlaceVMsOnVirtualWire1']
            - ['PlaceVMsOnVirtualWire2']
            - ['PlaceVMsOnVirtualWire3']
            - ['PoweronVM1','PoweronVM4','PoweronVM7','PoweronVM10']
            - ['PoweronVM2','PoweronVM5','PoweronVM8','PoweronVM11']
            - ['PoweronVM3','PoweronVM6','PoweronVM9','PoweronVM12']
            - ['NetperfTestVirtualWire1']
            - ['NetperfTestVirtualWire2']
            - ['NetperfTestVirtualWire3']

            # step 3: configure TOR gateway related
            - ['AddToPTEPCluster']
            - ['CreateTORBinding']
            - ['CreateTORAttachmentToVirtualWire1']
            - ['CreateTORAttachmentToVirtualWire2']

            # step 4: TOR functions verification
            - ['NetperfTestVirtualWire1WithTORAttachment']
            - ['NetperfTestVirtualWire2WithTORAttachment']
            - ['NetperfTestVirtualWire3']

            # step 5: shutdown controller 1, do the test and then startup
            - ['ShutdownController1']
            - ['NetperfTestVirtualWire1WithTORAttachment']
            - ['NetperfTestVirtualWire2WithTORAttachment']
            - ['NetperfTestVirtualWire3']
            - ['PoweronController1']

            # step 6: shutdown controller 2, do the test and then startup
            - ['ShutdownController2']
            - ['NetperfTestVirtualWire1WithTORAttachment']
            - ['NetperfTestVirtualWire2WithTORAttachment']
            - ['NetperfTestVirtualWire3']
            - ['PoweronController2']

            # step 7: shutdown controller 3, do the test and then startup
            - ['ShutdownController3']
            - ['NetperfTestVirtualWire1WithTORAttachment']
            - ['NetperfTestVirtualWire2WithTORAttachment']
            - ['NetperfTestVirtualWire3']
            - ['PoweronController3']

        ExitSequence:
            - ['DeleteVirtualWire1TORAttachment']
            - ['DeleteVirtualWire2TORAttachment']
            - ["DeleteTOR"]
            - ["RemoveFromPTEPCluster"]

            - ['CleanupTORSimulator']
            - ['PoweroffVMs']
            - ['DeleteVM1Vnic1', 'DeleteVM4Vnic1', 'DeleteVM7Vnic1', 'DeleteVM10Vnic1']
            - ['DeleteVM2Vnic1', 'DeleteVM5Vnic1', 'DeleteVM8Vnic1', 'DeleteVM11Vnic1']
            - ['DeleteVM3Vnic1', 'DeleteVM6Vnic1', 'DeleteVM9Vnic1', 'DeleteVM12Vnic1']
            - ['DeleteAllVirtualWires']

        SetupTORSimulator: *SETUP_TOR_SIMUATOR_2_GATEWAYS
        TORGatewaySetController: *TOR_GATEWAY_SET_CONTROLLER
        VerifyTORsConnected: *VERIFY_2_TOR_INSTANCES_CONNECTED
        CreateVirtualWires: *CREATE_VIRTUALWIRES
        PlaceVMsOnVirtualWire1: *PLACE_VMS_ON_VIRTUAL_WIRE_1
        PlaceVMsOnVirtualWire2: *PLACE_VMS_ON_VIRTUAL_WIRE_2
        PlaceVMsOnVirtualWire3: *PLACE_VMS_ON_VIRTUAL_WIRE_3
        PoweronVM1: *POWER_ON_VM1
        PoweronVM2: *POWER_ON_VM2
        PoweronVM3: *POWER_ON_VM3
        PoweronVM4: *POWER_ON_VM4
        PoweronVM5: *POWER_ON_VM5
        PoweronVM6: *POWER_ON_VM6
        PoweronVM7: *POWER_ON_VM7
        PoweronVM8: *POWER_ON_VM8
        PoweronVM9: *POWER_ON_VM9
        PoweronVM10: *POWER_ON_VM10
        PoweronVM11: *POWER_ON_VM11
        PoweronVM12: *POWER_ON_VM12
        AddToPTEPCluster: *ADD_3_PTEPS_TO_CLUSTER
        CreateTOROnVSM: *CREATE_2_TOR_ON_VSM
        CreateTORBinding: *CREATE_4_TOR_BINDINGS
        CreateTORAttachmentToVirtualWire1: *CREATE_2_TOR_ATTACHMENTS_TO_VWIRE_1
        CreateTORAttachmentToVirtualWire2: *CREATE_2_TOR_ATTACHMENTS_TO_VWIRE_2
        ShutdownController1: *SHUTDOWN_CONTROLLER_1
        ShutdownController2: *SHUTDOWN_CONTROLLER_2
        ShutdownController3: *SHUTDOWN_CONTROLLER_3
        PoweronController1: *POWERON_CONTROLLER_1
        PoweronController2: *POWERON_CONTROLLER_2
        PoweronController3: *POWERON_CONTROLLER_3
        NetperfTestVirtualWire1: *NETPERF_TEST_VIRTUAL_WIRE_1
        NetperfTestVirtualWire2: *NETPERF_TEST_VIRTUAL_WIRE_2
        NetperfTestVirtualWire3: *NETPERF_TEST_VIRTUAL_WIRE_3

        DeleteVirtualWire1TORAttachment: *DELETE_VWIRE1_2_TOR_ATTACHMENTS
        DeleteVirtualWire2TORAttachment: *DELETE_VWIRE2_2_TOR_ATTACHMENTS
        DeleteTOR: *DELETE_TOR_ON_VSM
        RemoveFromPTEPCluster: *REMOVE_FROM_PTEP_CLUSTER
        CleanupTORSimulator: *CLEANUP_TOR_SIMUATOR_2_GATEWAYS
        PoweroffVMs: *POWER_OFF_VMS
        DeleteVM1Vnic1: *DELETE_VM1_VNIC1
        DeleteVM2Vnic1: *DELETE_VM2_VNIC1
        DeleteVM3Vnic1: *DELETE_VM3_VNIC1
        DeleteVM4Vnic1: *DELETE_VM4_VNIC1
        DeleteVM5Vnic1: *DELETE_VM5_VNIC1
        DeleteVM6Vnic1: *DELETE_VM6_VNIC1
        DeleteVM7Vnic1: *DELETE_VM7_VNIC1
        DeleteVM8Vnic1: *DELETE_VM8_VNIC1
        DeleteVM9Vnic1: *DELETE_VM9_VNIC1
        DeleteVM10Vnic1: *DELETE_VM10_VNIC1
        DeleteVM11Vnic1: *DELETE_VM11_VNIC1
        DeleteVM12Vnic1: *DELETE_VM12_VNIC1
        DeleteAllVirtualWires: *DELETE_ALL_VIRTUALWIRES

        NetperfTestVirtualWire1WithTORAttachment:
          Type:            "Traffic"
          toolName:        "iperf"
          L4Protocol:      "tcp"
          TestAdapter:     "torgateway.[1].pif.[3],
                            torgateway.[2].pif.[3]"
          SupportAdapter:  "vm.[1].vnic.[1],vm.[4].vnic.[1],vm.[7].vnic.[1],vm.[10].vnic.[1]"
          TestDuration:    "30"

        NetperfTestVirtualWire2WithTORAttachment:
          Type:            "Traffic"
          toolName:        "iperf"
          L4Protocol:      "udp"
          udpbandwidth:    *UDP_TRAFFIC_BANDWIDTH
          TestAdapter:     "torgateway.[1].pif.[4],
                            torgateway.[2].pif.[4]"
          SupportAdapter:  "vm.[2].vnic.[1],vm.[5].vnic.[1],vm.[8].vnic.[1],vm.[11].vnic.[1]"
          TestDuration:    "30"

ControllerClusterDownUp:
    <<: *TDS_COMMON_FIELDS_P1_CASE
    Component: "VXLAN controller"
    TestName:  "ControllerClusterDownUp"
    Developer: "mqing"
    TestbedSpec: *FUNCTIONAL_TOPOLOGY_2
    Summary: |
        Bring down controllers one by one in a cluster till
        there aren’t any left up
    WORKLOADS:
        Sequence:
            # step 1: setup TOR simulators
            - ['SetupTORSimulator']
            - ['CreateTOROnVSM']
            # connect TOR gateway
            - ['TORGatewaySetController']
            - ["VerifyTORsConnected"]

            # step 2: legacy virtualwires setup
            - ['CreateVirtualWires']
            - ['PlaceVMsOnVirtualWire1']
            - ['PlaceVMsOnVirtualWire2']
            - ['PlaceVMsOnVirtualWire3']
            - ['PoweronVM1','PoweronVM4','PoweronVM7','PoweronVM10']
            - ['PoweronVM2','PoweronVM5','PoweronVM8','PoweronVM11']
            - ['PoweronVM3','PoweronVM6','PoweronVM9','PoweronVM12']
            - ['NetperfTestVirtualWire1']
            - ['NetperfTestVirtualWire2']
            - ['NetperfTestVirtualWire3']

            # step 3: configure TOR gateway related
            - ['AddToPTEPCluster']
            - ['CreateTORBinding']
            - ['CreateTORAttachmentToVirtualWire1']
            - ['CreateTORAttachmentToVirtualWire2']

            # step 4: TOR functions verification
            - ['NetperfTestVirtualWire1WithTORAttachment']
            - ['NetperfTestVirtualWire2WithTORAttachment']
            - ['NetperfTestVirtualWire3']

            # step 5: shutdown controller one by one, enter no ccp headless mode
            - ['ShutdownController1']
            - ['ShutdownController2']
            - ['ShutdownController3']

            # step 6: verify existing traffic still works
            - ['NetperfTestVirtualWire1WithTORAttachment']
            - ['NetperfTestVirtualWire2WithTORAttachment']
            - ['NetperfTestVirtualWire3']

            # step 7: recover all controllers
            - ['PoweronController1']
            - ['PoweronController2']
            - ['PoweronController3']

        ExitSequence:
            - ['DeleteVirtualWire1TORAttachment']
            - ['DeleteVirtualWire2TORAttachment']
            - ["DeleteTOR"]
            - ["RemoveFromPTEPCluster"]

            - ['CleanupTORSimulator']
            - ['PoweroffVMs']
            - ['DeleteVM1Vnic1', 'DeleteVM4Vnic1', 'DeleteVM7Vnic1', 'DeleteVM10Vnic1']
            - ['DeleteVM2Vnic1', 'DeleteVM5Vnic1', 'DeleteVM8Vnic1', 'DeleteVM11Vnic1']
            - ['DeleteVM3Vnic1', 'DeleteVM6Vnic1', 'DeleteVM9Vnic1', 'DeleteVM12Vnic1']
            - ['DeleteAllVirtualWires']

        SetupTORSimulator: *SETUP_TOR_SIMUATOR_2_GATEWAYS
        TORGatewaySetController: *TOR_GATEWAY_SET_CONTROLLER
        VerifyTORsConnected: *VERIFY_2_TOR_INSTANCES_CONNECTED
        CreateVirtualWires: *CREATE_VIRTUALWIRES
        PlaceVMsOnVirtualWire1: *PLACE_VMS_ON_VIRTUAL_WIRE_1
        PlaceVMsOnVirtualWire2: *PLACE_VMS_ON_VIRTUAL_WIRE_2
        PlaceVMsOnVirtualWire3: *PLACE_VMS_ON_VIRTUAL_WIRE_3
        PoweronVM1: *POWER_ON_VM1
        PoweronVM2: *POWER_ON_VM2
        PoweronVM3: *POWER_ON_VM3
        PoweronVM4: *POWER_ON_VM4
        PoweronVM5: *POWER_ON_VM5
        PoweronVM6: *POWER_ON_VM6
        PoweronVM7: *POWER_ON_VM7
        PoweronVM8: *POWER_ON_VM8
        PoweronVM9: *POWER_ON_VM9
        PoweronVM10: *POWER_ON_VM10
        PoweronVM11: *POWER_ON_VM11
        PoweronVM12: *POWER_ON_VM12
        AddToPTEPCluster: *ADD_3_PTEPS_TO_CLUSTER
        CreateTOROnVSM: *CREATE_2_TOR_ON_VSM
        CreateTORBinding: *CREATE_4_TOR_BINDINGS
        CreateTORAttachmentToVirtualWire1: *CREATE_2_TOR_ATTACHMENTS_TO_VWIRE_1
        CreateTORAttachmentToVirtualWire2: *CREATE_2_TOR_ATTACHMENTS_TO_VWIRE_2
        ShutdownController1: *SHUTDOWN_CONTROLLER_1
        ShutdownController2: *SHUTDOWN_CONTROLLER_2
        ShutdownController3: *SHUTDOWN_CONTROLLER_3
        PoweronController1: *POWERON_CONTROLLER_1
        PoweronController2: *POWERON_CONTROLLER_2
        PoweronController3: *POWERON_CONTROLLER_3
        NetperfTestVirtualWire1: *NETPERF_TEST_VIRTUAL_WIRE_1
        NetperfTestVirtualWire2: *NETPERF_TEST_VIRTUAL_WIRE_2
        NetperfTestVirtualWire3: *NETPERF_TEST_VIRTUAL_WIRE_3

        DeleteVirtualWire1TORAttachment: *DELETE_VWIRE1_2_TOR_ATTACHMENTS
        DeleteVirtualWire2TORAttachment: *DELETE_VWIRE2_2_TOR_ATTACHMENTS
        DeleteTOR: *DELETE_TOR_ON_VSM
        RemoveFromPTEPCluster: *REMOVE_FROM_PTEP_CLUSTER
        CleanupTORSimulator: *CLEANUP_TOR_SIMUATOR_2_GATEWAYS
        PoweroffVMs: *POWER_OFF_VMS
        DeleteVM1Vnic1: *DELETE_VM1_VNIC1
        DeleteVM2Vnic1: *DELETE_VM2_VNIC1
        DeleteVM3Vnic1: *DELETE_VM3_VNIC1
        DeleteVM4Vnic1: *DELETE_VM4_VNIC1
        DeleteVM5Vnic1: *DELETE_VM5_VNIC1
        DeleteVM6Vnic1: *DELETE_VM6_VNIC1
        DeleteVM7Vnic1: *DELETE_VM7_VNIC1
        DeleteVM8Vnic1: *DELETE_VM8_VNIC1
        DeleteVM9Vnic1: *DELETE_VM9_VNIC1
        DeleteVM10Vnic1: *DELETE_VM10_VNIC1
        DeleteVM11Vnic1: *DELETE_VM11_VNIC1
        DeleteVM12Vnic1: *DELETE_VM12_VNIC1
        DeleteAllVirtualWires: *DELETE_ALL_VIRTUALWIRES

        NetperfTestVirtualWire1WithTORAttachment:
          Type:            "Traffic"
          toolName:        "iperf"
          L4Protocol:      "tcp"
          TestAdapter:     "torgateway.[1].pif.[3],
                            torgateway.[2].pif.[3]"
          SupportAdapter:  "vm.[1].vnic.[1],vm.[4].vnic.[1],vm.[7].vnic.[1],vm.[10].vnic.[1]"
          TestDuration:    "30"

        NetperfTestVirtualWire2WithTORAttachment:
          Type:            "Traffic"
          toolName:        "iperf"
          L4Protocol:      "udp"
          udpbandwidth:    *UDP_TRAFFIC_BANDWIDTH
          TestAdapter:     "torgateway.[1].pif.[4],
                            torgateway.[2].pif.[4]"
          SupportAdapter:  "vm.[2].vnic.[1],vm.[5].vnic.[1],vm.[8].vnic.[1],vm.[11].vnic.[1]"
          TestDuration:    "30"

TorHostMacMovedFromOneVlanToAnother:
    <<: *TDS_COMMON_FIELDS_P1_CASE
    Component: "VXLAN controller"
    TestName:  "TorHostMacMovedFromOneVlanToAnother"
    Developer: "mqing"
    TestbedSpec: *FUNCTIONAL_TOPOLOGY_2
    Summary: |
        ToR host MAC moved from one VLAN to another
    WORKLOADS:
        Sequence:
            # step 1: setup TOR simulators
            - ['SetupTORSimulator']
            - ['CreateTOROnVSM']
            # connect TOR gateway
            - ['TORGatewaySetController']
            - ["VerifyTORsConnected"]

            # step 2: legacy virtualwires setup
            - ['CreateVirtualWires']
            - ['PlaceVMsOnVirtualWire1']
            - ['PlaceVMsOnVirtualWire2']
            - ['PlaceVMsOnVirtualWire3']
            - ['PoweronVM1','PoweronVM4','PoweronVM7','PoweronVM10']
            - ['PoweronVM2','PoweronVM5','PoweronVM8','PoweronVM11']
            - ['PoweronVM3','PoweronVM6','PoweronVM9','PoweronVM12']
            - ['NetperfTestVirtualWire1']
            - ['NetperfTestVirtualWire2']
            - ['NetperfTestVirtualWire3']

            # step 3: configure TOR gateway related
            - ['AddToPTEPCluster']
            - ['CreateTORBinding']
            - ['CreateTORAttachmentToVirtualWire1']
            - ['CreateTORAttachmentToVirtualWire2']

            # step 4: TOR functions verification
            - ['NetperfTestVirtualWire1WithTORAttachment']
            - ['NetperfTestVirtualWire2WithTORAttachment']
            - ['NetperfTestVirtualWire3']

            # step 5: swap mac address of tor switch1 port 1 and tor switch 2 port 1
            - ['ReadTorGateway1Switch1Port1MacAddress']

            # step 6: TOR functions verification
            - ['NetperfTestVirtualWire1WithTORAttachment']
            - ['NetperfTestVirtualWire2WithTORAttachment']
            - ['NetperfTestVirtualWire3']

            # step 7: restore mac address of tor switch1 port 1 and tor switch2 port 1
            - ['RestoreTorGateway1Switch1Port1MacAddress']

            # step 8: TOR functions verification
            - ['NetperfTestVirtualWire1WithTORAttachment']
            - ['NetperfTestVirtualWire2WithTORAttachment']
            - ['NetperfTestVirtualWire3']

        ExitSequence:
            - ['DeleteVirtualWire1TORAttachment']
            - ['DeleteVirtualWire2TORAttachment']
            - ["DeleteTOR"]
            - ["RemoveFromPTEPCluster"]

            - ['CleanupTORSimulator']
            - ['PoweroffVMs']
            - ['DeleteVM1Vnic1', 'DeleteVM4Vnic1', 'DeleteVM7Vnic1', 'DeleteVM10Vnic1']
            - ['DeleteVM2Vnic1', 'DeleteVM5Vnic1', 'DeleteVM8Vnic1', 'DeleteVM11Vnic1']
            - ['DeleteVM3Vnic1', 'DeleteVM6Vnic1', 'DeleteVM9Vnic1', 'DeleteVM12Vnic1']
            - ['DeleteAllVirtualWires']

        SetupTORSimulator: *SETUP_TOR_SIMUATOR_2_GATEWAYS
        TORGatewaySetController: *TOR_GATEWAY_SET_CONTROLLER
        VerifyTORsConnected: *VERIFY_2_TOR_INSTANCES_CONNECTED
        CreateVirtualWires: *CREATE_VIRTUALWIRES
        PlaceVMsOnVirtualWire1: *PLACE_VMS_ON_VIRTUAL_WIRE_1
        PlaceVMsOnVirtualWire2: *PLACE_VMS_ON_VIRTUAL_WIRE_2
        PlaceVMsOnVirtualWire3: *PLACE_VMS_ON_VIRTUAL_WIRE_3
        PoweronVM1: *POWER_ON_VM1
        PoweronVM2: *POWER_ON_VM2
        PoweronVM3: *POWER_ON_VM3
        PoweronVM4: *POWER_ON_VM4
        PoweronVM5: *POWER_ON_VM5
        PoweronVM6: *POWER_ON_VM6
        PoweronVM7: *POWER_ON_VM7
        PoweronVM8: *POWER_ON_VM8
        PoweronVM9: *POWER_ON_VM9
        PoweronVM10: *POWER_ON_VM10
        PoweronVM11: *POWER_ON_VM11
        PoweronVM12: *POWER_ON_VM12
        AddToPTEPCluster: *ADD_3_PTEPS_TO_CLUSTER
        CreateTOROnVSM: *CREATE_2_TOR_ON_VSM
        CreateTORBinding: *CREATE_4_TOR_BINDINGS
        CreateTORAttachmentToVirtualWire1: *CREATE_2_TOR_ATTACHMENTS_TO_VWIRE_1
        CreateTORAttachmentToVirtualWire2: *CREATE_2_TOR_ATTACHMENTS_TO_VWIRE_2
        ReadTorGateway1Switch1Port1MacAddress: *READ_TORGATEWAY1_SWITCH1_PORT1_MAC_ADDRESS
        RestoreTorGateway1Switch1Port1MacAddress: *RESTORE_TORGATEWAY1_SWITCH1_PORT1_MAC_ADDRESS
        NetperfTestVirtualWire1: *NETPERF_TEST_VIRTUAL_WIRE_1
        NetperfTestVirtualWire2: *NETPERF_TEST_VIRTUAL_WIRE_2
        NetperfTestVirtualWire3: *NETPERF_TEST_VIRTUAL_WIRE_3
        DeleteVirtualWire1TORAttachment: *DELETE_VWIRE1_2_TOR_ATTACHMENTS
        DeleteVirtualWire2TORAttachment: *DELETE_VWIRE2_2_TOR_ATTACHMENTS
        DeleteTOR: *DELETE_TOR_ON_VSM
        RemoveFromPTEPCluster: *REMOVE_FROM_PTEP_CLUSTER
        CleanupTORSimulator: *CLEANUP_TOR_SIMUATOR_2_GATEWAYS
        PoweroffVMs: *POWER_OFF_VMS
        DeleteVM1Vnic1: *DELETE_VM1_VNIC1
        DeleteVM2Vnic1: *DELETE_VM2_VNIC1
        DeleteVM3Vnic1: *DELETE_VM3_VNIC1
        DeleteVM4Vnic1: *DELETE_VM4_VNIC1
        DeleteVM5Vnic1: *DELETE_VM5_VNIC1
        DeleteVM6Vnic1: *DELETE_VM6_VNIC1
        DeleteVM7Vnic1: *DELETE_VM7_VNIC1
        DeleteVM8Vnic1: *DELETE_VM8_VNIC1
        DeleteVM9Vnic1: *DELETE_VM9_VNIC1
        DeleteVM10Vnic1: *DELETE_VM10_VNIC1
        DeleteVM11Vnic1: *DELETE_VM11_VNIC1
        DeleteVM12Vnic1: *DELETE_VM12_VNIC1
        DeleteAllVirtualWires: *DELETE_ALL_VIRTUALWIRES

        NetperfTestVirtualWire1WithTORAttachment:
          Type:            "Traffic"
          toolName:        "iperf"
          L4Protocol:      "tcp"
          TestAdapter:     "torgateway.[1].pif.[3],
                            torgateway.[2].pif.[3]"
          SupportAdapter:  "vm.[1].vnic.[1],vm.[4].vnic.[1],vm.[7].vnic.[1],vm.[10].vnic.[1]"
          TestDuration:    "30"

        NetperfTestVirtualWire2WithTORAttachment:
          Type:            "Traffic"
          toolName:        "iperf"
          L4Protocol:      "udp"
          udpbandwidth:    *UDP_TRAFFIC_BANDWIDTH
          TestAdapter:     "torgateway.[1].pif.[4],
                            torgateway.[2].pif.[4]"
          SupportAdapter:  "vm.[2].vnic.[1],vm.[5].vnic.[1],vm.[8].vnic.[1],vm.[11].vnic.[1]"
          TestDuration:    "30"

ClearArpMacTable:
    <<: *TDS_COMMON_FIELDS_P1_CASE
    Component: "VXLAN controller"
    TestName:  "ClearArpMacTable"
    Developer: "mqing"
    TestbedSpec: *FUNCTIONAL_TOPOLOGY_2
    Summary: |
        Look to see all learned MACs from bridged VLANs are
        removed MAC table is cleared from controller, also
        verify TOR hosts mac learned again
    WORKLOADS:
        Sequence:
            # step 1: setup TOR simulators
            - ['SetupTORSimulator']
            - ['CreateTOROnVSM']
            # connect TOR gateway
            - ['TORGatewaySetController']
            - ["VerifyTORsConnected"]

            # step 2: legacy virtualwires setup
            - ['CreateVirtualWires']
            - ['PlaceVMsOnVirtualWire1']
            - ['PlaceVMsOnVirtualWire2']
            - ['PlaceVMsOnVirtualWire3']
            - ['PoweronVM1','PoweronVM4','PoweronVM7','PoweronVM10']
            - ['PoweronVM2','PoweronVM5','PoweronVM8','PoweronVM11']
            - ['PoweronVM3','PoweronVM6','PoweronVM9','PoweronVM12']
            - ['TrafficTestVirtualWire1']
            - ['TrafficTestVirtualWire2']
            - ['TrafficTestVirtualWire3']
            - ['VerifyVirtualWire1ArpEntryOnController',
               'VerifyVirtualWire2ArpEntryOnController',
               'VerifyVirtualWire3ArpEntryOnController']
            - ['VerifyVirtualWire1MacEntryOnController',
               'VerifyVirtualWire2MacEntryOnController',
               'VerifyVirtualWire3MacEntryOnController']

            # step 3: configure TOR gateway related
            - ['AddToPTEPCluster']
            - ['CreateTORBinding']
            - ['CreateTORAttachmentToVirtualWire1']
            - ['CreateTORAttachmentToVirtualWire2']

            # step 4: verify TOR ARP/MAC on hosts
            - ['ArpingVirtualWire1WithTORAttachment']
            - ['CheckVirtualWire1ArpEntryOnHost4']
            - ['VerifyVirtualWire1TorPortsMacEntryOnHost']
            - ['ArpingVirtualWire2WithTORAttachment']
            - ['CheckVirtualWire2ArpEntryOnHost5']
            - ['VerifyVirtualWire2TorPortsMacEntryOnHost']

            # step 5: clear all mac arp table on hosts
            - ['ClearArpEntryForVirtualWire1OnAllHosts']
            - ['ClearMacEntryForVirtualWire1OnAllHosts']
            - ['ClearArpEntryForVirtualWire2OnAllHosts']
            - ['ClearMacEntryForVirtualWire2OnAllHosts']

            # step 6: verify mac arp info can be learned again on hosts
            - ['ArpingVirtualWire1WithTORAttachment']
            - ['CheckVirtualWire1ArpEntryOnHost4']
            - ['VerifyVirtualWire1TorPortsMacEntryOnHost']
            - ['ArpingVirtualWire2WithTORAttachment']
            - ['CheckVirtualWire2ArpEntryOnHost5']
            - ['VerifyVirtualWire2TorPortsMacEntryOnHost']

        ExitSequence:
            - ['DeleteVirtualWire1TORAttachment']
            - ['DeleteVirtualWire2TORAttachment']
            - ["DeleteTOR"]
            - ["RemoveFromPTEPCluster"]

            - ['CleanupTORSimulator']
            - ['PoweroffVMs']
            - ['DeleteVM1Vnic1', 'DeleteVM4Vnic1', 'DeleteVM7Vnic1', 'DeleteVM10Vnic1']
            - ['DeleteVM2Vnic1', 'DeleteVM5Vnic1', 'DeleteVM8Vnic1', 'DeleteVM11Vnic1']
            - ['DeleteVM3Vnic1', 'DeleteVM6Vnic1', 'DeleteVM9Vnic1', 'DeleteVM12Vnic1']
            - ['DeleteAllVirtualWires']

        SetupTORSimulator: *SETUP_TOR_SIMUATOR_2_GATEWAYS
        TORGatewaySetController: *TOR_GATEWAY_SET_CONTROLLER
        VerifyTORsConnected: *VERIFY_2_TOR_INSTANCES_CONNECTED
        CreateVirtualWires: *CREATE_VIRTUALWIRES
        PlaceVMsOnVirtualWire1: *PLACE_VMS_ON_VIRTUAL_WIRE_1
        PlaceVMsOnVirtualWire2: *PLACE_VMS_ON_VIRTUAL_WIRE_2
        PlaceVMsOnVirtualWire3: *PLACE_VMS_ON_VIRTUAL_WIRE_3
        PoweronVM1: *POWER_ON_VM1
        PoweronVM2: *POWER_ON_VM2
        PoweronVM3: *POWER_ON_VM3
        PoweronVM4: *POWER_ON_VM4
        PoweronVM5: *POWER_ON_VM5
        PoweronVM6: *POWER_ON_VM6
        PoweronVM7: *POWER_ON_VM7
        PoweronVM8: *POWER_ON_VM8
        PoweronVM9: *POWER_ON_VM9
        PoweronVM10: *POWER_ON_VM10
        PoweronVM11: *POWER_ON_VM11
        PoweronVM12: *POWER_ON_VM12
        AddToPTEPCluster: *ADD_3_PTEPS_TO_CLUSTER
        CreateTOROnVSM: *CREATE_2_TOR_ON_VSM
        CreateTORBinding: *CREATE_4_TOR_BINDINGS
        CreateTORAttachmentToVirtualWire1: *CREATE_2_TOR_ATTACHMENTS_TO_VWIRE_1
        CreateTORAttachmentToVirtualWire2: *CREATE_2_TOR_ATTACHMENTS_TO_VWIRE_2
        VerifyVirtualWire1ArpEntryOnController: *VERIFY_VWIRE1_ARP_ENTRY_ON_CONTROLLER
        VerifyVirtualWire2ArpEntryOnController: *VERIFY_VWIRE2_ARP_ENTRY_ON_CONTROLLER
        VerifyVirtualWire3ArpEntryOnController: *VERIFY_VWIRE3_ARP_ENTRY_ON_CONTROLLER
        VerifyVirtualWire1MacEntryOnController: *VERIFY_VWIRE1_MAC_ENTRY_ON_CONTROLLER
        VerifyVirtualWire2MacEntryOnController: *VERIFY_VWIRE2_MAC_ENTRY_ON_CONTROLLER
        VerifyVirtualWire3MacEntryOnController: *VERIFY_VWIRE3_MAC_ENTRY_ON_CONTROLLER
        CheckVirtualWire1ArpEntryOnHost4: *VERIFY_VWIRE1_ARP_ENTRY_ON_HOST_4
        CheckVirtualWire2ArpEntryOnHost5: *VERIFY_VWIRE2_ARP_ENTRY_ON_HOST_5
        VerifyVirtualWire1TorPortsMacEntryOnHost: *VERIFY_VWIRE1_TOR_PORTS_MAC_ENTRY_ON_HOST_4
        VerifyVirtualWire2TorPortsMacEntryOnHost: *VERIFY_VWIRE2_TOR_PORTS_MAC_ENTRY_ON_HOST_5
        ClearArpEntryForVirtualWire1OnAllHosts: *CLEAR_ARP_ENTRY_FOR_VWIRE1_ON_ALL_HOSTS
        ClearMacEntryForVirtualWire1OnAllHosts: *CLEAR_MAC_ENTRY_FOR_VWIRE1_ON_ALL_HOSTS
        ClearArpEntryForVirtualWire2OnAllHosts: *CLEAR_ARP_ENTRY_FOR_VWIRE2_ON_ALL_HOSTS
        ClearMacEntryForVirtualWire2OnAllHosts: *CLEAR_MAC_ENTRY_FOR_VWIRE2_ON_ALL_HOSTS
        DeleteVirtualWire1TORAttachment: *DELETE_VWIRE1_2_TOR_ATTACHMENTS
        DeleteVirtualWire2TORAttachment: *DELETE_VWIRE2_2_TOR_ATTACHMENTS
        DeleteTOR: *DELETE_TOR_ON_VSM
        RemoveFromPTEPCluster: *REMOVE_FROM_PTEP_CLUSTER
        CleanupTORSimulator: *CLEANUP_TOR_SIMUATOR_2_GATEWAYS
        PoweroffVMs: *POWER_OFF_VMS
        DeleteVM1Vnic1: *DELETE_VM1_VNIC1
        DeleteVM2Vnic1: *DELETE_VM2_VNIC1
        DeleteVM3Vnic1: *DELETE_VM3_VNIC1
        DeleteVM4Vnic1: *DELETE_VM4_VNIC1
        DeleteVM5Vnic1: *DELETE_VM5_VNIC1
        DeleteVM6Vnic1: *DELETE_VM6_VNIC1
        DeleteVM7Vnic1: *DELETE_VM7_VNIC1
        DeleteVM8Vnic1: *DELETE_VM8_VNIC1
        DeleteVM9Vnic1: *DELETE_VM9_VNIC1
        DeleteVM10Vnic1: *DELETE_VM10_VNIC1
        DeleteVM11Vnic1: *DELETE_VM11_VNIC1
        DeleteVM12Vnic1: *DELETE_VM12_VNIC1
        DeleteAllVirtualWires: *DELETE_ALL_VIRTUALWIRES

        TrafficTestVirtualWire1:
          Type:            "Traffic"
          toolName:        "ping"
          TestAdapter:     "vm.[1].vnic.[1]"
          SupportAdapter:  "vm.[4].vnic.[1],vm.[7].vnic.[1]"
          TestDuration:    "30"

        TrafficTestVirtualWire2:
          Type:            "Traffic"
          toolName:        "ping"
          TestAdapter:     "vm.[2].vnic.[1]"
          SupportAdapter:  "vm.[5].vnic.[1],vm.[8].vnic.[1]"
          TestDuration:    "30"

        TrafficTestVirtualWire3:
          Type:            "Traffic"
          toolName:        "ping"
          TestAdapter:     "vm.[3].vnic.[1]"
          SupportAdapter:  "vm.[6].vnic.[1],vm.[9].vnic.[1]"
          TestDuration:    "30"

        ArpingVirtualWire1WithTORAttachment:
          Type:            "Traffic"
          toolName:        "ArpPing"
          TestAdapter:     "torgateway.[1].pif.[3],
                            torgateway.[2].pif.[3]"
          SupportAdapter:  "vm.[1].vnic.[1],vm.[4].vnic.[1],vm.[7].vnic.[1],vm.[10].vnic.[1]"
          TestDuration:    "10"

        ArpingVirtualWire2WithTORAttachment:
          Type:            "Traffic"
          toolName:        "ArpPing"
          TestAdapter:     "torgateway.[1].pif.[4],
                            torgateway.[2].pif.[4]"
          SupportAdapter:  "vm.[2].vnic.[1],vm.[5].vnic.[1],vm.[8].vnic.[1],vm.[11].vnic.[1]"
          TestDuration:    "10"

DuplicateMacSameBridgedVLAN:
    <<: *TDS_COMMON_FIELDS_P1_CASE
    Component: "VXLAN controller"
    TestName:  "DuplicateMacSameBridgedVLAN"
    Developer: "mqing"
    TestbedSpec: *FUNCTIONAL_TOPOLOGY_2
    Summary: |
        Add two hosts to a bridged VLAN that have the same MAC address
    WORKLOADS:
        Sequence:
            # step 1: setup TOR simulators
            - ['SetupTORSimulator']
            - ['CreateTOROnVSM']
            # connect TOR gateway
            - ['TORGatewaySetController']
            - ["VerifyTORsConnected"]

            # step 2: legacy virtualwires setup
            - ['CreateVirtualWires']
            - ['PlaceVMsOnVirtualWire1']
            - ['PlaceVMsOnVirtualWire2']
            - ['PlaceVMsOnVirtualWire3']
            - ['PoweronVM1','PoweronVM4','PoweronVM7','PoweronVM10']
            - ['PoweronVM2','PoweronVM5','PoweronVM8','PoweronVM11']
            - ['PoweronVM3','PoweronVM6','PoweronVM9','PoweronVM12']
            - ['NetperfTestVirtualWire1']
            - ['NetperfTestVirtualWire2']
            - ['NetperfTestVirtualWire3']

            # step 3: configure TOR gateway related
            - ['AddToPTEPCluster']
            - ['CreateTORBinding']
            - ['CreateTORAttachmentToVirtualWire1']
            - ['CreateTORAttachmentToVirtualWire2']

            # step 4: TOR functions verification
            - ['NetperfTestVirtualWire1WithTORAttachment']
            - ['NetperfTestVirtualWire2WithTORAttachment']
            - ['NetperfTestVirtualWire3']

            # step 5: change mac address of tor switch1 port1 to tor switch1 port2
            - ['ReadTorGateway1Switch1Port1MacAddress']
            - ['ReadTorGateway1Switch1Port2MacAddress']
            - ['ChangeTorGateway1Switch1Port1ToSwitch1Port2MacAddress']

            # step 6: TOR functions verification
            - ['NetperfTestVirtualWire1WithTORAttachmentIgnore']
            - ['NetperfTestVirtualWire2WithTORAttachmentIgnore']
            - ['NetperfTestVirtualWire3']

            # step 7: restore mac address of tor switch1 port 1
            - ['RestoreTorGateway1Switch1Port1MacAddress']

            # step 8: TOR functions verification
            - ['NetperfTestVirtualWire1WithTORAttachment']
            - ['NetperfTestVirtualWire2WithTORAttachment']
            - ['NetperfTestVirtualWire3']

        ExitSequence:
            - ['DeleteVirtualWire1TORAttachment']
            - ['DeleteVirtualWire2TORAttachment']
            - ["DeleteTOR"]
            - ["RemoveFromPTEPCluster"]

            - ['CleanupTORSimulator']
            - ['PoweroffVMs']
            - ['DeleteVM1Vnic1', 'DeleteVM4Vnic1', 'DeleteVM7Vnic1', 'DeleteVM10Vnic1']
            - ['DeleteVM2Vnic1', 'DeleteVM5Vnic1', 'DeleteVM8Vnic1', 'DeleteVM11Vnic1']
            - ['DeleteVM3Vnic1', 'DeleteVM6Vnic1', 'DeleteVM9Vnic1', 'DeleteVM12Vnic1']
            - ['DeleteAllVirtualWires']

        SetupTORSimulator: *SETUP_TOR_SIMUATOR_2_GATEWAYS
        TORGatewaySetController: *TOR_GATEWAY_SET_CONTROLLER
        VerifyTORsConnected: *VERIFY_2_TOR_INSTANCES_CONNECTED
        CreateVirtualWires: *CREATE_VIRTUALWIRES
        PlaceVMsOnVirtualWire1: *PLACE_VMS_ON_VIRTUAL_WIRE_1
        PlaceVMsOnVirtualWire2: *PLACE_VMS_ON_VIRTUAL_WIRE_2
        PlaceVMsOnVirtualWire3: *PLACE_VMS_ON_VIRTUAL_WIRE_3
        PoweronVM1: *POWER_ON_VM1
        PoweronVM2: *POWER_ON_VM2
        PoweronVM3: *POWER_ON_VM3
        PoweronVM4: *POWER_ON_VM4
        PoweronVM5: *POWER_ON_VM5
        PoweronVM6: *POWER_ON_VM6
        PoweronVM7: *POWER_ON_VM7
        PoweronVM8: *POWER_ON_VM8
        PoweronVM9: *POWER_ON_VM9
        PoweronVM10: *POWER_ON_VM10
        PoweronVM11: *POWER_ON_VM11
        PoweronVM12: *POWER_ON_VM12
        AddToPTEPCluster: *ADD_3_PTEPS_TO_CLUSTER
        CreateTOROnVSM: *CREATE_2_TOR_ON_VSM
        CreateTORBinding: *CREATE_4_TOR_BINDINGS
        CreateTORAttachmentToVirtualWire1: *CREATE_2_TOR_ATTACHMENTS_TO_VWIRE_1
        CreateTORAttachmentToVirtualWire2: *CREATE_2_TOR_ATTACHMENTS_TO_VWIRE_2
        ReadTorGateway1Switch1Port1MacAddress: *READ_TORGATEWAY1_SWITCH1_PORT1_MAC_ADDRESS
        ReadTorGateway1Switch1Port2MacAddress: *READ_TORGATEWAY1_SWITCH1_PORT2_MAC_ADDRESS
        ChangeTorGateway1Switch1Port1ToSwitch1Port2MacAddress: *CHANGE_TORGATEWAY1_SWITCH1_PORT1_TO_SWITCH1_PORT2_MAC_ADDRESS
        RestoreTorGateway1Switch1Port1MacAddress: *RESTORE_TORGATEWAY1_SWITCH1_PORT1_MAC_ADDRESS
        NetperfTestVirtualWire1: *NETPERF_TEST_VIRTUAL_WIRE_1
        NetperfTestVirtualWire2: *NETPERF_TEST_VIRTUAL_WIRE_2
        NetperfTestVirtualWire3: *NETPERF_TEST_VIRTUAL_WIRE_3
        DeleteVirtualWire1TORAttachment: *DELETE_VWIRE1_2_TOR_ATTACHMENTS
        DeleteVirtualWire2TORAttachment: *DELETE_VWIRE2_2_TOR_ATTACHMENTS
        DeleteTOR: *DELETE_TOR_ON_VSM
        RemoveFromPTEPCluster: *REMOVE_FROM_PTEP_CLUSTER
        CleanupTORSimulator: *CLEANUP_TOR_SIMUATOR_2_GATEWAYS
        PoweroffVMs: *POWER_OFF_VMS
        DeleteVM1Vnic1: *DELETE_VM1_VNIC1
        DeleteVM2Vnic1: *DELETE_VM2_VNIC1
        DeleteVM3Vnic1: *DELETE_VM3_VNIC1
        DeleteVM4Vnic1: *DELETE_VM4_VNIC1
        DeleteVM5Vnic1: *DELETE_VM5_VNIC1
        DeleteVM6Vnic1: *DELETE_VM6_VNIC1
        DeleteVM7Vnic1: *DELETE_VM7_VNIC1
        DeleteVM8Vnic1: *DELETE_VM8_VNIC1
        DeleteVM9Vnic1: *DELETE_VM9_VNIC1
        DeleteVM10Vnic1: *DELETE_VM10_VNIC1
        DeleteVM11Vnic1: *DELETE_VM11_VNIC1
        DeleteVM12Vnic1: *DELETE_VM12_VNIC1
        DeleteAllVirtualWires: *DELETE_ALL_VIRTUALWIRES

        NetperfTestVirtualWire1WithTORAttachment:
          Type:            "Traffic"
          toolName:        "iperf"
          L4Protocol:      "tcp"
          TestAdapter:     "torgateway.[1].pif.[3],
                            torgateway.[2].pif.[3]"
          SupportAdapter:  "vm.[1].vnic.[1],vm.[4].vnic.[1],vm.[7].vnic.[1],vm.[10].vnic.[1]"
          TestDuration:    "30"

        NetperfTestVirtualWire2WithTORAttachment:
          Type:            "Traffic"
          toolName:        "iperf"
          L4Protocol:      "udp"
          udpbandwidth:    *UDP_TRAFFIC_BANDWIDTH
          TestAdapter:     "torgateway.[1].pif.[4],
                            torgateway.[2].pif.[4]"
          SupportAdapter:  "vm.[2].vnic.[1],vm.[5].vnic.[1],vm.[8].vnic.[1],vm.[11].vnic.[1]"
          TestDuration:    "30"

        NetperfTestVirtualWire1WithTORAttachmentIgnore:
          Type:            "Traffic"
          toolName:        "iperf"
          L4Protocol:      "tcp"
          TestAdapter:     "torgateway.[1].pif.[3]"
          SupportAdapter:  "vm.[1].vnic.[1]"
          TestDuration:    "30"
          ExpectedResult:  'ignore'

        NetperfTestVirtualWire2WithTORAttachmentIgnore:
          Type:            "Traffic"
          toolName:        "iperf"
          L4Protocol:      "udp"
          udpbandwidth:    *UDP_TRAFFIC_BANDWIDTH
          TestAdapter:     "torgateway.[1].pif.[4]"
          SupportAdapter:  "vm.[2].vnic.[1]"
          TestDuration:    "30"
          ExpectedResult:  'ignore'

DuplicateMacDifferentTors:
    <<: *TDS_COMMON_FIELDS_P1_CASE
    Component: "VXLAN controller"
    TestName:  "DuplicateMacDifferentTors"
    Developer: "mqing"
    TestbedSpec: *FUNCTIONAL_TOPOLOGY_2
    Summary: |
        Verify same MAC is learned by 2 different ToRs. Such state is transient
        and corresponds to topology change, but we want to see that system
        converges after only single ToR has this MAC.
    WORKLOADS:
        Sequence:
            # step 1: setup TOR simulators
            - ['SetupTORSimulator']
            - ['CreateTOROnVSM']
            # connect TOR gateway
            - ['TORGatewaySetController']
            - ["VerifyTORsConnected"]

            # step 2: legacy virtualwires setup
            - ['CreateVirtualWires']
            - ['PlaceVMsOnVirtualWire1']
            - ['PlaceVMsOnVirtualWire2']
            - ['PlaceVMsOnVirtualWire3']
            - ['PoweronVM1','PoweronVM4','PoweronVM7','PoweronVM10']
            - ['PoweronVM2','PoweronVM5','PoweronVM8','PoweronVM11']
            - ['PoweronVM3','PoweronVM6','PoweronVM9','PoweronVM12']
            - ['NetperfTestVirtualWire1']
            - ['NetperfTestVirtualWire2']
            - ['NetperfTestVirtualWire3']

            # step 3: configure TOR gateway related
            - ['AddToPTEPCluster']
            - ['CreateTORBinding']
            - ['CreateTORAttachmentToVirtualWire1']
            - ['CreateTORAttachmentToVirtualWire2']

            # step 4: TOR functions verification
            - ['NetperfTestVirtualWire1WithTORAttachment']
            - ['NetperfTestVirtualWire2WithTORAttachment']
            - ['NetperfTestVirtualWire3']

            # step 5: change mac address of tor switch1 port1 to tor switch1 port2
            - ['ReadTorGateway1Switch1Port1MacAddress']
            - ['ReadTorGateway2Switch1Port1MacAddress']
            - ['ChangeTorGateway1Switch1Port1ToGateway2Switch1Port1MacAddress']

            # step 6: TOR functions verification
            - ['NetperfTestVirtualWire1WithTORAttachment']
            - ['NetperfTestVirtualWire2WithTORAttachment']
            - ['NetperfTestVirtualWire3']

            # step 7: restore mac address of tor switch1 port 1
            - ['RestoreTorGateway1Switch1Port1MacAddress']

            # step 8: TOR functions verification
            - ['NetperfTestVirtualWire1WithTORAttachment']
            - ['NetperfTestVirtualWire2WithTORAttachment']
            - ['NetperfTestVirtualWire3']

        ExitSequence:
            - ['DeleteVirtualWire1TORAttachment']
            - ['DeleteVirtualWire2TORAttachment']
            - ["DeleteTOR"]
            - ["RemoveFromPTEPCluster"]

            - ['CleanupTORSimulator']
            - ['PoweroffVMs']
            - ['DeleteVM1Vnic1', 'DeleteVM4Vnic1', 'DeleteVM7Vnic1', 'DeleteVM10Vnic1']
            - ['DeleteVM2Vnic1', 'DeleteVM5Vnic1', 'DeleteVM8Vnic1', 'DeleteVM11Vnic1']
            - ['DeleteVM3Vnic1', 'DeleteVM6Vnic1', 'DeleteVM9Vnic1', 'DeleteVM12Vnic1']
            - ['DeleteAllVirtualWires']

        SetupTORSimulator: *SETUP_TOR_SIMUATOR_2_GATEWAYS
        TORGatewaySetController: *TOR_GATEWAY_SET_CONTROLLER
        VerifyTORsConnected: *VERIFY_2_TOR_INSTANCES_CONNECTED
        CreateVirtualWires: *CREATE_VIRTUALWIRES
        PlaceVMsOnVirtualWire1: *PLACE_VMS_ON_VIRTUAL_WIRE_1
        PlaceVMsOnVirtualWire2: *PLACE_VMS_ON_VIRTUAL_WIRE_2
        PlaceVMsOnVirtualWire3: *PLACE_VMS_ON_VIRTUAL_WIRE_3
        PoweronVM1: *POWER_ON_VM1
        PoweronVM2: *POWER_ON_VM2
        PoweronVM3: *POWER_ON_VM3
        PoweronVM4: *POWER_ON_VM4
        PoweronVM5: *POWER_ON_VM5
        PoweronVM6: *POWER_ON_VM6
        PoweronVM7: *POWER_ON_VM7
        PoweronVM8: *POWER_ON_VM8
        PoweronVM9: *POWER_ON_VM9
        PoweronVM10: *POWER_ON_VM10
        PoweronVM11: *POWER_ON_VM11
        PoweronVM12: *POWER_ON_VM12
        AddToPTEPCluster: *ADD_3_PTEPS_TO_CLUSTER
        CreateTOROnVSM: *CREATE_2_TOR_ON_VSM
        CreateTORBinding: *CREATE_4_TOR_BINDINGS
        CreateTORAttachmentToVirtualWire1: *CREATE_2_TOR_ATTACHMENTS_TO_VWIRE_1
        CreateTORAttachmentToVirtualWire2: *CREATE_2_TOR_ATTACHMENTS_TO_VWIRE_2
        ReadTorGateway1Switch1Port1MacAddress: *READ_TORGATEWAY1_SWITCH1_PORT1_MAC_ADDRESS
        ReadTorGateway2Switch1Port1MacAddress: *READ_TORGATEWAY2_SWITCH1_PORT1_MAC_ADDRESS
        ChangeTorGateway1Switch1Port1ToGateway2Switch1Port1MacAddress: *CHANGE_TORGATEWAY1_SWITCH1_PORT1_TO_GATEWAY2_SWITCH1_PORT1_MAC_ADDRESS
        RestoreTorGateway1Switch1Port1MacAddress: *RESTORE_TORGATEWAY1_SWITCH1_PORT1_MAC_ADDRESS
        NetperfTestVirtualWire1: *NETPERF_TEST_VIRTUAL_WIRE_1
        NetperfTestVirtualWire2: *NETPERF_TEST_VIRTUAL_WIRE_2
        NetperfTestVirtualWire3: *NETPERF_TEST_VIRTUAL_WIRE_3
        DeleteVirtualWire1TORAttachment: *DELETE_VWIRE1_2_TOR_ATTACHMENTS
        DeleteVirtualWire2TORAttachment: *DELETE_VWIRE2_2_TOR_ATTACHMENTS
        DeleteTOR: *DELETE_TOR_ON_VSM
        RemoveFromPTEPCluster: *REMOVE_FROM_PTEP_CLUSTER
        CleanupTORSimulator: *CLEANUP_TOR_SIMUATOR_2_GATEWAYS
        PoweroffVMs: *POWER_OFF_VMS
        DeleteVM1Vnic1: *DELETE_VM1_VNIC1
        DeleteVM2Vnic1: *DELETE_VM2_VNIC1
        DeleteVM3Vnic1: *DELETE_VM3_VNIC1
        DeleteVM4Vnic1: *DELETE_VM4_VNIC1
        DeleteVM5Vnic1: *DELETE_VM5_VNIC1
        DeleteVM6Vnic1: *DELETE_VM6_VNIC1
        DeleteVM7Vnic1: *DELETE_VM7_VNIC1
        DeleteVM8Vnic1: *DELETE_VM8_VNIC1
        DeleteVM9Vnic1: *DELETE_VM9_VNIC1
        DeleteVM10Vnic1: *DELETE_VM10_VNIC1
        DeleteVM11Vnic1: *DELETE_VM11_VNIC1
        DeleteVM12Vnic1: *DELETE_VM12_VNIC1
        DeleteAllVirtualWires: *DELETE_ALL_VIRTUALWIRES

        NetperfTestVirtualWire1WithTORAttachment:
          Type:            "Traffic"
          toolName:        "iperf"
          L4Protocol:      "tcp"
          TestAdapter:     "torgateway.[1].pif.[3],
                            torgateway.[2].pif.[3]"
          SupportAdapter:  "vm.[1].vnic.[1],vm.[4].vnic.[1],vm.[7].vnic.[1],vm.[10].vnic.[1]"
          TestDuration:    "30"

        NetperfTestVirtualWire2WithTORAttachment:
          Type:            "Traffic"
          toolName:        "iperf"
          L4Protocol:      "udp"
          udpbandwidth:    *UDP_TRAFFIC_BANDWIDTH
          TestAdapter:     "torgateway.[1].pif.[4],
                            torgateway.[2].pif.[4]"
          SupportAdapter:  "vm.[2].vnic.[1],vm.[5].vnic.[1],vm.[8].vnic.[1],vm.[11].vnic.[1]"
          TestDuration:    "30"

VsmDownAndRestore:
    <<: *TDS_COMMON_FIELDS_P1_CASE
    Component: "NSX Manager"
    TestName:  "VsmDownAndRestore"
    Developer: "mqing"
    TestbedSpec: *FUNCTIONAL_TOPOLOGY_2
    Summary: |
        VsmDown: verify VXLAN in headless mode
        VsmRestore: verify VSM down/up, current functions not affected
    WORKLOADS:
        Sequence:
            # step 1: setup TOR simulators
            - ['SetupTORSimulator']
            - ['CreateTOROnVSM']
            - ['TORGatewaySetController']
            - ["VerifyTORsConnected"]

            # step 2: legacy virtualwires setup
            - ['CreateVirtualWires']
            - ['PlaceVMsOnVirtualWire1']
            - ['PlaceVMsOnVirtualWire2']
            - ['PoweronVM1','PoweronVM4','PoweronVM7','PoweronVM10']
            - ['PoweronVM2','PoweronVM5','PoweronVM8','PoweronVM11']

            # step 3: configure TOR gateway related
            - ['AddToPTEPCluster']
            - ['CreateTORBinding']
            - ['CreateTORAttachmentToVirtualWire1']
            - ['CreateTORAttachmentToVirtualWire2']

            # step 4: TOR functions verification
            - ['TrafficTestVirtualWire1FromTorToHosts']
            - ['TrafficTestVirtualWire2FromTorToHosts']

            # step 5: we cannot shutdown VSM since it is deployed in nimbus,
            # but we can do it by restarting it and send traffic in parallel,
            # we can send traffic during VSM recover to simulate the shutdown
            # behaviour check current traffic not affected
            - ['RebootVSM', 'LongtimeTrafficTestVirtualWire1FromTorToHosts']

            # step 6, after VSM recover, doing functions verification again
            - ['TrafficTestVirtualWire1FromTorToHosts']
            - ['TrafficTestVirtualWire2FromTorToHosts']

        ExitSequence:
            - ['DeleteVirtualWire1TORAttachment']
            - ['DeleteVirtualWire2TORAttachment']
            - ["DeleteTOR"]
            - ["RemoveFromPTEPCluster"]

            - ['CleanupTORSimulator']
            - ['PoweroffVMs']
            - ['DeleteVM1Vnic1', 'DeleteVM4Vnic1', 'DeleteVM7Vnic1', 'DeleteVM10Vnic1']
            - ['DeleteVM2Vnic1', 'DeleteVM5Vnic1', 'DeleteVM8Vnic1', 'DeleteVM11Vnic1']
            - ['DeleteAllVirtualWires']

        SetupTORSimulator: *SETUP_TOR_SIMUATOR_2_GATEWAYS
        TORGatewaySetController: *TOR_GATEWAY_SET_CONTROLLER
        VerifyTORsConnected: *VERIFY_2_TOR_INSTANCES_CONNECTED
        CreateVirtualWires: *CREATE_VIRTUALWIRES
        PlaceVMsOnVirtualWire1: *PLACE_VMS_ON_VIRTUAL_WIRE_1
        PlaceVMsOnVirtualWire2: *PLACE_VMS_ON_VIRTUAL_WIRE_2
        PlaceVMsOnVirtualWire3: *PLACE_VMS_ON_VIRTUAL_WIRE_3
        PoweronVM1: *POWER_ON_VM1
        PoweronVM2: *POWER_ON_VM2
        PoweronVM4: *POWER_ON_VM4
        PoweronVM5: *POWER_ON_VM5
        PoweronVM7: *POWER_ON_VM7
        PoweronVM8: *POWER_ON_VM8
        PoweronVM10: *POWER_ON_VM10
        PoweronVM11: *POWER_ON_VM11
        AddToPTEPCluster: *ADD_3_PTEPS_TO_CLUSTER
        CreateTOROnVSM: *CREATE_2_TOR_ON_VSM
        CreateTORBinding: *CREATE_4_TOR_BINDINGS
        CreateTORAttachmentToVirtualWire1: *CREATE_2_TOR_ATTACHMENTS_TO_VWIRE_1
        CreateTORAttachmentToVirtualWire2: *CREATE_2_TOR_ATTACHMENTS_TO_VWIRE_2
        RebootVSM: *REBOOT_VSM
        DeleteVirtualWire1TORAttachment: *DELETE_VWIRE1_2_TOR_ATTACHMENTS
        DeleteVirtualWire2TORAttachment: *DELETE_VWIRE2_2_TOR_ATTACHMENTS
        DeleteTOR: *DELETE_TOR_ON_VSM
        RemoveFromPTEPCluster: *REMOVE_FROM_PTEP_CLUSTER
        CleanupTORSimulator: *CLEANUP_TOR_SIMUATOR_2_GATEWAYS
        PoweroffVMs: *POWER_OFF_VMS
        DeleteVM1Vnic1: *DELETE_VM1_VNIC1
        DeleteVM2Vnic1: *DELETE_VM2_VNIC1
        DeleteVM4Vnic1: *DELETE_VM4_VNIC1
        DeleteVM5Vnic1: *DELETE_VM5_VNIC1
        DeleteVM7Vnic1: *DELETE_VM7_VNIC1
        DeleteVM8Vnic1: *DELETE_VM8_VNIC1
        DeleteVM10Vnic1: *DELETE_VM10_VNIC1
        DeleteVM11Vnic1: *DELETE_VM11_VNIC1
        DeleteAllVirtualWires: *DELETE_ALL_VIRTUALWIRES

        TrafficTestVirtualWire1FromTorToHosts:
          Type:            "Traffic"
          toolName:        "ping"
          TestAdapter:     "torgateway.[1].pif.[3],
                            torgateway.[2].pif.[3]"
          SupportAdapter:  "vm.[1].vnic.[1],vm.[4].vnic.[1],vm.[7].vnic.[1],vm.[10].vnic.[1]"
          TestDuration:    "30"

        LongtimeTrafficTestVirtualWire1FromTorToHosts:
          Type:            "Traffic"
          toolName:        "ping"
          TestAdapter:     "torgateway.[1].pif.[3],
                            torgateway.[2].pif.[3]"
          SupportAdapter:  "vm.[1].vnic.[1],vm.[4].vnic.[1],vm.[7].vnic.[1],vm.[10].vnic.[1]"
          TestDuration:    "660"

        TrafficTestVirtualWire2FromTorToHosts:
          Type:            "Traffic"
          toolName:        "ping"
          TestAdapter:     "torgateway.[1].pif.[4],
                            torgateway.[2].pif.[4]"
          SupportAdapter:  "vm.[2].vnic.[1],vm.[5].vnic.[1],vm.[8].vnic.[1],vm.[11].vnic.[1]"
          TestDuration:    "30"

# from here, following test cases will use topo 3
NoControllerWhenVwireCreated:
    <<: *TDS_COMMON_FIELDS_P1_CASE
    Component: "NSX Manager"
    TestName:  "NoControllerWhenVwireCreated"
    Developer: "mqing"
    TestbedSpec: *FUNCTIONAL_TOPOLOGY_3
    Summary: |
        first host preparation with no controller
        create TZ
        create virtual wire, verify when no controller deployed, create virtual wire will failed
        deploy vxlan controller
        create virtualwire again, verify virtualwire can be deployed successfully
    WORKLOADS:
        Sequence:
            # step 1: setup TOR simulators
            - ['SetupTORSimulator']
            - ['CreateTOROnVSM']
            - ['TORGatewaySetController']
            - ["VerifyTORsConnected"]

            # step 2: create TZ
            - ['CreateNetworkScope']

            # step 3: legacy virtualwires setup failed
            - ['CreateVirtualwiresFailed']

            # step 4: deploy vlxan controller
            - ['ThreeControllers']

            # step 5: create virtualwires again
            - ['CreateVirtualWires']
            - ['PlaceVMsOnVirtualWire1']
            - ['PlaceVMsOnVirtualWire2']
            - ['PoweronVM1','PoweronVM4','PoweronVM7','PoweronVM10']
            - ['PoweronVM2','PoweronVM5','PoweronVM8','PoweronVM11']

            # step 6: configure TOR gateway related
            - ['AddToPTEPCluster']
            - ['CreateTORBinding']
            - ['CreateTORAttachmentToVirtualWire1']
            - ['CreateTORAttachmentToVirtualWire2']

            # step 7: TOR functions verification
            - ['TrafficTestVirtualWire1FromTorToHosts']
            - ['TrafficTestVirtualWire2FromTorToHosts']

        ExitSequence:
            - ['DeleteVirtualWire1TORAttachment']
            - ['DeleteVirtualWire2TORAttachment']
            - ["DeleteTOR"]
            - ["RemoveFromPTEPCluster"]

            - ['CleanupTORSimulator']
            - ['PoweroffVMs']
            - ['DeleteVM1Vnic1', 'DeleteVM4Vnic1', 'DeleteVM7Vnic1', 'DeleteVM10Vnic1']
            - ['DeleteVM2Vnic1', 'DeleteVM5Vnic1', 'DeleteVM8Vnic1', 'DeleteVM11Vnic1']
            - ['DeleteAllVirtualWires']

        SetupTORSimulator: *SETUP_TOR_SIMUATOR_2_GATEWAYS
        TORGatewaySetController: *TOR_GATEWAY_SET_CONTROLLER
        VerifyTORsConnected: *VERIFY_2_TOR_INSTANCES_CONNECTED
        CreateVirtualWires: *CREATE_VIRTUALWIRES
        PlaceVMsOnVirtualWire1: *PLACE_VMS_ON_VIRTUAL_WIRE_1
        PlaceVMsOnVirtualWire2: *PLACE_VMS_ON_VIRTUAL_WIRE_2
        PlaceVMsOnVirtualWire3: *PLACE_VMS_ON_VIRTUAL_WIRE_3
        PoweronVM1: *POWER_ON_VM1
        PoweronVM2: *POWER_ON_VM2
        PoweronVM4: *POWER_ON_VM4
        PoweronVM5: *POWER_ON_VM5
        PoweronVM7: *POWER_ON_VM7
        PoweronVM8: *POWER_ON_VM8
        PoweronVM10: *POWER_ON_VM10
        PoweronVM11: *POWER_ON_VM11
        AddToPTEPCluster: *ADD_3_PTEPS_TO_CLUSTER
        CreateTOROnVSM: *CREATE_2_TOR_ON_VSM
        CreateTORBinding: *CREATE_4_TOR_BINDINGS
        CreateTORAttachmentToVirtualWire1: *CREATE_2_TOR_ATTACHMENTS_TO_VWIRE_1
        CreateTORAttachmentToVirtualWire2: *CREATE_2_TOR_ATTACHMENTS_TO_VWIRE_2
        ThreeControllers: *THREE_CONTROLLERS
        CreateNetworkScope: *CREATE_NETWORK_SCOPE
        DeleteVirtualWire1TORAttachment: *DELETE_VWIRE1_2_TOR_ATTACHMENTS
        DeleteVirtualWire2TORAttachment: *DELETE_VWIRE2_2_TOR_ATTACHMENTS
        DeleteTOR: *DELETE_TOR_ON_VSM
        RemoveFromPTEPCluster: *REMOVE_FROM_PTEP_CLUSTER
        CleanupTORSimulator: *CLEANUP_TOR_SIMUATOR_2_GATEWAYS
        PoweroffVMs: *POWER_OFF_VMS
        DeleteVM1Vnic1: *DELETE_VM1_VNIC1
        DeleteVM2Vnic1: *DELETE_VM2_VNIC1
        DeleteVM4Vnic1: *DELETE_VM4_VNIC1
        DeleteVM5Vnic1: *DELETE_VM5_VNIC1
        DeleteVM7Vnic1: *DELETE_VM7_VNIC1
        DeleteVM8Vnic1: *DELETE_VM8_VNIC1
        DeleteVM10Vnic1: *DELETE_VM10_VNIC1
        DeleteVM11Vnic1: *DELETE_VM11_VNIC1
        DeleteAllVirtualWires: *DELETE_ALL_VIRTUALWIRES

        CreateVirtualwiresFailed:
          <<: *CREATE_VIRTUALWIRES
          ExpectedResult: 'Fail'

        TrafficTestVirtualWire1FromTorToHosts:
          Type:            "Traffic"
          toolName:        "ping"
          TestAdapter:     "torgateway.[1].pif.[3],
                            torgateway.[2].pif.[3]"
          SupportAdapter:  "vm.[1].vnic.[1],vm.[4].vnic.[1],vm.[7].vnic.[1],vm.[10].vnic.[1]"
          TestDuration:    "30"

        TrafficTestVirtualWire2FromTorToHosts:
          Type:            "Traffic"
          toolName:        "ping"
          TestAdapter:     "torgateway.[1].pif.[4],
                            torgateway.[2].pif.[4]"
          SupportAdapter:  "vm.[2].vnic.[1],vm.[5].vnic.[1],vm.[8].vnic.[1],vm.[11].vnic.[1]"
          TestDuration:    "30"

ControllerDeployAfterHostPrep:
    <<: *TDS_COMMON_FIELDS_P1_CASE
    Component: "NSX Manager"
    TestName:  "ControllerDeployAfterHostPrep"
    Developer: "mqing"
    TestbedSpec: *FUNCTIONAL_TOPOLOGY_3
    Summary: |
        first host preparation with no controller
        configure vxlan
        deploy controller
        create TZ
        create virtualwire
    WORKLOADS:
        Sequence:
            # step 1: setup TOR simulators
            - ['SetupTORSimulator']
            - ['CreateTOROnVSM']
            - ['TORGatewaySetController']
            - ["VerifyTORsConnected"]

            # step 2: deploy controller and create TZ
            - ['ThreeControllers']
            - ['CreateNetworkScope']

            # step 5: create virtualwires again
            - ['CreateVirtualWires']
            - ['PlaceVMsOnVirtualWire1']
            - ['PlaceVMsOnVirtualWire2']
            - ['PoweronVM1','PoweronVM4','PoweronVM7','PoweronVM10']
            - ['PoweronVM2','PoweronVM5','PoweronVM8','PoweronVM11']

            # step 6: configure TOR gateway related
            - ['AddToPTEPCluster']
            - ['CreateTORBinding']
            - ['CreateTORAttachmentToVirtualWire1']
            - ['CreateTORAttachmentToVirtualWire2']

            # step 7: TOR functions verification
            - ['TrafficTestVirtualWire1FromTorToHosts']
            - ['TrafficTestVirtualWire2FromTorToHosts']

        ExitSequence:
            - ['DeleteVirtualWire1TORAttachment']
            - ['DeleteVirtualWire2TORAttachment']
            - ["DeleteTOR"]
            - ["RemoveFromPTEPCluster"]

            - ['CleanupTORSimulator']
            - ['PoweroffVMs']
            - ['DeleteVM1Vnic1', 'DeleteVM4Vnic1', 'DeleteVM7Vnic1', 'DeleteVM10Vnic1']
            - ['DeleteVM2Vnic1', 'DeleteVM5Vnic1', 'DeleteVM8Vnic1', 'DeleteVM11Vnic1']
            - ['DeleteAllVirtualWires']

        SetupTORSimulator: *SETUP_TOR_SIMUATOR_2_GATEWAYS
        TORGatewaySetController: *TOR_GATEWAY_SET_CONTROLLER
        VerifyTORsConnected: *VERIFY_2_TOR_INSTANCES_CONNECTED
        CreateVirtualWires: *CREATE_VIRTUALWIRES
        PlaceVMsOnVirtualWire1: *PLACE_VMS_ON_VIRTUAL_WIRE_1
        PlaceVMsOnVirtualWire2: *PLACE_VMS_ON_VIRTUAL_WIRE_2
        PlaceVMsOnVirtualWire3: *PLACE_VMS_ON_VIRTUAL_WIRE_3
        PoweronVM1: *POWER_ON_VM1
        PoweronVM2: *POWER_ON_VM2
        PoweronVM4: *POWER_ON_VM4
        PoweronVM5: *POWER_ON_VM5
        PoweronVM7: *POWER_ON_VM7
        PoweronVM8: *POWER_ON_VM8
        PoweronVM10: *POWER_ON_VM10
        PoweronVM11: *POWER_ON_VM11
        AddToPTEPCluster: *ADD_3_PTEPS_TO_CLUSTER
        CreateTOROnVSM: *CREATE_2_TOR_ON_VSM
        CreateTORBinding: *CREATE_4_TOR_BINDINGS
        CreateTORAttachmentToVirtualWire1: *CREATE_2_TOR_ATTACHMENTS_TO_VWIRE_1
        CreateTORAttachmentToVirtualWire2: *CREATE_2_TOR_ATTACHMENTS_TO_VWIRE_2
        ThreeControllers: *THREE_CONTROLLERS
        CreateNetworkScope: *CREATE_NETWORK_SCOPE
        DeleteVirtualWire1TORAttachment: *DELETE_VWIRE1_2_TOR_ATTACHMENTS
        DeleteVirtualWire2TORAttachment: *DELETE_VWIRE2_2_TOR_ATTACHMENTS
        DeleteTOR: *DELETE_TOR_ON_VSM
        RemoveFromPTEPCluster: *REMOVE_FROM_PTEP_CLUSTER
        CleanupTORSimulator: *CLEANUP_TOR_SIMUATOR_2_GATEWAYS
        PoweroffVMs: *POWER_OFF_VMS
        DeleteVM1Vnic1: *DELETE_VM1_VNIC1
        DeleteVM2Vnic1: *DELETE_VM2_VNIC1
        DeleteVM4Vnic1: *DELETE_VM4_VNIC1
        DeleteVM5Vnic1: *DELETE_VM5_VNIC1
        DeleteVM7Vnic1: *DELETE_VM7_VNIC1
        DeleteVM8Vnic1: *DELETE_VM8_VNIC1
        DeleteVM10Vnic1: *DELETE_VM10_VNIC1
        DeleteVM11Vnic1: *DELETE_VM11_VNIC1
        DeleteAllVirtualWires: *DELETE_ALL_VIRTUALWIRES

        TrafficTestVirtualWire1FromTorToHosts:
          Type:            "Traffic"
          toolName:        "ping"
          TestAdapter:     "torgateway.[1].pif.[3],
                            torgateway.[2].pif.[3]"
          SupportAdapter:  "vm.[1].vnic.[1],vm.[4].vnic.[1],vm.[7].vnic.[1],vm.[10].vnic.[1]"
          TestDuration:    "30"

        TrafficTestVirtualWire2FromTorToHosts:
          Type:            "Traffic"
          toolName:        "ping"
          TestAdapter:     "torgateway.[1].pif.[4],
                            torgateway.[2].pif.[4]"
          SupportAdapter:  "vm.[2].vnic.[1],vm.[5].vnic.[1],vm.[8].vnic.[1],vm.[11].vnic.[1]"
          TestDuration:    "30"

