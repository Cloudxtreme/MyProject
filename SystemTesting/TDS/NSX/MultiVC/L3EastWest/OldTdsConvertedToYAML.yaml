---
Category: NSX
Component: network vDR
Summary: 'Verify different VXLAN routing combos with 1 cluster and 1 vds '
Tags: RunOnCAT
TestName: 2Cluster2VDSAllVXLANRoutingCombos1
TestbedSpec:
  host:
    '[1]': {}
    '[2-5]':
      vmnic:
        '[1-2]':
          driver: any
  vc:
    '[1]':
      datacenter:
        '[1]':
          Cluster:
            '[1]':
              host: 'host.[1]'
              name: Controller-Cluster-26724
            '[2]':
              name: Compute-Cluster-SJC-26724
            '[3]':
              name: Compute-Cluster-SFO-26724
          host: 'host.[2-5]'
      dvportgroup:
        '[10]':
          name: dvpg-SFO-vlan19-26724
          vds: 'vc.[1].vds.[2]'
          vlan: 19
          vlantype: access
        '[11]':
          name: dvpg-SFO-vlan21-26724
          vds: 'vc.[1].vds.[2]'
          vlan: 21
          vlantype: access
        '[12]':
          name: dvpg-SFO-vlan22-26724
          vds: 'vc.[1].vds.[2]'
          vlan: 22
          vlantype: access
        '[1]':
          name: dvpg-SJC-vlan16-26724
          vds: 'vc.[1].vds.[1]'
          vlan: 16
          vlantype: access
        '[2]':
          name: dvpg-SJC-vlan17-26724
          vds: 'vc.[1].vds.[1]'
          vlan: 17
          vlantype: access
        '[3]':
          name: dvpg-SJC-vlan18-26724
          vds: 'vc.[1].vds.[1]'
          vlan: 18
          vlantype: access
        '[4]':
          name: dvpg-SJC-mgmt-26724
          vds: 'vc.[1].vds.[1]'
          vlan: 19
          vlantype: access
        '[5]':
          name: dvpg-SJC-vlan21-26724
          vds: 'vc.[1].vds.[1]'
          vlan: 21
          vlantype: access
        '[6]':
          name: dvpg-SJC-vlan22-26724
          vds: 'vc.[1].vds.[1]'
          vlan: 22
          vlantype: access
        '[7]':
          name: dvpg-SFO-vlan16-26724
          vds: 'vc.[1].vds.[2]'
          vlan: 16
          vlantype: access
        '[8]':
          name: dvpg-SFO-vlan17-26724
          vds: 'vc.[1].vds.[2]'
          vlan: 17
          vlantype: access
        '[9]':
          name: dvpg-SFO-vlan18-26724
          vds: 'vc.[1].vds.[2]'
          vlan: 18
          vlantype: access
      vds:
        '[1]':
          configurehosts: add
          datacenter: 'vc.[1].datacenter.[1]'
          host: 'host.[2-3]'
          name: VDS-1-SJC-26724
          numuplinkports: 1
          vmnicadapter: 'host.[2-3].vmnic.[1]'
        '[2]':
          configurehosts: add
          datacenter: 'vc.[1].datacenter.[1]'
          host: 'host.[4-5]'
          name: VDS-2-SFO-26724
          numuplinkports: 1
          vmnicadapter: 'host.[4-5].vmnic.[1]'
  vm:
    '[1]':
      datastoreType: shared
      host: 'host.[2]'
      vmstate: poweroff
    '[2]':
      datastoreType: shared
      host: 'host.[3]'
      vmstate: poweroff
    '[3]':
      datastoreType: shared
      host: 'host.[4]'
      vmstate: poweroff
    '[4]':
      datastoreType: shared
      host: 'host.[5]'
      vmstate: poweroff
    '[5]':
      datastoreType: shared
      host: 'host.[2]'
      vmstate: poweroff
    '[6]':
      datastoreType: shared
      host: 'host.[3]'
      vmstate: poweroff
  vsm:
    '[1]':
      assignrole: enterprise_admin
      ippool:
        '[1]':
          gateway: x.x.x.x
          ipranges:
            - a.a.a.a-b.b.b.b
          name: AutoGenerate
          prefixlength: yy
      multicastiprange:
        '[1]':
          begin: 239.1.1.1
          end: 239.1.1.100
          name: AutoGenerate
      reconfigure: true
      segmentidrange:
        '[1]':
          begin: 10000
          end: 19000
          name: AutoGenerate
      vc: 'vc.[1]'
      vxlancontroller:
        '[1]':
          host: 'host.[1]'
          ippool: 'vsm.[1].ippool.[1]'
          name: AutoGenerate
          resourcepool: 'vc.[1].datacenter.[1].cluster.[1]'
Version: 2
WORKLOADS:
  AddRouteVM1VLAN16:
    Testadapter: 'vm.[1].vnic.[1]'
    Type: NetAdapter
    gateway: 172.16.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM1VLAN17:
    Testadapter: 'vm.[1].vnic.[1]'
    Type: NetAdapter
    gateway: 172.17.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM1VLAN18:
    Testadapter: 'vm.[1].vnic.[1]'
    Type: NetAdapter
    gateway: 172.18.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM1VWire1:
    Testadapter: 'vm.[1].vnic.[1]'
    Type: NetAdapter
    gateway: 172.31.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM1VWire2:
    Testadapter: 'vm.[1].vnic.[1]'
    Type: NetAdapter
    gateway: 172.32.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM1VWire3:
    Testadapter: 'vm.[1].vnic.[1]'
    Type: NetAdapter
    gateway: 172.33.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM2VLAN16:
    Testadapter: 'vm.[2].vnic.[1]'
    Type: NetAdapter
    gateway: 172.16.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM2VLAN17:
    Testadapter: 'vm.[2].vnic.[1]'
    Type: NetAdapter
    gateway: 172.17.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM2VLAN18:
    Testadapter: 'vm.[2].vnic.[1]'
    Type: NetAdapter
    gateway: 172.18.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM2VWire1:
    Testadapter: 'vm.[2].vnic.[1]'
    Type: NetAdapter
    gateway: 172.31.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM2VWire2:
    Testadapter: 'vm.[2].vnic.[1]'
    Type: NetAdapter
    gateway: 172.32.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM2VWire3:
    Testadapter: 'vm.[2].vnic.[1]'
    Type: NetAdapter
    gateway: 172.33.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM3VLAN16:
    Testadapter: 'vm.[3].vnic.[1]'
    Type: NetAdapter
    gateway: 172.16.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM3VLAN17:
    Testadapter: 'vm.[3].vnic.[1]'
    Type: NetAdapter
    gateway: 172.17.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM3VLAN18:
    Testadapter: 'vm.[3].vnic.[1]'
    Type: NetAdapter
    gateway: 172.18.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM3VWire1:
    Testadapter: 'vm.[3].vnic.[1]'
    Type: NetAdapter
    gateway: 172.31.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM3VWire2:
    Testadapter: 'vm.[3].vnic.[1]'
    Type: NetAdapter
    gateway: 172.32.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM3VWire3:
    Testadapter: 'vm.[3].vnic.[1]'
    Type: NetAdapter
    gateway: 172.33.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM4VLAN16:
    Testadapter: 'vm.[4].vnic.[1]'
    Type: NetAdapter
    gateway: 172.16.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM4VLAN17:
    Testadapter: 'vm.[4].vnic.[1]'
    Type: NetAdapter
    gateway: 172.17.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM4VLAN18:
    Testadapter: 'vm.[4].vnic.[1]'
    Type: NetAdapter
    gateway: 172.18.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM4VWire1:
    Testadapter: 'vm.[4].vnic.[1]'
    Type: NetAdapter
    gateway: 172.31.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM4VWire2:
    Testadapter: 'vm.[4].vnic.[1]'
    Type: NetAdapter
    gateway: 172.32.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM4VWire3:
    Testadapter: 'vm.[4].vnic.[1]'
    Type: NetAdapter
    gateway: 172.33.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM5VLAN18:
    Testadapter: 'vm.[5].vnic.[1]'
    Type: NetAdapter
    gateway: 172.18.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM5VWire2:
    Testadapter: 'vm.[5].vnic.[1]'
    Type: NetAdapter
    gateway: 172.32.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM5VWire3:
    Testadapter: 'vm.[5].vnic.[1]'
    Type: NetAdapter
    gateway: 172.33.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM6VLAN18:
    Testadapter: 'vm.[6].vnic.[1]'
    Type: NetAdapter
    gateway: 172.18.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM6VWire2:
    Testadapter: 'vm.[6].vnic.[1]'
    Type: NetAdapter
    gateway: 172.32.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM6VWire3:
    Testadapter: 'vm.[6].vnic.[1]'
    Type: NetAdapter
    gateway: 172.33.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddVmotionvmknicsHost2and3:
    TestHost: 'host.[2-3]'
    Type: Host
    vmknic:
      '[1]':
        configurevmotion: enable
        ipv4: dhcp
        portgroup: 'vc.[1].dvportgroup.[1]'
  AddVmotionvmknicsHost4and5:
    TestHost: 'host.[4-5]'
    Type: Host
    vmknic:
      '[1]':
        configurevmotion: enable
        ipv4: dhcp
        portgroup: 'vc.[1].dvportgroup.[6]'
  AddvNICsOn1to4VMs:
    TestVM: 'vm.[5],vm.[6]'
    Type: VM
    vnic:
      '[1]':
        allowguestcontrol: 1
        connected: 1
        driver: vmxnet3
        portgroup: 'vsm.[1].networkscope.[1].virtualwire.[1]'
        startconnected: 1
  AddvNICsOn1to6VMs:
    TestVM: 'vm.[1],vm.[2],vm.[3],vm.[4],vm.[5],vm.[6]'
    Type: VM
    vnic:
      '[1]':
        allowguestcontrol: 1
        connected: 1
        driver: vmxnet3
        portgroup: 'vsm.[1].networkscope.[1].virtualwire.[1]'
        startconnected: 1
  CreateBridges:
    TestVM: 'vsm.[1].vse.[1]'
    Type: VM
    bridge:
      '[1]':
        name: bridge-1-26724
        portgroup: 'vc.[1].dvportgroup.[5]'
        virtualwire: 'vsm.[1].networkscope.[1].virtualwire.[4]'
      '[2]':
        name: bridge-2-26724
        portgroup: 'vc.[1].dvportgroup.[6]'
        virtualwire: 'vsm.[1].networkscope.[1].virtualwire.[5]'
  CreateNetworkScopeClusterSJCandSFO:
    TestNSX: 'vsm.[1]'
    Type: NSX
    networkscope:
      '[1]':
        clusters: 'vc.[1].datacenter.[1].cluster.[2-3]'
        name: network-scope-1-26724
  CreateVXLANLIF1:
    TestVM: 'vsm.[1].vse.[1]'
    Type: VM
    lif:
      '[1]':
        addressgroup:
          - addresstype: primary
            ipv4address: 172.31.1.1
            netmask: 255.255.0.0
        connected: 1
        name: lif-vwire1-26724
        portgroup: 'vsm.[1].networkscope.[1].virtualwire.[1]'
        type: internal
  CreateVXLANLIF2:
    TestVM: 'vsm.[1].vse.[1]'
    Type: VM
    lif:
      '[2]':
        addressgroup:
          - addresstype: primary
            ipv4address: 172.32.1.1
            netmask: 255.255.0.0
        connected: 1
        name: lif-vwire2-26724
        portgroup: 'vsm.[1].networkscope.[1].virtualwire.[2]'
        type: internal
  CreateVXLANLIF3:
    TestVM: 'vsm.[1].vse.[1]'
    Type: VM
    lif:
      '[3]':
        addressgroup:
          - addresstype: primary
            ipv4address: 172.33.1.1
            netmask: 255.255.0.0
        connected: 1
        name: lif-vwire3-26724
        portgroup: 'vsm.[1].networkscope.[1].virtualwire.[3]'
        type: internal
  CreateVXLANLIF4:
    TestVM: 'vsm.[1].vse.[1]'
    Type: VM
    lif:
      '[4]':
        addressgroup:
          - addresstype: primary
            ipv4address: 172.34.1.1
            netmask: 255.255.0.0
        connected: 1
        name: lif-vwire4-26724
        portgroup: 'vsm.[1].networkscope.[1].virtualwire.[4]'
        type: internal
  CreateVirtualWires:
    TestTransportZone: 'vsm.[1].networkscope.[1]'
    Type: TransportZone
    VirtualWire:
      '[1]':
        controlplanemode: HYBRID_MODE
        name: AutoGenerate
        tenantid: AutoGenerate
      '[2]':
        controlplanemode: UNICAST_MODE
        name: AutoGenerate
        tenantid: AutoGenerate
      '[3]':
        controlplanemode: MULTICAST_MODE
        name: AutoGenerate
        tenantid: AutoGenerate
      '[4-8]':
        name: AutoGenerate
        tenantid: AutoGenerate
  DeleteAllVmknics:
    TestHost: 'host.[2-5]'
    Type: Host
    deletevmknic: 'host.[2-5].vmknic.[-1]'
  DeleteController:
    TestNSX: 'vsm.[1]'
    Type: NSX
    deletevxlancontroller: 'vsm.[1].vxlancontroller.[-1]'
  DeleteEdges:
    TestNSX: 'vsm.[1]'
    Type: NSX
    deletevse: 'vsm.[1].vse.[-1]'
  DeleteNetworkScopes:
    TestNSX: 'vsm.[1]'
    Type: NSX
    deletenetworkscope: 'vsm.[1].networkscope.[-1]'
  DeleteVirtualWires:
    TestTransportZone: 'vsm.[1].networkscope.[-1]'
    Type: TransportZone
    deletevirtualwire: 'vsm.[1].networkscope.[-1].virtualwire.[-1]'
  Deploy2ndController:
    TestNSX: 'vsm.[1]'
    Type: NSX
    vxlancontroller:
      '[2]':
        host: 'host.[1]'
        ippool: 'vsm.[1].ippool.[1]'
        name: AutoGenerate
        resourcepool: 'vc.[1].datacenter.[1].cluster.[1]'
  Deploy3rdController:
    TestNSX: 'vsm.[1]'
    Type: NSX
    vxlancontroller:
      '[3]':
        host: 'host.[1]'
        ippool: 'vsm.[1].ippool.[1]'
        name: AutoGenerate
        resourcepool: 'vc.[1].datacenter.[1].cluster.[1]'
  DeployEdge:
    TestNSX: 'vsm.[1]'
    Type: NSX
    vse:
      '[1]':
        datacenter: 'vc.[1].datacenter.[1]'
        host: 'host.[2]'
        name: Edge-26724
        portgroup: 'vc.[1].dvportgroup.[1]'
        primaryaddress: 10.10.10.14
        resourcepool: 'vc.[1].datacenter.[1].cluster.[2]'
        subnetmask: 255.255.255.0
  DeployFirstController:
    TestNSX: 'vsm.[1]'
    Type: NSX
    vxlancontroller:
      '[1]':
        firstnodeofcluster: true
        host: 'host.[1]'
        ippool: 'vsm.[1].ippool.[1]'
        name: AutoGenerate
        resourcepool: 'vc.[1].datacenter.[1].cluster.[1]'
  EnableHAandDRSOnClusterSJCandSFO:
    DRS: 1
    EditCluster: edit
    HA: 1
    TestCluster: 'vc.[1].datacenter.[1].cluster.[2-3]'
    Type: Cluster
  ExitSequence:
    -
      - DeleteEdges
    -
      - RemovevNICFromVM1
      - RemovevNICFromVM2
      - RemovevNICFromVM3
      - RemovevNICFromVM4
      - RemovevNICFromVM5
      - RemovevNICFromVM6
    -
      - DeleteVirtualWires
    -
      - DeleteNetworkScopes
    -
      - Uninstall_VDNCluster
    -
      - RemoveHostsFromClusterSJC
      - RemoveHostsFromClusterSFO
    -
      - RebootHost2
      - RebootHost3
      - RebootHost4
      - RebootHost5
  Install_Configure_ClusterSFO:
    TestNSX: 'vsm.[1]'
    Type: NSX
    VDNCluster:
      '[2]':
        cluster: 'vc.[1].datacenter.[1].cluster.[3]'
        mtu: 1600
        switch: 'vc.[1].vds.[2]'
        teaming: FAILOVER_ORDER
        vibs: install
        vlan: 22
        vmkniccount: 1
  Install_Configure_ClusterSJC:
    TestNSX: 'vsm.[1]'
    Type: NSX
    VDNCluster:
      '[1]':
        cluster: 'vc.[1].datacenter.[1].cluster.[2]'
        mtu: 1600
        switch: 'vc.[1].vds.[1]'
        teaming:
          - LOADBALANCE_SRCMAC
          - LOADBALANCE_SRCID
          - LOADBALANCE_LOADBASED
          - FAILOVER_ORDER
          - ETHER_CHANNEL
        vibs: install
        vlan:
          - 21
        vmkniccount: 1
  MakeSurevNICConnectedVM1andVM2:
    Type: NetAdapter
    connected: 1
    reconfigure: true
    startconnected: 1
    testadapter: 'vm.[1-2].vnic.[1]'
  MoveHostsToClusterSFO:
    MoveHostsToCluster: 'host.[4],host.[5]'
    TestCluster: 'vc.[1].datacenter.[1].cluster.[3]'
    Type: Cluster
  MoveHostsToClusterSJC:
    MoveHostsToCluster: 'host.[2],host.[3]'
    TestCluster: 'vc.[1].datacenter.[1].cluster.[2]'
    Type: Cluster
  NetperfTest2VMsToOther2VMs:
    ExpectedResult: ignore
    L4Protocol: 'tcp,udp'
    LocalSendSocketSize: 131072
    NoofInbound: 1
    NoofOutbound: 1
    ParallelSession: yes
    RemoteSendSocketSize: 131072
    SendMessageSize: '16384,128804'
    SupportAdapter: 'vm.[5-6].vnic.[1]'
    TestAdapter: 'vm.[1-2].vnic.[1]'
    TestDuration: 60
    ToolName: Netperf
    Type: Traffic
    maxtimeout: 128000
  NetperfTest3VMsToOther3VMs:
    ExpectedResult: ignore
    LocalSendSocketSize: 131072
    NoofInbound: 1
    NoofOutbound: 1
    ParallelSession: yes
    RemoteSendSocketSize: 131072
    SendMessageSize: '16384,96684,128804'
    SupportAdapter: 'vm.[4-6].vnic.[1]'
    TestAdapter: 'vm.[1-3].vnic.[1]'
    TestDuration: 60
    ToolName: Netperf
    Type: Traffic
    maxtimeout: 128000
  NetperfTestIgnorethroughput:
    ExpectedResult: ignore
    NoofOutbound: 1
    SupportAdapter: 'vm.[2].vnic.[1]'
    TestAdapter: 'vm.[1].vnic.[1]'
    TestDuration: 60
    ToolName: iperf
    Type: Traffic
  NetperfTestVM1ToAllOthers:
    ExpectedResult: ignore
    NoofInbound: 3
    NoofOutbound: 10
    ParallelSession: yes
    SupportAdapter: 'vm.[2-6].vnic.[1]'
    TestAdapter: 'vm.[1].vnic.[1]'
    TestDuration: 60
    ToolName: 'Netperf,Iperf,Ping'
    Type: Traffic
    maxtimeout: 128000
  PingTest:
    NoofInbound: 1
    NoofOutbound: 1
    ParallelSession: yes
    SupportAdapter: 'vm.[2].vnic.[1]'
    TestAdapter: 'vm.[1].vnic.[1]'
    TestDuration: 60
    ToolName: Ping
    Type: Traffic
    maxtimeout: 128000
  PingTest2VMsToOther2VMs:
    NoofInbound: 1
    NoofOutbound: 1
    SupportAdapter: 'vm.[5-6].vnic.[1]'
    TestAdapter: 'vm.[1-2].vnic.[1]'
    TestDuration: 60
    ToolName: Ping
    Type: Traffic
    maxtimeout: 128000
  PingTest3VMsToOther3VMs:
    NoofInbound: 1
    NoofOutbound: 1
    SupportAdapter: 'vm.[4-6].vnic.[1]'
    TestAdapter: 'vm.[1-3].vnic.[1]'
    TestDuration: 60
    ToolName: Ping
    Type: Traffic
    maxtimeout: 128000
  PingTestSameCluster1:
    NoofInbound: 1
    NoofOutbound: 1
    SupportAdapter: 'vm.[2].vnic.[1]'
    TestAdapter: 'vm.[1].vnic.[1]'
    TestDuration: 60
    ToolName: Ping
    Type: Traffic
    maxtimeout: 128000
  PingTestSameCluster2:
    NoofInbound: 1
    NoofOutbound: 1
    SupportAdapter: 'vm.[4].vnic.[1]'
    TestAdapter: 'vm.[3].vnic.[1]'
    TestDuration: 60
    ToolName: Ping
    Type: Traffic
    maxtimeout: 128000
  PingTestVM1ToAllOthers:
    NoofInbound: 1
    NoofOutbound: 1
    ParallelSession: yes
    SupportAdapter: 'vm.[2-6].vnic.[1]'
    TestAdapter: 'vm.[1].vnic.[1]'
    TestDuration: 60
    ToolName: Ping
    Type: Traffic
    maxtimeout: 128000
  PlaceVM1OnVLAN16_VDS1:
    Type: NetAdapter
    portgroup: 'vc.[1].dvportgroup.[1]'
    reconfigure: true
    testadapter: 'vm.[1].vnic.[1]'
  PlaceVM1OnvWire1:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[1]'
    reconfigure: true
    testadapter: 'vm.[1].vnic.[1]'
  PlaceVM1OnvWire2:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[2]'
    reconfigure: true
    testadapter: 'vm.[1].vnic.[1]'
  PlaceVM1OnvWire3:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[3]'
    reconfigure: true
    testadapter: 'vm.[1].vnic.[1]'
  PlaceVM1OnvWire4:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[4]'
    reconfigure: true
    testadapter: 'vm.[1].vnic.[1]'
  PlaceVM2OnMgmtdvpg:
    Type: NetAdapter
    portgroup: 'vc.[1].dvportgroup.[1]'
    reconfigure: true
    testadapter: 'vm.[2].vnic.[1]'
  PlaceVM2OnVLAN17_VDS1:
    Type: NetAdapter
    portgroup: 'vc.[1].dvportgroup.[2]'
    reconfigure: true
    testadapter: 'vm.[2].vnic.[1]'
  PlaceVM2OnVLAN21_VDS1:
    Type: NetAdapter
    portgroup: 'vc.[1].dvportgroup.[5]'
    reconfigure: true
    testadapter: 'vm.[2].vnic.[1]'
  PlaceVM2OnvWire1:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[1]'
    reconfigure: true
    testadapter: 'vm.[2].vnic.[1]'
  PlaceVM2OnvWire2:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[2]'
    reconfigure: true
    testadapter: 'vm.[2].vnic.[1]'
  PlaceVM2OnvWire3:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[3]'
    reconfigure: true
    testadapter: 'vm.[2].vnic.[1]'
  PlaceVM3OnVLAN16_VDS2:
    Type: NetAdapter
    portgroup: 'vc.[1].dvportgroup.[7]'
    reconfigure: true
    testadapter: 'vm.[3].vnic.[1]'
  PlaceVM3OnVLAN21_VDS2:
    Type: NetAdapter
    portgroup: 'vc.[1].dvportgroup.[5]'
    reconfigure: true
    testadapter: 'vm.[3].vnic.[1]'
  PlaceVM3OnvWire1:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[1]'
    reconfigure: true
    testadapter: 'vm.[3].vnic.[1]'
  PlaceVM3OnvWire2:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[2]'
    reconfigure: true
    testadapter: 'vm.[3].vnic.[1]'
  PlaceVM3OnvWire3:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[3]'
    reconfigure: true
    testadapter: 'vm.[3].vnic.[1]'
  PlaceVM4OnVLAN17_VDS2:
    Type: NetAdapter
    portgroup: 'vc.[1].dvportgroup.[8]'
    reconfigure: true
    testadapter: 'vm.[4].vnic.[1]'
  PlaceVM4OnvWire1:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[1]'
    reconfigure: true
    testadapter: 'vm.[4].vnic.[1]'
  PlaceVM4OnvWire2:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[2]'
    reconfigure: true
    testadapter: 'vm.[4].vnic.[1]'
  PlaceVM4OnvWire3:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[3]'
    reconfigure: true
    testadapter: 'vm.[4].vnic.[1]'
  PlaceVM5OnvWire1:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[1]'
    reconfigure: true
    testadapter: 'vm.[5].vnic.[1]'
  PlaceVM5OnvWire2:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[2]'
    reconfigure: true
    testadapter: 'vm.[5].vnic.[1]'
  PlaceVM5OnvWire3:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[3]'
    reconfigure: true
    testadapter: 'vm.[5].vnic.[1]'
  PlaceVM6OnVLAN18_VDS1:
    Type: NetAdapter
    portgroup: 'vc.[1].dvportgroup.[3]'
    reconfigure: true
    testadapter: 'vm.[6].vnic.[1]'
  PlaceVM6OnvWire1:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[1]'
    reconfigure: true
    testadapter: 'vm.[6].vnic.[1]'
  PlaceVM6OnvWire2:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[2]'
    reconfigure: true
    testadapter: 'vm.[6].vnic.[1]'
  PlaceVM6OnvWire3:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[3]'
    reconfigure: true
    testadapter: 'vm.[6].vnic.[1]'
  PlaceVMsOnMgmtdvPG:
    Type: NetAdapter
    portgroup: 'vc.[1].dvportgroup.[4]'
    reconfigure: true
    testadapter: 'vm.[1-3].vnic.[1]'
  PoweroffVM1:
    TestVM: 'vm.[1]'
    Type: VM
    vmstate: poweroff
  PoweroffVM2:
    TestVM: 'vm.[2]'
    Type: VM
    vmstate: poweroff
  PoweroffVM3:
    TestVM: 'vm.[3]'
    Type: VM
    vmstate: poweroff
  PoweronVM1:
    TestVM: 'vm.[1]'
    Type: VM
    vmstate: poweron
  PoweronVM2:
    TestVM: 'vm.[2]'
    Type: VM
    vmstate: poweron
  PoweronVM3:
    TestVM: 'vm.[3]'
    Type: VM
    vmstate: poweron
  PoweronVM4:
    TestVM: 'vm.[4]'
    Type: VM
    vmstate: poweron
  PoweronVM5:
    TestVM: 'vm.[5]'
    Type: VM
    vmstate: poweron
  PoweronVM6:
    TestVM: 'vm.[6]'
    Type: VM
    vmstate: poweron
  PrepClusterSFO:
    TestNSX: 'vsm.[1]'
    Type: NSX
    VDNCluster:
      '[3]':
        cluster: 'vc.[1].datacenter.[1].cluster.[3]'
  ReDeployEdge:
    TestVM: 'vsm.[1].vse.[1]'
    Type: VM
    applianceaction: redeploy
  RebootHost:
    TestHost: 'host.[1]'
    Type: Host
    reboot: yes
  RebootHost2:
    TestHost: 'host.[2]'
    Type: Host
    reboot: yes
  RebootHost3:
    TestHost: 'host.[3]'
    Type: Host
    reboot: yes
  RebootHost4:
    TestHost: 'host.[4]'
    Type: Host
    reboot: yes
  RebootHost5:
    TestHost: 'host.[5]'
    Type: Host
    reboot: yes
  RemoveHostsFromClusterSFO:
    MoveHostsFromCluster: 'host.[4],host.[5]'
    TestCluster: 'vc.[1].datacenter.[1].cluster.[3]'
    Type: Cluster
  RemoveHostsFromClusterSJC:
    MoveHostsFromCluster: 'host.[2],host.[3]'
    TestCluster: 'vc.[1].datacenter.[1].cluster.[2]'
    Type: Cluster
  RemovevNICFromVM1:
    TestVM: 'vm.[1]'
    Type: VM
    deletevnic: 'vm.[1].vnic.[1]'
  RemovevNICFromVM1To3:
    TestVM: 'vm.[1-3]'
    Type: VM
    deletevnic: 'vm.[x].vnic.[1]'
  RemovevNICFromVM2:
    TestVM: 'vm.[2]'
    Type: VM
    deletevnic: 'vm.[2].vnic.[1]'
  RemovevNICFromVM3:
    TestVM: 'vm.[3]'
    Type: VM
    deletevnic: 'vm.[3].vnic.[1]'
  RemovevNICFromVM4:
    TestVM: 'vm.[4]'
    Type: VM
    deletevnic: 'vm.[4].vnic.[1]'
  RemovevNICFromVM4To6:
    TestVM: 'vm.[4-6]'
    Type: VM
    deletevnic: 'vm.[x].vnic.[1]'
  RemovevNICFromVM5:
    TestVM: 'vm.[5]'
    Type: VM
    deletevnic: 'vm.[5].vnic.[1]'
  RemovevNICFromVM6:
    TestVM: 'vm.[6]'
    Type: VM
    deletevnic: 'vm.[6].vnic.[1]'
  ResetMulticast:
    TestNSX: 'vsm.[1]'
    Type: NSX
    deletemulticastiprange: 'vsm.[1].multicastiprange.[-1]'
  ResetSegmentID:
    TestNSX: 'vsm.[1]'
    Type: NSX
    deletesegmentidrange: 'vsm.[1].segmentidrange.[-1]'
  SamevWireNetperfTestDifferentCluster:
    MinExpResult: 1
    NoofInbound: 1
    NoofOutbound: 1
    SupportAdapter: 'vm.[3].vnic.[1]'
    TestAdapter: 'vm.[1].vnic.[1]'
    TestDuration: 60
    Type: Traffic
    l3protocol: 'ipv4,ipv6'
    l4protocol: 'tcp,udp'
    maxtimeout: 128000
  Sequence:
    -
      - MoveHostsToClusterSJC
    -
      - MoveHostsToClusterSFO
    -
      - Install_Configure_ClusterSJC
      - Install_Configure_ClusterSFO
    -
      - CreateNetworkScopeClusterSJCandSFO
    -
      - CreateVirtualWires
    -
      - AddvNICsOn1to6VMs
    -
      - PoweronVM1
      - PoweronVM2
    -
      - MakeSurevNICConnectedVM1andVM2
    -
      - SetIPVM1VWire1
      - SetIPVM2VWire1
    -
      - PingTest
    -
      - DeployEdge
    -
      - CreateVXLANLIF1
    -
      - CreateVXLANLIF2
    -
      - CreateVXLANLIF3
    -
      - CreateBridges
    -
      - PlaceVM1OnvWire1
      - PlaceVM2OnvWire2
    -
      - SetIPVM1VWire1
      - SetIPVM2VWire2
    -
      - AddRouteVM1VWire1
      - AddRouteVM2VWire2
    -
      - PingTest
    -
      - PlaceVM1OnvWire4
      - PlaceVM2OnVLAN21_VDS1
    -
      - SetIPVM1VWire4
      - SetIPVM2VLAN21
    -
      - PingTest
  SetIPVM1VLAN16:
    Testadapter: 'vm.[1].vnic.[1]'
    Type: NetAdapter
    ipv4: dhcp
  SetIPVM1VLAN17:
    Testadapter: 'vm.[1].vnic.[1]'
    Type: NetAdapter
    ipv4: dhcp
  SetIPVM1VLAN18:
    Testadapter: 'vm.[1].vnic.[1]'
    Type: NetAdapter
    ipv4: dhcp
  SetIPVM1VWire1:
    Testadapter: 'vm.[1].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.31.1.15
    netmask: 255.255.0.0
  SetIPVM1VWire2:
    Testadapter: 'vm.[1].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.32.1.15
    netmask: 255.255.0.0
  SetIPVM1VWire3:
    Testadapter: 'vm.[1].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.33.1.15
    netmask: 255.255.0.0
  SetIPVM1VWire4:
    Testadapter: 'vm.[1].vnic.[1]'
    Type: NetAdapter
    ipv4: dhcp
  SetIPVM2VLAN16:
    Testadapter: 'vm.[2].vnic.[1]'
    Type: NetAdapter
    ipv4: dhcp
  SetIPVM2VLAN17:
    Testadapter: 'vm.[2].vnic.[1]'
    Type: NetAdapter
    ipv4: dhcp
  SetIPVM2VLAN18:
    Testadapter: 'vm.[2].vnic.[1]'
    Type: NetAdapter
    ipv4: dhcp
  SetIPVM2VLAN21:
    Testadapter: 'vm.[2].vnic.[1]'
    Type: NetAdapter
    ipv4: dhcp
  SetIPVM2VWire1:
    Testadapter: 'vm.[2].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.31.1.25
    netmask: 255.255.0.0
  SetIPVM2VWire2:
    Testadapter: 'vm.[2].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.32.1.25
    netmask: 255.255.0.0
  SetIPVM2VWire3:
    Testadapter: 'vm.[2].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.33.1.25
    netmask: 255.255.0.0
  SetIPVM3VLAN16:
    Testadapter: 'vm.[3].vnic.[1]'
    Type: NetAdapter
    ipv4: dhcp
  SetIPVM3VLAN17:
    Testadapter: 'vm.[3].vnic.[1]'
    Type: NetAdapter
    ipv4: dhcp
  SetIPVM3VLAN18:
    Testadapter: 'vm.[3].vnic.[1]'
    Type: NetAdapter
    ipv4: dhcp
  SetIPVM3VWire1:
    Testadapter: 'vm.[3].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.31.1.35
    netmask: 255.255.0.0
  SetIPVM3VWire2:
    Testadapter: 'vm.[3].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.32.1.35
    netmask: 255.255.0.0
  SetIPVM3VWire3:
    Testadapter: 'vm.[3].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.33.1.35
    netmask: 255.255.0.0
  SetIPVM4VLAN16:
    Testadapter: 'vm.[4].vnic.[1]'
    Type: NetAdapter
    ipv4: dhcp
  SetIPVM4VLAN17:
    Testadapter: 'vm.[4].vnic.[1]'
    Type: NetAdapter
    ipv4: dhcp
  SetIPVM4VLAN18:
    Testadapter: 'vm.[4].vnic.[1]'
    Type: NetAdapter
    ipv4: dhcp
  SetIPVM4VWire1:
    Testadapter: 'vm.[4].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.31.1.45
    netmask: 255.255.0.0
  SetIPVM4VWire2:
    Testadapter: 'vm.[4].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.32.1.45
    netmask: 255.255.0.0
  SetIPVM4VWire3:
    Testadapter: 'vm.[4].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.33.1.45
    netmask: 255.255.0.0
  SetIPVM5VLAN18:
    Testadapter: 'vm.[5].vnic.[1]'
    Type: NetAdapter
    ipv4: dhcp
  SetIPVM5VWire1:
    Testadapter: 'vm.[5].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.31.1.55
    netmask: 255.255.0.0
  SetIPVM5VWire2:
    Testadapter: 'vm.[5].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.32.1.55
    netmask: 255.255.0.0
  SetIPVM5VWire3:
    Testadapter: 'vm.[5].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.33.1.55
    netmask: 255.255.0.0
  SetIPVM6VLAN18:
    Testadapter: 'vm.[6].vnic.[1]'
    Type: NetAdapter
    ipv4: dhcp
  SetIPVM6VWire1:
    Testadapter: 'vm.[6].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.31.1.65
    netmask: 255.255.0.0
  SetIPVM6VWire2:
    Testadapter: 'vm.[6].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.32.1.65
    netmask: 255.255.0.0
  SetIPVM6VWire3:
    Testadapter: 'vm.[6].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.33.1.65
    netmask: 255.255.0.0
  SetMulticastRange:
    Multicastiprange:
      '[1]':
        begin: 239.0.0.101
        end: 239.254.254.254
        name: AutoGenerate
    TestNSX: 'vsm.[1]'
    Type: NSX
  SetSegmentIDRange:
    TestNSX: 'vsm.[1]'
    Type: NSX
    segmentidrange:
      '[1]':
        begin: 5001-10001
        end: 99000
        name: AutoGenerate
  Uninstall_VDNCluster:
    TestNSX: 'vsm.[1]'
    Type: NSX
    deletevdncluster: 'vsm.[1].vdncluster.[-1]'
  vMotionVM2ToHost3:
    Iterations: 1
    TestVM: 'vm.[3]'
    Type: VM
    dsthost: 'host.[2]'
    vmotion: oneway
---
AutomationLevel: Automated
Category: NSX
Component: network vDR
Developer: adityaj
Duration: ''
FullyAutomatable: Y
PartnerFacing: N
Priority: P0
Procedure: ''
Product: VSM
QCPath: ''
Status: Execution Ready
Summary: 'Check if the data traffic is working properlywhile doing VM operations on controller VMs '
Tags: vdr
TestName: ControllerVMOperationsTestScenarios
TestbedSpec:
  host:
    '[1]': {}
    '[2-5]':
      vmnic:
        '[1-2]':
          driver: any
  vc:
    '[1]':
      datacenter:
        '[1]':
          Cluster:
            '[1]':
              host: 'host.[1]'
              name: Controller-Cluster-26724
            '[2]':
              host: 'host.[2-3]'
              name: Compute-Cluster-SJC-26724
            '[3]':
              host: 'host.[4]'
              name: Compute-Cluster-SFO-26724
            '[4]':
              host: 'host.[5]'
              name: Compute-Cluster-LAX-26724
      dvportgroup:
        '[10]':
          name: dvpg-VDS2-vlan19-26724
          vds: 'vc.[1].vds.[2]'
          vlan: 19
          vlantype: access
        '[11]':
          name: dvpg-VDS2-vlan21-26724
          vds: 'vc.[1].vds.[2]'
          vlan: 21
          vlantype: access
        '[12]':
          name: dvpg-VDS2-vlan22-26724
          vds: 'vc.[1].vds.[2]'
          vlan: 22
          vlantype: access
        '[1]':
          name: dvpg-VDS1-vlan16-26724
          vds: 'vc.[1].vds.[1]'
          vlan: 16
          vlantype: access
        '[2]':
          name: dvpg-VDS-vlan17-26724
          vds: 'vc.[1].vds.[1]'
          vlan: 17
          vlantype: access
        '[3]':
          name: dvpg-VDS1-vlan18-26724
          vds: 'vc.[1].vds.[1]'
          vlan: 18
          vlantype: access
        '[4]':
          name: dvpg-VDS1-mgmt-26724
          vds: 'vc.[1].vds.[1]'
          vlan: 19
          vlantype: access
        '[5]':
          name: dvpg-VDS1-vlan21-26724
          vds: 'vc.[1].vds.[1]'
          vlan: 21
          vlantype: access
        '[6]':
          name: dvpg-VDS1-vlan22-26724
          vds: 'vc.[1].vds.[1]'
          vlan: 22
          vlantype: access
        '[7]':
          name: dvpg-VDS2-vlan16-26724
          vds: 'vc.[1].vds.[2]'
          vlan: 16
          vlantype: access
        '[8]':
          name: dvpg-VDS2-vlan17-26724
          vds: 'vc.[1].vds.[2]'
          vlan: 17
          vlantype: access
        '[9]':
          name: dvpg-VDS2-vlan18-26724
          vds: 'vc.[1].vds.[2]'
          vlan: 18
          vlantype: access
      vds:
        '[1]':
          configurehosts: add
          datacenter: 'vc.[1].datacenter.[1]'
          host: 'host.[2-4]'
          name: VDS-1-26724
          numuplinkports: 1
          vmnicadapter: 'host.[2-4].vmnic.[1]'
        '[2]':
          configurehosts: add
          datacenter: 'vc.[1].datacenter.[1]'
          host: 'host.[5]'
          name: VDS-2-26724
          numuplinkports: 1
          vmnicadapter: 'host.[5].vmnic.[1]'
  vm:
    '[1]':
      datastoreType: shared
      host: 'host.[2]'
      vmstate: poweroff
    '[2]':
      datastoreType: shared
      host: 'host.[3]'
      vmstate: poweroff
    '[3]':
      datastoreType: shared
      host: 'host.[4]'
      vmstate: poweroff
    '[4]':
      datastoreType: shared
      host: 'host.[5]'
      vmstate: poweroff
    '[5]':
      datastoreType: shared
      host: 'host.[2]'
      vmstate: poweroff
    '[6]':
      datastoreType: shared
      host: 'host.[3]'
      vmstate: poweroff
    '[7]':
      datastoreType: shared
      host: 'host.[4]'
      vmstate: poweroff
  vsm:
    '[1]':
      VDNCluster:
        '[1]':
          cluster: 'vc.[1].datacenter.[1].cluster.[2]'
          mtu: 1600
          switch: 'vc.[1].vds.[1]'
          teaming: &1
            - LOADBALANCE_SRCMAC
            - LOADBALANCE_SRCID
            - LOADBALANCE_LOADBASED
            - FAILOVER_ORDER
            - ETHER_CHANNEL
          vibs: install
          vlan:
            - 18
          vmkniccount: 1
        '[2]':
          cluster: 'vc.[1].datacenter.[1].cluster.[3]'
          mtu: 1600
          switch: 'vc.[1].vds.[1]'
          teaming: FAILOVER_ORDER
          vibs: install
          vlan: 18
          vmkniccount: 1
        '[3]':
          cluster: 'vc.[1].datacenter.[1].cluster.[4]'
          mtu: 1600
          switch: 'vc.[1].vds.[2]'
          teaming: FAILOVER_ORDER
          vibs: install
          vlan: 19
          vmkniccount: 1
      assignrole: enterprise_admin
      ippool:
        '[1]':
          gateway: x.x.x.x
          ipranges:
            - a.a.a.a-b.b.b.b
          name: AutoGenerate
          prefixlength: yy
      multicastiprange:
        '[1]':
          begin: 239.1.1.1
          end: 239.1.1.100
          name: AutoGenerate
      reconfigure: true
      segmentidrange:
        '[1]':
          begin: 10000
          end: 19000
          name: AutoGenerate
      vc: 'vc.[1]'
      vxlancontroller:
        '[1]':
          host: 'host.[1]'
          ippool: 'vsm.[1].ippool.[1]'
          name: AutoGenerate
          resourcepool: 'vc.[1].datacenter.[1].cluster.[1]'
TestcaseLevel: Functional
TestcaseType: Functional
Version: 2
WORKLOADS:
  AddVXLANRouteVM1:
    Testadapter: 'vm.[1].vnic.[1]'
    Type: NetAdapter
    gateway: 172.31.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddVXLANRouteVM2:
    Testadapter: 'vm.[2].vnic.[1]'
    Type: NetAdapter
    gateway: 172.32.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddVXLANRouteVM3:
    Testadapter: 'vm.[3].vnic.[1]'
    Type: NetAdapter
    gateway: 172.33.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddvNICsOnVM1:
    TestVM: 'vm.[1]'
    Type: VM
    vnic:
      '[1]':
        allowguestcontrol: 1
        connected: 1
        driver: vmxnet3
        portgroup: 'vsm.[1].networkscope.[1].virtualwire.[1]'
        startconnected: 1
  AddvNICsOnVM2:
    TestVM: 'vm.[2]'
    Type: VM
    vnic:
      '[1]':
        allowguestcontrol: 1
        connected: 1
        driver: vmxnet3
        portgroup: 'vsm.[1].networkscope.[1].virtualwire.[2]'
        startconnected: 1
  AddvNICsOnVM3:
    TestVM: 'vm.[3]'
    Type: VM
    vnic:
      '[1]':
        allowguestcontrol: 1
        connected: 1
        driver: vmxnet3
        portgroup: 'vsm.[1].networkscope.[1].virtualwire.[3]'
        startconnected: 1
  CreateNetworkScope:
    TestNSX: 'vsm.[1]'
    Type: NSX
    networkscope:
      '[1]':
        clusters: 'vc.[1].datacenter.[1].cluster.[2]'
        name: network-scope-1-26724
  CreateVLANLIF1:
    TestVM: 'vsm.[1].vse.[1]'
    Type: VM
    lif:
      '[1]':
        addressgroup:
          - addresstype: primary
            ipv4address: 172.16.1.1
            netmask: 255.255.0.0
        connected: 1
        name: lif-vlan1-26724
        portgroup: 'vc.[1].dvportgroup.[1]'
        type: internal
  CreateVLANLIF2:
    TestVM: 'vsm.[1].vse.[1]'
    Type: VM
    lif:
      '[2]':
        addressgroup:
          - addresstype: primary
            ipv4address: 172.17.1.1
            netmask: 255.255.0.0
        connected: 1
        name: lif-vlan2-26724
        portgroup: 'vc.[1].dvportgroup.[2]'
        type: internal
  CreateVLANLIF3:
    TestVM: 'vsm.[1].vse.[1]'
    Type: VM
    lif:
      '[3]':
        addressgroup:
          - addresstype: primary
            ipv4address: 172.18.1.1
            netmask: 255.255.0.0
        connected: 1
        name: lif-vlan3-26724
        portgroup: 'vc.[1].dvportgroup.[3]'
        type: internal
  CreateVXLANLIF1:
    TestVM: 'vsm.[1].vse.[1]'
    Type: VM
    lif:
      '[1]':
        addressgroup:
          - addresstype: primary
            ipv4address: 172.31.1.1
            netmask: 255.255.0.0
        connected: 1
        name: lif-vwire1-26724
        portgroup: 'vsm.[1].networkscope.[1].virtualwire.[1]'
        type: internal
  CreateVXLANLIF2:
    TestVM: 'vsm.[1].vse.[1]'
    Type: VM
    lif:
      '[2]':
        addressgroup:
          - addresstype: primary
            ipv4address: 172.32.1.1
            netmask: 255.255.0.0
        connected: 1
        name: lif-vwire2-26724
        portgroup: 'vsm.[1].networkscope.[1].virtualwire.[2]'
        type: internal
  CreateVXLANLIF3:
    TestVM: 'vsm.[1].vse.[1]'
    Type: VM
    lif:
      '[3]':
        addressgroup:
          - addresstype: primary
            ipv4address: 172.33.1.1
            netmask: 255.255.0.0
        connected: 1
        name: lif-vwire3-26724
        portgroup: 'vsm.[1].networkscope.[1].virtualwire.[3]'
        type: internal
  CreateVXLANLIF4:
    TestVM: 'vsm.[1].vse.[1]'
    Type: VM
    lif:
      '[4]':
        addressgroup:
          - addresstype: primary
            ipv4address: 172.34.1.1
            netmask: 255.255.0.0
        connected: 1
        name: lif-vwire4-26724
        portgroup: 'vsm.[1].networkscope.[1].virtualwire.[4]'
        type: internal
  CreateVirtualWires:
    TestTransportZone: 'vsm.[1].networkscope.[1]'
    Type: TransportZone
    VirtualWire:
      '[1]':
        controlplanemode: HYBRID_MODE
        name: AutoGenerate
        tenantid: AutoGenerate
      '[2]':
        controlplanemode: UNICAST_MODE
        name: AutoGenerate
        tenantid: AutoGenerate
      '[3]':
        controlplanemode: MULTICAST_MODE
        name: AutoGenerate
        tenantid: AutoGenerate
      '[4-8]':
        name: AutoGenerate
        tenantid: AutoGenerate
  DeleteAllControllers:
    TestNSX: 'vsm.[1]'
    Type: NSX
    deletevxlancontroller: 'vsm.[1].vxlancontroller.[-1]'
  DeleteEdges: &2
    TestNSX: 'vsm.[1]'
    Type: NSX
    deletevse: 'vsm.[1].vse.[-1]'
  DeleteNetworkScopes:
    TestNSX: 'vsm.[1]'
    Type: NSX
    deletenetworkscope: 'vsm.[1].networkscope.[-1]'
  Delete_All_VirtualWires:
    TestTransportZone: 'vsm.[1].networkscope.[-1]'
    Type: TransportZone
    deletevirtualwire: 'vsm.[1].networkscope.[-1].virtualwire.[-1]'
  DeployEdge:
    TestNSX: 'vsm.[1]'
    Type: NSX
    vse:
      '[1]':
        datacenter: 'vc.[1].datacenter.[1]'
        host: 'host.[4]'
        name: Edge-26724
        portgroup: 'vc.[1].dvportgroup.[1]'
        primaryaddress: 10.10.10.10
        resourcepool: 'vc.[1].datacenter.[1].cluster.[3]'
        subnetmask: 255.255.255.0
  DeployFirstController:
    TestNSX: 'vsm.[1]'
    Type: NSX
    vxlancontroller:
      '[1]':
        firstnodeofcluster: true
        host: 'host.[1]'
        ippool: 'vsm.[1].ippool.[1]'
        name: AutoGenerate
        resourcepool: 'vc.[1].datacenter.[1].cluster.[1]'
  DeploySecondController:
    TestNSX: 'vsm.[1]'
    Type: NSX
    vxlancontroller:
      '[2]':
        firstnodeofcluster: true
        host: 'host.[1]'
        ippool: 'vsm.[1].ippool.[1]'
        name: AutoGenerate
        resourcepool: 'vc.[1].datacenter.[1].cluster.[1]'
  DeployThirdController:
    TestNSX: 'vsm.[1]'
    Type: NSX
    vxlancontroller:
      '[3]':
        firstnodeofcluster: true
        host: 'host.[1]'
        ippool: 'vsm.[1].ippool.[1]'
        name: AutoGenerate
        resourcepool: 'vc.[1].datacenter.[1].cluster.[1]'
  ExitSequence:
    -
      - DeployFirstController
    -
      - DeleteEdges
    -
      - RemovevNICFromVM1
      - RemovevNICFromVM2
      - RemovevNICFromVM3
    -
      - Delete_All_VirtualWires
    -
      - DeleteNetworkScopes
  Expand_TZ:
    TestTransportZone: 'vsm.[1].networkscope.[1]'
    Type: TransportZone
    clusters: 'vc.[1].datacenter.[1].cluster.[3]'
    transportzoneaction: expand
  InstallVibsConfigureVxlanClusterSFOVds1:
    TestNSX: 'vsm.[1]'
    Type: NSX
    VDNCluster:
      '[2]':
        cluster: 'vc.[1].datacenter.[1].cluster.[3]'
        mtu: 1600
        switch: 'vc.[1].vds.[1]'
        teaming: *1
        vibs: install
        vlan: 18
        vmkniccount: 1
  InstallVibsConfigureVxlanClusterSJCVds1:
    TestNSX: 'vsm.[1]'
    Type: NSX
    VDNCluster:
      '[1]':
        cluster: 'vc.[1].datacenter.[1].cluster.[2]'
        mtu: 1600
        switch: 'vc.[1].vds.[1]'
        teaming: *1
        vibs: install
        vlan: 18
        vmkniccount: 1
  MakeSurevNICConnectedVm1andVm2:
    Type: NetAdapter
    connected: 1
    reconfigure: true
    startconnected: 1
    testadapter:
      - 'vm.[1].vnic.[1]'
      - 'vm.[2].vnic.[1]'
  MakeSurevNICConnectedVm1andVm2andVm3:
    Type: NetAdapter
    connected: 1
    reconfigure: true
    startconnected: 1
    testadapter:
      - 'vm.[1].vnic.[1]'
      - 'vm.[2].vnic.[1]'
      - 'vm.[3].vnic.[1]'
  PingAllTest:
    NoofInbound: 1
    NoofOutbound: 1
    SupportAdapter: 'vm.[2].vnic.[1],vm.[3].vnic.[1]'
    TestAdapter: 'vm.[1].vnic.[1]'
    TestDuration: 60
    ToolName: Ping
    Type: Traffic
    maxtimeout: 128000
  PoweroffControllerVM1:
    TestVM: 'vsm.[1].vxlancontroller.[1]'
    Type: VM
    vmstate: poweroff
  PoweroffControllerVM2:
    TestVM: 'vsm.[1].vxlancontroller.[2]'
    Type: VM
    vmstate: poweroff
  PoweroffControllerVM3:
    TestVM: 'vsm.[1].vxlancontroller.[3]'
    Type: VM
    vmstate: poweroff
  PoweronControllerVM1:
    TestVM: 'vsm.[1].vxlancontroller.[1]'
    Type: VM
    vmstate: poweron
  PoweronControllerVM2:
    TestVM: 'vsm.[1].vxlancontroller.[2]'
    Type: VM
    vmstate: poweron
  PoweronControllerVM3:
    TestVM: 'vsm.[1].vxlancontroller.[3]'
    Type: VM
    vmstate: poweron
  PoweronVM1:
    TestVM: 'vm.[1]'
    Type: VM
    vmstate: poweron
  PoweronVM2:
    TestVM: 'vm.[2]'
    Type: VM
    vmstate: poweron
  PoweronVM3:
    TestVM: 'vm.[3]'
    Type: VM
    vmstate: poweron
  RebootControllerVM1:
    TestVM: 'vsm.[1].vxlancontroller.[1]'
    Type: VM
    vmstate: reboot
  RebootControllerVM2:
    TestVM: 'vsm.[1].vxlancontroller.[2]'
    Type: VM
    vmstate: reboot
  RebootControllerVM3:
    TestVM: 'vsm.[1].vxlancontroller.[3]'
    Type: VM
    vmstate: reboot
  RebootHost:
    TestHost: 'host.[1]'
    Type: Host
    reboot: yes
  RebootHost2:
    TestHost: 'host.[2]'
    Type: Host
    reboot: yes
  RebootHost3:
    TestHost: 'host.[3]'
    Type: Host
    reboot: yes
  RebootHost4:
    TestHost: 'host.[4]'
    Type: Host
    reboot: yes
  RebootHost5:
    TestHost: 'host.[5]'
    Type: Host
    reboot: yes
  RemovevNICFromVM1:
    TestVM: 'vm.[1]'
    Type: VM
    deletevnic: 'vm.[1].vnic.[1]'
  RemovevNICFromVM2:
    TestVM: 'vm.[2]'
    Type: VM
    deletevnic: 'vm.[2].vnic.[1]'
  RemovevNICFromVM3:
    TestVM: 'vm.[3]'
    Type: VM
    deletevnic: 'vm.[3].vnic.[1]'
  ResetControllerVM1:
    TestVM: 'vsm.[1].vxlancontroller.[1]'
    Type: VM
    vmstate: reset
  ResetControllerVM2:
    TestVM: 'vsm.[1].vxlancontroller.[2]'
    Type: VM
    vmstate: reset
  ResetControllerVM3:
    TestVM: 'vsm.[1].vxlancontroller.[3]'
    Type: VM
    vmstate: reset
  ResumeControllerVM1:
    TestVM: 'vsm.[1].vxlancontroller.[1]'
    Type: VM
    vmstate: resume
  ResumeControllerVM2:
    TestVM: 'vsm.[1].vxlancontroller.[2]'
    Type: VM
    vmstate: resume
  ResumeControllerVM3:
    TestVM: 'vsm.[1].vxlancontroller.[3]'
    Type: VM
    vmstate: resume
  Sequence:
    -
      - CreateNetworkScope
    -
      - CreateVirtualWires
    -
      - DeployEdge
    -
      - CreateVXLANLIF1
    -
      - CreateVXLANLIF2
    -
      - AddvNICsOnVM1
    -
      - AddvNICsOnVM2
    -
      - PoweronVM1
      - PoweronVM2
    -
      - MakeSurevNICConnectedVm1andVm2
    -
      - SetVXLANIPVM1
      - SetVXLANIPVM2DifferentvWire
    -
      - AddVXLANRouteVM1
      - AddVXLANRouteVM2
    -
      - Expand_TZ
    -
      - CreateVXLANLIF3
    -
      - AddvNICsOnVM3
    -
      - PoweronVM3
    -
      - MakeSurevNICConnectedVm1andVm2andVm3
    -
      - SetVXLANIPVM3DifferentvWire
    -
      - AddVXLANRouteVM3
    -
      - PingAllTest
    -
      - RebootControllerVM1
    -
      - PingAllTest
    -
      - ResetControllerVM1
    -
      - PingAllTest
    -
      - PoweroffControllerVM1
    -
      - PingAllTest
    -
      - PoweronControllerVM1
    -
      - PingAllTest
    -
      - SuspendControllerVM1
    -
      - PingAllTest
    -
      - ResumeControllerVM1
    -
      - PingAllTest
    -
      - DeploySecondController
    -
      - DeployThirdController
    -
      - PingAllTest
    -
      - RebootControllerVM1
    -
      - RebootControllerVM2
    -
      - RebootControllerVM3
    -
      - PingAllTest
    -
      - ResetControllerVM1
    -
      - ResetControllerVM2
    -
      - ResetControllerVM3
    -
      - PingAllTest
    -
      - PoweroffControllerVM1
    -
      - PoweroffControllerVM2
    -
      - PoweroffControllerVM3
    -
      - PingAllTest
    -
      - PoweronControllerVM1
    -
      - PoweronControllerVM2
    -
      - PoweronControllerVM3
    -
      - PingAllTest
    -
      - SuspendControllerVM1
    -
      - SuspendControllerVM2
    -
      - SuspendControllerVM3
    -
      - PingAllTest
    -
      - ResumeControllerVM1
    -
      - ResumeControllerVM2
    -
      - ResumeControllerVM3
    -
      - PingAllTest
    -
      - DeleteAllControllers
    -
      - PingAllTest
  SetMulticastRange:
    Multicastiprange:
      '[1]':
        begin: 239.0.0.101
        end: 239.254.254.254
        name: AutoGenerate
    TestNSX: 'vsm.[1]'
    Type: NSX
  SetSegmentIDRange:
    TestNSX: 'vsm.[1]'
    Type: NSX
    segmentidrange:
      '[1]':
        begin: 5001-10001
        end: 99000
        name: AutoGenerate
  SetVXLANIPVM1:
    Testadapter: 'vm.[1].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.31.1.5
    netmask: 255.255.0.0
  SetVXLANIPVM2DifferentvWire:
    Testadapter: 'vm.[2].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.32.1.5
    netmask: 255.255.0.0
  SetVXLANIPVM3DifferentvWire:
    Testadapter: 'vm.[3].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.33.1.5
    netmask: 255.255.0.0
  SuspendControllerVM1:
    TestVM: 'vsm.[1].vxlancontroller.[1]'
    Type: VM
    vmstate: suspend
  SuspendControllerVM2:
    TestVM: 'vsm.[1].vxlancontroller.[2]'
    Type: VM
    vmstate: suspend
  SuspendControllerVM3:
    TestVM: 'vsm.[1].vxlancontroller.[3]'
    Type: VM
    vmstate: suspend
  Uninstall_VDNCluster:
    TestNSX: 'vsm.[1]'
    Type: NSX
    deletevdncluster: 'vsm.[1].vdncluster.[-1]'
  deleteEdge: *2
---
Category: NSX
Component: network vDR
Summary: Sanity test to verify different routing/bridging traffic combos for vmknics
Tags: RunOnCAT
TestName: JumboSanityTestVmknics
TestbedSpec:
  host:
    '[1]': {}
    '[2-4]':
      vmnic:
        '[1-2]':
          driver: any
  vc:
    '[1]':
      datacenter:
        '[1]':
          Cluster:
            '[1]':
              host: 'host.[1]'
              name: Controller-Cluster-26724
            '[2]':
              host: 'host.[2-3]'
              name: Compute-Cluster-26724
            '[3]':
              host: 'host.[4]'
              name: Compute-Cluster2-26724
      dvportgroup:
        '[1]':
          name: dvpg-mgmt-26724
          vds: 'vc.[1].vds.[1]'
        '[2]':
          name: dvpg-vlan16-26724
          vds: 'vc.[1].vds.[1]'
          vlan: 16
          vlantype: access
        '[3]':
          name: dvpg-vlan17-26724
          vds: 'vc.[1].vds.[1]'
          vlan: 17
          vlantype: access
        '[4]':
          name: dvpg-vlan21-26724
          vds: 'vc.[1].vds.[1]'
          vlan: 21
          vlantype: access
      vds:
        '[1]':
          configurehosts: add
          datacenter: 'vc.[1].datacenter.[1]'
          host: 'host.[2-4]'
          numuplinkports: 1
          vmnicadapter: 'host.[2-4].vmnic.[1]'
  vm:
    '[1-2]':
      datastoreType: shared
      host: 'host.[2]'
      vmstate: poweroff
    '[3]':
      datastoreType: shared
      host: 'host.[3]'
      vmstate: poweroff
  vsm:
    '[1]':
      VDNCluster:
        '[1]':
          cluster: 'vc.[1].datacenter.[1].cluster.[2]'
          mtu: 1600
          switch: 'vc.[1].vds.[1]'
          teaming: &1
            - LOADBALANCE_SRCMAC
            - LOADBALANCE_SRCID
            - LOADBALANCE_LOADBASED
            - FAILOVER_ORDER
            - ETHER_CHANNEL
          vibs: install
          vlan:
            - 21
          vmkniccount: 1
      assignrole: enterprise_admin
      ippool:
        '[1]':
          gateway: x.x.x.x
          ipranges:
            - a.a.a.a-b.b.b.b
          name: AutoGenerate
          prefixlength: yy
      multicastiprange:
        '[1]':
          begin: 239.1.1.1
          end: 239.1.1.100
          name: AutoGenerate
      reconfigure: true
      segmentidrange:
        '[1]':
          begin: 10000
          end: 19000
          name: AutoGenerate
      vc: 'vc.[1]'
      vxlancontroller:
        '[1]':
          host: 'host.[1]'
          ippool: 'vsm.[1].ippool.[1]'
          name: AutoGenerate
          resourcepool: 'vc.[1].datacenter.[1].cluster.[1]'
        '[2]':
          host: 'host.[1]'
          ippool: 'vsm.[1].ippool.[1]'
          name: AutoGenerate
          resourcepool: 'vc.[1].datacenter.[1].cluster.[1]'
        '[3]':
          host: 'host.[1]'
          ippool: 'vsm.[1].ippool.[1]'
          name: AutoGenerate
          resourcepool: 'vc.[1].datacenter.[1].cluster.[1]'
Version: 2
WORKLOADS:
  AddvmknicHost2VLAN16:
    TestHost: 'host.[2]'
    Type: Host
    maxtimeout: 128000
    vmknic:
      '[13]':
        ipv4address: dhcp
        netstack: 'host.[2].netstack.[3]'
        portgroup: 'vc.[1].dvportgroup.[2]'
      '[18]':
        ipv4address: dhcp
        netstack: 'host.[2].netstack.[3]'
        portgroup: 'vc.[1].dvportgroup.[2]'
      '[3]':
        ipv4address: dhcp
        netstack: 'host.[2].netstack.[3]'
        portgroup: 'vc.[1].dvportgroup.[2]'
      '[8]':
        ipv4address: dhcp
        netstack: 'host.[2].netstack.[3]'
        portgroup: 'vc.[1].dvportgroup.[2]'
  AddvmknicHost2VLAN17:
    TestHost: 'host.[2]'
    Type: Host
    maxtimeout: 128000
    vmknic:
      '[14]':
        ipv4address: dhcp
        netstack: 'host.[2].netstack.[4]'
        portgroup: 'vc.[1].dvportgroup.[3]'
      '[19]':
        ipv4address: dhcp
        netstack: 'host.[2].netstack.[4]'
        portgroup: 'vc.[1].dvportgroup.[3]'
      '[4]':
        ipv4address: dhcp
        netstack: 'host.[2].netstack.[4]'
        portgroup: 'vc.[1].dvportgroup.[3]'
      '[9]':
        ipv4address: dhcp
        netstack: 'host.[2].netstack.[4]'
        portgroup: 'vc.[1].dvportgroup.[3]'
  AddvmknicHost2VirtualWire1:
    TestHost: 'host.[2]'
    Type: Host
    maxtimeout: 128000
    vmknic:
      '[11]':
        ipv4address: 172.31.1.9
        netmask: 255.255.0.0
        netstack: 'host.[2].netstack.[1]'
        portgroup: 'vsm.[1].networkscope.[1].virtualwire.[1]'
      '[16]':
        ipv4address: 172.31.1.10
        netmask: 255.255.0.0
        netstack: 'host.[2].netstack.[1]'
        portgroup: 'vsm.[1].networkscope.[1].virtualwire.[1]'
      '[1]':
        ipv4address: 172.31.1.7
        netmask: 255.255.0.0
        netstack: 'host.[2].netstack.[1]'
        portgroup: 'vsm.[1].networkscope.[1].virtualwire.[1]'
      '[6]':
        ipv4address: 172.31.1.8
        netmask: 255.255.0.0
        netstack: 'host.[2].netstack.[1]'
        portgroup: 'vsm.[1].networkscope.[1].virtualwire.[1]'
  AddvmknicHost2VirtualWire2:
    TestHost: 'host.[2]'
    Type: Host
    maxtimeout: 128000
    vmknic:
      '[12]':
        ipv4address: 172.32.1.9
        netmask: 255.255.0.0
        netstack: 'host.[2].netstack.[2]'
        portgroup: 'vsm.[1].networkscope.[1].virtualwire.[2]'
      '[17]':
        ipv4address: 172.32.1.10
        netmask: 255.255.0.0
        netstack: 'host.[2].netstack.[2]'
        portgroup: 'vsm.[1].networkscope.[1].virtualwire.[2]'
      '[2]':
        ipv4address: 172.32.1.7
        netmask: 255.255.0.0
        netstack: 'host.[2].netstack.[2]'
        portgroup: 'vsm.[1].networkscope.[1].virtualwire.[2]'
      '[7]':
        ipv4address: 172.32.1.8
        netmask: 255.255.0.0
        netstack: 'host.[2].netstack.[2]'
        portgroup: 'vsm.[1].networkscope.[1].virtualwire.[2]'
  AddvmknicHost2VirtualWire3:
    TestHost: 'host.[2]'
    Type: Host
    maxtimeout: 128000
    vmknic:
      '[10]':
        ipv4address: 172.21.1.8
        netmask: 255.255.0.0
        netstack: 'host.[2].netstack.[5]'
        portgroup: 'vsm.[1].networkscope.[1].virtualwire.[3]'
      '[15]':
        ipv4address: 172.21.1.9
        netmask: 255.255.0.0
        netstack: 'host.[2].netstack.[5]'
        portgroup: 'vsm.[1].networkscope.[1].virtualwire.[3]'
      '[20]':
        ipv4address: 172.21.1.10
        netmask: 255.255.0.0
        netstack: 'host.[2].netstack.[5]'
        portgroup: 'vsm.[1].networkscope.[1].virtualwire.[3]'
      '[5]':
        ipv4address: 172.21.1.7
        netmask: 255.255.0.0
        netstack: 'host.[2].netstack.[5]'
        portgroup: 'vsm.[1].networkscope.[1].virtualwire.[3]'
  AddvmknicHost3VLAN16:
    TestHost: 'host.[3]'
    Type: Host
    maxtimeout: 128000
    vmknic:
      '[13]':
        ipv4address: dhcp
        netstack: 'host.[3].netstack.[3]'
        portgroup: 'vc.[1].dvportgroup.[2]'
      '[18]':
        ipv4address: dhcp
        netstack: 'host.[3].netstack.[3]'
        portgroup: 'vc.[1].dvportgroup.[2]'
      '[3]':
        ipv4address: dhcp
        netstack: 'host.[3].netstack.[3]'
        portgroup: 'vc.[1].dvportgroup.[2]'
      '[8]':
        ipv4address: dhcp
        netstack: 'host.[3].netstack.[3]'
        portgroup: 'vc.[1].dvportgroup.[2]'
  AddvmknicHost3VLAN17:
    TestHost: 'host.[3]'
    Type: Host
    maxtimeout: 128000
    vmknic:
      '[14]':
        ipv4address: dhcp
        netstack: 'host.[3].netstack.[4]'
        portgroup: 'vc.[1].dvportgroup.[3]'
      '[19]':
        ipv4address: dhcp
        netstack: 'host.[3].netstack.[4]'
        portgroup: 'vc.[1].dvportgroup.[3]'
      '[4]':
        ipv4address: dhcp
        netstack: 'host.[3].netstack.[4]'
        portgroup: 'vc.[1].dvportgroup.[3]'
      '[9]':
        ipv4address: dhcp
        netstack: 'host.[3].netstack.[4]'
        portgroup: 'vc.[1].dvportgroup.[3]'
  AddvmknicHost3VLAN21:
    TestHost: 'host.[3]'
    Type: Host
    maxtimeout: 128000
    vmknic:
      '[10]':
        ipv4address: dhcp
        netstack: 'host.[3].netstack.[5]'
        portgroup: 'vc.[1].dvportgroup.[4]'
      '[15]':
        ipv4address: dhcp
        netstack: 'host.[3].netstack.[5]'
        portgroup: 'vc.[1].dvportgroup.[4]'
      '[20]':
        ipv4address: dhcp
        netstack: 'host.[3].netstack.[5]'
        portgroup: 'vc.[1].dvportgroup.[4]'
      '[5]':
        ipv4address: dhcp
        netstack: 'host.[3].netstack.[5]'
        portgroup: 'vc.[1].dvportgroup.[4]'
  AddvmknicHost3VirtualWire1:
    TestHost: 'host.[3]'
    Type: Host
    maxtimeout: 128000
    vmknic:
      '[11]':
        ipv4address: 172.31.1.19
        netmask: 255.255.0.0
        netstack: 'host.[3].netstack.[1]'
        portgroup: 'vsm.[1].networkscope.[1].virtualwire.[1]'
      '[16]':
        ipv4address: 172.31.1.20
        netmask: 255.255.0.0
        netstack: 'host.[3].netstack.[1]'
        portgroup: 'vsm.[1].networkscope.[1].virtualwire.[1]'
      '[1]':
        ipv4address: 172.31.1.17
        netmask: 255.255.0.0
        netstack: 'host.[3].netstack.[1]'
        portgroup: 'vsm.[1].networkscope.[1].virtualwire.[1]'
      '[6]':
        ipv4address: 172.31.1.18
        netmask: 255.255.0.0
        netstack: 'host.[3].netstack.[1]'
        portgroup: 'vsm.[1].networkscope.[1].virtualwire.[1]'
  AddvmknicHost3VirtualWire2:
    TestHost: 'host.[3]'
    Type: Host
    maxtimeout: 128000
    vmknic:
      '[12]':
        ipv4address: 172.32.1.19
        netmask: 255.255.0.0
        netstack: 'host.[3].netstack.[2]'
        portgroup: 'vsm.[1].networkscope.[1].virtualwire.[2]'
      '[17]':
        ipv4address: 172.32.1.20
        netmask: 255.255.0.0
        netstack: 'host.[3].netstack.[2]'
        portgroup: 'vsm.[1].networkscope.[1].virtualwire.[2]'
      '[2]':
        ipv4address: 172.32.1.17
        netmask: 255.255.0.0
        netstack: 'host.[3].netstack.[2]'
        portgroup: 'vsm.[1].networkscope.[1].virtualwire.[2]'
      '[7]':
        ipv4address: 172.32.1.18
        netmask: 255.255.0.0
        netstack: 'host.[3].netstack.[2]'
        portgroup: 'vsm.[1].networkscope.[1].virtualwire.[2]'
  BridgevWire3ToVLAN21:
    TestVM: 'vsm.[1].vse.[1]'
    Type: VM
    bridge:
      '[1]':
        name: bridge-1-26724
        portgroup: 'vc.[1].dvportgroup.[4]'
        virtualwire: 'vsm.[1].networkscope.[1].virtualwire.[3]'
  CreateAllNetstacks:
    TestHost: 'host.[2-3]'
    Type: Host
    netstack:
      '[1]':
        name: subnet31-netstack-26724
      '[2]':
        name: subnet32-netstack-26724
      '[3]':
        name: subnet16-netstack-26724
      '[4]':
        name: subnet17-netstack-26724
      '[5]':
        name: subnet21-netstack-26724
  CreateNetworkScope:
    TestNSX: 'vsm.[1]'
    Type: NSX
    networkscope:
      '[1]':
        clusters: 'vc.[1].datacenter.[1].cluster.[2]'
        name: network-scope-1-26724
  CreateVLANLIF3:
    TestVM: 'vsm.[1].vse.[1]'
    Type: VM
    lif:
      '[3]':
        addressgroup:
          - addresstype: primary
            ipv4address: 172.16.1.1
            netmask: 255.255.0.0
        connected: 1
        name: lif-16-26724
        portgroup: 'vc.[1].dvportgroup.[2]'
        type: internal
  CreateVLANLIF4:
    TestVM: 'vsm.[1].vse.[1]'
    Type: VM
    lif:
      '[4]':
        addressgroup:
          - addresstype: primary
            ipv4address: 172.17.1.1
            netmask: 255.255.0.0
        connected: 1
        name: lif-17-26724
        portgroup: 'vc.[1].dvportgroup.[3]'
        type: internal
  CreateVXLANLIF1:
    TestVM: 'vsm.[1].vse.[1]'
    Type: VM
    lif:
      '[1]':
        addressgroup:
          - addresstype: primary
            ipv4address: 172.31.1.1
            netmask: 255.255.0.0
        connected: 1
        name: lif-vwire1-26724
        portgroup: 'vsm.[1].networkscope.[1].virtualwire.[1]'
        type: internal
  CreateVXLANLIF2:
    TestVM: 'vsm.[1].vse.[1]'
    Type: VM
    lif:
      '[2]':
        addressgroup:
          - addresstype: primary
            ipv4address: 172.32.1.1
            netmask: 255.255.0.0
        connected: 1
        name: lif-vwire2-26724
        portgroup: 'vsm.[1].networkscope.[1].virtualwire.[2]'
        type: internal
  CreateVirtualWires:
    TestTransportZone: 'vsm.[1].networkscope.[1]'
    Type: TransportZone
    VirtualWire:
      '[1]':
        controlplanemode: HYBRID_MODE
        name: AutoGenerate
        tenantid: AutoGenerate
      '[2]':
        controlplanemode: UNICAST_MODE
        name: AutoGenerate
        tenantid: AutoGenerate
      '[3]':
        controlplanemode: MULTICAST_MODE
        name: AutoGenerate
        tenantid: AutoGenerate
      '[4-8]':
        name: AutoGenerate
        tenantid: AutoGenerate
  DeleteAllVmknicsHost2:
    TestHost: 'host.[2]'
    Type: Host
    deletevmknic: 'host.[2].vmknic.[-1]'
  DeleteAllVmknicsHost3:
    TestHost: 'host.[3]'
    Type: Host
    deletevmknic: 'host.[3].vmknic.[-1]'
  DeleteController:
    TestNSX: 'vsm.[1]'
    Type: NSX
    deletevxlancontroller: 'vsm.[1].vxlancontroller.[-1]'
  DeleteEdges:
    TestNSX: 'vsm.[1]'
    Type: NSX
    deletevse: 'vsm.[1].vse.[-1]'
  DeleteNetworkScopes:
    TestNSX: 'vsm.[1]'
    Type: NSX
    deletenetworkscope: 'vsm.[1].networkscope.[-1]'
  Delete_All_VirtualWires:
    TestTransportZone: 'vsm.[1].networkscope.[-1]'
    Type: TransportZone
    deletevirtualwire: 'vsm.[1].networkscope.[-1].virtualwire.[-1]'
  DeployEdge:
    TestNSX: 'vsm.[1]'
    Type: NSX
    vse:
      '[1]':
        datacenter: 'vc.[1].datacenter.[1]'
        host: 'host.[2]'
        name: Edge-26724
        portgroup: 'vc.[1].dvportgroup.[1]'
        primaryaddress: 10.10.10.32
        resourcepool: 'vc.[1].datacenter.[1].cluster.[2]'
        subnetmask: 255.255.255.0
  DeployFirstController:
    TestNSX: 'vsm.[1]'
    Type: NSX
    vxlancontroller:
      '[1]':
        firstnodeofcluster: true
        host: 'host.[1]'
        ippool: 'vsm.[1].ippool.[1]'
        name: AutoGenerate
        resourcepool: 'vc.[1].datacenter.[1].cluster.[1]'
  ExitSequence:
    -
      - DeleteAllVmknicsHost2
      - DeleteAllVmknicsHost3
    -
      - DeleteEdges
    -
      - Delete_All_VirtualWires
    -
      - DeleteNetworkScopes
  Install_Configure_ClusterSJC:
    TestNSX: 'vsm.[1]'
    Type: NSX
    VDNCluster:
      '[1]':
        cluster: 'vc.[1].datacenter.[1].cluster.[2]'
        mtu: 1600
        switch: 'vc.[1].vds.[1]'
        teaming: *1
        vibs: install
        vlan:
          - 21
        vmkniccount: 1
  MassiveNetperfTestVmknicsIgnorethroughput:
    BurstType: 'stream,rr'
    ExpectedResult: ignore
    L4Protocol: 'tcp,udp'
    LocalSendSocketSize: '131072-100,5000'
    NoofInbound: 1
    NoofOutbound: 1
    RemoteSendSocketSize: 131072
    SendMessageSize: '16384,128804'
    SupportAdapter: 'host.[2].vmknic.[11-14],host.[2].vmknic.[16-19]'
    TestAdapter: 'host.[2].vmknic.[1-4],host.[2].vmknic.[6-9]'
    TestDuration: 60
    ToolName: netperf
    Type: Traffic
    maxtimeout: 128000
  MassivePingTestVmknics:
    NoofInbound: 1
    NoofOutbound: 1
    SupportAdapter: 'host.[2].vmknic.[11-14],host.[2].vmknic.[16-19]'
    TestAdapter: 'host.[2].vmknic.[1-4],host.[2].vmknic.[6-9]'
    TestDuration: 60
    ToolName: Ping
    Type: Traffic
    maxtimeout: 128000
    sleepbetweenworkloads: 10
  MoveHostsToClusterSFO:
    MoveHostsToCluster: 'host.[4],host.[5]'
    TestCluster: 'vc.[1].datacenter.[1].cluster.[3]'
    Type: Cluster
  NetperfTestVmknicsIgnorethroughput:
    BurstType: 'stream,rr'
    ExpectedResult: ignore
    L4Protocol: 'tcp,udp'
    LocalSendSocketSize: '131072-100,5000'
    NoofInbound: 1
    NoofOutbound: 1
    ParallelSession: yes
    RemoteSendSocketSize: 131072
    SendMessageSize: '16384,128804'
    SupportAdapter: 'host.[3].vmknic.[1-4]'
    TestAdapter: 'host.[2].vmknic.[1-4]'
    TestDuration: 60
    ToolName: netperf
    Type: Traffic
    maxtimeout: 128000
  PingTestBridgedVmknics:
    NoofInbound: 1
    NoofOutbound: 1
    SupportAdapter: 'host.[3].vmknic.[5],host.[3].vmknic.[10],host.[3].vmknic.[15],host.[3].vmknic.[20]'
    TestAdapter: 'host.[2].vmknic.[5]'
    TestDuration: 60
    ToolName: Ping
    Type: Traffic
    maxtimeout: 128000
    sleepbetweenworkloads: 60
  PingTestVmknics:
    NoofInbound: 1
    NoofOutbound: 1
    SupportAdapter: 'host.[3].vmknic.[1-4]'
    TestAdapter: 'host.[2].vmknic.[1-4]'
    TestDuration: 60
    ToolName: Ping
    Type: Traffic
    maxtimeout: 128000
    sleepbetweenworkloads: 10
  RebootHost:
    TestHost: 'host.[1]'
    Type: Host
    reboot: yes
  RebootHost2:
    TestHost: 'host.[2]'
    Type: Host
    reboot: yes
  RebootHost3:
    TestHost: 'host.[3]'
    Type: Host
    reboot: yes
  RebootHost4:
    TestHost: 'host.[4]'
    Type: Host
    reboot: yes
  RebootHost5:
    TestHost: 'host.[5]'
    Type: Host
    reboot: yes
  RemovevNICFromVM1:
    TestVM: 'vm.[1]'
    Type: VM
    deletevnic: 'vm.[1].vnic.[1]'
  RemovevNICFromVM2:
    TestVM: 'vm.[2]'
    Type: VM
    deletevnic: 'vm.[2].vnic.[1]'
  RemovevNICFromVM3:
    TestVM: 'vm.[3]'
    Type: VM
    deletevnic: 'vm.[3].vnic.[1]'
  RemovevNICFromVM4:
    TestVM: 'vm.[4]'
    Type: VM
    deletevnic: 'vm.[4].vnic.[1]'
  RemovevNICFromVM5:
    TestVM: 'vm.[5]'
    Type: VM
    deletevnic: 'vm.[5].vnic.[1]'
  RemovevNICFromVM6:
    TestVM: 'vm.[6]'
    Type: VM
    deletevnic: 'vm.[6].vnic.[1]'
  Sequence:
    -
      - CreateNetworkScope
    -
      - CreateVirtualWires
    -
      - DeployEdge
    -
      - CreateVXLANLIF1
    -
      - CreateVXLANLIF2
    -
      - CreateVLANLIF3
    -
      - CreateVLANLIF4
    -
      - BridgevWire3ToVLAN21
    -
      - CreateAllNetstacks
    -
      - DeleteAllVmknicsHost2
      - DeleteAllVmknicsHost3
    -
      - AddvmknicHost2VirtualWire1
      - AddvmknicHost3VirtualWire1
    -
      - AddvmknicHost2VirtualWire2
      - AddvmknicHost3VirtualWire2
    -
      - AddvmknicHost2VLAN16
      - AddvmknicHost3VLAN16
    -
      - AddvmknicHost2VLAN17
      - AddvmknicHost3VLAN17
    -
      - SetGatewayvWire1Netstack
    -
      - SetGatewayvWire2Netstack
    -
      - SetGatewayVLAN16Netstack
    -
      - SetGatewayVLAN17Netstack
    -
      - PingTestVmknics
    -
      - MassivePingTestVmknics
    -
      - AddvmknicHost2VirtualWire3
      - AddvmknicHost3VLAN21
    -
      - SetGatewayNetstackForBridge
    -
      - PingTestBridgedVmknics
  SetGatewayNetstackForBridge:
    TestNetstack: 'host.[2-3].netstack.[5]'
    Type: Netstack
    route: 172.21.1.1
    setnetstackgateway: add
  SetGatewayVLAN16Netstack:
    TestNetstack: 'host.[2-3].netstack.[3]'
    Type: Netstack
    route: 172.16.1.1
    setnetstackgateway: add
  SetGatewayVLAN17Netstack:
    TestNetstack: 'host.[2-3].netstack.[4]'
    Type: Netstack
    route: 172.17.1.1
    setnetstackgateway: add
  SetGatewayvWire1Netstack:
    TestNetstack: 'host.[2-3].netstack.[1]'
    Type: Netstack
    route: 172.31.1.1
    setnetstackgateway: add
  SetGatewayvWire2Netstack:
    TestNetstack: 'host.[2-3].netstack.[2]'
    Type: Netstack
    route: 172.32.1.1
    setnetstackgateway: add
  SetMulticastRange:
    Multicastiprange:
      '[1]':
        begin: 239.0.0.101
        end: 239.254.254.254
        name: AutoGenerate
    TestNSX: 'vsm.[1]'
    Type: NSX
  SetSegmentIDRange:
    TestNSX: 'vsm.[1]'
    Type: NSX
    segmentidrange:
      '[1]':
        begin: 5001-10001
        end: 99000
        name: AutoGenerate
  Uninstall_VDNCluster:
    TestNSX: 'vsm.[1]'
    Type: NSX
    deletevdncluster: 'vsm.[1].vdncluster.[-1]'
---
AutomationLevel: Automated
Category: NSX
Component: network vDR
Developer: adityaj
Duration: ''
ExpectedResult: TZ expand and shrink scenarios executed successfully
FullyAutomatable: Y
PartnerFacing: N
Priority: P0
Procedure: ''
Product: VSM
QCPath: ''
Status: Execution Ready
Summary: 'This is the vdr TZ expand and shrink acrossclusters with one or 2 VDSes '
Tags: vdr
TestName: ExpandShrinkTransportZoneTestScenarios
TestbedSpec:
  host:
    '[1]': {}
    '[2-5]':
      vmnic:
        '[1-2]':
          driver: any
  vc:
    '[1]':
      datacenter:
        '[1]':
          Cluster:
            '[1]':
              host: 'host.[1]'
              name: Controller-Cluster-26724
            '[2]':
              host: 'host.[2-3]'
              name: Compute-Cluster-SJC-26724
            '[3]':
              host: 'host.[4]'
              name: Compute-Cluster-SFO-26724
            '[4]':
              host: 'host.[5]'
              name: Compute-Cluster-LAX-26724
      dvportgroup:
        '[10]':
          name: dvpg-VDS2-vlan19-26724
          vds: 'vc.[1].vds.[2]'
          vlan: 19
          vlantype: access
        '[11]':
          name: dvpg-VDS2-vlan21-26724
          vds: 'vc.[1].vds.[2]'
          vlan: 21
          vlantype: access
        '[12]':
          name: dvpg-VDS2-vlan22-26724
          vds: 'vc.[1].vds.[2]'
          vlan: 22
          vlantype: access
        '[1]':
          name: dvpg-VDS1-vlan16-26724
          vds: 'vc.[1].vds.[1]'
          vlan: 16
          vlantype: access
        '[2]':
          name: dvpg-VDS-vlan17-26724
          vds: 'vc.[1].vds.[1]'
          vlan: 17
          vlantype: access
        '[3]':
          name: dvpg-VDS1-vlan18-26724
          vds: 'vc.[1].vds.[1]'
          vlan: 18
          vlantype: access
        '[4]':
          name: dvpg-VDS1-mgmt-26724
          vds: 'vc.[1].vds.[1]'
          vlan: 19
          vlantype: access
        '[5]':
          name: dvpg-VDS1-vlan21-26724
          vds: 'vc.[1].vds.[1]'
          vlan: 21
          vlantype: access
        '[6]':
          name: dvpg-VDS1-vlan22-26724
          vds: 'vc.[1].vds.[1]'
          vlan: 22
          vlantype: access
        '[7]':
          name: dvpg-VDS2-vlan16-26724
          vds: 'vc.[1].vds.[2]'
          vlan: 16
          vlantype: access
        '[8]':
          name: dvpg-VDS2-vlan17-26724
          vds: 'vc.[1].vds.[2]'
          vlan: 17
          vlantype: access
        '[9]':
          name: dvpg-VDS2-vlan18-26724
          vds: 'vc.[1].vds.[2]'
          vlan: 18
          vlantype: access
      vds:
        '[1]':
          configurehosts: add
          datacenter: 'vc.[1].datacenter.[1]'
          host: 'host.[2-4]'
          name: VDS-1-26724
          numuplinkports: 1
          vmnicadapter: 'host.[2-4].vmnic.[1]'
        '[2]':
          configurehosts: add
          datacenter: 'vc.[1].datacenter.[1]'
          host: 'host.[5]'
          name: VDS-2-26724
          numuplinkports: 1
          vmnicadapter: 'host.[5].vmnic.[1]'
  vm:
    '[1]':
      datastoreType: shared
      host: 'host.[2]'
      vmstate: poweroff
    '[2]':
      datastoreType: shared
      host: 'host.[3]'
      vmstate: poweroff
    '[3]':
      datastoreType: shared
      host: 'host.[4]'
      vmstate: poweroff
    '[4]':
      datastoreType: shared
      host: 'host.[5]'
      vmstate: poweroff
    '[5]':
      datastoreType: shared
      host: 'host.[2]'
      vmstate: poweroff
    '[6]':
      datastoreType: shared
      host: 'host.[3]'
      vmstate: poweroff
    '[7]':
      datastoreType: shared
      host: 'host.[4]'
      vmstate: poweroff
  vsm:
    '[1]':
      VDNCluster:
        '[1]':
          cluster: 'vc.[1].datacenter.[1].cluster.[2]'
          mtu: 1600
          switch: 'vc.[1].vds.[1]'
          teaming: &1
            - LOADBALANCE_SRCMAC
            - LOADBALANCE_SRCID
            - LOADBALANCE_LOADBASED
            - FAILOVER_ORDER
            - ETHER_CHANNEL
          vibs: install
          vlan:
            - 18
          vmkniccount: 1
        '[2]':
          cluster: 'vc.[1].datacenter.[1].cluster.[3]'
          mtu: 1600
          switch: 'vc.[1].vds.[1]'
          teaming: FAILOVER_ORDER
          vibs: install
          vlan: 18
          vmkniccount: 1
        '[3]':
          cluster: 'vc.[1].datacenter.[1].cluster.[4]'
          mtu: 1600
          switch: 'vc.[1].vds.[2]'
          teaming: FAILOVER_ORDER
          vibs: install
          vlan: 19
          vmkniccount: 1
      assignrole: enterprise_admin
      ippool:
        '[1]':
          gateway: x.x.x.x
          ipranges:
            - a.a.a.a-b.b.b.b
          name: AutoGenerate
          prefixlength: yy
      multicastiprange:
        '[1]':
          begin: 239.1.1.1
          end: 239.1.1.100
          name: AutoGenerate
      reconfigure: true
      segmentidrange:
        '[1]':
          begin: 10000
          end: 19000
          name: AutoGenerate
      vc: 'vc.[1]'
      vxlancontroller:
        '[1]':
          host: 'host.[1]'
          ippool: 'vsm.[1].ippool.[1]'
          name: AutoGenerate
          resourcepool: 'vc.[1].datacenter.[1].cluster.[1]'
TestcaseLevel: Functional
TestcaseType: Functional
Version: 2
WORKLOADS:
  AddVLANRouteVM1:
    Testadapter: 'vm.[1].vnic.[1]'
    Type: NetAdapter
    gateway: 172.16.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddVXLANRouteVM1:
    Testadapter: 'vm.[1].vnic.[1]'
    Type: NetAdapter
    gateway: 172.31.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddVXLANRouteVM2:
    Testadapter: 'vm.[2].vnic.[1]'
    Type: NetAdapter
    gateway: 172.32.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddVXLANRouteVM3:
    Testadapter: 'vm.[3].vnic.[1]'
    Type: NetAdapter
    gateway: 172.33.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddVXLANRouteVM4:
    Testadapter: 'vm.[4].vnic.[1]'
    Type: NetAdapter
    gateway: 172.34.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddvNICsOnVM1:
    TestVM: 'vm.[1]'
    Type: VM
    vnic:
      '[1]':
        allowguestcontrol: 1
        connected: 1
        driver: vmxnet3
        portgroup: 'vsm.[1].networkscope.[1].virtualwire.[1]'
        startconnected: 1
  AddvNICsOnVM2:
    TestVM: 'vm.[2]'
    Type: VM
    vnic:
      '[1]':
        allowguestcontrol: 1
        connected: 1
        driver: vmxnet3
        portgroup: 'vsm.[1].networkscope.[1].virtualwire.[2]'
        startconnected: 1
  AddvNICsOnVM3:
    TestVM: 'vm.[3]'
    Type: VM
    vnic:
      '[1]':
        allowguestcontrol: 1
        connected: 1
        driver: vmxnet3
        portgroup: 'vsm.[1].networkscope.[1].virtualwire.[3]'
        startconnected: 1
  AddvNICsOnVM4:
    TestVM: 'vm.[4]'
    Type: VM
    vnic:
      '[1]':
        allowguestcontrol: 1
        connected: 1
        driver: vmxnet3
        portgroup: 'vsm.[1].networkscope.[1].virtualwire.[4]'
        startconnected: 1
  AddvNICsOnVM5:
    TestVM: 'vm.[5]'
    Type: VM
    vnic:
      '[1]':
        allowguestcontrol: 1
        connected: 1
        driver: vmxnet3
        portgroup: 'vc.[1].dvportgroup.[1]'
        startconnected: 1
  AddvNICsOnVM6:
    TestVM: 'vm.[6]'
    Type: VM
    vnic:
      '[1]':
        allowguestcontrol: 1
        connected: 1
        driver: vmxnet3
        portgroup: 'vc.[1].dvportgroup.[2]'
        startconnected: 1
  AddvNICsOnVM7:
    TestVM: 'vm.[7]'
    Type: VM
    vnic:
      '[1]':
        allowguestcontrol: 1
        connected: 1
        driver: vmxnet3
        portgroup: 'vc.[1].dvportgroup.[3]'
        startconnected: 1
  CreateNetworkScope:
    TestNSX: 'vsm.[1]'
    Type: NSX
    networkscope:
      '[1]':
        clusters: 'vc.[1].datacenter.[1].cluster.[2]'
        name: network-scope-1-26724
  CreateVLANLIF1:
    TestVM: 'vsm.[1].vse.[1]'
    Type: VM
    lif:
      '[1]':
        addressgroup:
          - addresstype: primary
            ipv4address: 172.16.1.1
            netmask: 255.255.0.0
        connected: 1
        name: lif-vlan1-26724
        portgroup: 'vc.[1].dvportgroup.[1]'
        type: internal
  CreateVXLANLIF1:
    TestVM: 'vsm.[1].vse.[1]'
    Type: VM
    lif:
      '[1]':
        addressgroup:
          - addresstype: primary
            ipv4address: 172.31.1.1
            netmask: 255.255.0.0
        connected: 1
        name: lif-vwire1-26724
        portgroup: 'vsm.[1].networkscope.[1].virtualwire.[1]'
        type: internal
  CreateVXLANLIF2:
    TestVM: 'vsm.[1].vse.[1]'
    Type: VM
    lif:
      '[2]':
        addressgroup:
          - addresstype: primary
            ipv4address: 172.32.1.1
            netmask: 255.255.0.0
        connected: 1
        name: lif-vwire2-26724
        portgroup: 'vsm.[1].networkscope.[1].virtualwire.[2]'
        type: internal
  CreateVXLANLIF3:
    TestVM: 'vsm.[1].vse.[1]'
    Type: VM
    lif:
      '[3]':
        addressgroup:
          - addresstype: primary
            ipv4address: 172.33.1.1
            netmask: 255.255.0.0
        connected: 1
        name: lif-vwire3-26724
        portgroup: 'vsm.[1].networkscope.[1].virtualwire.[3]'
        type: internal
  CreateVXLANLIF4:
    TestVM: 'vsm.[1].vse.[1]'
    Type: VM
    lif:
      '[4]':
        addressgroup:
          - addresstype: primary
            ipv4address: 172.34.1.1
            netmask: 255.255.0.0
        connected: 1
        name: lif-vwire4-26724
        portgroup: 'vsm.[1].networkscope.[1].virtualwire.[4]'
        type: internal
  CreateVirtualWires:
    TestTransportZone: 'vsm.[1].networkscope.[1]'
    Type: TransportZone
    VirtualWire:
      '[1]':
        controlplanemode: HYBRID_MODE
        name: AutoGenerate
        tenantid: AutoGenerate
      '[2]':
        controlplanemode: UNICAST_MODE
        name: AutoGenerate
        tenantid: AutoGenerate
      '[3]':
        controlplanemode: MULTICAST_MODE
        name: AutoGenerate
        tenantid: AutoGenerate
      '[4-8]':
        name: AutoGenerate
        tenantid: AutoGenerate
  DeleteAllLifs:
    TestVM: 'vsm.[1].vse.[1]'
    Type: VM
    deletelif: 'vsm.[1].vse.[1].lif.[-1]'
  DeleteController:
    TestNSX: 'vsm.[1]'
    Type: NSX
    deletevxlancontroller: 'vsm.[1].vxlancontroller.[-1]'
  DeleteEdge:
    TestNSX: 'vsm.[1]'
    Type: NSX
    deletevse: 'vsm.[1].vse.[-1]'
  DeleteNetworkScopes:
    TestNSX: 'vsm.[1]'
    Type: NSX
    deletenetworkscope: 'vsm.[1].networkscope.[-1]'
  Delete_All_VirtualWires:
    TestTransportZone: 'vsm.[1].networkscope.[-1]'
    Type: TransportZone
    deletevirtualwire: 'vsm.[1].networkscope.[-1].virtualwire.[-1]'
  DeployEdge:
    TestNSX: 'vsm.[1]'
    Type: NSX
    vse:
      '[1]':
        datacenter: 'vc.[1].datacenter.[1]'
        host: 'host.[4]'
        name: Edge-26724
        portgroup: 'vc.[1].dvportgroup.[1]'
        primaryaddress: 10.10.10.10
        resourcepool: 'vc.[1].datacenter.[1].cluster.[3]'
        subnetmask: 255.255.255.0
  DeployFirstController:
    TestNSX: 'vsm.[1]'
    Type: NSX
    vxlancontroller:
      '[1]':
        firstnodeofcluster: true
        host: 'host.[1]'
        ippool: 'vsm.[1].ippool.[1]'
        name: AutoGenerate
        resourcepool: 'vc.[1].datacenter.[1].cluster.[1]'
  ExitSequence:
    -
      - DeleteEdge
    -
      - RemovevNICFromVM1
      - RemovevNICFromVM2
      - RemovevNICFromVM3
    -
      - Delete_All_VirtualWires
    -
      - DeleteNetworkScopes
  Expand_TZ:
    TestTransportZone: 'vsm.[1].networkscope.[1]'
    Type: TransportZone
    clusters: 'vc.[1].datacenter.[1].cluster.[3]'
    transportzoneaction: expand
  Expand_TZ_Across_VDSes:
    TestTransportZone: 'vsm.[1].networkscope.[1]'
    Type: TransportZone
    clusters: 'vc.[1].datacenter.[1].cluster.[4]'
    transportzoneaction: expand
  InstallVibsConfigureVxlanClusterLAXVds2:
    TestNSX: 'vsm.[1]'
    Type: NSX
    VDNCluster:
      '[3]':
        cluster: 'vc.[1].datacenter.[1].cluster.[4]'
        mtu: 1600
        switch: 'vc.[1].vds.[2]'
        teaming: *1
        vibs: install
        vlan: 19
        vmkniccount: 1
  InstallVibsConfigureVxlanClusterSFOVds1:
    TestNSX: 'vsm.[1]'
    Type: NSX
    VDNCluster:
      '[2]':
        cluster: 'vc.[1].datacenter.[1].cluster.[3]'
        mtu: 1600
        switch: 'vc.[1].vds.[1]'
        teaming: *1
        vibs: install
        vlan: 18
        vmkniccount: 1
  InstallVibsConfigureVxlanClusterSJCVds1:
    TestNSX: 'vsm.[1]'
    Type: NSX
    VDNCluster:
      '[1]':
        cluster: 'vc.[1].datacenter.[1].cluster.[2]'
        mtu: 1600
        switch: 'vc.[1].vds.[1]'
        teaming: *1
        vibs: install
        vlan: 18
        vmkniccount: 1
  MakeSurevNICConnectedVm1andVm2:
    Type: NetAdapter
    connected: 1
    reconfigure: true
    startconnected: 1
    testadapter:
      - 'vm.[1].vnic.[1]'
      - 'vm.[2].vnic.[1]'
  MakeSurevNICConnectedVm1andVm2andVm3:
    Type: NetAdapter
    connected: 1
    reconfigure: true
    startconnected: 1
    testadapter:
      - 'vm.[1].vnic.[1]'
      - 'vm.[2].vnic.[1]'
      - 'vm.[3].vnic.[1]'
  MakeSurevNICConnectedVm1andVm2andVm3andVm4:
    Type: NetAdapter
    connected: 1
    reconfigure: true
    startconnected: 1
    testadapter:
      - 'vm.[1].vnic.[1]'
      - 'vm.[2].vnic.[1]'
      - 'vm.[3].vnic.[1]'
      - 'vm.[4].vnic.[1]'
  NetperfTestDifferentHostIgnorethroughput:
    ExpectedResult: ignore
    NoofOutbound: 1
    SupportAdapter: 'vm.[2].vnic.[1]'
    TestAdapter: 'vm.[1].vnic.[1]'
    TestDuration: 60
    ToolName: Ping
    Type: Traffic
  PingAllTest:
    NoofInbound: 1
    NoofOutbound: 1
    SupportAdapter: 'vm.[2].vnic.[1],vm.[3].vnic.[1],vm.[4].vnic.[1]'
    TestAdapter: 'vm.[1].vnic.[1]'
    TestDuration: 60
    ToolName: Ping
    Type: Traffic
    maxtimeout: 128000
  PingAllTestDifferentHost:
    NoofInbound: 1
    NoofOutbound: 1
    SupportAdapter: 'vm.[2].vnic.[1],vm.[3].vnic.[1]'
    TestAdapter: 'vm.[1].vnic.[1]'
    TestDuration: 60
    ToolName: Ping
    Type: Traffic
    maxtimeout: 128000
  PingAllTestThreeDifferentHost:
    NoofInbound: 1
    NoofOutbound: 1
    SupportAdapter: 'vm.[2].vnic.[1],vm.[4].vnic.[1]'
    TestAdapter: 'vm.[1].vnic.[1]'
    TestDuration: 60
    ToolName: Ping
    Type: Traffic
    maxtimeout: 128000
  PingTestDifferentHost:
    NoofInbound: 1
    NoofOutbound: 1
    SupportAdapter: 'vm.[2].vnic.[1]'
    TestAdapter: 'vm.[1].vnic.[1]'
    TestDuration: 60
    ToolName: Ping
    Type: Traffic
    maxtimeout: 128000
  PingTestDifferentHostNegative:
    NoofInbound: 1
    NoofOutbound: 1
    SupportAdapter: 'vm.[3].vnic.[1]'
    TestAdapter: 'vm.[1].vnic.[1]'
    TestDuration: 60
    ToolName: Ping
    Type: Traffic
    expectedresult: fail
    maxtimeout: 128000
  PingVlanTestSameVdsDifferentCluster:
    NoofInbound: 1
    NoofOutbound: 1
    SupportAdapter: 'vm.[6].vnic.[1], vm.[7].vnic.[1]'
    TestAdapter: 'vm.[5].vnic.[1]'
    TestDuration: 60
    ToolName: Ping
    Type: Traffic
    maxtimeout: 128000
  PingVlanTestSameVdsSameCluster:
    NoofInbound: 1
    NoofOutbound: 1
    SupportAdapter: 'vm.[6].vnic.[1]'
    TestAdapter: 'vm.[5].vnic.[1]'
    TestDuration: 60
    ToolName: Ping
    Type: Traffic
    maxtimeout: 128000
  PlaceVM1OnVLAN16:
    Type: NetAdapter
    portgroup: 'vc.[1].dvportgroup.[1]'
    reconfigure: true
    testadapter: 'vm.[1].vnic.[1]'
  PoweronVM1:
    TestVM: 'vm.[1]'
    Type: VM
    vmstate: poweron
  PoweronVM2:
    TestVM: 'vm.[2]'
    Type: VM
    vmstate: poweron
  PoweronVM3:
    TestVM: 'vm.[3]'
    Type: VM
    vmstate: poweron
  PoweronVM4:
    TestVM: 'vm.[4]'
    Type: VM
    vmstate: poweron
  PoweronVM5:
    TestVM: 'vm.[5]'
    Type: VM
    vmstate: poweron
  RebootHost:
    TestHost: 'host.[1]'
    Type: Host
    reboot: yes
  RebootHost1:
    TestHost: 'host.[1]'
    Type: Host
    reboot: yes
  RebootHost2:
    TestHost: 'host.[2]'
    Type: Host
    reboot: yes
  RebootHost3:
    TestHost: 'host.[3]'
    Type: Host
    reboot: yes
  RebootHost4:
    TestHost: 'host.[4]'
    Type: Host
    reboot: yes
  RebootHost5:
    TestHost: 'host.[5]'
    Type: Host
    reboot: yes
  RemovevNICFromVM1:
    TestVM: 'vm.[1]'
    Type: VM
    deletevnic: 'vm.[1].vnic.[1]'
  RemovevNICFromVM2:
    TestVM: 'vm.[2]'
    Type: VM
    deletevnic: 'vm.[2].vnic.[1]'
  RemovevNICFromVM3:
    TestVM: 'vm.[3]'
    Type: VM
    deletevnic: 'vm.[3].vnic.[1]'
  RemovevNICFromVM4:
    TestVM: 'vm.[4]'
    Type: VM
    deletevnic: 'vm.[4].vnic.[1]'
  RemovevNICFromVM5:
    TestVM: 'vm.[5]'
    Type: VM
    deletevnic: 'vm.[5].vnic.[1]'
  RemovevNICFromVM6:
    TestVM: 'vm.[6]'
    Type: VM
    deletevnic: 'vm.[6].vnic.[1]'
  Sequence:
    -
      - CreateNetworkScope
    -
      - CreateVirtualWires
    -
      - DeployEdge
    -
      - CreateVXLANLIF1
    -
      - CreateVXLANLIF2
    -
      - AddvNICsOnVM1
    -
      - AddvNICsOnVM2
    -
      - PoweronVM1
      - PoweronVM2
    -
      - MakeSurevNICConnectedVm1andVm2
    -
      - SetVXLANIPVM1
      - SetVXLANIPVM2DifferentvWire
    -
      - AddVXLANRouteVM1
      - AddVXLANRouteVM2
    -
      - PingTestDifferentHost
    -
      - NetperfTestDifferentHostIgnorethroughput
    -
      - Expand_TZ
    -
      - CreateVXLANLIF3
    -
      - AddvNICsOnVM3
    -
      - PoweronVM3
    -
      - MakeSurevNICConnectedVm1andVm2andVm3
    -
      - SetVXLANIPVM3DifferentvWire
    -
      - AddVXLANRouteVM3
    -
      - PingAllTestDifferentHost
    -
      - Shrink_TZ
    -
      - PingTestDifferentHostNegative
    -
      - Expand_TZ_Across_VDSes
    -
      - CreateVXLANLIF4
    -
      - AddvNICsOnVM4
    -
      - PoweronVM4
    -
      - MakeSurevNICConnectedVm1andVm2andVm3andVm4
    -
      - SetVXLANIPVM4DifferentvWire
    -
      - AddVXLANRouteVM4
    -
      - PingAllTestThreeDifferentHost
    -
      - RemovevNICFromVM4
    -
      - Shrink_TZ_1
    -
      - PingTestDifferentHost
    -
      - DeleteEdge
    -
      - UninstallvibsConfigureVxlanClusterSFOVds1
    -
      - RebootHost4
    -
      - InstallVibsConfigureVxlanClusterSFOVds1
    -
      - PoweronVM3
    -
      - PoweronVM4
    -
      - Expand_TZ
    -
      - Expand_TZ_Across_VDSes
    -
      - DeployEdge
    -
      - CreateVXLANLIF1
    -
      - CreateVXLANLIF2
    -
      - CreateVXLANLIF3
    -
      - CreateVXLANLIF4
    -
      - AddvNICsOnVM4
    -
      - MakeSurevNICConnectedVm1andVm2andVm3andVm4
    -
      - SetVXLANIPVM3DifferentvWire
    -
      - AddVXLANRouteVM3
    -
      - SetVXLANIPVM4DifferentvWire
    -
      - AddVXLANRouteVM4
    -
      - PingAllTest
    -
      - Shrink_TZ
    -
      - RemovevNICFromVM4
    -
      - Shrink_TZ_1
    -
      - DeleteAllLifs
    -
      - CreateVLANLIF1
    -
      - CreateVXLANLIF2
    -
      - PlaceVM1OnVLAN16
    -
      - SetVLANIPVM1
    -
      - AddVLANRouteVM1
    -
      - PingTestDifferentHost
    -
      - Expand_TZ
    -
      - Expand_TZ_Across_VDSes
    -
      - PingTestDifferentHost
    -
      - Shrink_TZ
    -
      - Shrink_TZ_1
    -
      - PingTestDifferentHost
  SetMulticastRange:
    Multicastiprange:
      '[1]':
        begin: 239.0.0.101
        end: 239.254.254.254
        name: AutoGenerate
    TestNSX: 'vsm.[1]'
    Type: NSX
  SetSegmentIDRange:
    TestNSX: 'vsm.[1]'
    Type: NSX
    segmentidrange:
      '[1]':
        begin: 5001-10001
        end: 99000
        name: AutoGenerate
  SetVLANIPVM1:
    Testadapter: 'vm.[1].vnic.[1]'
    Type: NetAdapter
    ipv4: dhcp
  SetVXLANIPVM1:
    Testadapter: 'vm.[1].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.31.1.5
    netmask: 255.255.0.0
  SetVXLANIPVM2DifferentvWire:
    Testadapter: 'vm.[2].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.32.1.5
    netmask: 255.255.0.0
  SetVXLANIPVM3DifferentvWire:
    Testadapter: 'vm.[3].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.33.1.5
    netmask: 255.255.0.0
  SetVXLANIPVM4DifferentvWire:
    Testadapter: 'vm.[4].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.34.1.5
    netmask: 255.255.0.0
  Shrink_TZ:
    TestTransportZone: 'vsm.[1].networkscope.[1]'
    Type: TransportZone
    clusters: 'vc.[1].datacenter.[1].cluster.[3]'
    transportzoneaction: shrink
  Shrink_TZ_1:
    TestTransportZone: 'vsm.[1].networkscope.[1]'
    Type: TransportZone
    clusters: 'vc.[1].datacenter.[1].cluster.[4]'
    transportzoneaction: shrink
  Uninstall_VDNCluster:
    TestNSX: 'vsm.[1]'
    Type: NSX
    deletevdncluster: 'vsm.[1].vdncluster.[-1]'
  UninstallvibsConfigureVxlanClusterSFOVds1:
    TestNSX: 'vsm.[1]'
    Type: NSX
    deletevdncluster: 'vsm.[1].vdncluster.[2]'
---
Category: NSX
Component: network vDR
Summary: 'This is the vdr datapath sanity testcase for vms on same host '
Tags: RunOnCAT
TestName: JumboSanityTest_SameHost
TestbedSpec:
  host:
    '[1]': {}
    '[2-4]':
      vmnic:
        '[1-2]':
          driver: any
  vc:
    '[1]':
      datacenter:
        '[1]':
          Cluster:
            '[1]':
              host: 'host.[1]'
              name: Controller-Cluster-26724
            '[2]':
              host: 'host.[2-3]'
              name: Compute-Cluster-26724
            '[3]':
              host: 'host.[4]'
              name: Compute-Cluster2-26724
      dvportgroup:
        '[1]':
          name: dvpg-mgmt-26724
          vds: 'vc.[1].vds.[1]'
        '[2]':
          name: dvpg-vlan16-26724
          vds: 'vc.[1].vds.[1]'
          vlan: 16
          vlantype: access
        '[3]':
          name: dvpg-vlan17-26724
          vds: 'vc.[1].vds.[1]'
          vlan: 17
          vlantype: access
        '[4]':
          name: dvpg-vlan21-26724
          vds: 'vc.[1].vds.[1]'
          vlan: 21
          vlantype: access
      vds:
        '[1]':
          configurehosts: add
          datacenter: 'vc.[1].datacenter.[1]'
          host: 'host.[2-4]'
          numuplinkports: 1
          vmnicadapter: 'host.[2-4].vmnic.[1]'
  vm:
    '[1-2]':
      datastoreType: shared
      host: 'host.[2]'
      vmstate: poweroff
    '[3]':
      datastoreType: shared
      host: 'host.[3]'
      vmstate: poweroff
  vsm:
    '[1]':
      VDNCluster:
        '[1]':
          cluster: 'vc.[1].datacenter.[1].cluster.[2]'
          mtu: 1600
          switch: 'vc.[1].vds.[1]'
          teaming: &1
            - LOADBALANCE_SRCMAC
            - LOADBALANCE_SRCID
            - LOADBALANCE_LOADBASED
            - FAILOVER_ORDER
            - ETHER_CHANNEL
          vibs: install
          vlan:
            - 21
          vmkniccount: 1
      assignrole: enterprise_admin
      ippool:
        '[1]':
          gateway: x.x.x.x
          ipranges:
            - a.a.a.a-b.b.b.b
          name: AutoGenerate
          prefixlength: yy
      multicastiprange:
        '[1]':
          begin: 239.1.1.1
          end: 239.1.1.100
          name: AutoGenerate
      reconfigure: true
      segmentidrange:
        '[1]':
          begin: 10000
          end: 19000
          name: AutoGenerate
      vc: 'vc.[1]'
      vxlancontroller:
        '[1]':
          host: 'host.[1]'
          ippool: 'vsm.[1].ippool.[1]'
          name: AutoGenerate
          resourcepool: 'vc.[1].datacenter.[1].cluster.[1]'
        '[2]':
          host: 'host.[1]'
          ippool: 'vsm.[1].ippool.[1]'
          name: AutoGenerate
          resourcepool: 'vc.[1].datacenter.[1].cluster.[1]'
        '[3]':
          host: 'host.[1]'
          ippool: 'vsm.[1].ippool.[1]'
          name: AutoGenerate
          resourcepool: 'vc.[1].datacenter.[1].cluster.[1]'
Version: 2
WORKLOADS:
  AddVLANRouteVM1:
    Testadapter: 'vm.[1].vnic.[1]'
    Type: NetAdapter
    gateway: 172.16.1.1
    netmask: 255.255.0.0
    network: '172.17.0.0,172.31.0.0,172.32.0.0'
    route: add
  AddVLANRouteVM2:
    Testadapter: 'vm.[2].vnic.[1]'
    Type: NetAdapter
    gateway: 172.17.1.1
    netmask: 255.255.0.0
    network: '172.16.0.0,172.31.0.0,172.32.0.0'
    route: add
  AddVXLANRouteVM1:
    Testadapter: 'vm.[1].vnic.[1]'
    Type: NetAdapter
    gateway: 172.31.1.1
    netmask: 255.255.0.0
    network: '172.32.0.0,172.16.0.0,172.17.0.0'
    route: add
  AddVXLANRouteVM2:
    Testadapter: 'vm.[2].vnic.[1]'
    Type: NetAdapter
    gateway: 172.32.1.1
    netmask: 255.255.0.0
    network: '172.31.0.0,172.16.0.0,172.17.0.0'
    route: add
  AddvNICsOnVMs:
    TestVM: 'vm.[1],vm.[2],vm.[3]'
    Type: VM
    vnic:
      '[1]':
        allowguestcontrol: 1
        connected: 1
        driver: vmxnet3
        portgroup: 'vsm.[1].networkscope.[1].virtualwire.[1]'
        startconnected: 1
  BridgevWire3ToVLAN21:
    TestVM: 'vsm.[1].vse.[1]'
    Type: VM
    bridge:
      '[1]':
        name: bridge-1-26724
        portgroup: 'vc.[1].dvportgroup.[4]'
        virtualwire: 'vsm.[1].networkscope.[1].virtualwire.[3]'
  CreateNetworkScope:
    TestNSX: 'vsm.[1]'
    Type: NSX
    networkscope:
      '[1]':
        clusters: 'vc.[1].datacenter.[1].cluster.[2]'
        name: network-scope-1-26724
  CreateVLANLIF3:
    TestVM: 'vsm.[1].vse.[1]'
    Type: VM
    lif:
      '[3]':
        addressgroup:
          - addresstype: primary
            ipv4address: 172.16.1.1
            netmask: 255.255.0.0
        connected: 1
        name: lif-16-26724
        portgroup: 'vc.[1].dvportgroup.[2]'
        type: internal
  CreateVLANLIF4:
    TestVM: 'vsm.[1].vse.[1]'
    Type: VM
    lif:
      '[4]':
        addressgroup:
          - addresstype: primary
            ipv4address: 172.17.1.1
            netmask: 255.255.0.0
        connected: 1
        name: lif-17-26724
        portgroup: 'vc.[1].dvportgroup.[3]'
        type: internal
  CreateVXLANLIF1:
    TestVM: 'vsm.[1].vse.[1]'
    Type: VM
    lif:
      '[1]':
        addressgroup:
          - addresstype: primary
            ipv4address: 172.31.1.1
            netmask: 255.255.0.0
        connected: 1
        name: lif-vwire1-26724
        portgroup: 'vsm.[1].networkscope.[1].virtualwire.[1]'
        type: internal
  CreateVXLANLIF2:
    TestVM: 'vsm.[1].vse.[1]'
    Type: VM
    lif:
      '[2]':
        addressgroup:
          - addresstype: primary
            ipv4address: 172.32.1.1
            netmask: 255.255.0.0
        connected: 1
        name: lif-vwire2-26724
        portgroup: 'vsm.[1].networkscope.[1].virtualwire.[2]'
        type: internal
  CreateVirtualWires:
    TestTransportZone: 'vsm.[1].networkscope.[1]'
    Type: TransportZone
    VirtualWire:
      '[1]':
        name: AutoGenerate
        tenantid: 1
      '[2]':
        name: AutoGenerate
        tenantid: 2
      '[3]':
        name: AutoGenerate
        tenantid: 3
  DeleteController:
    TestNSX: 'vsm.[1]'
    Type: NSX
    deletevxlancontroller: 'vsm.[1].vxlancontroller.[-1]'
  DeleteEdges:
    TestNSX: 'vsm.[1]'
    Type: NSX
    deletevse: 'vsm.[1].vse.[-1]'
  DeleteNetworkScope:
    TestNSX: 'vsm.[1]'
    Type: NSX
    deletenetworkscope: 'vsm.[1].networkscope.[-1]'
  DeleteVirtualWires:
    TestTransportZone: 'vsm.[1].networkscope.[1]'
    Type: TransportZone
    deletevirtualwire: 'vsm.[1].networkscope.[1].virtualwire.[1-3]'
  Delete_All_VirtualWires:
    TestTransportZone: 'vsm.[1].networkscope.[-1]'
    Type: TransportZone
    deletevirtualwire: 'vsm.[1].networkscope.[-1].virtualwire.[-1]'
  DeployEdge:
    TestNSX: 'vsm.[1]'
    Type: NSX
    vse:
      '[1]':
        datacenter: 'vc.[1].datacenter.[1]'
        host: 'host.[3]'
        name: Edge-26724
        portgroup: 'vc.[1].dvportgroup.[1]'
        primaryaddress: 10.10.10.11
        resourcepool: 'vc.[1].datacenter.[1].cluster.[2]'
        subnetmask: 255.255.255.0
  DeployFirstController:
    TestNSX: 'vsm.[1]'
    Type: NSX
    vxlancontroller:
      '[1]':
        firstnodeofcluster: true
        host: 'host.[1]'
        ippool: 'vsm.[1].ippool.[1]'
        name: AutoGenerate
        resourcepool: 'vc.[1].datacenter.[1].cluster.[1]'
  ExitSequence:
    -
      - DeleteEdges
    -
      - RemovevNICFromVM1
    -
      - RemovevNICFromVM2
    -
      - RemovevNICFromVM3
    -
      - Delete_All_VirtualWires
    -
      - DeleteNetworkScope
  Expand_TZ:
    TestTransportZone: 'vsm.[1].networkscope.[1]'
    Type: TransportZone
    clusters: 'vc.[1].datacenter.[1].cluster.[3]'
    transportzoneaction: expand
  GetVirtualWireID:
    FindType: Switch
    Type: Switch
    testvirtualwire: 'vsm.[1].networkscope.[1].virtualwire.[1]'
  Install_Config_ClusterSJC:
    TestNSX: 'vsm.[1]'
    Type: NSX
    VDNCluster:
      '[1]':
        cluster: 'vc.[1].datacenter.[1].cluster.[2]'
        mtu: 1600
        switch: 'vc.[1].vds.[1]'
        teaming: *1
        vibs: install
        vlan:
          - 21
        vmkniccount: 1
  Install_Config_ClusterSJC2:
    TestNSX: 'vsm.[1]'
    Type: NSX
    VDNCluster:
      '[2]':
        cluster: 'vc.[1].datacenter.[1].cluster.[3]'
        mtu: 1600
        switch: 'vc.[1].vds.[1]'
        teaming: *1
        vibs: install
        vlan:
          - 21
        vmkniccount: 1
  MakeSurevNICConnected:
    Type: NetAdapter
    connected: 1
    reconfigure: true
    startconnected: 1
    testadapter: 'vm.[1-2].vnic.[1]'
  NetperfTestIgnorethroughput:
    ExpectedResult: ignore
    NoofOutbound: 1
    SupportAdapter: 'vm.[2].vnic.[1]'
    TestAdapter: 'vm.[1].vnic.[1]'
    TestDuration: 60
    ToolName: netperf
    Type: Traffic
  PingTest:
    NoofInbound: 1
    NoofOutbound: 1
    SupportAdapter: 'vm.[2].vnic.[1]'
    TestAdapter: 'vm.[1].vnic.[1]'
    TestDuration: 60
    ToolName: Ping
    Type: Traffic
    maxtimeout: 128000
  PlaceVM1OnVLAN16:
    Type: NetAdapter
    portgroup: 'vc.[1].dvportgroup.[2]'
    reconfigure: true
    testadapter: 'vm.[1].vnic.[1]'
  PlaceVM1OnvWire1:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[1]'
    reconfigure: true
    testadapter: 'vm.[1].vnic.[1]'
  PlaceVM1OnvWire3:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[3]'
    reconfigure: true
    testadapter: 'vm.[1].vnic.[1]'
  PlaceVM2OnMgmtdvpg:
    Type: NetAdapter
    portgroup: 'vc.[1].dvportgroup.[1]'
    reconfigure: true
    testadapter: 'vm.[2].vnic.[1]'
  PlaceVM2OnVLAN17:
    Type: NetAdapter
    portgroup: 'vc.[1].dvportgroup.[3]'
    reconfigure: true
    testadapter: 'vm.[2].vnic.[1]'
  PlaceVM2OnVLAN21:
    Type: NetAdapter
    portgroup: 'vc.[1].dvportgroup.[4]'
    reconfigure: true
    testadapter: 'vm.[2].vnic.[1]'
  PlaceVM2OnvWire2:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[2]'
    reconfigure: true
    testadapter: 'vm.[2].vnic.[1]'
  PlaceVM3OnvWire2:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[2]'
    reconfigure: true
    testadapter: 'vm.[3].vnic.[1]'
  PlaceVMsOnMgmtdvPG:
    Type: NetAdapter
    portgroup: 'vc.[1].dvportgroup.[1]'
    reconfigure: true
    testadapter: 'vm.[1-3].vnic.[1]'
  PoweroffVM1:
    TestVM: 'vm.[1]'
    Type: VM
    vmstate: poweroff
  PoweroffVM2:
    TestVM: 'vm.[2]'
    Type: VM
    vmstate: poweroff
  PoweronVM1:
    TestVM: 'vm.[1]'
    Type: VM
    vmstate: poweron
  PoweronVM2:
    TestVM: 'vm.[2]'
    Type: VM
    vmstate: poweron
  RebootHost:
    TestHost: 'host.[1]'
    Type: Host
    reboot: yes
  RebootHost2:
    TestHost: 'host.[2]'
    Type: Host
    reboot: yes
  RebootHost3:
    TestHost: 'host.[3]'
    Type: Host
    reboot: yes
  RemovevNICFromVM1:
    TestVM: 'vm.[1]'
    Type: VM
    deletevnic: 'vm.[1].vnic.[1]'
  RemovevNICFromVM2:
    TestVM: 'vm.[2]'
    Type: VM
    deletevnic: 'vm.[2].vnic.[1]'
  RemovevNICFromVM3:
    TestVM: 'vm.[3]'
    Type: VM
    deletevnic: 'vm.[3].vnic.[1]'
  Sequence:
    -
      - CreateNetworkScope
    -
      - CreateVirtualWires
    -
      - AddvNICsOnVMs
    -
      - PoweronVM1
      - PoweronVM2
    -
      - MakeSurevNICConnected
    -
      - SetVXLANIPVM1
      - SetVXLANIPVM2SamevWire
    -
      - PingTest
    -
      - NetperfTestIgnorethroughput
    -
      - DeployEdge
    -
      - CreateVXLANLIF1
    -
      - CreateVXLANLIF2
    -
      - CreateVLANLIF3
    -
      - CreateVLANLIF4
    -
      - BridgevWire3ToVLAN21
    -
      - PlaceVM1OnvWire1
      - PlaceVM2OnvWire2
    -
      - SetVXLANIPVM1
      - SetVXLANIPVM2
    -
      - AddVXLANRouteVM1
      - AddVXLANRouteVM2
    -
      - PingTest
    -
      - NetperfTestIgnorethroughput
    -
      - PlaceVM1OnVLAN16
      - PlaceVM2OnVLAN17
    -
      - SetVLANIPVM1
      - SetVLANIPVM2
    -
      - AddVLANRouteVM1
      - AddVLANRouteVM2
    -
      - PingTest
    -
      - NetperfTestIgnorethroughput
    -
      - PlaceVM1OnvWire1
      - PlaceVM2OnVLAN17
    -
      - SetVXLANIPVM1
      - SetVLANIPVM2
    -
      - AddVXLANRouteVM1
      - AddVLANRouteVM2
    -
      - PingTest
    -
      - NetperfTestIgnorethroughput
    -
      - PlaceVM2OnvWire2
      - PlaceVM1OnVLAN16
    -
      - SetVLANIPVM1
      - SetVXLANIPVM2
    -
      - AddVLANRouteVM1
      - AddVXLANRouteVM2
    -
      - PingTest
    -
      - NetperfTestIgnorethroughput
    -
      - PlaceVM1OnvWire3
      - PlaceVM2OnVLAN21
    -
      - SetVXLANBridgeIPVM1
      - SetVLANBridgeIPVM2
    -
      - PingTest
    -
      - NetperfTestIgnorethroughput
  SetMulticastRange:
    Multicastiprange:
      '[1]':
        begin: 239.0.0.101
        end: 239.254.254.254
        name: AutoGenerate
    TestNSX: 'vsm.[1]'
    Type: NSX
  SetSegmentIDRange:
    TestNSX: 'vsm.[1]'
    Type: NSX
    segmentidrange:
      '[1]':
        begin: 5001-10001
        end: 99000
        name: AutoGenerate
  SetVLANBridgeIPVM2:
    Testadapter: 'vm.[2].vnic.[1]'
    Type: NetAdapter
    ipv4: dhcp
  SetVLANIPVM1:
    Testadapter: 'vm.[1].vnic.[1]'
    Type: NetAdapter
    ipv4: dhcp
  SetVLANIPVM2:
    Testadapter: 'vm.[2].vnic.[1]'
    Type: NetAdapter
    ipv4: dhcp
  SetVXLANBridgeIPVM1:
    Testadapter: 'vm.[1].vnic.[1]'
    Type: NetAdapter
    ipv4: dhcp
  SetVXLANIPVM1:
    Testadapter: 'vm.[1].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.31.1.5
    netmask: 255.255.0.0
  SetVXLANIPVM2:
    Testadapter: 'vm.[2].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.32.1.5
    netmask: 255.255.0.0
  SetVXLANIPVM2SamevWire:
    Testadapter: 'vm.[2].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.31.1.6
    netmask: 255.255.0.0
  UnconfigureVXLAN:
    Type: Cluster
    testcluster: 'vsm.[1].vdncluster.[1]'
    vxlan: unconfigure
  Uninstall_VDNCluster:
    TestNSX: 'vsm.[1]'
    Type: NSX
    deletevdncluster: 'vsm.[1].vdncluster.[-1]'
---
Category: NSX
Component: network vDR
Summary: Verify VXLAN routing combos across the clusters with 2 VDS
Tags: RunOnCAT
TestName: 2Cluster2VDSAllVXLANRoutingCombos2
TestbedSpec:
  host:
    '[1]': {}
    '[2-5]':
      vmnic:
        '[1-2]':
          driver: any
  vc:
    '[1]':
      datacenter:
        '[1]':
          Cluster:
            '[1]':
              host: 'host.[1]'
              name: Controller-Cluster-26724
            '[2]':
              name: Compute-Cluster-SJC-26724
            '[3]':
              name: Compute-Cluster-SFO-26724
          host: 'host.[2-5]'
      dvportgroup:
        '[10]':
          name: dvpg-SFO-vlan19-26724
          vds: 'vc.[1].vds.[2]'
          vlan: 19
          vlantype: access
        '[11]':
          name: dvpg-SFO-vlan21-26724
          vds: 'vc.[1].vds.[2]'
          vlan: 21
          vlantype: access
        '[12]':
          name: dvpg-SFO-vlan22-26724
          vds: 'vc.[1].vds.[2]'
          vlan: 22
          vlantype: access
        '[1]':
          name: dvpg-SJC-vlan16-26724
          vds: 'vc.[1].vds.[1]'
          vlan: 16
          vlantype: access
        '[2]':
          name: dvpg-SJC-vlan17-26724
          vds: 'vc.[1].vds.[1]'
          vlan: 17
          vlantype: access
        '[3]':
          name: dvpg-SJC-vlan18-26724
          vds: 'vc.[1].vds.[1]'
          vlan: 18
          vlantype: access
        '[4]':
          name: dvpg-SJC-mgmt-26724
          vds: 'vc.[1].vds.[1]'
          vlan: 19
          vlantype: access
        '[5]':
          name: dvpg-SJC-vlan21-26724
          vds: 'vc.[1].vds.[1]'
          vlan: 21
          vlantype: access
        '[6]':
          name: dvpg-SJC-vlan22-26724
          vds: 'vc.[1].vds.[1]'
          vlan: 22
          vlantype: access
        '[7]':
          name: dvpg-SFO-vlan16-26724
          vds: 'vc.[1].vds.[2]'
          vlan: 16
          vlantype: access
        '[8]':
          name: dvpg-SFO-vlan17-26724
          vds: 'vc.[1].vds.[2]'
          vlan: 17
          vlantype: access
        '[9]':
          name: dvpg-SFO-vlan18-26724
          vds: 'vc.[1].vds.[2]'
          vlan: 18
          vlantype: access
      vds:
        '[1]':
          configurehosts: add
          datacenter: 'vc.[1].datacenter.[1]'
          host: 'host.[2-3]'
          name: VDS-1-SJC-26724
          numuplinkports: 1
          vmnicadapter: 'host.[2-3].vmnic.[1]'
        '[2]':
          configurehosts: add
          datacenter: 'vc.[1].datacenter.[1]'
          host: 'host.[4-5]'
          name: VDS-2-SFO-26724
          numuplinkports: 1
          vmnicadapter: 'host.[4-5].vmnic.[1]'
  vm:
    '[1]':
      datastoreType: shared
      host: 'host.[2]'
      vmstate: poweroff
    '[2]':
      datastoreType: shared
      host: 'host.[3]'
      vmstate: poweroff
    '[3]':
      datastoreType: shared
      host: 'host.[4]'
      vmstate: poweroff
    '[4]':
      datastoreType: shared
      host: 'host.[5]'
      vmstate: poweroff
    '[5]':
      datastoreType: shared
      host: 'host.[2]'
      vmstate: poweroff
    '[6]':
      datastoreType: shared
      host: 'host.[3]'
      vmstate: poweroff
  vsm:
    '[1]':
      assignrole: enterprise_admin
      ippool:
        '[1]':
          gateway: x.x.x.x
          ipranges:
            - a.a.a.a-b.b.b.b
          name: AutoGenerate
          prefixlength: yy
      multicastiprange:
        '[1]':
          begin: 239.1.1.1
          end: 239.1.1.100
          name: AutoGenerate
      reconfigure: true
      segmentidrange:
        '[1]':
          begin: 10000
          end: 19000
          name: AutoGenerate
      vc: 'vc.[1]'
      vxlancontroller:
        '[1]':
          host: 'host.[1]'
          ippool: 'vsm.[1].ippool.[1]'
          name: AutoGenerate
          resourcepool: 'vc.[1].datacenter.[1].cluster.[1]'
Version: 2
WORKLOADS:
  AddRouteVM1VLAN16:
    Testadapter: 'vm.[1].vnic.[1]'
    Type: NetAdapter
    gateway: 172.16.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM1VLAN17:
    Testadapter: 'vm.[1].vnic.[1]'
    Type: NetAdapter
    gateway: 172.17.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM1VLAN18:
    Testadapter: 'vm.[1].vnic.[1]'
    Type: NetAdapter
    gateway: 172.18.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM1VWire1:
    Testadapter: 'vm.[1].vnic.[1]'
    Type: NetAdapter
    gateway: 172.31.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM1VWire2:
    Testadapter: 'vm.[1].vnic.[1]'
    Type: NetAdapter
    gateway: 172.32.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM1VWire3:
    Testadapter: 'vm.[1].vnic.[1]'
    Type: NetAdapter
    gateway: 172.33.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM2VLAN16:
    Testadapter: 'vm.[2].vnic.[1]'
    Type: NetAdapter
    gateway: 172.16.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM2VLAN17:
    Testadapter: 'vm.[2].vnic.[1]'
    Type: NetAdapter
    gateway: 172.17.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM2VLAN18:
    Testadapter: 'vm.[2].vnic.[1]'
    Type: NetAdapter
    gateway: 172.18.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM2VWire1:
    Testadapter: 'vm.[2].vnic.[1]'
    Type: NetAdapter
    gateway: 172.31.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM2VWire2:
    Testadapter: 'vm.[2].vnic.[1]'
    Type: NetAdapter
    gateway: 172.32.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM2VWire3:
    Testadapter: 'vm.[2].vnic.[1]'
    Type: NetAdapter
    gateway: 172.33.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM3VLAN16:
    Testadapter: 'vm.[3].vnic.[1]'
    Type: NetAdapter
    gateway: 172.16.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM3VLAN17:
    Testadapter: 'vm.[3].vnic.[1]'
    Type: NetAdapter
    gateway: 172.17.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM3VLAN18:
    Testadapter: 'vm.[3].vnic.[1]'
    Type: NetAdapter
    gateway: 172.18.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM3VWire1:
    Testadapter: 'vm.[3].vnic.[1]'
    Type: NetAdapter
    gateway: 172.31.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM3VWire2:
    Testadapter: 'vm.[3].vnic.[1]'
    Type: NetAdapter
    gateway: 172.32.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM3VWire3:
    Testadapter: 'vm.[3].vnic.[1]'
    Type: NetAdapter
    gateway: 172.33.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM4VLAN16:
    Testadapter: 'vm.[4].vnic.[1]'
    Type: NetAdapter
    gateway: 172.16.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM4VLAN17:
    Testadapter: 'vm.[4].vnic.[1]'
    Type: NetAdapter
    gateway: 172.17.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM4VLAN18:
    Testadapter: 'vm.[4].vnic.[1]'
    Type: NetAdapter
    gateway: 172.18.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM4VWire1:
    Testadapter: 'vm.[4].vnic.[1]'
    Type: NetAdapter
    gateway: 172.31.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM4VWire2:
    Testadapter: 'vm.[4].vnic.[1]'
    Type: NetAdapter
    gateway: 172.32.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM4VWire3:
    Testadapter: 'vm.[4].vnic.[1]'
    Type: NetAdapter
    gateway: 172.33.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM5VLAN18:
    Testadapter: 'vm.[5].vnic.[1]'
    Type: NetAdapter
    gateway: 172.18.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM5VWire2:
    Testadapter: 'vm.[5].vnic.[1]'
    Type: NetAdapter
    gateway: 172.32.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM5VWire3:
    Testadapter: 'vm.[5].vnic.[1]'
    Type: NetAdapter
    gateway: 172.33.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM6VLAN18:
    Testadapter: 'vm.[6].vnic.[1]'
    Type: NetAdapter
    gateway: 172.18.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM6VWire2:
    Testadapter: 'vm.[6].vnic.[1]'
    Type: NetAdapter
    gateway: 172.32.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM6VWire3:
    Testadapter: 'vm.[6].vnic.[1]'
    Type: NetAdapter
    gateway: 172.33.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddVmotionvmknicsHost2and3:
    TestHost: 'host.[2-3]'
    Type: Host
    vmknic:
      '[1]':
        configurevmotion: enable
        ipv4: dhcp
        portgroup: 'vc.[1].dvportgroup.[1]'
  AddVmotionvmknicsHost4and5:
    TestHost: 'host.[4-5]'
    Type: Host
    vmknic:
      '[1]':
        configurevmotion: enable
        ipv4: dhcp
        portgroup: 'vc.[1].dvportgroup.[6]'
  AddvNICsOn1to4VMs:
    TestVM: 'vm.[5],vm.[6]'
    Type: VM
    vnic:
      '[1]':
        allowguestcontrol: 1
        connected: 1
        driver: vmxnet3
        portgroup: 'vsm.[1].networkscope.[1].virtualwire.[1]'
        startconnected: 1
  AddvNICsOn1to6VMs:
    TestVM: 'vm.[1],vm.[2],vm.[3],vm.[4],vm.[5],vm.[6]'
    Type: VM
    vnic:
      '[1]':
        allowguestcontrol: 1
        connected: 1
        driver: vmxnet3
        portgroup: 'vsm.[1].networkscope.[1].virtualwire.[1]'
        startconnected: 1
  CreateBridges:
    TestVM: 'vsm.[1].vse.[1]'
    Type: VM
    bridge:
      '[1]':
        name: bridge-1-26724
        portgroup: 'vc.[1].dvportgroup.[5]'
        virtualwire: 'vsm.[1].networkscope.[1].virtualwire.[4]'
      '[2]':
        name: bridge-2-26724
        portgroup: 'vc.[1].dvportgroup.[6]'
        virtualwire: 'vsm.[1].networkscope.[1].virtualwire.[5]'
  CreateNetworkScopeClusterSJCandSFO:
    TestNSX: 'vsm.[1]'
    Type: NSX
    networkscope:
      '[1]':
        clusters: 'vc.[1].datacenter.[1].cluster.[2-3]'
        name: network-scope-1-26724
  CreateVXLANLIF1:
    TestVM: 'vsm.[1].vse.[1]'
    Type: VM
    lif:
      '[1]':
        addressgroup:
          - addresstype: primary
            ipv4address: 172.31.1.1
            netmask: 255.255.0.0
        connected: 1
        name: lif-vwire1-26724
        portgroup: 'vsm.[1].networkscope.[1].virtualwire.[1]'
        type: internal
  CreateVXLANLIF2:
    TestVM: 'vsm.[1].vse.[1]'
    Type: VM
    lif:
      '[2]':
        addressgroup:
          - addresstype: primary
            ipv4address: 172.32.1.1
            netmask: 255.255.0.0
        connected: 1
        name: lif-vwire2-26724
        portgroup: 'vsm.[1].networkscope.[1].virtualwire.[2]'
        type: internal
  CreateVXLANLIF3:
    TestVM: 'vsm.[1].vse.[1]'
    Type: VM
    lif:
      '[3]':
        addressgroup:
          - addresstype: primary
            ipv4address: 172.33.1.1
            netmask: 255.255.0.0
        connected: 1
        name: lif-vwire3-26724
        portgroup: 'vsm.[1].networkscope.[1].virtualwire.[3]'
        type: internal
  CreateVXLANLIF4:
    TestVM: 'vsm.[1].vse.[1]'
    Type: VM
    lif:
      '[4]':
        addressgroup:
          - addresstype: primary
            ipv4address: 172.34.1.1
            netmask: 255.255.0.0
        connected: 1
        name: lif-vwire4-26724
        portgroup: 'vsm.[1].networkscope.[1].virtualwire.[4]'
        type: internal
  CreateVirtualWires:
    TestTransportZone: 'vsm.[1].networkscope.[1]'
    Type: TransportZone
    VirtualWire:
      '[1]':
        controlplanemode: HYBRID_MODE
        name: AutoGenerate
        tenantid: AutoGenerate
      '[2]':
        controlplanemode: UNICAST_MODE
        name: AutoGenerate
        tenantid: AutoGenerate
      '[3]':
        controlplanemode: MULTICAST_MODE
        name: AutoGenerate
        tenantid: AutoGenerate
      '[4-8]':
        name: AutoGenerate
        tenantid: AutoGenerate
  DeleteAllVmknics:
    TestHost: 'host.[2-5]'
    Type: Host
    deletevmknic: 'host.[2-5].vmknic.[-1]'
  DeleteController:
    TestNSX: 'vsm.[1]'
    Type: NSX
    deletevxlancontroller: 'vsm.[1].vxlancontroller.[-1]'
  DeleteEdges:
    TestNSX: 'vsm.[1]'
    Type: NSX
    deletevse: 'vsm.[1].vse.[-1]'
  DeleteNetworkScopes:
    TestNSX: 'vsm.[1]'
    Type: NSX
    deletenetworkscope: 'vsm.[1].networkscope.[-1]'
  DeleteVirtualWires:
    TestTransportZone: 'vsm.[1].networkscope.[-1]'
    Type: TransportZone
    deletevirtualwire: 'vsm.[1].networkscope.[-1].virtualwire.[-1]'
  Deploy2ndController:
    TestNSX: 'vsm.[1]'
    Type: NSX
    vxlancontroller:
      '[2]':
        host: 'host.[1]'
        ippool: 'vsm.[1].ippool.[1]'
        name: AutoGenerate
        resourcepool: 'vc.[1].datacenter.[1].cluster.[1]'
  Deploy3rdController:
    TestNSX: 'vsm.[1]'
    Type: NSX
    vxlancontroller:
      '[3]':
        host: 'host.[1]'
        ippool: 'vsm.[1].ippool.[1]'
        name: AutoGenerate
        resourcepool: 'vc.[1].datacenter.[1].cluster.[1]'
  DeployEdge:
    TestNSX: 'vsm.[1]'
    Type: NSX
    vse:
      '[1]':
        datacenter: 'vc.[1].datacenter.[1]'
        host: 'host.[2]'
        name: Edge-26724
        portgroup: 'vc.[1].dvportgroup.[1]'
        primaryaddress: 10.10.10.14
        resourcepool: 'vc.[1].datacenter.[1].cluster.[2]'
        subnetmask: 255.255.255.0
  DeployFirstController:
    TestNSX: 'vsm.[1]'
    Type: NSX
    vxlancontroller:
      '[1]':
        firstnodeofcluster: true
        host: 'host.[1]'
        ippool: 'vsm.[1].ippool.[1]'
        name: AutoGenerate
        resourcepool: 'vc.[1].datacenter.[1].cluster.[1]'
  EnableHAandDRSOnClusterSJCandSFO:
    DRS: 1
    EditCluster: edit
    HA: 1
    TestCluster: 'vc.[1].datacenter.[1].cluster.[2-3]'
    Type: Cluster
  ExitSequence:
    -
      - DeleteEdges
    -
      - RemovevNICFromVM1
      - RemovevNICFromVM2
      - RemovevNICFromVM3
      - RemovevNICFromVM4
      - RemovevNICFromVM5
      - RemovevNICFromVM6
    -
      - DeleteVirtualWires
    -
      - DeleteNetworkScopes
    -
      - Uninstall_VDNCluster
    -
      - RemoveHostsFromClusterSJC
      - RemoveHostsFromClusterSFO
    -
      - RebootHost2
      - RebootHost3
      - RebootHost4
      - RebootHost5
  Install_Configure_ClusterSFO:
    TestNSX: 'vsm.[1]'
    Type: NSX
    VDNCluster:
      '[2]':
        cluster: 'vc.[1].datacenter.[1].cluster.[3]'
        mtu: 1600
        switch: 'vc.[1].vds.[2]'
        teaming: FAILOVER_ORDER
        vibs: install
        vlan: 22
        vmkniccount: 1
  Install_Configure_ClusterSJC:
    TestNSX: 'vsm.[1]'
    Type: NSX
    VDNCluster:
      '[1]':
        cluster: 'vc.[1].datacenter.[1].cluster.[2]'
        mtu: 1600
        switch: 'vc.[1].vds.[1]'
        teaming:
          - LOADBALANCE_SRCMAC
          - LOADBALANCE_SRCID
          - LOADBALANCE_LOADBASED
          - FAILOVER_ORDER
          - ETHER_CHANNEL
        vibs: install
        vlan:
          - 21
        vmkniccount: 1
  MakeSurevNICConnectedVM1andVM2:
    Type: NetAdapter
    connected: 1
    reconfigure: true
    startconnected: 1
    testadapter: 'vm.[1-2].vnic.[1]'
  MoveHostsToClusterSFO:
    MoveHostsToCluster: 'host.[4],host.[5]'
    TestCluster: 'vc.[1].datacenter.[1].cluster.[3]'
    Type: Cluster
  MoveHostsToClusterSJC:
    MoveHostsToCluster: 'host.[2],host.[3]'
    TestCluster: 'vc.[1].datacenter.[1].cluster.[2]'
    Type: Cluster
  NetperfTest2VMsToOther2VMs:
    ExpectedResult: ignore
    L4Protocol: 'tcp,udp'
    LocalSendSocketSize: 131072
    NoofInbound: 1
    NoofOutbound: 1
    ParallelSession: yes
    RemoteSendSocketSize: 131072
    SendMessageSize: '16384,128804'
    SupportAdapter: 'vm.[5-6].vnic.[1]'
    TestAdapter: 'vm.[1-2].vnic.[1]'
    TestDuration: 60
    ToolName: Netperf
    Type: Traffic
    maxtimeout: 128000
  NetperfTest3VMsToOther3VMs:
    ExpectedResult: ignore
    LocalSendSocketSize: 131072
    NoofInbound: 1
    NoofOutbound: 1
    ParallelSession: yes
    RemoteSendSocketSize: 131072
    SendMessageSize: '16384,96684,128804'
    SupportAdapter: 'vm.[4-6].vnic.[1]'
    TestAdapter: 'vm.[1-3].vnic.[1]'
    TestDuration: 60
    ToolName: Netperf
    Type: Traffic
    maxtimeout: 128000
  NetperfTestIgnorethroughput:
    ExpectedResult: ignore
    NoofOutbound: 1
    SupportAdapter: 'vm.[2].vnic.[1]'
    TestAdapter: 'vm.[1].vnic.[1]'
    TestDuration: 60
    ToolName: iperf
    Type: Traffic
  NetperfTestVM1ToAllOthers:
    ExpectedResult: ignore
    NoofInbound: 3
    NoofOutbound: 10
    ParallelSession: yes
    SupportAdapter: 'vm.[2-6].vnic.[1]'
    TestAdapter: 'vm.[1].vnic.[1]'
    TestDuration: 60
    ToolName: 'Netperf,Iperf,Ping'
    Type: Traffic
    maxtimeout: 128000
  PingTest:
    NoofInbound: 1
    NoofOutbound: 1
    ParallelSession: yes
    SupportAdapter: 'vm.[2].vnic.[1]'
    TestAdapter: 'vm.[1].vnic.[1]'
    TestDuration: 60
    ToolName: Ping
    Type: Traffic
    maxtimeout: 128000
  PingTest2VMsToOther2VMs:
    NoofInbound: 1
    NoofOutbound: 1
    SupportAdapter: 'vm.[5-6].vnic.[1]'
    TestAdapter: 'vm.[1-2].vnic.[1]'
    TestDuration: 60
    ToolName: Ping
    Type: Traffic
    maxtimeout: 128000
  PingTest3VMsToOther3VMs:
    NoofInbound: 1
    NoofOutbound: 1
    SupportAdapter: 'vm.[4-6].vnic.[1]'
    TestAdapter: 'vm.[1-3].vnic.[1]'
    TestDuration: 60
    ToolName: Ping
    Type: Traffic
    maxtimeout: 128000
  PingTestSameCluster1:
    NoofInbound: 1
    NoofOutbound: 1
    SupportAdapter: 'vm.[2].vnic.[1]'
    TestAdapter: 'vm.[1].vnic.[1]'
    TestDuration: 60
    ToolName: Ping
    Type: Traffic
    maxtimeout: 128000
  PingTestSameCluster2:
    NoofInbound: 1
    NoofOutbound: 1
    SupportAdapter: 'vm.[4].vnic.[1]'
    TestAdapter: 'vm.[3].vnic.[1]'
    TestDuration: 60
    ToolName: Ping
    Type: Traffic
    maxtimeout: 128000
  PingTestVM1ToAllOthers:
    NoofInbound: 1
    NoofOutbound: 1
    ParallelSession: yes
    SupportAdapter: 'vm.[2-6].vnic.[1]'
    TestAdapter: 'vm.[1].vnic.[1]'
    TestDuration: 60
    ToolName: Ping
    Type: Traffic
    maxtimeout: 128000
  PlaceVM1OnVLAN16_VDS1:
    Type: NetAdapter
    portgroup: 'vc.[1].dvportgroup.[1]'
    reconfigure: true
    testadapter: 'vm.[1].vnic.[1]'
  PlaceVM1OnvWire1:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[1]'
    reconfigure: true
    testadapter: 'vm.[1].vnic.[1]'
  PlaceVM1OnvWire2:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[2]'
    reconfigure: true
    testadapter: 'vm.[1].vnic.[1]'
  PlaceVM1OnvWire3:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[3]'
    reconfigure: true
    testadapter: 'vm.[1].vnic.[1]'
  PlaceVM1OnvWire4:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[4]'
    reconfigure: true
    testadapter: 'vm.[1].vnic.[1]'
  PlaceVM2OnMgmtdvpg:
    Type: NetAdapter
    portgroup: 'vc.[1].dvportgroup.[1]'
    reconfigure: true
    testadapter: 'vm.[2].vnic.[1]'
  PlaceVM2OnVLAN17_VDS1:
    Type: NetAdapter
    portgroup: 'vc.[1].dvportgroup.[2]'
    reconfigure: true
    testadapter: 'vm.[2].vnic.[1]'
  PlaceVM2OnVLAN21_VDS1:
    Type: NetAdapter
    portgroup: 'vc.[1].dvportgroup.[5]'
    reconfigure: true
    testadapter: 'vm.[2].vnic.[1]'
  PlaceVM2OnvWire1:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[1]'
    reconfigure: true
    testadapter: 'vm.[2].vnic.[1]'
  PlaceVM2OnvWire2:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[2]'
    reconfigure: true
    testadapter: 'vm.[2].vnic.[1]'
  PlaceVM2OnvWire3:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[3]'
    reconfigure: true
    testadapter: 'vm.[2].vnic.[1]'
  PlaceVM3OnVLAN16_VDS2:
    Type: NetAdapter
    portgroup: 'vc.[1].dvportgroup.[7]'
    reconfigure: true
    testadapter: 'vm.[3].vnic.[1]'
  PlaceVM3OnVLAN21_VDS2:
    Type: NetAdapter
    portgroup: 'vc.[1].dvportgroup.[5]'
    reconfigure: true
    testadapter: 'vm.[3].vnic.[1]'
  PlaceVM3OnvWire1:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[1]'
    reconfigure: true
    testadapter: 'vm.[3].vnic.[1]'
  PlaceVM3OnvWire2:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[2]'
    reconfigure: true
    testadapter: 'vm.[3].vnic.[1]'
  PlaceVM3OnvWire3:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[3]'
    reconfigure: true
    testadapter: 'vm.[3].vnic.[1]'
  PlaceVM4OnVLAN17_VDS2:
    Type: NetAdapter
    portgroup: 'vc.[1].dvportgroup.[8]'
    reconfigure: true
    testadapter: 'vm.[4].vnic.[1]'
  PlaceVM4OnvWire1:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[1]'
    reconfigure: true
    testadapter: 'vm.[4].vnic.[1]'
  PlaceVM4OnvWire2:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[2]'
    reconfigure: true
    testadapter: 'vm.[4].vnic.[1]'
  PlaceVM4OnvWire3:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[3]'
    reconfigure: true
    testadapter: 'vm.[4].vnic.[1]'
  PlaceVM5OnvWire1:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[1]'
    reconfigure: true
    testadapter: 'vm.[5].vnic.[1]'
  PlaceVM5OnvWire2:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[2]'
    reconfigure: true
    testadapter: 'vm.[5].vnic.[1]'
  PlaceVM5OnvWire3:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[3]'
    reconfigure: true
    testadapter: 'vm.[5].vnic.[1]'
  PlaceVM6OnVLAN18_VDS1:
    Type: NetAdapter
    portgroup: 'vc.[1].dvportgroup.[3]'
    reconfigure: true
    testadapter: 'vm.[6].vnic.[1]'
  PlaceVM6OnvWire1:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[1]'
    reconfigure: true
    testadapter: 'vm.[6].vnic.[1]'
  PlaceVM6OnvWire2:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[2]'
    reconfigure: true
    testadapter: 'vm.[6].vnic.[1]'
  PlaceVM6OnvWire3:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[3]'
    reconfigure: true
    testadapter: 'vm.[6].vnic.[1]'
  PlaceVMsOnMgmtdvPG:
    Type: NetAdapter
    portgroup: 'vc.[1].dvportgroup.[4]'
    reconfigure: true
    testadapter: 'vm.[1-3].vnic.[1]'
  PoweroffVM1:
    TestVM: 'vm.[1]'
    Type: VM
    vmstate: poweroff
  PoweroffVM2:
    TestVM: 'vm.[2]'
    Type: VM
    vmstate: poweroff
  PoweroffVM3:
    TestVM: 'vm.[3]'
    Type: VM
    vmstate: poweroff
  PoweroffVM4:
    TestVM: 'vm.[4]'
    Type: VM
    vmstate: poweroff
  PoweroffVM5:
    TestVM: 'vm.[5]'
    Type: VM
    vmstate: poweroff
  PoweroffVM6:
    TestVM: 'vm.[6]'
    Type: VM
    vmstate: poweroff
  PoweronVM1:
    TestVM: 'vm.[1]'
    Type: VM
    vmstate: poweron
  PoweronVM2:
    TestVM: 'vm.[2]'
    Type: VM
    vmstate: poweron
  PoweronVM3:
    TestVM: 'vm.[3]'
    Type: VM
    vmstate: poweron
  PoweronVM4:
    TestVM: 'vm.[4]'
    Type: VM
    vmstate: poweron
  PoweronVM5:
    TestVM: 'vm.[5]'
    Type: VM
    vmstate: poweron
  PoweronVM6:
    TestVM: 'vm.[6]'
    Type: VM
    vmstate: poweron
  PrepClusterSFO:
    TestNSX: 'vsm.[1]'
    Type: NSX
    VDNCluster:
      '[3]':
        cluster: 'vc.[1].datacenter.[1].cluster.[3]'
  ReDeployEdge:
    TestVM: 'vsm.[1].vse.[1]'
    Type: VM
    applianceaction: redeploy
  RebootHost:
    TestHost: 'host.[1]'
    Type: Host
    reboot: yes
  RebootHost2:
    TestHost: 'host.[2]'
    Type: Host
    reboot: yes
  RebootHost3:
    TestHost: 'host.[3]'
    Type: Host
    reboot: yes
  RebootHost4:
    TestHost: 'host.[4]'
    Type: Host
    reboot: yes
  RebootHost5:
    TestHost: 'host.[5]'
    Type: Host
    reboot: yes
  RemoveHostsFromClusterSFO:
    MoveHostsFromCluster: 'host.[4],host.[5]'
    TestCluster: 'vc.[1].datacenter.[1].cluster.[3]'
    Type: Cluster
  RemoveHostsFromClusterSJC:
    MoveHostsFromCluster: 'host.[2],host.[3]'
    TestCluster: 'vc.[1].datacenter.[1].cluster.[2]'
    Type: Cluster
  RemovevNICFromVM1:
    TestVM: 'vm.[1]'
    Type: VM
    deletevnic: 'vm.[1].vnic.[1]'
  RemovevNICFromVM1To3:
    TestVM: 'vm.[1-3]'
    Type: VM
    deletevnic: 'vm.[x].vnic.[1]'
  RemovevNICFromVM2:
    TestVM: 'vm.[2]'
    Type: VM
    deletevnic: 'vm.[2].vnic.[1]'
  RemovevNICFromVM3:
    TestVM: 'vm.[3]'
    Type: VM
    deletevnic: 'vm.[3].vnic.[1]'
  RemovevNICFromVM4:
    TestVM: 'vm.[4]'
    Type: VM
    deletevnic: 'vm.[4].vnic.[1]'
  RemovevNICFromVM4To6:
    TestVM: 'vm.[4-6]'
    Type: VM
    deletevnic: 'vm.[x].vnic.[1]'
  RemovevNICFromVM5:
    TestVM: 'vm.[5]'
    Type: VM
    deletevnic: 'vm.[5].vnic.[1]'
  RemovevNICFromVM6:
    TestVM: 'vm.[6]'
    Type: VM
    deletevnic: 'vm.[6].vnic.[1]'
  ResetMulticast:
    TestNSX: 'vsm.[1]'
    Type: NSX
    deletemulticastiprange: 'vsm.[1].multicastiprange.[-1]'
  ResetSegmentID:
    TestNSX: 'vsm.[1]'
    Type: NSX
    deletesegmentidrange: 'vsm.[1].segmentidrange.[-1]'
  SamevWireNetperfTestDifferentCluster:
    MinExpResult: 1
    NoofInbound: 1
    NoofOutbound: 1
    SupportAdapter: 'vm.[3].vnic.[1]'
    TestAdapter: 'vm.[1].vnic.[1]'
    TestDuration: 60
    Type: Traffic
    l3protocol: 'ipv4,ipv6'
    l4protocol: 'tcp,udp'
    maxtimeout: 128000
  Sequence:
    -
      - MoveHostsToClusterSJC
    -
      - MoveHostsToClusterSFO
    -
      - Install_Configure_ClusterSJC
      - Install_Configure_ClusterSFO
    -
      - CreateNetworkScopeClusterSJCandSFO
    -
      - CreateVirtualWires
    -
      - DeployEdge
    -
      - CreateVXLANLIF1
    -
      - CreateVXLANLIF2
    -
      - CreateVXLANLIF3
    -
      - CreateBridges
    -
      - AddvNICsOn1to6VMs
    -
      - PoweronVM1
      - PoweronVM2
    -
      - PoweronVM3
      - PoweronVM4
      - PoweronVM5
      - PoweronVM6
    -
      - PlaceVM1OnvWire1
      - PlaceVM2OnvWire1
      - PlaceVM3OnvWire1
      - PlaceVM4OnvWire1
      - PlaceVM5OnvWire1
      - PlaceVM6OnvWire1
    -
      - SetIPVM1VWire1
      - SetIPVM2VWire1
      - SetIPVM3VWire1
      - SetIPVM4VWire1
      - SetIPVM5VWire1
      - SetIPVM6VWire1
    -
      - PingTestVM1ToAllOthers
    -
      - PingTest3VMsToOther3VMs
    -
      - PoweroffVM1
      - PoweroffVM2
      - PoweroffVM3
    -
      - PoweroffVM4
      - PoweroffVM5
      - PoweroffVM6
    -
      - PoweronVM1
      - PoweronVM2
      - PoweronVM3
    -
      - PoweronVM4
      - PoweronVM5
      - PoweronVM6
    -
      - PlaceVM1OnvWire1
      - PlaceVM2OnvWire2
      - PlaceVM3OnvWire2
      - PlaceVM4OnvWire2
      - PlaceVM5OnvWire2
      - PlaceVM6OnvWire2
    -
      - SetIPVM1VWire1
      - SetIPVM2VWire2
      - SetIPVM3VWire2
      - SetIPVM4VWire2
      - SetIPVM5VWire2
      - SetIPVM6VWire2
    -
      - AddRouteVM1VWire1
      - AddRouteVM2VWire2
      - AddRouteVM3VWire2
      - AddRouteVM4VWire2
      - AddRouteVM5VWire2
      - AddRouteVM6VWire2
    -
      - PingTestVM1ToAllOthers
    -
      - PingTest3VMsToOther3VMs
    -
      - PlaceVM1OnvWire1
      - PlaceVM2OnvWire1
      - PlaceVM3OnvWire1
      - PlaceVM4OnvWire2
      - PlaceVM5OnvWire2
      - PlaceVM6OnvWire2
    -
      - SetIPVM1VWire1
      - SetIPVM2VWire1
      - SetIPVM3VWire1
      - SetIPVM4VWire2
      - SetIPVM5VWire2
      - SetIPVM6VWire2
    -
      - AddRouteVM1VWire1
      - AddRouteVM2VWire1
      - AddRouteVM3VWire1
      - AddRouteVM4VWire2
      - AddRouteVM5VWire2
      - AddRouteVM6VWire2
    -
      - PingTestVM1ToAllOthers
    -
      - PingTest3VMsToOther3VMs
    -
      - PoweroffVM1
      - PoweroffVM2
      - PoweroffVM3
    -
      - PoweroffVM4
      - PoweroffVM5
      - PoweroffVM6
    -
      - PoweronVM1
      - PoweronVM2
      - PoweronVM3
    -
      - PoweronVM4
      - PoweronVM5
      - PoweronVM6
    -
      - PlaceVM1OnvWire1
      - PlaceVM2OnvWire1
      - PlaceVM3OnvWire2
      - PlaceVM4OnvWire2
      - PlaceVM5OnvWire3
      - PlaceVM6OnvWire3
    -
      - SetIPVM1VWire1
      - SetIPVM2VWire1
      - SetIPVM3VWire2
      - SetIPVM4VWire2
      - SetIPVM5VWire3
      - SetIPVM6VWire3
    -
      - AddRouteVM1VWire1
      - AddRouteVM2VWire1
      - AddRouteVM3VWire2
      - AddRouteVM4VWire2
      - AddRouteVM5VWire3
      - AddRouteVM6VWire3
    -
      - PingTestVM1ToAllOthers
      - PingTest3VMsToOther3VMs
  SetIPVM1VLAN16:
    Testadapter: 'vm.[1].vnic.[1]'
    Type: NetAdapter
    ipv4: dhcp
  SetIPVM1VLAN17:
    Testadapter: 'vm.[1].vnic.[1]'
    Type: NetAdapter
    ipv4: dhcp
  SetIPVM1VLAN18:
    Testadapter: 'vm.[1].vnic.[1]'
    Type: NetAdapter
    ipv4: dhcp
  SetIPVM1VWire1:
    Testadapter: 'vm.[1].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.31.1.15
    netmask: 255.255.0.0
  SetIPVM1VWire2:
    Testadapter: 'vm.[1].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.32.1.15
    netmask: 255.255.0.0
  SetIPVM1VWire3:
    Testadapter: 'vm.[1].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.33.1.15
    netmask: 255.255.0.0
  SetIPVM1VWire4:
    Testadapter: 'vm.[1].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.21.1.15
    netmask: 255.255.0.0
  SetIPVM2VLAN16:
    Testadapter: 'vm.[2].vnic.[1]'
    Type: NetAdapter
    ipv4: dhcp
  SetIPVM2VLAN17:
    Testadapter: 'vm.[2].vnic.[1]'
    Type: NetAdapter
    ipv4: dhcp
  SetIPVM2VLAN18:
    Testadapter: 'vm.[2].vnic.[1]'
    Type: NetAdapter
    ipv4: dhcp
  SetIPVM2VLAN21:
    Testadapter: 'vm.[2].vnic.[1]'
    Type: NetAdapter
    ipv4: dhcp
  SetIPVM2VWire1:
    Testadapter: 'vm.[2].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.31.1.25
    netmask: 255.255.0.0
  SetIPVM2VWire2:
    Testadapter: 'vm.[2].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.32.1.25
    netmask: 255.255.0.0
  SetIPVM2VWire3:
    Testadapter: 'vm.[2].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.33.1.25
    netmask: 255.255.0.0
  SetIPVM3VLAN16:
    Testadapter: 'vm.[3].vnic.[1]'
    Type: NetAdapter
    ipv4: dhcp
  SetIPVM3VLAN17:
    Testadapter: 'vm.[3].vnic.[1]'
    Type: NetAdapter
    ipv4: dhcp
  SetIPVM3VLAN18:
    Testadapter: 'vm.[3].vnic.[1]'
    Type: NetAdapter
    ipv4: dhcp
  SetIPVM3VWire1:
    Testadapter: 'vm.[3].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.31.1.35
    netmask: 255.255.0.0
  SetIPVM3VWire2:
    Testadapter: 'vm.[3].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.32.1.35
    netmask: 255.255.0.0
  SetIPVM3VWire3:
    Testadapter: 'vm.[3].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.33.1.35
    netmask: 255.255.0.0
  SetIPVM4VLAN16:
    Testadapter: 'vm.[4].vnic.[1]'
    Type: NetAdapter
    ipv4: dhcp
  SetIPVM4VLAN17:
    Testadapter: 'vm.[4].vnic.[1]'
    Type: NetAdapter
    ipv4: dhcp
  SetIPVM4VLAN18:
    Testadapter: 'vm.[4].vnic.[1]'
    Type: NetAdapter
    ipv4: dhcp
  SetIPVM4VWire1:
    Testadapter: 'vm.[4].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.31.1.45
    netmask: 255.255.0.0
  SetIPVM4VWire2:
    Testadapter: 'vm.[4].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.32.1.45
    netmask: 255.255.0.0
  SetIPVM4VWire3:
    Testadapter: 'vm.[4].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.33.1.45
    netmask: 255.255.0.0
  SetIPVM5VLAN18:
    Testadapter: 'vm.[5].vnic.[1]'
    Type: NetAdapter
    ipv4: dhcp
  SetIPVM5VWire1:
    Testadapter: 'vm.[5].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.31.1.55
    netmask: 255.255.0.0
  SetIPVM5VWire2:
    Testadapter: 'vm.[5].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.32.1.55
    netmask: 255.255.0.0
  SetIPVM5VWire3:
    Testadapter: 'vm.[5].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.33.1.55
    netmask: 255.255.0.0
  SetIPVM6VLAN18:
    Testadapter: 'vm.[6].vnic.[1]'
    Type: NetAdapter
    ipv4: dhcp
  SetIPVM6VWire1:
    Testadapter: 'vm.[6].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.31.1.65
    netmask: 255.255.0.0
  SetIPVM6VWire2:
    Testadapter: 'vm.[6].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.32.1.65
    netmask: 255.255.0.0
  SetIPVM6VWire3:
    Testadapter: 'vm.[6].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.33.1.65
    netmask: 255.255.0.0
  SetMulticastRange:
    Multicastiprange:
      '[1]':
        begin: 239.0.0.101
        end: 239.254.254.254
        name: AutoGenerate
    TestNSX: 'vsm.[1]'
    Type: NSX
  SetSegmentIDRange:
    TestNSX: 'vsm.[1]'
    Type: NSX
    segmentidrange:
      '[1]':
        begin: 5001-10001
        end: 99000
        name: AutoGenerate
  Uninstall_VDNCluster:
    TestNSX: 'vsm.[1]'
    Type: NSX
    deletevdncluster: 'vsm.[1].vdncluster.[-1]'
  vMotionVM2ToHost3:
    Iterations: 1
    TestVM: 'vm.[3]'
    Type: VM
    dsthost: 'host.[2]'
    vmotion: oneway
---
Category: NSX
Component: network vDR
Summary: 'rebooting the hosts carrying vdr instances and then verify different traffic combos '
Tags: RunOnCAT
TestName: HostRebootScenarios
TestbedSpec:
  host:
    '[1]': {}
    '[2-4]':
      vmnic:
        '[1-2]':
          driver: any
  vc:
    '[1]':
      datacenter:
        '[1]':
          Cluster:
            '[1]':
              host: 'host.[1]'
              name: Controller-Cluster-26724
            '[2]':
              host: 'host.[2-3]'
              name: Compute-Cluster-26724
            '[3]':
              host: 'host.[4]'
              name: Compute-Cluster2-26724
      dvportgroup:
        '[1]':
          name: dvpg-mgmt-26724
          vds: 'vc.[1].vds.[1]'
        '[2]':
          name: dvpg-vlan16-26724
          vds: 'vc.[1].vds.[1]'
          vlan: 16
          vlantype: access
        '[3]':
          name: dvpg-vlan17-26724
          vds: 'vc.[1].vds.[1]'
          vlan: 17
          vlantype: access
        '[4]':
          name: dvpg-vlan21-26724
          vds: 'vc.[1].vds.[1]'
          vlan: 21
          vlantype: access
      vds:
        '[1]':
          configurehosts: add
          datacenter: 'vc.[1].datacenter.[1]'
          host: 'host.[2-4]'
          numuplinkports: 1
          vmnicadapter: 'host.[2-4].vmnic.[1]'
  vm:
    '[1-2]':
      datastoreType: shared
      host: 'host.[2]'
      vmstate: poweroff
    '[3]':
      datastoreType: shared
      host: 'host.[3]'
      vmstate: poweroff
  vsm:
    '[1]':
      VDNCluster:
        '[1]':
          cluster: 'vc.[1].datacenter.[1].cluster.[2]'
          mtu: 1600
          switch: 'vc.[1].vds.[1]'
          teaming: &1
            - LOADBALANCE_SRCMAC
            - LOADBALANCE_SRCID
            - LOADBALANCE_LOADBASED
            - FAILOVER_ORDER
            - ETHER_CHANNEL
          vibs: install
          vlan:
            - 21
          vmkniccount: 1
      assignrole: enterprise_admin
      ippool:
        '[1]':
          gateway: x.x.x.x
          ipranges:
            - a.a.a.a-b.b.b.b
          name: AutoGenerate
          prefixlength: yy
      multicastiprange:
        '[1]':
          begin: 239.1.1.1
          end: 239.1.1.100
          name: AutoGenerate
      reconfigure: true
      segmentidrange:
        '[1]':
          begin: 10000
          end: 19000
          name: AutoGenerate
      vc: 'vc.[1]'
      vxlancontroller:
        '[1]':
          host: 'host.[1]'
          ippool: 'vsm.[1].ippool.[1]'
          name: AutoGenerate
          resourcepool: 'vc.[1].datacenter.[1].cluster.[1]'
        '[2]':
          host: 'host.[1]'
          ippool: 'vsm.[1].ippool.[1]'
          name: AutoGenerate
          resourcepool: 'vc.[1].datacenter.[1].cluster.[1]'
        '[3]':
          host: 'host.[1]'
          ippool: 'vsm.[1].ippool.[1]'
          name: AutoGenerate
          resourcepool: 'vc.[1].datacenter.[1].cluster.[1]'
Version: 2
WORKLOADS:
  AddVLANRouteVM1:
    Testadapter: 'vm.[1].vnic.[1]'
    Type: NetAdapter
    gateway: 172.16.1.1
    netmask: 255.255.0.0
    network: '172.17.0.0,172.31.0.0,172.32.0.0'
    route: add
  AddVLANRouteVM2:
    Testadapter: 'vm.[2].vnic.[1]'
    Type: NetAdapter
    gateway: 172.17.1.1
    netmask: 255.255.0.0
    network: '172.16.0.0,172.31.0.0,172.32.0.0'
    route: add
  AddVLANRouteVM3:
    Testadapter: 'vm.[3].vnic.[1]'
    Type: NetAdapter
    gateway: 172.17.1.1
    netmask: 255.255.0.0
    network: '172.16.0.0,172.31.0.0,172.32.0.0'
    route: add
  AddVXLANRouteVM1:
    Testadapter: 'vm.[1].vnic.[1]'
    Type: NetAdapter
    gateway: 172.31.1.1
    netmask: 255.255.0.0
    network: '172.32.0.0,172.16.0.0,172.17.0.0'
    route: add
  AddVXLANRouteVM2:
    Testadapter: 'vm.[2].vnic.[1]'
    Type: NetAdapter
    gateway: 172.32.1.1
    netmask: 255.255.0.0
    network: '172.31.0.0,172.16.0.0,172.17.0.0'
    route: add
  AddVXLANRouteVM3:
    Testadapter: 'vm.[3].vnic.[1]'
    Type: NetAdapter
    gateway: 172.32.1.1
    netmask: 255.255.0.0
    network: '172.31.0.0,172.16.0.0,172.17.0.0'
    route: add
  AddVmotionvmknics:
    TestHost: 'host.[2-3]'
    Type: Host
    vmknic:
      '[1]':
        configurevmotion: enable
        ipv4: dhcp
        portgroup: 'vc.[1].dvportgroup.[1]'
  AddvNICForvMotion:
    TestVM: 'vm.[1],vm.[2]'
    Type: VM
    vnic:
      '[2]':
        allowguestcontrol: 1
        connected: 1
        driver: vmxnet3
        portgroup: 'vc.[1].dvportgroup.[1]'
        startconnected: 1
  AddvNICsOnVMs:
    TestVM: 'vm.[1],vm.[2],vm.[3]'
    Type: VM
    vnic:
      '[1]':
        allowguestcontrol: 1
        connected: 1
        driver: vmxnet3
        portgroup: 'vsm.[1].networkscope.[1].virtualwire.[1]'
        startconnected: 1
  BridgevWire3ToVLAN21:
    TestVM: 'vsm.[1].vse.[1]'
    Type: VM
    bridge:
      '[1]':
        name: bridge-1-26724
        portgroup: 'vc.[1].dvportgroup.[4]'
        virtualwire: 'vsm.[1].networkscope.[1].virtualwire.[3]'
  CreateNetworkScope:
    TestNSX: 'vsm.[1]'
    Type: NSX
    networkscope:
      '[1]':
        clusters: 'vc.[1].datacenter.[1].cluster.[2]'
        name: network-scope-1-26724
  CreateVLANLIF3:
    TestVM: 'vsm.[1].vse.[1]'
    Type: VM
    lif:
      '[3]':
        addressgroup:
          - addresstype: primary
            ipv4address: 172.16.1.1
            netmask: 255.255.0.0
        connected: 1
        name: lif-16-26724
        portgroup: 'vc.[1].dvportgroup.[2]'
        type: internal
  CreateVLANLIF4:
    TestVM: 'vsm.[1].vse.[1]'
    Type: VM
    lif:
      '[4]':
        addressgroup:
          - addresstype: primary
            ipv4address: 172.17.1.1
            netmask: 255.255.0.0
        connected: 1
        name: lif-17-26724
        portgroup: 'vc.[1].dvportgroup.[3]'
        type: internal
  CreateVXLANLIF1:
    TestVM: 'vsm.[1].vse.[1]'
    Type: VM
    lif:
      '[1]':
        addressgroup:
          - addresstype: primary
            ipv4address: 172.31.1.1
            netmask: 255.255.0.0
        connected: 1
        name: lif-vwire1-26724
        portgroup: 'vsm.[1].networkscope.[1].virtualwire.[1]'
        type: internal
  CreateVXLANLIF2:
    TestVM: 'vsm.[1].vse.[1]'
    Type: VM
    lif:
      '[2]':
        addressgroup:
          - addresstype: primary
            ipv4address: 172.32.1.1
            netmask: 255.255.0.0
        connected: 1
        name: lif-vwire2-26724
        portgroup: 'vsm.[1].networkscope.[1].virtualwire.[2]'
        type: internal
  CreateVirtualWires:
    TestTransportZone: 'vsm.[1].networkscope.[1]'
    Type: TransportZone
    VirtualWire:
      '[1]':
        name: AutoGenerate
        tenantid: 1
      '[2]':
        name: AutoGenerate
        tenantid: 2
      '[3]':
        name: AutoGenerate
        tenantid: 3
  DeleteController:
    TestNSX: 'vsm.[1]'
    Type: NSX
    deletevxlancontroller: 'vsm.[1].vxlancontroller.[-1]'
  DeleteEdges:
    TestNSX: 'vsm.[1]'
    Type: NSX
    deletevse: 'vsm.[1].vse.[-1]'
  DeleteIPPool:
    TestNSX: 'vsm.[1]'
    Type: NSX
    deleteippool: 'vsm.[1].ippool.[1]'
    sleepbetweenworkloads: 10
  DeleteNetworkScope: &2
    TestNSX: 'vsm.[1]'
    Type: NSX
    deletenetworkscope: 'vsm.[1].networkscope.[-1]'
  DeleteNetworkScopes: *2
  DeleteVirtualWires:
    TestTransportZone: 'vsm.[1].networkscope.[1]'
    Type: TransportZone
    deletevirtualwire: 'vsm.[1].networkscope.[1].virtualwire.[1-3]'
  Delete_All_VirtualWires:
    TestTransportZone: 'vsm.[1].networkscope.[-1]'
    Type: TransportZone
    deletevirtualwire: 'vsm.[1].networkscope.[-1].virtualwire.[-1]'
  Deploy2ndController:
    TestNSX: 'vsm.[1]'
    Type: NSX
    vxlancontroller:
      '[2]':
        host: 'host.[1]'
        ippool: 'vsm.[1].ippool.[1]'
        name: AutoGenerate
        resourcepool: 'vc.[1].datacenter.[1].cluster.[1]'
  Deploy3rdController:
    TestNSX: 'vsm.[1]'
    Type: NSX
    vxlancontroller:
      '[3]':
        host: 'host.[1]'
        ippool: 'vsm.[1].ippool.[1]'
        name: AutoGenerate
        resourcepool: 'vc.[1].datacenter.[1].cluster.[1]'
  DeployEdge:
    TestNSX: 'vsm.[1]'
    Type: NSX
    vse:
      '[1]':
        datacenter: 'vc.[1].datacenter.[1]'
        host: 'host.[2]'
        name: Edge-26724
        portgroup: 'vc.[1].dvportgroup.[1]'
        primaryaddress: 10.10.10.31
        resourcepool: 'vc.[1].datacenter.[1].cluster.[2]'
        subnetmask: 255.255.255.0
  DeployFirstController:
    TestNSX: 'vsm.[1]'
    Type: NSX
    vxlancontroller:
      '[1]':
        firstnodeofcluster: true
        host: 'host.[1]'
        ippool: 'vsm.[1].ippool.[1]'
        name: AutoGenerate
        resourcepool: 'vc.[1].datacenter.[1].cluster.[1]'
  ExitSequence:
    -
      - DeleteEdges
    -
      - RemovevNICFromVM1
      - RemovevNICFromVM2
      - RemovevNICFromVM3
    -
      - Delete_All_VirtualWires
    -
      - DeleteNetworkScopes
  GetVirtualWireID:
    FindType: Switch
    Type: Switch
    testvirtualwire: 'vsm.[1].networkscope.[1].virtualwire.[1]'
  Install_Configure_ClusterSJC:
    TestNSX: 'vsm.[1]'
    Type: NSX
    VDNCluster:
      '[1]':
        cluster: 'vc.[1].datacenter.[1].cluster.[2]'
        mtu: 1600
        switch: 'vc.[1].vds.[1]'
        teaming: *1
        vibs: install
        vlan:
          - 21
        vmkniccount: 1
  MakeSurevNICConnected:
    Type: NetAdapter
    connected: 1
    reconfigure: true
    startconnected: 1
    testadapter: 'vm.[1-2].vnic.[1]'
  NetperfTestDifferentHostIgnoreThroughput:
    ExpectedResult: ignore
    NoofOutbound: 1
    SupportAdapter: 'vm.[3].vnic.[1]'
    TestAdapter: 'vm.[1].vnic.[1]'
    TestDuration: 60
    ToolName: Ping
    Type: Traffic
  NetperfTestIgnorethroughput:
    ExpectedResult: ignore
    NoofOutbound: 1
    ParallelSession: yes
    SupportAdapter: 'vm.[2].vnic.[1]'
    TestAdapter: 'vm.[1].vnic.[1]'
    TestDuration: 60
    ToolName: 'netperf,iperf'
    Type: Traffic
  PingTest:
    NoofInbound: 1
    NoofOutbound: 1
    SupportAdapter: 'vm.[2].vnic.[1]'
    TestAdapter: 'vm.[1].vnic.[1]'
    TestDuration: 60
    ToolName: Ping
    Type: Traffic
    maxtimeout: 128000
  PingTestDifferentHost:
    NoofInbound: 1
    NoofOutbound: 1
    SupportAdapter: 'vm.[3].vnic.[1]'
    TestAdapter: 'vm.[1].vnic.[1]'
    TestDuration: 60
    ToolName: Ping
    Type: Traffic
    maxtimeout: 128000
    sleepbetweenworkloads: 60
  PlaceVM1OnVLAN16:
    Type: NetAdapter
    portgroup: 'vc.[1].dvportgroup.[2]'
    reconfigure: true
    testadapter: 'vm.[1].vnic.[1]'
  PlaceVM1OnvWire1:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[1]'
    reconfigure: true
    testadapter: 'vm.[1].vnic.[1]'
  PlaceVM1OnvWire3:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[3]'
    reconfigure: true
    testadapter: 'vm.[1].vnic.[1]'
  PlaceVM2OnMgmtdvpg:
    Type: NetAdapter
    portgroup: 'vc.[1].dvportgroup.[1]'
    reconfigure: true
    testadapter: 'vm.[2].vnic.[1]'
  PlaceVM2OnVLAN17:
    Type: NetAdapter
    portgroup: 'vc.[1].dvportgroup.[3]'
    reconfigure: true
    testadapter: 'vm.[2].vnic.[1]'
  PlaceVM2OnVLAN21:
    Type: NetAdapter
    portgroup: 'vc.[1].dvportgroup.[4]'
    reconfigure: true
    testadapter: 'vm.[2].vnic.[1]'
  PlaceVM2OnvWire2:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[2]'
    reconfigure: true
    testadapter: 'vm.[2].vnic.[1]'
  PlaceVM3OnVLAN17:
    Type: NetAdapter
    portgroup: 'vc.[1].dvportgroup.[3]'
    reconfigure: true
    testadapter: 'vm.[3].vnic.[1]'
  PlaceVM3OnVLAN21:
    Type: NetAdapter
    portgroup: 'vc.[1].dvportgroup.[4]'
    reconfigure: true
    testadapter: 'vm.[3].vnic.[1]'
  PlaceVM3OnvWire1:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[1]'
    reconfigure: true
    testadapter: 'vm.[3].vnic.[1]'
  PlaceVM3OnvWire2:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[2]'
    reconfigure: true
    testadapter: 'vm.[3].vnic.[1]'
  PlaceVM3OnvWire3:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[3]'
    reconfigure: true
    testadapter: 'vm.[3].vnic.[1]'
  PlaceVMsOnMgmtdvPG:
    Type: NetAdapter
    portgroup: 'vc.[1].dvportgroup.[1]'
    reconfigure: true
    testadapter: 'vm.[1-3].vnic.[1]'
  PoweroffVM1:
    TestVM: 'vm.[1]'
    Type: VM
    vmstate: poweroff
  PoweroffVM2:
    TestVM: 'vm.[2]'
    Type: VM
    vmstate: poweroff
  PoweroffVM3:
    TestVM: 'vm.[3]'
    Type: VM
    vmstate: poweroff
  PoweronVM1:
    TestVM: 'vm.[1]'
    Type: VM
    vmstate: poweron
  PoweronVM2:
    TestVM: 'vm.[2]'
    Type: VM
    vmstate: poweron
  PoweronVM3:
    TestVM: 'vm.[3]'
    Type: VM
    vmstate: poweron
  PrepClusterSFO:
    TestNSX: 'vsm.[1]'
    Type: NSX
    VDNCluster:
      '[3]':
        cluster: 'vc.[1].datacenter.[1].cluster.[3]'
  RebootHost:
    TestHost: 'host.[1]'
    Type: Host
    reboot: yes
  RebootHost2:
    TestHost: 'host.[2]'
    Type: Host
    reboot: yes
  RebootHost3:
    TestHost: 'host.[3]'
    Type: Host
    reboot: yes
  RemovevNICFromVM1:
    TestVM: 'vm.[1]'
    Type: VM
    deletevnic: 'vm.[1].vnic.[1]'
  RemovevNICFromVM2:
    TestVM: 'vm.[2]'
    Type: VM
    deletevnic: 'vm.[2].vnic.[1]'
  RemovevNICFromVM3:
    TestVM: 'vm.[3]'
    Type: VM
    deletevnic: 'vm.[3].vnic.[1]'
  ResetMulticast:
    TestNSX: 'vsm.[1]'
    Type: NSX
    deletemulticastiprange: 'vsm.[1].multicastiprange.[-1]'
  ResetSegmentID:
    TestNSX: 'vsm.[1]'
    Type: NSX
    deletesegmentidrange: 'vsm.[1].segmentidrange.[-1]'
  SamevWireNetperfTestDifferentHost:
    MinExpResult: 1
    NoofInbound: 1
    NoofOutbound: 1
    SupportAdapter: 'vm.[3].vnic.[1]'
    TestAdapter: 'vm.[1].vnic.[1]'
    TestDuration: 60
    Type: Traffic
    l3protocol: 'ipv4,ipv6'
    l4protocol: 'tcp,udp'
    maxtimeout: 128000
  Sequence:
    -
      - CreateNetworkScope
    -
      - CreateVirtualWires
    -
      - AddvNICsOnVMs
    -
      - PoweronVM1
      - PoweronVM2
    -
      - MakeSurevNICConnected
    -
      - SetVXLANIPVM1
      - SetVXLANIPVM2SamevWire
    -
      - PingTest
    -
      - DeployEdge
    -
      - CreateVXLANLIF1
    -
      - CreateVXLANLIF2
    -
      - CreateVLANLIF3
    -
      - CreateVLANLIF4
    -
      - BridgevWire3ToVLAN21
    -
      - PoweronVM3
    -
      - PlaceVM1OnvWire1
      - PlaceVM3OnvWire1
    -
      - SetVXLANIPVM1
      - SetVXLANIPVM3SamevWire
    -
      - PingTestDifferentHost
    -
      - PlaceVM1OnvWire1
      - PlaceVM3OnvWire2
    -
      - SetVXLANIPVM1
      - SetVXLANIPVM3
    -
      - AddVXLANRouteVM1
      - AddVXLANRouteVM3
    -
      - PingTestDifferentHost
    -
      - RebootHost2
    -
      - PoweronVM1
      - PoweronVM2
      - PoweronVM3
    -
      - PlaceVM1OnvWire1
      - PlaceVM3OnvWire2
    -
      - SetVXLANIPVM1
      - SetVXLANIPVM3
    -
      - AddVXLANRouteVM1
      - AddVXLANRouteVM3
    -
      - PingTestDifferentHost
    -
      - RebootHost2
      - RebootHost3
    -
      - PoweronVM1
      - PoweronVM2
      - PoweronVM3
    -
      - PlaceVM1OnvWire1
      - PlaceVM3OnvWire2
    -
      - SetVXLANIPVM1
      - SetVXLANIPVM3
    -
      - AddVXLANRouteVM1
      - AddVXLANRouteVM3
    -
      - PingTestDifferentHost
    -
      - PlaceVM1OnVLAN16
      - PlaceVM3OnVLAN17
    -
      - SetVLANIPVM1
      - SetVLANIPVM3
    -
      - AddVLANRouteVM1
      - AddVLANRouteVM3
    -
      - PingTestDifferentHost
    -
      - PlaceVM1OnvWire1
      - PlaceVM3OnVLAN17
    -
      - SetVXLANIPVM1
      - SetVLANIPVM3
    -
      - AddVXLANRouteVM1
      - AddVLANRouteVM3
    -
      - PingTestDifferentHost
    -
      - PlaceVM3OnvWire2
      - PlaceVM1OnVLAN16
    -
      - SetVLANIPVM1
      - SetVXLANIPVM3
    -
      - AddVLANRouteVM1
      - AddVXLANRouteVM3
    -
      - PingTestDifferentHost
    -
      - PlaceVM1OnvWire3
    -
      - PlaceVM3OnVLAN21
    -
      - SetVXLANBridgeIPVM1
      - SetVLANBridgeIPVM3
    -
      - PingTestDifferentHost
  SetMulticastRange:
    Multicastiprange:
      '[1]':
        begin: 239.0.0.101
        end: 239.254.254.254
        name: AutoGenerate
    TestNSX: 'vsm.[1]'
    Type: NSX
  SetSegmentIDRange:
    TestNSX: 'vsm.[1]'
    Type: NSX
    segmentidrange:
      '[1]':
        begin: 5001-10001
        end: 99000
        name: AutoGenerate
  SetVLANBridgeIPVM2:
    Testadapter: 'vm.[2].vnic.[1]'
    Type: NetAdapter
    ipv4: dhcp
  SetVLANBridgeIPVM3:
    Testadapter: 'vm.[3].vnic.[1]'
    Type: NetAdapter
    ipv4: dhcp
  SetVLANIPVM1:
    Testadapter: 'vm.[1].vnic.[1]'
    Type: NetAdapter
    ipv4: dhcp
  SetVLANIPVM2:
    Testadapter: 'vm.[2].vnic.[1]'
    Type: NetAdapter
    ipv4: dhcp
  SetVLANIPVM3:
    Testadapter: 'vm.[3].vnic.[1]'
    Type: NetAdapter
    ipv4: dhcp
  SetVXLANBridgeIPVM1:
    Testadapter: 'vm.[1].vnic.[1]'
    Type: NetAdapter
    ipv4: dhcp
  SetVXLANIPVM1:
    Testadapter: 'vm.[1].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.31.1.5
    netmask: 255.255.0.0
  SetVXLANIPVM2:
    Testadapter: 'vm.[2].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.32.1.5
    netmask: 255.255.0.0
  SetVXLANIPVM2SamevWire:
    Testadapter: 'vm.[2].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.31.1.6
    netmask: 255.255.0.0
  SetVXLANIPVM3:
    Testadapter: 'vm.[3].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.32.1.5
    netmask: 255.255.0.0
  SetVXLANIPVM3SamevWire:
    Testadapter: 'vm.[3].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.31.1.15
    netmask: 255.255.0.0
  UnconfigureVXLAN:
    Type: Cluster
    testcluster: 'vsm.[1].vdncluster.[1]'
    vxlan: unconfigure
  Uninstall_VDNCluster:
    TestNSX: 'vsm.[1]'
    Type: NSX
    deletevdncluster: 'vsm.[1].vdncluster.[-1]'
  vMotionVM2ToHost3:
    Iterations: 1
    TestVM: 'vm.[2]'
    Type: VM
    dsthost: 'host.[3]'
    vmotion: oneway
---
Category: NSX
Component: network vDR
Summary: This is a negative test to make sure data traffic does not work across different VDRs
Tags: RunOnCAT
TestName: LIFsOnDifferentVDRs
TestbedSpec:
  host:
    '[1]': {}
    '[2-4]':
      vmnic:
        '[1-2]':
          driver: any
  vc:
    '[1]':
      datacenter:
        '[1]':
          Cluster:
            '[1]':
              host: 'host.[1]'
              name: Controller-Cluster-26724
            '[2]':
              host: 'host.[2-3]'
              name: Compute-Cluster-26724
            '[3]':
              host: 'host.[4]'
              name: Compute-Cluster2-26724
      dvportgroup:
        '[1]':
          name: dvpg-mgmt-26724
          vds: 'vc.[1].vds.[1]'
        '[2]':
          name: dvpg-vlan16-26724
          vds: 'vc.[1].vds.[1]'
          vlan: 16
          vlantype: access
        '[3]':
          name: dvpg-vlan17-26724
          vds: 'vc.[1].vds.[1]'
          vlan: 17
          vlantype: access
        '[4]':
          name: dvpg-vlan21-26724
          vds: 'vc.[1].vds.[1]'
          vlan: 21
          vlantype: access
      vds:
        '[1]':
          configurehosts: add
          datacenter: 'vc.[1].datacenter.[1]'
          host: 'host.[2-4]'
          numuplinkports: 1
          vmnicadapter: 'host.[2-4].vmnic.[1]'
  vm:
    '[1-2]':
      datastoreType: shared
      host: 'host.[2]'
      vmstate: poweroff
    '[3]':
      datastoreType: shared
      host: 'host.[3]'
      vmstate: poweroff
  vsm:
    '[1]':
      VDNCluster:
        '[1]':
          cluster: 'vc.[1].datacenter.[1].cluster.[2]'
          mtu: 1600
          switch: 'vc.[1].vds.[1]'
          teaming: &1
            - LOADBALANCE_SRCMAC
            - LOADBALANCE_SRCID
            - LOADBALANCE_LOADBASED
            - FAILOVER_ORDER
            - ETHER_CHANNEL
          vibs: install
          vlan:
            - 21
          vmkniccount: 1
      assignrole: enterprise_admin
      ippool:
        '[1]':
          gateway: x.x.x.x
          ipranges:
            - a.a.a.a-b.b.b.b
          name: AutoGenerate
          prefixlength: yy
      multicastiprange:
        '[1]':
          begin: 239.1.1.1
          end: 239.1.1.100
          name: AutoGenerate
      reconfigure: true
      segmentidrange:
        '[1]':
          begin: 10000
          end: 19000
          name: AutoGenerate
      vc: 'vc.[1]'
      vxlancontroller:
        '[1]':
          host: 'host.[1]'
          ippool: 'vsm.[1].ippool.[1]'
          name: AutoGenerate
          resourcepool: 'vc.[1].datacenter.[1].cluster.[1]'
        '[2]':
          host: 'host.[1]'
          ippool: 'vsm.[1].ippool.[1]'
          name: AutoGenerate
          resourcepool: 'vc.[1].datacenter.[1].cluster.[1]'
        '[3]':
          host: 'host.[1]'
          ippool: 'vsm.[1].ippool.[1]'
          name: AutoGenerate
          resourcepool: 'vc.[1].datacenter.[1].cluster.[1]'
Version: 2
WORKLOADS:
  AddVLANRouteVM1:
    Testadapter: 'vm.[1].vnic.[1]'
    Type: NetAdapter
    gateway: 172.16.1.1
    netmask: 255.255.0.0
    network: '172.17.0.0,172.31.0.0,172.32.0.0'
    route: add
  AddVLANRouteVM2:
    Testadapter: 'vm.[2].vnic.[1]'
    Type: NetAdapter
    gateway: 172.17.1.1
    netmask: 255.255.0.0
    network: '172.16.0.0,172.31.0.0,172.32.0.0'
    route: add
  AddVLANRouteVM3:
    Testadapter: 'vm.[3].vnic.[1]'
    Type: NetAdapter
    gateway: 172.17.1.1
    netmask: 255.255.0.0
    network: '172.16.0.0,172.31.0.0,172.32.0.0'
    route: add
  AddVXLANRouteVM1:
    Testadapter: 'vm.[1].vnic.[1]'
    Type: NetAdapter
    gateway: 172.31.1.1
    netmask: 255.255.0.0
    network: '172.32.0.0,172.16.0.0,172.17.0.0'
    route: add
  AddVXLANRouteVM2:
    Testadapter: 'vm.[2].vnic.[1]'
    Type: NetAdapter
    gateway: 172.32.1.1
    netmask: 255.255.0.0
    network: '172.31.0.0,172.16.0.0,172.17.0.0'
    route: add
  AddVXLANRouteVM3:
    Testadapter: 'vm.[3].vnic.[1]'
    Type: NetAdapter
    gateway: 172.32.1.1
    netmask: 255.255.0.0
    network: '172.31.0.0,172.16.0.0,172.17.0.0'
    route: add
  AddvNICsOnVMs:
    TestVM: 'vm.[1],vm.[2],vm.[3]'
    Type: VM
    vnic:
      '[1]':
        allowguestcontrol: 1
        connected: 1
        driver: vmxnet3
        portgroup: 'vsm.[1].networkscope.[1].virtualwire.[1]'
        startconnected: 1
  BridgevWire3ToVLAN21:
    TestVM: 'vsm.[1].vse.[5]'
    Type: VM
    bridge:
      '[1]':
        name: bridge-1-26724
        portgroup: 'vc.[1].dvportgroup.[4]'
        virtualwire: 'vsm.[1].networkscope.[1].virtualwire.[3]'
  CreateNetworkScope:
    TestNSX: 'vsm.[1]'
    Type: NSX
    networkscope:
      '[1]':
        clusters: 'vc.[1].datacenter.[1].cluster.[2]'
        name: network-scope-1-26724
  CreateVLANLIF3:
    TestVM: 'vsm.[1].vse.[3]'
    Type: VM
    lif:
      '[1]':
        addressgroup:
          - addresstype: primary
            ipv4address: 172.16.1.1
            netmask: 255.255.0.0
        connected: 1
        name: lif-16-26724
        portgroup: 'vc.[1].dvportgroup.[2]'
        type: internal
  CreateVLANLIF4:
    TestVM: 'vsm.[1].vse.[4]'
    Type: VM
    lif:
      '[1]':
        addressgroup:
          - addresstype: primary
            ipv4address: 172.17.1.1
            netmask: 255.255.0.0
        connected: 1
        name: lif-17-26724
        portgroup: 'vc.[1].dvportgroup.[3]'
        type: internal
  CreateVXLANLIF1:
    TestVM: 'vsm.[1].vse.[1]'
    Type: VM
    lif:
      '[1]':
        addressgroup:
          - addresstype: primary
            ipv4address: 172.31.1.1
            netmask: 255.255.0.0
        connected: 1
        name: lif-vwire1-26724
        portgroup: 'vsm.[1].networkscope.[1].virtualwire.[1]'
        type: internal
  CreateVXLANLIF2:
    TestVM: 'vsm.[1].vse.[2]'
    Type: VM
    lif:
      '[1]':
        addressgroup:
          - addresstype: primary
            ipv4address: 172.32.1.1
            netmask: 255.255.0.0
        connected: 1
        name: lif-vwire2-26724
        portgroup: 'vsm.[1].networkscope.[1].virtualwire.[2]'
        type: internal
  CreateVirtualWires:
    TestTransportZone: 'vsm.[1].networkscope.[1]'
    Type: TransportZone
    VirtualWire:
      '[1]':
        controlplanemode: HYBRID_MODE
        name: AutoGenerate
        tenantid: AutoGenerate
      '[2]':
        controlplanemode: UNICAST_MODE
        name: AutoGenerate
        tenantid: AutoGenerate
      '[3]':
        controlplanemode: MULTICAST_MODE
        name: AutoGenerate
        tenantid: AutoGenerate
      '[4-8]':
        name: AutoGenerate
        tenantid: AutoGenerate
  DeleteController:
    TestNSX: 'vsm.[1]'
    Type: NSX
    deletevxlancontroller: 'vsm.[1].vxlancontroller.[-1]'
  DeleteEdges:
    TestNSX: 'vsm.[1]'
    Type: NSX
    deletevse: 'vsm.[1].vse.[-1]'
  DeleteNetworkScopes:
    TestNSX: 'vsm.[1]'
    Type: NSX
    deletenetworkscope: 'vsm.[1].networkscope.[-1]'
  Delete_All_VirtualWires:
    TestTransportZone: 'vsm.[1].networkscope.[-1]'
    Type: TransportZone
    deletevirtualwire: 'vsm.[1].networkscope.[-1].virtualwire.[-1]'
  DeployEdge:
    TestNSX: 'vsm.[1]'
    Type: NSX
    vse:
      '[1]':
        datacenter: 'vc.[1].datacenter.[1]'
        host: 'host.[2]'
        name: autogenerate
        portgroup: 'vc.[1].dvportgroup.[1]'
        primaryaddress: 10.10.10.18
        resourcepool: 'vc.[1].datacenter.[1].cluster.[2]'
        subnetmask: 255.255.255.0
  DeployEdge2and3:
    TestNSX: 'vsm.[1]'
    Type: NSX
    vse:
      '[2]':
        datacenter: 'vc.[1].datacenter.[1]'
        host: 'host.[2]'
        name: autogenerate
        portgroup: 'vc.[1].dvportgroup.[2]'
        primaryaddress: 10.10.10.20
        resourcepool: 'vc.[1].datacenter.[1].cluster.[2]'
        subnetmask: 255.255.255.0
      '[3]':
        datacenter: 'vc.[1].datacenter.[1]'
        host: 'host.[2]'
        name: autogenerate
        portgroup: 'vc.[1].dvportgroup.[2]'
        primaryaddress: 10.10.10.21
        resourcepool: 'vc.[1].datacenter.[1].cluster.[2]'
        subnetmask: 255.255.255.0
  DeployEdge4and5:
    TestNSX: 'vsm.[1]'
    Type: NSX
    vse:
      '[4]':
        datacenter: 'vc.[1].datacenter.[1]'
        host: 'host.[3]'
        name: autogenerate
        portgroup: 'vc.[1].dvportgroup.[3]'
        primaryaddress: 10.10.10.22
        resourcepool: 'vc.[1].datacenter.[1].cluster.[2]'
        subnetmask: 255.255.255.0
      '[5]':
        datacenter: 'vc.[1].datacenter.[1]'
        host: 'host.[3]'
        name: autogenerate
        portgroup: 'vc.[1].dvportgroup.[3]'
        primaryaddress: 10.10.10.23
        resourcepool: 'vc.[1].datacenter.[1].cluster.[2]'
        subnetmask: 255.255.255.0
  DeployFirstController:
    TestNSX: 'vsm.[1]'
    Type: NSX
    vxlancontroller:
      '[1]':
        firstnodeofcluster: true
        host: 'host.[1]'
        ippool: 'vsm.[1].ippool.[1]'
        name: AutoGenerate
        resourcepool: 'vc.[1].datacenter.[1].cluster.[1]'
  ExitSequence:
    -
      - DeleteEdges
    -
      - RemovevNICFromVM1
      - RemovevNICFromVM2
      - RemovevNICFromVM3
    -
      - Delete_All_VirtualWires
    -
      - DeleteNetworkScopes
  Install_Configure_ClusterSJC:
    TestNSX: 'vsm.[1]'
    Type: NSX
    VDNCluster:
      '[1]':
        cluster: 'vc.[1].datacenter.[1].cluster.[2]'
        mtu: 1600
        switch: 'vc.[1].vds.[1]'
        teaming: *1
        vibs: install
        vlan:
          - 21
        vmkniccount: 1
  MakeSurevNICConnected:
    Type: NetAdapter
    connected: 1
    reconfigure: true
    startconnected: 1
    testadapter: 'vm.[1-2].vnic.[1]'
  MoveHostsToClusterSFO:
    MoveHostsToCluster: 'host.[4],host.[5]'
    TestCluster: 'vc.[1].datacenter.[1].cluster.[3]'
    Type: Cluster
  NetperfTestDifferentHostIgnoreThroughput:
    ExpectedResult: ignore
    NoofOutbound: 1
    SupportAdapter: 'vm.[3].vnic.[1]'
    TestAdapter: 'vm.[1].vnic.[1]'
    TestDuration: 60
    ToolName: Ping
    Type: Traffic
  NetperfTestIgnorethroughput:
    ExpectedResult: ignore
    NoofOutbound: 1
    SupportAdapter: 'vm.[2].vnic.[1]'
    TestAdapter: 'vm.[1].vnic.[1]'
    TestDuration: 60
    ToolName: netperf
    Type: Traffic
  PingTest:
    NoofInbound: 1
    NoofOutbound: 1
    SupportAdapter: 'vm.[2].vnic.[1]'
    TestAdapter: 'vm.[1].vnic.[1]'
    TestDuration: 60
    ToolName: Ping
    Type: Traffic
    maxtimeout: 128000
  PingTestDifferentHost:
    NoofInbound: 1
    NoofOutbound: 1
    SupportAdapter: 'vm.[3].vnic.[1]'
    TestAdapter: 'vm.[1].vnic.[1]'
    TestDuration: 60
    ToolName: Ping
    Type: Traffic
    maxtimeout: 128000
  PingTestDifferentHostNegative:
    ExpectedResult: fail
    NoofInbound: 1
    NoofOutbound: 1
    SupportAdapter: 'vm.[3].vnic.[1]'
    TestAdapter: 'vm.[1].vnic.[1]'
    TestDuration: 60
    ToolName: Ping
    Type: Traffic
    maxtimeout: 128000
  PingTestNegative:
    ExpectedResult: fail
    NoofInbound: 1
    NoofOutbound: 1
    SupportAdapter: 'vm.[2].vnic.[1]'
    TestAdapter: 'vm.[1].vnic.[1]'
    TestDuration: 60
    ToolName: Ping
    Type: Traffic
    maxtimeout: 128000
  PlaceVM1OnVLAN16:
    Type: NetAdapter
    portgroup: 'vc.[1].dvportgroup.[2]'
    reconfigure: true
    testadapter: 'vm.[1].vnic.[1]'
  PlaceVM1OnvWire1:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[1]'
    reconfigure: true
    testadapter: 'vm.[1].vnic.[1]'
  PlaceVM1OnvWire3:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[3]'
    reconfigure: true
    testadapter: 'vm.[1].vnic.[1]'
  PlaceVM2OnVLAN17:
    Type: NetAdapter
    portgroup: 'vc.[1].dvportgroup.[3]'
    reconfigure: true
    testadapter: 'vm.[2].vnic.[1]'
  PlaceVM2OnVLAN21:
    Type: NetAdapter
    portgroup: 'vc.[1].dvportgroup.[4]'
    reconfigure: true
    testadapter: 'vm.[2].vnic.[1]'
  PlaceVM2OnvWire2:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[2]'
    reconfigure: true
    testadapter: 'vm.[2].vnic.[1]'
  PlaceVM3OnVLAN17:
    Type: NetAdapter
    portgroup: 'vc.[1].dvportgroup.[3]'
    reconfigure: true
    testadapter: 'vm.[3].vnic.[1]'
  PlaceVM3OnVLAN21:
    Type: NetAdapter
    portgroup: 'vc.[1].dvportgroup.[4]'
    reconfigure: true
    testadapter: 'vm.[3].vnic.[1]'
  PlaceVM3OnvWire1:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[1]'
    reconfigure: true
    testadapter: 'vm.[3].vnic.[1]'
  PlaceVM3OnvWire2:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[2]'
    reconfigure: true
    testadapter: 'vm.[3].vnic.[1]'
  PlaceVM3OnvWire3:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[3]'
    reconfigure: true
    testadapter: 'vm.[3].vnic.[1]'
  PlaceVMsOnMgmtdvPG:
    Type: NetAdapter
    portgroup: 'vc.[1].dvportgroup.[1]'
    reconfigure: true
    testadapter: 'vm.[1-3].vnic.[1]'
  PoweroffVM1:
    TestVM: 'vm.[1]'
    Type: VM
    vmstate: poweroff
  PoweroffVM2:
    TestVM: 'vm.[2]'
    Type: VM
    vmstate: poweroff
  PoweroffVM3:
    TestVM: 'vm.[3]'
    Type: VM
    vmstate: poweroff
  PoweroffVM4:
    TestVM: 'vm.[4]'
    Type: VM
    vmstate: poweroff
  PoweronVM1:
    TestVM: 'vm.[1]'
    Type: VM
    vmstate: poweron
  PoweronVM2:
    TestVM: 'vm.[2]'
    Type: VM
    vmstate: poweron
  PoweronVM3:
    TestVM: 'vm.[3]'
    Type: VM
    vmstate: poweron
  RebootHost:
    TestHost: 'host.[1]'
    Type: Host
    reboot: yes
  RebootHost2:
    TestHost: 'host.[2]'
    Type: Host
    reboot: yes
  RebootHost3:
    TestHost: 'host.[3]'
    Type: Host
    reboot: yes
  RebootHost4:
    TestHost: 'host.[4]'
    Type: Host
    reboot: yes
  RebootHost5:
    TestHost: 'host.[5]'
    Type: Host
    reboot: yes
  RemovevNICFromVM1:
    TestVM: 'vm.[1]'
    Type: VM
    deletevnic: 'vm.[1].vnic.[1]'
  RemovevNICFromVM2:
    TestVM: 'vm.[2]'
    Type: VM
    deletevnic: 'vm.[2].vnic.[1]'
  RemovevNICFromVM3:
    TestVM: 'vm.[3]'
    Type: VM
    deletevnic: 'vm.[3].vnic.[1]'
  RemovevNICFromVM4:
    TestVM: 'vm.[4]'
    Type: VM
    deletevnic: 'vm.[4].vnic.[1]'
  RemovevNICFromVM5:
    TestVM: 'vm.[5]'
    Type: VM
    deletevnic: 'vm.[5].vnic.[1]'
  RemovevNICFromVM6:
    TestVM: 'vm.[6]'
    Type: VM
    deletevnic: 'vm.[6].vnic.[1]'
  SamevWireNetperfTestDifferentHost:
    MinExpResult: 1
    NoofInbound: 1
    NoofOutbound: 1
    SupportAdapter: 'vm.[3].vnic.[1]'
    TestAdapter: 'vm.[1].vnic.[1]'
    TestDuration: 60
    Type: Traffic
    l3protocol: 'ipv4,ipv6'
    l4protocol: 'tcp,udp'
    maxtimeout: 128000
  Sequence:
    -
      - CreateNetworkScope
    -
      - CreateVirtualWires
    -
      - AddvNICsOnVMs
    -
      - PoweronVM1
      - PoweronVM2
    -
      - MakeSurevNICConnected
    -
      - SetVXLANIPVM1
      - SetVXLANIPVM2SamevWire
    -
      - PingTest
    -
      - DeployEdge
      - DeployEdge2and3
      - DeployEdge4and5
    -
      - CreateVXLANLIF1
      - CreateVXLANLIF2
      - CreateVLANLIF3
      - CreateVLANLIF4
      - BridgevWire3ToVLAN21
    -
      - PlaceVM1OnvWire1
      - PlaceVM2OnvWire2
    -
      - SetVXLANIPVM1
      - SetVXLANIPVM2
    -
      - AddVXLANRouteVM1
      - AddVXLANRouteVM2
    -
      - PingTestNegative
    -
      - PlaceVM1OnVLAN16
      - PlaceVM2OnVLAN17
    -
      - SetVLANIPVM1
      - SetVLANIPVM2
    -
      - AddVLANRouteVM1
      - AddVLANRouteVM2
    -
      - PingTestNegative
    -
      - PlaceVM1OnvWire1
      - PlaceVM2OnVLAN17
    -
      - SetVXLANIPVM1
      - SetVLANIPVM2
    -
      - AddVXLANRouteVM1
      - AddVLANRouteVM2
    -
      - PingTestNegative
    -
      - PlaceVM2OnvWire2
      - PlaceVM1OnVLAN16
    -
      - SetVLANIPVM1
      - SetVXLANIPVM2
    -
      - AddVLANRouteVM1
      - AddVXLANRouteVM2
    -
      - PingTestNegative
    -
      - PlaceVM1OnvWire3
      - PlaceVM2OnVLAN21
    -
      - SetVXLANBridgeIPVM1
      - SetVLANBridgeIPVM2
    -
      - PingTest
    -
      - PoweronVM3
    -
      - PlaceVM1OnvWire1
      - PlaceVM3OnvWire1
    -
      - SetVXLANIPVM1
      - SetVXLANIPVM3SamevWire
    -
      - PingTestDifferentHost
    -
      - PlaceVM1OnvWire1
      - PlaceVM3OnvWire2
    -
      - SetVXLANIPVM1
      - SetVXLANIPVM3
    -
      - AddVXLANRouteVM1
      - AddVXLANRouteVM3
    -
      - PingTestDifferentHostNegative
    -
      - PlaceVM1OnVLAN16
      - PlaceVM3OnVLAN17
    -
      - SetVLANIPVM1
      - SetVLANIPVM3
    -
      - AddVLANRouteVM1
      - AddVLANRouteVM3
    -
      - PingTestDifferentHostNegative
    -
      - PlaceVM1OnvWire1
      - PlaceVM3OnVLAN17
    -
      - SetVXLANIPVM1
      - SetVLANIPVM3
    -
      - AddVXLANRouteVM1
      - AddVLANRouteVM3
    -
      - PingTestDifferentHostNegative
    -
      - PlaceVM3OnvWire2
      - PlaceVM1OnVLAN16
    -
      - SetVLANIPVM1
      - SetVXLANIPVM3
    -
      - AddVLANRouteVM1
      - AddVXLANRouteVM3
    -
      - PingTestDifferentHostNegative
    -
      - PlaceVM1OnvWire3
    -
      - PlaceVM3OnVLAN21
    -
      - SetVXLANBridgeIPVM1
      - SetVLANBridgeIPVM3
    -
      - PingTestDifferentHost
  SetMulticastRange:
    Multicastiprange:
      '[1]':
        begin: 239.0.0.101
        end: 239.254.254.254
        name: AutoGenerate
    TestNSX: 'vsm.[1]'
    Type: NSX
  SetSegmentIDRange:
    TestNSX: 'vsm.[1]'
    Type: NSX
    segmentidrange:
      '[1]':
        begin: 5001-10001
        end: 99000
        name: AutoGenerate
  SetVLANBridgeIPVM2:
    Testadapter: 'vm.[2].vnic.[1]'
    Type: NetAdapter
    ipv4: dhcp
  SetVLANBridgeIPVM3:
    Testadapter: 'vm.[3].vnic.[1]'
    Type: NetAdapter
    ipv4: dhcp
  SetVLANIPVM1:
    Testadapter: 'vm.[1].vnic.[1]'
    Type: NetAdapter
    ipv4: dhcp
  SetVLANIPVM2:
    Testadapter: 'vm.[2].vnic.[1]'
    Type: NetAdapter
    ipv4: dhcp
  SetVLANIPVM3:
    Testadapter: 'vm.[3].vnic.[1]'
    Type: NetAdapter
    ipv4: dhcp
  SetVXLANBridgeIPVM1:
    Testadapter: 'vm.[1].vnic.[1]'
    Type: NetAdapter
    ipv4: dhcp
  SetVXLANIPVM1:
    Testadapter: 'vm.[1].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.31.1.5
    netmask: 255.255.0.0
  SetVXLANIPVM2:
    Testadapter: 'vm.[2].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.32.1.5
    netmask: 255.255.0.0
  SetVXLANIPVM2SamevWire:
    Testadapter: 'vm.[2].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.31.1.6
    netmask: 255.255.0.0
  SetVXLANIPVM3:
    Testadapter: 'vm.[3].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.32.1.5
    netmask: 255.255.0.0
  SetVXLANIPVM3SamevWire:
    Testadapter: 'vm.[3].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.31.1.15
    netmask: 255.255.0.0
  Uninstall_VDNCluster:
    TestNSX: 'vsm.[1]'
    Type: NSX
    deletevdncluster: 'vsm.[1].vdncluster.[-1]'
---
Category: NSX
Component: network vDR
Summary: 'Adding/Removing hosts before/after cluster prep and verifying data traffic '
Tags: RunOnCAT
TestName: AddHostScenarios
TestbedSpec:
  host:
    '[1]': {}
    '[2-5]':
      vmnic:
        '[1-2]':
          driver: any
  vc:
    '[1]':
      datacenter:
        '[1]':
          Cluster:
            '[1]':
              host: 'host.[1]'
              name: Controller-Cluster-26724
            '[2]':
              name: Compute-Cluster-SJC-26724
            '[3]':
              name: Compute-Cluster-SFO-26724
          host: 'host.[2-5]'
      dvportgroup:
        '[10]':
          name: dvpg-SFO-vlan19-26724
          vds: 'vc.[1].vds.[2]'
          vlan: 19
          vlantype: access
        '[11]':
          name: dvpg-SFO-vlan21-26724
          vds: 'vc.[1].vds.[2]'
          vlan: 21
          vlantype: access
        '[12]':
          name: dvpg-SFO-vlan22-26724
          vds: 'vc.[1].vds.[2]'
          vlan: 22
          vlantype: access
        '[1]':
          name: dvpg-SJC-vlan16-26724
          vds: 'vc.[1].vds.[1]'
          vlan: 16
          vlantype: access
        '[2]':
          name: dvpg-SJC-vlan17-26724
          vds: 'vc.[1].vds.[1]'
          vlan: 17
          vlantype: access
        '[3]':
          name: dvpg-SJC-vlan18-26724
          vds: 'vc.[1].vds.[1]'
          vlan: 18
          vlantype: access
        '[4]':
          name: dvpg-SJC-mgmt-26724
          vds: 'vc.[1].vds.[1]'
          vlan: 19
          vlantype: access
        '[5]':
          name: dvpg-SJC-vlan21-26724
          vds: 'vc.[1].vds.[1]'
          vlan: 21
          vlantype: access
        '[6]':
          name: dvpg-SJC-vlan22-26724
          vds: 'vc.[1].vds.[1]'
          vlan: 22
          vlantype: access
        '[7]':
          name: dvpg-SFO-vlan16-26724
          vds: 'vc.[1].vds.[2]'
          vlan: 16
          vlantype: access
        '[8]':
          name: dvpg-SFO-vlan17-26724
          vds: 'vc.[1].vds.[2]'
          vlan: 17
          vlantype: access
        '[9]':
          name: dvpg-SFO-vlan18-26724
          vds: 'vc.[1].vds.[2]'
          vlan: 18
          vlantype: access
      vds:
        '[1]':
          configurehosts: add
          datacenter: 'vc.[1].datacenter.[1]'
          host: 'host.[2-3]'
          name: VDS-1-SJC-26724
          numuplinkports: 1
          vmnicadapter: 'host.[2-3].vmnic.[1]'
        '[2]':
          configurehosts: add
          datacenter: 'vc.[1].datacenter.[1]'
          host: 'host.[4-5]'
          name: VDS-2-SFO-26724
          numuplinkports: 1
          vmnicadapter: 'host.[4-5].vmnic.[1]'
  vm:
    '[1]':
      datastoreType: shared
      host: 'host.[2]'
      vmstate: poweroff
    '[2]':
      datastoreType: shared
      host: 'host.[3]'
      vmstate: poweroff
    '[3]':
      datastoreType: shared
      host: 'host.[4]'
      vmstate: poweroff
    '[4]':
      datastoreType: shared
      host: 'host.[5]'
      vmstate: poweroff
    '[5]':
      datastoreType: shared
      host: 'host.[2]'
      vmstate: poweroff
    '[6]':
      datastoreType: shared
      host: 'host.[3]'
      vmstate: poweroff
  vsm:
    '[1]':
      assignrole: enterprise_admin
      ippool:
        '[1]':
          gateway: x.x.x.x
          ipranges:
            - a.a.a.a-b.b.b.b
          name: AutoGenerate
          prefixlength: yy
      multicastiprange:
        '[1]':
          begin: 239.1.1.1
          end: 239.1.1.100
          name: AutoGenerate
      reconfigure: true
      segmentidrange:
        '[1]':
          begin: 10000
          end: 19000
          name: AutoGenerate
      vc: 'vc.[1]'
      vxlancontroller:
        '[1]':
          host: 'host.[1]'
          ippool: 'vsm.[1].ippool.[1]'
          name: AutoGenerate
          resourcepool: 'vc.[1].datacenter.[1].cluster.[1]'
Version: 2
WORKLOADS:
  AddHost2ToClusterSJC:
    MoveHostsToCluster: 'host.[2]'
    TestCluster: 'vc.[1].datacenter.[1].cluster.[2]'
    Type: Cluster
  AddHost3ToClusterSJC:
    MoveHostsToCluster: 'host.[3]'
    TestCluster: 'vc.[1].datacenter.[1].cluster.[2]'
    Type: Cluster
  AddHost4ToClusterSFO:
    MoveHostsToCluster: 'host.[4]'
    TestCluster: 'vc.[1].datacenter.[1].cluster.[3]'
    Type: Cluster
  AddHost5ToClusterSFO:
    MoveHostsToCluster: 'host.[5]'
    TestCluster: 'vc.[1].datacenter.[1].cluster.[3]'
    Type: Cluster
  AddHost5ToVDSSFO:
    ConfigureUplinks: add
    TestSwitch: 'vc.[1].vds.[2]'
    Type: Switch
    configurehosts: add
    host: 'host.[5]'
    vmnicadapter: 'host.[5].vmnic.[1]'
  AddHosts3ToVDSSJC:
    ConfigureUplinks: add
    TestSwitch: 'vc.[1].vds.[1]'
    Type: Switch
    configurehosts: add
    host: 'host.[3]'
    vmnicadapter: 'host.[3].vmnic.[1]'
  AddHosts4and5ToClusterSFO:
    MoveHostsToCluster: 'host.[4],host.[5]'
    TestCluster: 'vc.[1].datacenter.[1].cluster.[3]'
    Type: Cluster
  AddHosts4and5ToVDSSJC:
    TestSwitch: 'vc.[1].vds.[2]'
    Type: Switch
    configurehosts: add
    host: 'host.[4-5]'
    vmnicadapter: 'host.[4-5].vmnic.[1]'
  AddRouteVM1VWire1:
    Testadapter: 'vm.[1].vnic.[1]'
    Type: NetAdapter
    gateway: 172.31.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM1VWire2:
    Testadapter: 'vm.[1].vnic.[1]'
    Type: NetAdapter
    gateway: 172.32.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM1VWire3:
    Testadapter: 'vm.[1].vnic.[1]'
    Type: NetAdapter
    gateway: 172.33.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM2VWire1:
    Testadapter: 'vm.[2].vnic.[1]'
    Type: NetAdapter
    gateway: 172.31.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM2VWire2:
    Testadapter: 'vm.[2].vnic.[1]'
    Type: NetAdapter
    gateway: 172.32.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM2VWire3:
    Testadapter: 'vm.[2].vnic.[1]'
    Type: NetAdapter
    gateway: 172.33.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM3VWire1:
    Testadapter: 'vm.[3].vnic.[1]'
    Type: NetAdapter
    gateway: 172.31.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM3VWire2:
    Testadapter: 'vm.[3].vnic.[1]'
    Type: NetAdapter
    gateway: 172.32.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM3VWire3:
    Testadapter: 'vm.[3].vnic.[1]'
    Type: NetAdapter
    gateway: 172.33.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM4VWire1:
    Testadapter: 'vm.[4].vnic.[1]'
    Type: NetAdapter
    gateway: 172.31.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM4VWire2:
    Testadapter: 'vm.[4].vnic.[1]'
    Type: NetAdapter
    gateway: 172.32.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM4VWire3:
    Testadapter: 'vm.[4].vnic.[1]'
    Type: NetAdapter
    gateway: 172.33.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM5VWire2:
    Testadapter: 'vm.[5].vnic.[1]'
    Type: NetAdapter
    gateway: 172.32.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM5VWire3:
    Testadapter: 'vm.[5].vnic.[1]'
    Type: NetAdapter
    gateway: 172.33.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM6VWire2:
    Testadapter: 'vm.[6].vnic.[1]'
    Type: NetAdapter
    gateway: 172.32.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM6VWire3:
    Testadapter: 'vm.[6].vnic.[1]'
    Type: NetAdapter
    gateway: 172.33.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddVmotionvmknicsHost2and3:
    TestHost: 'host.[2-3]'
    Type: Host
    vmknic:
      '[1]':
        configurevmotion: enable
        ipv4: dhcp
        portgroup: 'vc.[1].dvportgroup.[1]'
  AddVmotionvmknicsHost4and5:
    TestHost: 'host.[4-5]'
    Type: Host
    vmknic:
      '[1]':
        configurevmotion: enable
        ipv4: dhcp
        portgroup: 'vc.[1].dvportgroup.[6]'
  AddvNICsOn1to4VMs:
    TestVM: 'vm.[5],vm.[6]'
    Type: VM
    vnic:
      '[1]':
        allowguestcontrol: 1
        connected: 1
        driver: vmxnet3
        portgroup: 'vsm.[1].networkscope.[1].virtualwire.[1]'
        startconnected: 1
  AddvNICsOn1to6VMs:
    TestVM: 'vm.[1-6]'
    Type: VM
    vnic:
      '[1]':
        allowguestcontrol: 1
        connected: 1
        driver: vmxnet3
        portgroup: 'vsm.[1].networkscope.[1].virtualwire.[1]'
        startconnected: 1
  ConfigureVXLAN_ClusterSFO:
    TestNSX: 'vsm.[1]'
    Type: NSX
    VDNCluster:
      '[2]':
        cluster: 'vc.[1].datacenter.[1].cluster.[3]'
        mtu: 1600
        switch: 'vc.[1].vds.[2]'
        teaming: FAILOVER_ORDER
        vibs: install
        vlan: 22
        vmkniccount: 1
  ConfigureVXLAN_ClusterSJC:
    TestNSX: 'vsm.[1]'
    Type: NSX
    VDNCluster:
      '[1]':
        cluster: 'vc.[1].datacenter.[1].cluster.[2]'
        mtu: 1600
        switch: 'vc.[1].vds.[1]'
        teaming: FAILOVER_ORDER
        vibs: install
        vlan: '19,21'
        vmkniccount: 1
  CreateNetworkScope:
    TestNSX: 'vsm.[1]'
    Type: NSX
    networkscope:
      '[1]':
        clusters: 'vc.[1].datacenter.[1].cluster.[2]'
        name: network-scope-1-26724
  CreateNetworkScopeClusterSJCandSFO:
    TestNSX: 'vsm.[1]'
    Type: NSX
    networkscope:
      '[1]':
        clusters: 'vc.[1].datacenter.[1].cluster.[2-3]'
        name: network-scope-1-26724
  CreateNetworkScopeClusterSJCandSFOHybridMode:
    TestNSX: 'vsm.[1]'
    Type: NSX
    networkscope:
      '[1]':
        clusters: 'vc.[1].datacenter.[1].cluster.[2-3]'
        controlplanemode: HYBRID_MODE
        name: network-scope-1-26724
  CreateVXLANLIF1OnEdge1:
    TestVM: 'vsm.[1].vse.[1]'
    Type: VM
    lif:
      '[1]':
        addressgroup:
          - addresstype: primary
            ipv4address: 172.31.1.1
            netmask: 255.255.0.0
        connected: 1
        name: lif-vwire1-26724
        portgroup: 'vsm.[1].networkscope.[1].virtualwire.[1]'
        type: internal
  CreateVXLANLIF2OnEdge1:
    TestVM: 'vsm.[1].vse.[1]'
    Type: VM
    lif:
      '[2]':
        addressgroup:
          - addresstype: primary
            ipv4address: 172.32.1.1
            netmask: 255.255.0.0
        connected: 1
        name: lif-vwire2-26724
        portgroup: 'vsm.[1].networkscope.[1].virtualwire.[2]'
        type: internal
  CreateVXLANLIF3OnEdge1:
    TestVM: 'vsm.[1].vse.[1]'
    Type: VM
    lif:
      '[3]':
        addressgroup:
          - addresstype: primary
            ipv4address: 172.33.1.1
            netmask: 255.255.0.0
        connected: 1
        name: lif-vwire3-26724
        portgroup: 'vsm.[1].networkscope.[1].virtualwire.[3]'
        type: internal
  CreateVirtualWires:
    TestTransportZone: 'vsm.[1].networkscope.[1]'
    Type: TransportZone
    VirtualWire:
      '[1]':
        controlplanemode: HYBRID_MODE
        name: AutoGenerate
        tenantid: AutoGenerate
      '[2]':
        controlplanemode: UNICAST_MODE
        name: AutoGenerate
        tenantid: AutoGenerate
      '[3]':
        controlplanemode: MULTICAST_MODE
        name: AutoGenerate
        tenantid: AutoGenerate
      '[4-8]':
        name: AutoGenerate
        tenantid: AutoGenerate
  Delete2ndController:
    TestNSX: 'vsm.[1]'
    Type: NSX
    deletevxlancontroller: 'vsm.[1].vxlancontroller.[2]'
  DeleteAllVmknics:
    TestHost: 'host.[2-5]'
    Type: Host
    deletevmknic: 'host.[2-5].vmknic.[-1]'
  DeleteController:
    TestNSX: 'vsm.[1]'
    Type: NSX
    deletevxlancontroller: 'vsm.[1].vxlancontroller.[-1]'
  DeleteEdges:
    TestNSX: 'vsm.[1]'
    Type: NSX
    deletevse: 'vsm.[1].vse.[-1]'
  DeleteNetworkScope:
    TestNSX: 'vsm.[1]'
    Type: NSX
    deletenetworkscope: 'vsm.[1].networkscope.[-1]'
  DeleteNetworkScopes:
    TestNSX: 'vsm.[1]'
    Type: NSX
    deletenetworkscope: 'vsm.[1].networkscope.[-1]'
  DeleteVirtualWires:
    TestTransportZone: 'vsm.[1].networkscope.[1]'
    Type: TransportZone
    deletevirtualwire: 'vsm.[1].networkscope.[1].virtualwire.[-1]'
  Delete_All_VirtualWires:
    TestTransportZone: 'vsm.[1].networkscope.[-1]'
    Type: TransportZone
    deletevirtualwire: 'vsm.[1].networkscope.[-1].virtualwire.[-1]'
  Deploy2ndController:
    TestNSX: 'vsm.[1]'
    Type: NSX
    vxlancontroller:
      '[2]':
        host: 'host.[1]'
        ippool: 'vsm.[1].ippool.[1]'
        name: AutoGenerate
        resourcepool: 'vc.[1].datacenter.[1].cluster.[1]'
  Deploy3rdController:
    TestNSX: 'vsm.[1]'
    Type: NSX
    vxlancontroller:
      '[3]':
        host: 'host.[1]'
        ippool: 'vsm.[1].ippool.[1]'
        name: AutoGenerate
        resourcepool: 'vc.[1].datacenter.[1].cluster.[1]'
  DeployEdge:
    TestNSX: 'vsm.[1]'
    Type: NSX
    vse:
      '[1]':
        datacenter: 'vc.[1].datacenter.[1]'
        host: 'host.[2]'
        name: Edge-26724
        portgroup: 'vc.[1].dvportgroup.[1]'
        primaryaddress: 10.10.10.16
        resourcepool: 'vc.[1].datacenter.[1].cluster.[2]'
        subnetmask: 255.255.255.0
  DeployEdge1OnHost4:
    TestNSX: 'vsm.[1]'
    Type: NSX
    vse:
      '[1]':
        datacenter: 'vc.[1].datacenter.[1]'
        host: 'host.[4]'
        name: Edge-26724
        portgroup: 'vc.[1].dvportgroup.[7]'
        primaryaddress: 10.10.10.29
        resourcepool: 'vc.[1].datacenter.[1].cluster.[3]'
        subnetmask: 255.255.255.0
  DeployEdge2OnHost2:
    TestNSX: 'vsm.[1]'
    Type: NSX
    vse:
      '[2]':
        datacenter: 'vc.[1].datacenter.[1]'
        host: 'host.[2]'
        name: Edge-26724
        portgroup: 'vc.[1].dvportgroup.[1]'
        primaryaddress: 10.10.10.27
        resourcepool: 'vc.[1].datacenter.[1].cluster.[2]'
        subnetmask: 255.255.255.0
  DeployEdge3OnHost3:
    TestNSX: 'vsm.[1]'
    Type: NSX
    vse:
      '[3]':
        datacenter: 'vc.[1].datacenter.[1]'
        host: 'host.[2]'
        name: Edge-26724
        portgroup: 'vc.[1].dvportgroup.[1]'
        primaryaddress: 10.10.10.28
        resourcepool: 'vc.[1].datacenter.[1].cluster.[2]'
        subnetmask: 255.255.255.0
  DeployFirstController:
    TestNSX: 'vsm.[1]'
    Type: NSX
    vxlancontroller:
      '[1]':
        firstnodeofcluster: true
        host: 'host.[1]'
        ippool: 'vsm.[1].ippool.[1]'
        name: AutoGenerate
        resourcepool: 'vc.[1].datacenter.[1].cluster.[1]'
  ExitSequence:
    -
      - DeleteEdges
    -
      - RemovevNICFromVM1
      - RemovevNICFromVM2
      - RemovevNICFromVM3
      - RemovevNICFromVM4
      - RemovevNICFromVM5
      - RemovevNICFromVM6
    -
      - Delete_All_VirtualWires
    -
      - DeleteNetworkScopes
    -
      - Uninstall_VDNCluster
    -
      - RemoveHosts2and3FromClusterSJC
      - RemoveHosts4and5FromClusterSFO
    -
      - RebootHost2
      - RebootHost3
      - RebootHost4
      - RebootHost5
  InstallVIBs_ClusterSFO:
    TestNSX: 'vsm.[1]'
    Type: NSX
    VDNCluster:
      '[2]':
        cluster: 'vc.[1].datacenter.[1].cluster.[3]'
        vibs: install
  InstallVIBs_ClusterSJC:
    TestNSX: 'vsm.[1]'
    Type: NSX
    VDNCluster:
      '[1]':
        cluster: 'vc.[1].datacenter.[1].cluster.[2]'
        vibs: install
  Install_Configure_ClusterSJC:
    TestNSX: 'vsm.[1]'
    Type: NSX
    VDNCluster:
      '[1]':
        cluster: 'vc.[1].datacenter.[1].cluster.[2]'
        mtu: 1600
        switch: 'vc.[1].vds.[1]'
        teaming:
          - LOADBALANCE_SRCMAC
          - LOADBALANCE_SRCID
          - LOADBALANCE_LOADBASED
          - FAILOVER_ORDER
          - ETHER_CHANNEL
        vibs: install
        vlan:
          - 21
        vmkniccount: 1
  MakeSurevNICConnectedVM1toVM6:
    Type: NetAdapter
    connected: 1
    reconfigure: true
    startconnected: 1
    testadapter: 'vm.[1-6].vnic.[1]'
  NetperfTest2VMsToOther2VMs:
    ExpectedResult: ignore
    L4Protocol: 'tcp,udp'
    LocalSendSocketSize: 131072
    NoofInbound: 1
    NoofOutbound: 1
    ParallelSession: yes
    RemoteSendSocketSize: 131072
    SendMessageSize: '16384,128804'
    SupportAdapter: 'vm.[5-6].vnic.[1]'
    TestAdapter: 'vm.[1-2].vnic.[1]'
    TestDuration: 60
    ToolName: Netperf
    Type: Traffic
    maxtimeout: 128000
  NetperfTest3VMsToOther3VMs:
    ExpectedResult: ignore
    LocalSendSocketSize: 131072
    NoofInbound: 1
    NoofOutbound: 1
    ParallelSession: yes
    RemoteSendSocketSize: 131072
    SendMessageSize: '16384,96684,128804'
    SupportAdapter: 'vm.[4-6].vnic.[1]'
    TestAdapter: 'vm.[1-3].vnic.[1]'
    TestDuration: 60
    ToolName: Netperf
    Type: Traffic
    maxtimeout: 128000
  NetperfTestIgnorethroughput:
    ExpectedResult: ignore
    NoofOutbound: 1
    SupportAdapter: 'vm.[2].vnic.[1]'
    TestAdapter: 'vm.[1].vnic.[1]'
    TestDuration: 60
    ToolName: iperf
    Type: Traffic
  NetperfTestVM1ToAllOthers:
    ExpectedResult: ignore
    NoofInbound: 3
    NoofOutbound: 10
    ParallelSession: yes
    SupportAdapter: 'vm.[2-6].vnic.[1]'
    TestAdapter: 'vm.[1].vnic.[1]'
    TestDuration: 60
    ToolName: 'Netperf,Iperf,Ping'
    Type: Traffic
    maxtimeout: 128000
  PingTest:
    NoofInbound: 1
    NoofOutbound: 1
    SupportAdapter: 'vm.[2].vnic.[1]'
    TestAdapter: 'vm.[1].vnic.[1]'
    TestDuration: 60
    ToolName: Ping
    Type: Traffic
    maxtimeout: 128000
  PingTest2VMsToOther2VMs:
    NoofInbound: 1
    NoofOutbound: 1
    SupportAdapter: 'vm.[5-6].vnic.[1]'
    TestAdapter: 'vm.[1-2].vnic.[1]'
    TestDuration: 60
    ToolName: Ping
    Type: Traffic
    maxtimeout: 128000
  PingTest3VMsToOther3VMs:
    NoofInbound: 1
    NoofOutbound: 1
    SupportAdapter: 'vm.[4-6].vnic.[1]'
    TestAdapter: 'vm.[1-3].vnic.[1]'
    TestDuration: 60
    ToolName: Ping
    Type: Traffic
    maxtimeout: 128000
  PingTestSameCluster1:
    NoofInbound: 1
    NoofOutbound: 1
    SupportAdapter: 'vm.[2].vnic.[1]'
    TestAdapter: 'vm.[1].vnic.[1]'
    TestDuration: 60
    ToolName: Ping
    Type: Traffic
    maxtimeout: 128000
  PingTestSameCluster2:
    NoofInbound: 1
    NoofOutbound: 1
    SupportAdapter: 'vm.[4].vnic.[1]'
    TestAdapter: 'vm.[3].vnic.[1]'
    TestDuration: 60
    ToolName: Ping
    Type: Traffic
    maxtimeout: 128000
  PingTestVM1ToAllOthers:
    NoofInbound: 1
    NoofOutbound: 1
    SupportAdapter: 'vm.[2-6].vnic.[1]'
    TestAdapter: 'vm.[1].vnic.[1]'
    TestDuration: 60
    ToolName: Ping
    Type: Traffic
    maxtimeout: 128000
  PlaceVM1OnvWire1:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[1]'
    reconfigure: true
    testadapter: 'vm.[1].vnic.[1]'
  PlaceVM1OnvWire2:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[2]'
    reconfigure: true
    testadapter: 'vm.[1].vnic.[1]'
  PlaceVM1OnvWire3:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[3]'
    reconfigure: true
    testadapter: 'vm.[1].vnic.[1]'
  PlaceVM1OnvWire4:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[4]'
    reconfigure: true
    testadapter: 'vm.[1].vnic.[1]'
  PlaceVM2OnvWire1:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[1]'
    reconfigure: true
    testadapter: 'vm.[2].vnic.[1]'
  PlaceVM2OnvWire2:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[2]'
    reconfigure: true
    testadapter: 'vm.[2].vnic.[1]'
  PlaceVM2OnvWire3:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[3]'
    reconfigure: true
    testadapter: 'vm.[2].vnic.[1]'
  PlaceVM3OnvWire1:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[1]'
    reconfigure: true
    testadapter: 'vm.[3].vnic.[1]'
  PlaceVM3OnvWire2:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[2]'
    reconfigure: true
    testadapter: 'vm.[3].vnic.[1]'
  PlaceVM3OnvWire3:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[3]'
    reconfigure: true
    testadapter: 'vm.[3].vnic.[1]'
  PlaceVM4OnvWire1:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[1]'
    reconfigure: true
    testadapter: 'vm.[4].vnic.[1]'
  PlaceVM4OnvWire2:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[2]'
    reconfigure: true
    testadapter: 'vm.[4].vnic.[1]'
  PlaceVM4OnvWire3:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[3]'
    reconfigure: true
    testadapter: 'vm.[4].vnic.[1]'
  PlaceVM5OnvWire1:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[1]'
    reconfigure: true
    testadapter: 'vm.[5].vnic.[1]'
  PlaceVM5OnvWire2:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[2]'
    reconfigure: true
    testadapter: 'vm.[5].vnic.[1]'
  PlaceVM5OnvWire3:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[3]'
    reconfigure: true
    testadapter: 'vm.[5].vnic.[1]'
  PlaceVM6OnvWire1:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[1]'
    reconfigure: true
    testadapter: 'vm.[6].vnic.[1]'
  PlaceVM6OnvWire2:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[2]'
    reconfigure: true
    testadapter: 'vm.[6].vnic.[1]'
  PlaceVM6OnvWire3:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[3]'
    reconfigure: true
    testadapter: 'vm.[6].vnic.[1]'
  PoweroffVM1:
    TestVM: 'vm.[1]'
    Type: VM
    vmstate: poweroff
  PoweroffVM2:
    TestVM: 'vm.[2]'
    Type: VM
    vmstate: poweroff
  PoweroffVM3:
    TestVM: 'vm.[3]'
    Type: VM
    vmstate: poweroff
  PoweroffVM4:
    TestVM: 'vm.[4]'
    Type: VM
    vmstate: poweroff
  PoweronVM1:
    TestVM: 'vm.[1]'
    Type: VM
    vmstate: poweron
  PoweronVM2:
    TestVM: 'vm.[2]'
    Type: VM
    vmstate: poweron
  PoweronVM3:
    TestVM: 'vm.[3]'
    Type: VM
    vmstate: poweron
  PoweronVM4:
    TestVM: 'vm.[4]'
    Type: VM
    vmstate: poweron
  PoweronVM5:
    TestVM: 'vm.[5]'
    Type: VM
    vmstate: poweron
  PoweronVM6:
    TestVM: 'vm.[6]'
    Type: VM
    vmstate: poweron
  RebootHost:
    TestHost: 'host.[1]'
    Type: Host
    reboot: yes
  RebootHost2:
    TestHost: 'host.[2]'
    Type: Host
    reboot: yes
  RebootHost3:
    TestHost: 'host.[3]'
    Type: Host
    reboot: yes
  RebootHost4:
    TestHost: 'host.[4]'
    Type: Host
    reboot: yes
  RebootHost5:
    TestHost: 'host.[5]'
    Type: Host
    reboot: yes
  RemoveHost4FromClusterSFO:
    MoveHostsFromCluster: 'host.[4]'
    TestCluster: 'vc.[1].datacenter.[1].cluster.[3]'
    Type: Cluster
  RemoveHost4FromVDSSFO:
    TestSwitch: 'vc.[1].vds.[2]'
    Type: Switch
    configurehosts: remove
    host: 'host.[4]'
  RemoveHost5FromClusterSFO:
    TestCluster: 'vc.[1].datacenter.[1].cluster.[3]'
    Type: Cluster
    movehostsfromcluster: 'host.[5]'
  RemoveHost5FromVDSSFO:
    TestSwitch: 'vc.[1].vds.[2]'
    Type: Switch
    configurehosts: remove
    host: 'host.[5]'
  RemoveHosts2and3FromClusterSJC:
    TestCluster: 'vc.[1].datacenter.[1].cluster.[2]'
    Type: Cluster
    movehostsfromcluster: 'host.[2],host.[3]'
  RemoveHosts3FromVDSSJC:
    TestSwitch: 'vc.[1].vds.[1]'
    Type: Switch
    configurehosts: remove
    host: 'host.[3]'
  RemoveHosts3UpinkFromVDSSJC:
    ConfigureUplinks: remove
    TestSwitch: 'vc.[1].vds.[1]'
    Type: Switch
    vmnicadapter: 'host.[3].vmnic.[1]'
  RemoveHosts4and5FromClusterSFO:
    TestCluster: 'vc.[1].datacenter.[1].cluster.[3]'
    Type: Cluster
    movehostsfromcluster: 'host.[4],host.[5]'
  RemovevNICFromVM1:
    TestVM: 'vm.[1]'
    Type: VM
    deletevnic: 'vm.[1].vnic.[1]'
  RemovevNICFromVM1to6:
    TestVM: 'vm.[1-6]'
    Type: VM
    deletevnic: 'vm.[x].vnic.[1]'
  RemovevNICFromVM2:
    TestVM: 'vm.[2]'
    Type: VM
    deletevnic: 'vm.[2].vnic.[1]'
  RemovevNICFromVM3:
    TestVM: 'vm.[3]'
    Type: VM
    deletevnic: 'vm.[3].vnic.[1]'
  RemovevNICFromVM4:
    TestVM: 'vm.[4]'
    Type: VM
    deletevnic: 'vm.[4].vnic.[1]'
  RemovevNICFromVM5:
    TestVM: 'vm.[5]'
    Type: VM
    deletevnic: 'vm.[5].vnic.[1]'
  RemovevNICFromVM6:
    TestVM: 'vm.[6]'
    Type: VM
    deletevnic: 'vm.[6].vnic.[1]'
  SamevWireNetperfTestDifferentCluster:
    MinExpResult: 1
    NoofInbound: 1
    NoofOutbound: 1
    SupportAdapter: 'vm.[3].vnic.[1]'
    TestAdapter: 'vm.[1].vnic.[1]'
    TestDuration: 60
    Type: Traffic
    l3protocol: 'ipv4,ipv6'
    l4protocol: 'tcp,udp'
    maxtimeout: 128000
  Sequence:
    -
      - AddHost2ToClusterSJC
    -
      - RemoveHosts3FromVDSSJC
    -
      - Install_Configure_ClusterSJC
    -
      - AddHosts3ToVDSSJC
    -
      - AddHost3ToClusterSJC
    -
      - InstallVIBs_ClusterSFO
    -
      - AddHost4ToClusterSFO
    -
      - ConfigureVXLAN_ClusterSFO
    -
      - CreateNetworkScopeClusterSJCandSFO
    -
      - CreateVirtualWires
    -
      - RemoveHost5FromVDSSFO
    -
      - DeployEdge1OnHost4
    -
      - CreateVXLANLIF1OnEdge1
    -
      - CreateVXLANLIF2OnEdge1
    -
      - CreateVXLANLIF3OnEdge1
    -
      - AddHost5ToVDSSFO
    -
      - AddHost5ToClusterSFO
    -
      - AddvNICsOn1to6VMs
    -
      - PoweronVM1
      - PoweronVM2
      - PoweronVM3
    -
      - PoweronVM4
      - PoweronVM5
      - PoweronVM6
    -
      - MakeSurevNICConnectedVM1toVM6
    -
      - PingTestVM1ToAllOthers
      - PingTest3VMsToOther3VMs
    -
      - PlaceVM1OnvWire1
      - PlaceVM2OnvWire1
      - PlaceVM3OnvWire2
      - PlaceVM4OnvWire2
      - PlaceVM5OnvWire3
      - PlaceVM6OnvWire3
    -
      - SetIPVM1VWire1
      - SetIPVM2VWire1
      - SetIPVM3VWire2
      - SetIPVM4VWire2
      - SetIPVM5VWire3
      - SetIPVM6VWire3
    -
      - AddRouteVM1VWire1
      - AddRouteVM2VWire1
      - AddRouteVM3VWire2
      - AddRouteVM4VWire2
      - AddRouteVM5VWire3
      - AddRouteVM6VWire3
    -
      - PingTestVM1ToAllOthers
    -
      - PingTest3VMsToOther3VMs
    -
      - RemovevNICFromVM1to6
    -
      - DeleteEdges
    -
      - DeleteVirtualWires
    -
      - DeleteNetworkScope
    -
      - UnconfigureVXLAN
    -
      - Uninstall_Unconfigure_All_Cluster
    -
      - RebootHost2
      - RebootHost3
      - RebootHost4
      - RebootHost5
    -
      - RemoveHosts3FromVDSSJC
    -
      - RemoveHost5FromVDSSFO
    -
      - AddHosts3ToVDSSJC
    -
      - AddHost5ToVDSSFO
    -
      - RemoveHost5FromClusterSFO
    -
      - Install_Configure_ClusterSJC
    -
      - InstallVIBs_ClusterSFO
    -
      - ConfigureVXLAN_ClusterSFO
    -
      - CreateNetworkScopeClusterSJCandSFO
    -
      - CreateVirtualWires
    -
      - DeployEdge1OnHost4
    -
      - AddHost5ToClusterSFO
    -
      - CreateVXLANLIF1OnEdge1
    -
      - CreateVXLANLIF2OnEdge1
    -
      - CreateVXLANLIF3OnEdge1
    -
      - PoweronVM1
      - PoweronVM2
      - PoweronVM3
    -
      - PoweronVM4
      - PoweronVM5
      - PoweronVM6
    -
      - AddvNICsOn1to6VMs
    -
      - MakeSurevNICConnectedVM1toVM6
    -
      - PlaceVM1OnvWire1
      - PlaceVM2OnvWire1
      - PlaceVM3OnvWire2
      - PlaceVM4OnvWire2
      - PlaceVM5OnvWire3
      - PlaceVM6OnvWire3
    -
      - SetIPVM1VWire1
      - SetIPVM2VWire1
      - SetIPVM3VWire2
      - SetIPVM4VWire2
      - SetIPVM5VWire3
      - SetIPVM6VWire3
    -
      - AddRouteVM1VWire1
      - AddRouteVM2VWire1
      - AddRouteVM3VWire2
      - AddRouteVM4VWire2
      - AddRouteVM5VWire3
      - AddRouteVM6VWire3
    -
      - PingTestVM1ToAllOthers
    -
      - PingTest3VMsToOther3VMs
  SetIPVM1VWire1:
    Testadapter: 'vm.[1].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.31.1.15
    netmask: 255.255.0.0
  SetIPVM1VWire2:
    Testadapter: 'vm.[1].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.32.1.15
    netmask: 255.255.0.0
  SetIPVM1VWire3:
    Testadapter: 'vm.[1].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.33.1.15
    netmask: 255.255.0.0
  SetIPVM2VWire1:
    Testadapter: 'vm.[2].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.31.1.25
    netmask: 255.255.0.0
  SetIPVM2VWire2:
    Testadapter: 'vm.[2].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.32.1.25
    netmask: 255.255.0.0
  SetIPVM2VWire3:
    Testadapter: 'vm.[2].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.33.1.25
    netmask: 255.255.0.0
  SetIPVM3VWire1:
    Testadapter: 'vm.[3].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.31.1.35
    netmask: 255.255.0.0
  SetIPVM3VWire2:
    Testadapter: 'vm.[3].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.32.1.35
    netmask: 255.255.0.0
  SetIPVM3VWire3:
    Testadapter: 'vm.[3].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.33.1.35
    netmask: 255.255.0.0
  SetIPVM4VWire1:
    Testadapter: 'vm.[4].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.31.1.45
    netmask: 255.255.0.0
  SetIPVM4VWire2:
    Testadapter: 'vm.[4].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.32.1.45
    netmask: 255.255.0.0
  SetIPVM4VWire3:
    Testadapter: 'vm.[4].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.33.1.45
    netmask: 255.255.0.0
  SetIPVM5VWire1:
    Testadapter: 'vm.[5].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.31.1.55
    netmask: 255.255.0.0
  SetIPVM5VWire2:
    Testadapter: 'vm.[5].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.32.1.55
    netmask: 255.255.0.0
  SetIPVM5VWire3:
    Testadapter: 'vm.[5].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.33.1.55
    netmask: 255.255.0.0
  SetIPVM6VWire1:
    Testadapter: 'vm.[6].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.31.1.65
    netmask: 255.255.0.0
  SetIPVM6VWire2:
    Testadapter: 'vm.[6].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.32.1.65
    netmask: 255.255.0.0
  SetIPVM6VWire3:
    Testadapter: 'vm.[6].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.33.1.65
    netmask: 255.255.0.0
  SetMulticastRange:
    Multicastiprange:
      '[1]':
        begin: 239.0.0.101
        end: 239.254.254.254
        name: AutoGenerate
    TestNSX: 'vsm.[1]'
    Type: NSX
  SetSegmentIDRange:
    TestNSX: 'vsm.[1]'
    Type: NSX
    segmentidrange:
      '[1]':
        begin: 5001-10001
        end: 99000
        name: AutoGenerate
  UnconfigureVXLAN:
    Type: Cluster
    testcluster: 'vsm.[1].vdncluster.[-1]'
    vxlan: unconfigure
  Uninstall_Unconfigure_All_Cluster: &1
    TestNSX: 'vsm.[1]'
    Type: NSX
    deletevdncluster: 'vsm.[1].vdncluster.[-1]'
  Uninstall_VDNCluster: *1
  UpdatevWires1and4ToHybridMode:
    TestSwitch: 'vsm.[1].networkscope.[1].virtualwire.[1],vsm.[1].networkscope.[1].virtualwire.[4]'
    Type: Switch
    controlplanemode: HYBRID_MODE
    name: vWire-Updated-Hybrid
    updatelogicalswitch: true
  UpdatevWires2and5ToMulticastMode:
    TestSwitch: 'vsm.[1].networkscope.[1].virtualwire.[2],vsm.[1].networkscope.[1].virtualwire.[5]'
    Type: Switch
    controlplanemode: MULTICAST_MODE
    name: vWire-Updated-Multicast
    updatelogicalswitch: true
  UpdatevWires3and6ToUnicastMode:
    TestSwitch: 'vsm.[1].networkscope.[1].virtualwire.[3],vsm.[1].networkscope.[1].virtualwire.[6]'
    Type: Switch
    controlplanemode: UNICAST_MODE
    name: vWire-Updated-Unicast
    updatelogicalswitch: true
  UpdatevWiresToHybridMode:
    TestSwitch: 'vsm.[1].networkscope.[1].virtualwire.[1-5]'
    Type: Switch
    controlplanemode: HYBRID_MODE
    name: vWire-Updated-Hybrid
    updatelogicalswitch: true
  UpdatevWiresToMulticastMode:
    TestSwitch: 'vsm.[1].networkscope.[1].virtualwire.[1-5]'
    Type: Switch
    controlplanemode: MULTICAST_MODE
    name: vWire-Updated-Multicast
    updatelogicalswitch: true
  UpdatevWiresToUnicastMode:
    TestSwitch: 'vsm.[1].networkscope.[1].virtualwire.[1-5]'
    Type: Switch
    controlplanemode: UNICAST_MODE
    name: vWire-Updated-Unicast
    updatelogicalswitch: true
  vMotionVM2ToHost3:
    Iterations: 1
    TestVM: 'vm.[3]'
    Type: VM
    dsthost: 'host.[2]'
    vmotion: oneway
---
Category: NSX
Component: network vDR
Summary: Verify VLAN routing and bridging scenarios with 4 hosts (1 vds) in same cluster
Tags: RunOnCAT
TestName: 4HostsVLANandBridingScenarios
TestbedSpec:
  host:
    '[1]': {}
    '[2-5]':
      vmnic:
        '[1-2]':
          driver: any
  vc:
    '[1]':
      datacenter:
        '[1]':
          Cluster:
            '[1]':
              host: 'host.[1]'
              name: Controller-Cluster-26724
            '[2]':
              name: Compute-Cluster-SJC-26724
            '[3]':
              name: Compute-Cluster-SFO-26724
          host: 'host.[2-5]'
      dvportgroup:
        '[10]':
          name: dvpg-SFO-vlan19-26724
          vds: 'vc.[1].vds.[2]'
          vlan: 19
          vlantype: access
        '[11]':
          name: dvpg-SFO-vlan21-26724
          vds: 'vc.[1].vds.[2]'
          vlan: 21
          vlantype: access
        '[12]':
          name: dvpg-SFO-vlan22-26724
          vds: 'vc.[1].vds.[2]'
          vlan: 22
          vlantype: access
        '[1]':
          name: dvpg-SJC-vlan16-26724
          vds: 'vc.[1].vds.[1]'
          vlan: 16
          vlantype: access
        '[2]':
          name: dvpg-SJC-vlan17-26724
          vds: 'vc.[1].vds.[1]'
          vlan: 17
          vlantype: access
        '[3]':
          name: dvpg-SJC-vlan18-26724
          vds: 'vc.[1].vds.[1]'
          vlan: 18
          vlantype: access
        '[4]':
          name: dvpg-SJC-mgmt-26724
          vds: 'vc.[1].vds.[1]'
          vlan: 19
          vlantype: access
        '[5]':
          name: dvpg-SJC-vlan21-26724
          vds: 'vc.[1].vds.[1]'
          vlan: 21
          vlantype: access
        '[6]':
          name: dvpg-SJC-vlan22-26724
          vds: 'vc.[1].vds.[1]'
          vlan: 22
          vlantype: access
        '[7]':
          name: dvpg-SFO-vlan16-26724
          vds: 'vc.[1].vds.[2]'
          vlan: 16
          vlantype: access
        '[8]':
          name: dvpg-SFO-vlan17-26724
          vds: 'vc.[1].vds.[2]'
          vlan: 17
          vlantype: access
        '[9]':
          name: dvpg-SFO-vlan18-26724
          vds: 'vc.[1].vds.[2]'
          vlan: 18
          vlantype: access
      vds:
        '[1]':
          configurehosts: add
          datacenter: 'vc.[1].datacenter.[1]'
          host: 'host.[2-3]'
          name: VDS-1-SJC-26724
          numuplinkports: 1
          vmnicadapter: 'host.[2-3].vmnic.[1]'
        '[2]':
          configurehosts: add
          datacenter: 'vc.[1].datacenter.[1]'
          host: 'host.[4-5]'
          name: VDS-2-SFO-26724
          numuplinkports: 1
          vmnicadapter: 'host.[4-5].vmnic.[1]'
  vm:
    '[1]':
      datastoreType: shared
      host: 'host.[2]'
      vmstate: poweroff
    '[2]':
      datastoreType: shared
      host: 'host.[3]'
      vmstate: poweroff
    '[3]':
      datastoreType: shared
      host: 'host.[4]'
      vmstate: poweroff
    '[4]':
      datastoreType: shared
      host: 'host.[5]'
      vmstate: poweroff
    '[5]':
      datastoreType: shared
      host: 'host.[2]'
      vmstate: poweroff
    '[6]':
      datastoreType: shared
      host: 'host.[3]'
      vmstate: poweroff
  vsm:
    '[1]':
      assignrole: enterprise_admin
      ippool:
        '[1]':
          gateway: x.x.x.x
          ipranges:
            - a.a.a.a-b.b.b.b
          name: AutoGenerate
          prefixlength: yy
      multicastiprange:
        '[1]':
          begin: 239.1.1.1
          end: 239.1.1.100
          name: AutoGenerate
      reconfigure: true
      segmentidrange:
        '[1]':
          begin: 10000
          end: 19000
          name: AutoGenerate
      vc: 'vc.[1]'
      vxlancontroller:
        '[1]':
          host: 'host.[1]'
          ippool: 'vsm.[1].ippool.[1]'
          name: AutoGenerate
          resourcepool: 'vc.[1].datacenter.[1].cluster.[1]'
Version: 2
WORKLOADS:
  AddHosts2and3ToClusterSJC:
    MoveHostsToCluster: 'host.[2],host.[3]'
    TestCluster: 'vc.[1].datacenter.[1].cluster.[2]'
    Type: Cluster
  AddHosts4and5ToClusterSJC:
    MoveHostsToCluster: 'host.[4],host.[5]'
    TestCluster: 'vc.[1].datacenter.[1].cluster.[2]'
    Type: Cluster
  AddHosts4and5ToVDSSFO:
    TestSwitch: 'vc.[1].vds.[2]'
    Type: Switch
    configurehosts: add
    host: 'host.[4-5]'
  AddHosts4and5ToVDSSJC:
    TestSwitch: 'vc.[1].vds.[1]'
    Type: Switch
    configurehosts: add
    configureuplinks: add
    host: 'host.[4-5]'
    vmnicadapter: 'host.[4-5].vmnic.[1]'
  AddRouteVM1VLAN16:
    Testadapter: 'vm.[1].vnic.[1]'
    Type: NetAdapter
    gateway: 172.16.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM1VLAN17:
    Testadapter: 'vm.[1].vnic.[1]'
    Type: NetAdapter
    gateway: 172.17.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM1VLAN18:
    Testadapter: 'vm.[1].vnic.[1]'
    Type: NetAdapter
    gateway: 172.18.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM1VWire1:
    Testadapter: 'vm.[1].vnic.[1]'
    Type: NetAdapter
    gateway: 172.31.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM1VWire2:
    Testadapter: 'vm.[1].vnic.[1]'
    Type: NetAdapter
    gateway: 172.32.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM1VWire3:
    Testadapter: 'vm.[1].vnic.[1]'
    Type: NetAdapter
    gateway: 172.33.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM2VLAN16:
    Testadapter: 'vm.[2].vnic.[1]'
    Type: NetAdapter
    gateway: 172.16.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM2VLAN17:
    Testadapter: 'vm.[2].vnic.[1]'
    Type: NetAdapter
    gateway: 172.17.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM2VLAN18:
    Testadapter: 'vm.[2].vnic.[1]'
    Type: NetAdapter
    gateway: 172.18.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM2VWire1:
    Testadapter: 'vm.[2].vnic.[1]'
    Type: NetAdapter
    gateway: 172.31.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM2VWire2:
    Testadapter: 'vm.[2].vnic.[1]'
    Type: NetAdapter
    gateway: 172.32.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM2VWire3:
    Testadapter: 'vm.[2].vnic.[1]'
    Type: NetAdapter
    gateway: 172.33.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM3VLAN16:
    Testadapter: 'vm.[3].vnic.[1]'
    Type: NetAdapter
    gateway: 172.16.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM3VLAN17:
    Testadapter: 'vm.[3].vnic.[1]'
    Type: NetAdapter
    gateway: 172.17.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM3VLAN18:
    Testadapter: 'vm.[3].vnic.[1]'
    Type: NetAdapter
    gateway: 172.18.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM3VWire1:
    Testadapter: 'vm.[3].vnic.[1]'
    Type: NetAdapter
    gateway: 172.31.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM3VWire2:
    Testadapter: 'vm.[3].vnic.[1]'
    Type: NetAdapter
    gateway: 172.32.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM3VWire3:
    Testadapter: 'vm.[3].vnic.[1]'
    Type: NetAdapter
    gateway: 172.33.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM4VLAN16:
    Testadapter: 'vm.[4].vnic.[1]'
    Type: NetAdapter
    gateway: 172.16.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM4VLAN17:
    Testadapter: 'vm.[4].vnic.[1]'
    Type: NetAdapter
    gateway: 172.17.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM4VLAN18:
    Testadapter: 'vm.[4].vnic.[1]'
    Type: NetAdapter
    gateway: 172.18.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM4VWire1:
    Testadapter: 'vm.[4].vnic.[1]'
    Type: NetAdapter
    gateway: 172.31.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM4VWire2:
    Testadapter: 'vm.[4].vnic.[1]'
    Type: NetAdapter
    gateway: 172.32.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM4VWire3:
    Testadapter: 'vm.[4].vnic.[1]'
    Type: NetAdapter
    gateway: 172.33.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM5VLAN17:
    Testadapter: 'vm.[5].vnic.[1]'
    Type: NetAdapter
    gateway: 172.17.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM5VLAN18:
    Testadapter: 'vm.[5].vnic.[1]'
    Type: NetAdapter
    gateway: 172.18.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM5VWire2:
    Testadapter: 'vm.[5].vnic.[1]'
    Type: NetAdapter
    gateway: 172.32.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM5VWire3:
    Testadapter: 'vm.[5].vnic.[1]'
    Type: NetAdapter
    gateway: 172.33.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM6VLAN17:
    Testadapter: 'vm.[6].vnic.[1]'
    Type: NetAdapter
    gateway: 172.17.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM6VLAN18:
    Testadapter: 'vm.[6].vnic.[1]'
    Type: NetAdapter
    gateway: 172.18.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM6VWire2:
    Testadapter: 'vm.[6].vnic.[1]'
    Type: NetAdapter
    gateway: 172.32.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM6VWire3:
    Testadapter: 'vm.[6].vnic.[1]'
    Type: NetAdapter
    gateway: 172.33.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddVmotionvmknicsHost2and3:
    TestHost: 'host.[2-3]'
    Type: Host
    vmknic:
      '[1]':
        configurevmotion: enable
        ipv4: dhcp
        portgroup: 'vc.[1].dvportgroup.[1]'
  AddVmotionvmknicsHost4and5:
    TestHost: 'host.[4-5]'
    Type: Host
    vmknic:
      '[1]':
        configurevmotion: enable
        ipv4: dhcp
        portgroup: 'vc.[1].dvportgroup.[6]'
  AddvNICsOn1to6VMs:
    TestVM: 'vm.[1-6]'
    Type: VM
    vnic:
      '[1]':
        allowguestcontrol: 1
        connected: 1
        driver: vmxnet3
        portgroup: 'vsm.[1].networkscope.[1].virtualwire.[1]'
        startconnected: 1
  AddvNICsOn1to6VMsOnVlanPortGroup:
    TestVM: 'vm.[1-6]'
    Type: VM
    vnic:
      '[1]':
        allowguestcontrol: 1
        connected: 1
        driver: vmxnet3
        portgroup: 'vc.[1].dvportgroup.[1]'
        startconnected: 1
  ConfigureVXLAN_ClusterSJC:
    TestNSX: 'vsm.[1]'
    Type: NSX
    VDNCluster:
      '[1]':
        cluster: 'vc.[1].datacenter.[1].cluster.[2]'
        mtu: 1600
        switch: 'vc.[1].vds.[1]'
        teaming:
          - LOADBALANCE_SRCMAC
          - LOADBALANCE_SRCID
          - LOADBALANCE_LOADBASED
          - FAILOVER_ORDER
          - ETHER_CHANNEL
        vibs: install
        vlan:
          - 21
        vmkniccount: 1
  CreateBridges:
    TestVM: 'vsm.[1].vse.[1]'
    Type: VM
    bridge:
      '[1]':
        name: bridge-1-26724
        portgroup: 'vc.[1].dvportgroup.[5]'
        virtualwire: 'vsm.[1].networkscope.[1].virtualwire.[4]'
      '[2]':
        name: bridge-2-26724
        portgroup: 'vc.[1].dvportgroup.[6]'
        virtualwire: 'vsm.[1].networkscope.[1].virtualwire.[5]'
  CreateNetworkScope:
    TestNSX: 'vsm.[1]'
    Type: NSX
    networkscope:
      '[1]':
        clusters: 'vc.[1].datacenter.[1].cluster.[2]'
        name: network-scope-1-26724
  CreateVLANLIF1:
    TestVM: 'vsm.[1].vse.[1]'
    Type: VM
    lif:
      '[1]':
        addressgroup:
          - addresstype: primary
            ipv4address: 172.16.1.1
            netmask: 255.255.0.0
        connected: 1
        name: lif-vlan1-26724
        portgroup: 'vc.[1].dvportgroup.[1]'
        type: internal
  CreateVLANLIF2:
    TestVM: 'vsm.[1].vse.[1]'
    Type: VM
    lif:
      '[2]':
        addressgroup:
          - addresstype: primary
            ipv4address: 172.17.1.1
            netmask: 255.255.0.0
        connected: 1
        name: lif-vlan2-26724
        portgroup: 'vc.[1].dvportgroup.[2]'
        type: internal
  CreateVLANLIF3:
    TestVM: 'vsm.[1].vse.[1]'
    Type: VM
    lif:
      '[3]':
        addressgroup:
          - addresstype: primary
            ipv4address: 172.18.1.1
            netmask: 255.255.0.0
        connected: 1
        name: lif-vlan3-26724
        portgroup: 'vc.[1].dvportgroup.[3]'
        type: internal
  CreateVirtualWires:
    TestTransportZone: 'vsm.[1].networkscope.[1]'
    Type: TransportZone
    VirtualWire:
      '[1]':
        controlplanemode: HYBRID_MODE
        name: AutoGenerate
        tenantid: AutoGenerate
      '[2]':
        controlplanemode: UNICAST_MODE
        name: AutoGenerate
        tenantid: AutoGenerate
      '[3]':
        controlplanemode: MULTICAST_MODE
        name: AutoGenerate
        tenantid: AutoGenerate
      '[4-8]':
        name: AutoGenerate
        tenantid: AutoGenerate
  DeleteAllVmknics:
    TestHost: 'host.[2-5]'
    Type: Host
    deletevmknic: 'host.[2-5].vmknic.[-1]'
  DeleteController:
    TestNSX: 'vsm.[1]'
    Type: NSX
    deletevxlancontroller: 'vsm.[1].vxlancontroller.[-1]'
  DeleteEdges:
    TestNSX: 'vsm.[1]'
    Type: NSX
    deletevse: 'vsm.[1].vse.[-1]'
  DeleteNetworkScope:
    TestNSX: 'vsm.[1]'
    Type: NSX
    deletenetworkscope: 'vsm.[1].networkscope.[-1]'
  DeleteVirtualWires:
    TestTransportZone: 'vsm.[1].networkscope.[-1]'
    Type: TransportZone
    deletevirtualwire: 'vsm.[1].networkscope.[-1].virtualwire.[-1]'
  Deploy2ndController:
    TestNSX: 'vsm.[1]'
    Type: NSX
    vxlancontroller:
      '[2]':
        host: 'host.[1]'
        ippool: 'vsm.[1].ippool.[1]'
        name: AutoGenerate
        resourcepool: 'vc.[1].datacenter.[1].cluster.[1]'
  Deploy3rdController:
    TestNSX: 'vsm.[1]'
    Type: NSX
    vxlancontroller:
      '[3]':
        host: 'host.[1]'
        ippool: 'vsm.[1].ippool.[1]'
        name: AutoGenerate
        resourcepool: 'vc.[1].datacenter.[1].cluster.[1]'
  DeployEdgeOnHost4:
    TestNSX: 'vsm.[1]'
    Type: NSX
    vse:
      '[1]':
        datacenter: 'vc.[1].datacenter.[1]'
        host: 'host.[4]'
        name: Edge-26724
        portgroup: 'vc.[1].dvportgroup.[1]'
        primaryaddress: 10.10.10.34
        resourcepool: 'vc.[1].datacenter.[1].cluster.[2]'
        subnetmask: 255.255.255.0
  DeployFirstController:
    TestNSX: 'vsm.[1]'
    Type: NSX
    vxlancontroller:
      '[1]':
        firstnodeofcluster: true
        host: 'host.[1]'
        ippool: 'vsm.[1].ippool.[1]'
        name: AutoGenerate
        resourcepool: 'vc.[1].datacenter.[1].cluster.[1]'
  EnableHAandDRSOnClusterSJCandSFO:
    DRS: 1
    EditCluster: edit
    HA: 1
    TestCluster: 'vc.[1].datacenter.[1].cluster.[2-3]'
    Type: Cluster
  ExitSequence:
    -
      - DeleteEdges
    -
      - RemovevNICFromVM1
      - RemovevNICFromVM2
      - RemovevNICFromVM3
      - RemovevNICFromVM4
      - RemovevNICFromVM5
      - RemovevNICFromVM6
    -
      - DeleteVirtualWires
    -
      - DeleteNetworkScope
    -
      - Uninstall_VDNCluster
    -
      - RemoveHosts4and5FromClusterSJC
      - RemoveHosts2and3FromClusterSJC
    -
      - RebootHost2
      - RebootHost3
      - RebootHost4
      - RebootHost5
    -
      - RemoveHosts4and5FromVDSSJC
    -
      - AddHosts4and5ToVDSSFO
  InstallVIBs_ClusterSJC:
    TestNSX: 'vsm.[1]'
    Type: NSX
    VDNCluster:
      '[2]':
        cluster: 'vc.[1].datacenter.[1].cluster.[2]'
        vibs: install
  MakeSurevNICConnectedVM1toVM6:
    Type: NetAdapter
    connected: 1
    reconfigure: true
    startconnected: 1
    testadapter: 'vm.[1-6].vnic.[1]'
  MoveHostsToClusterSFO:
    MoveHostsToCluster: 'host.[4],host.[5]'
    TestCluster: 'vc.[1].datacenter.[1].cluster.[3]'
    Type: Cluster
  MoveHostsToClusterSJC:
    MoveHostsToCluster: 'host.[2],host.[3]'
    TestCluster: 'vc.[1].datacenter.[1].cluster.[2]'
    Type: Cluster
  NetperfTest2VMsToOther2VMs:
    ExpectedResult: ignore
    L4Protocol: 'tcp,udp'
    LocalSendSocketSize: 131072
    NoofInbound: 1
    NoofOutbound: 1
    ParallelSession: yes
    RemoteSendSocketSize: 131072
    SendMessageSize: '16384,128804'
    SupportAdapter: 'vm.[5-6].vnic.[1]'
    TestAdapter: 'vm.[1-2].vnic.[1]'
    TestDuration: 60
    ToolName: Netperf
    Type: Traffic
    maxtimeout: 128000
  NetperfTest3VMsToOther3VMs:
    ExpectedResult: ignore
    LocalSendSocketSize: 131072
    NoofInbound: 1
    NoofOutbound: 1
    ParallelSession: yes
    RemoteSendSocketSize: 131072
    SendMessageSize: '16384,96684,128804'
    SupportAdapter: 'vm.[4-6].vnic.[1]'
    TestAdapter: 'vm.[1-3].vnic.[1]'
    TestDuration: 60
    ToolName: Netperf
    Type: Traffic
    maxtimeout: 128000
  NetperfTestIgnorethroughput:
    ExpectedResult: ignore
    NoofOutbound: 1
    SupportAdapter: 'vm.[2].vnic.[1]'
    TestAdapter: 'vm.[1].vnic.[1]'
    TestDuration: 60
    ToolName: iperf
    Type: Traffic
  NetperfTestVM1ToAllOthers:
    ExpectedResult: ignore
    NoofInbound: 1
    NoofOutbound: 10
    ParallelSession: yes
    SupportAdapter: 'vm.[2-6].vnic.[1]'
    TestAdapter: 'vm.[1].vnic.[1]'
    TestDuration: 60
    ToolName: 'Netperf,Iperf,Ping'
    Type: Traffic
    maxtimeout: 128000
  PingTest2VMsToOther2VMs:
    NoofInbound: 1
    NoofOutbound: 1
    SupportAdapter: 'vm.[5-6].vnic.[1]'
    TestAdapter: 'vm.[1-2].vnic.[1]'
    TestDuration: 60
    ToolName: Ping
    Type: Traffic
    maxtimeout: 128000
  PingTest3VMsToOther3VMs:
    NoofOutbound: 1
    SupportAdapter: 'vm.[4-6].vnic.[1]'
    TestAdapter: 'vm.[1-3].vnic.[1]'
    TestDuration: 60
    ToolName: Ping
    Type: Traffic
    maxtimeout: 128000
  PingTestSameCluster1:
    NoofInbound: 1
    NoofOutbound: 1
    SupportAdapter: 'vm.[2].vnic.[1]'
    TestAdapter: 'vm.[1].vnic.[1]'
    TestDuration: 60
    ToolName: Ping
    Type: Traffic
    maxtimeout: 128000
  PingTestSameCluster2:
    NoofInbound: 1
    NoofOutbound: 1
    SupportAdapter: 'vm.[4].vnic.[1]'
    TestAdapter: 'vm.[3].vnic.[1]'
    TestDuration: 60
    ToolName: Ping
    Type: Traffic
    maxtimeout: 128000
  PingTestVM1ToAllOthers:
    NoofOutbound: 1
    SupportAdapter: 'vm.[2-6].vnic.[1]'
    TestAdapter: 'vm.[1].vnic.[1]'
    TestDuration: 60
    ToolName: Ping
    Type: Traffic
    maxtimeout: 128000
  PlaceVM1OnVLAN16_VDS1:
    Type: NetAdapter
    portgroup: 'vc.[1].dvportgroup.[1]'
    reconfigure: true
    testadapter: 'vm.[1].vnic.[1]'
  PlaceVM1OnvWire1:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[1]'
    reconfigure: true
    testadapter: 'vm.[1].vnic.[1]'
  PlaceVM1OnvWire2:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[2]'
    reconfigure: true
    testadapter: 'vm.[1].vnic.[1]'
  PlaceVM1OnvWire3:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[3]'
    reconfigure: true
    testadapter: 'vm.[1].vnic.[1]'
  PlaceVM1OnvWire4:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[4]'
    reconfigure: true
    testadapter: 'vm.[1].vnic.[1]'
  PlaceVM2OnMgmtdvpg:
    Type: NetAdapter
    portgroup: 'vc.[1].dvportgroup.[1]'
    reconfigure: true
    testadapter: 'vm.[2].vnic.[1]'
  PlaceVM2OnVLAN16_VDS1:
    Type: NetAdapter
    portgroup: 'vc.[1].dvportgroup.[1]'
    reconfigure: true
    testadapter: 'vm.[2].vnic.[1]'
  PlaceVM2OnVLAN17_VDS1:
    Type: NetAdapter
    portgroup: 'vc.[1].dvportgroup.[2]'
    reconfigure: true
    testadapter: 'vm.[2].vnic.[1]'
  PlaceVM2OnVLAN21_VDS1:
    Type: NetAdapter
    portgroup: 'vc.[1].dvportgroup.[5]'
    reconfigure: true
    testadapter: 'vm.[2].vnic.[1]'
  PlaceVM2OnvWire1:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[1]'
    reconfigure: true
    testadapter: 'vm.[2].vnic.[1]'
  PlaceVM2OnvWire2:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[2]'
    reconfigure: true
    testadapter: 'vm.[2].vnic.[1]'
  PlaceVM2OnvWire3:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[3]'
    reconfigure: true
    testadapter: 'vm.[2].vnic.[1]'
  PlaceVM3OnVLAN16_VDS1:
    Type: NetAdapter
    portgroup: 'vc.[1].dvportgroup.[1]'
    reconfigure: true
    testadapter: 'vm.[3].vnic.[1]'
  PlaceVM3OnVLAN16_VDS2:
    Type: NetAdapter
    portgroup: 'vc.[1].dvportgroup.[7]'
    reconfigure: true
    testadapter: 'vm.[3].vnic.[1]'
  PlaceVM3OnVLAN17_VDS1:
    Type: NetAdapter
    portgroup: 'vc.[1].dvportgroup.[2]'
    reconfigure: true
    testadapter: 'vm.[3].vnic.[1]'
  PlaceVM3OnVLAN21_VDS2:
    Type: NetAdapter
    portgroup: 'vc.[1].dvportgroup.[5]'
    reconfigure: true
    testadapter: 'vm.[3].vnic.[1]'
  PlaceVM3OnvWire1:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[1]'
    reconfigure: true
    testadapter: 'vm.[3].vnic.[1]'
  PlaceVM3OnvWire2:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[2]'
    reconfigure: true
    testadapter: 'vm.[3].vnic.[1]'
  PlaceVM3OnvWire3:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[3]'
    reconfigure: true
    testadapter: 'vm.[3].vnic.[1]'
  PlaceVM4OnVLAN17_VDS1:
    Type: NetAdapter
    portgroup: 'vc.[1].dvportgroup.[2]'
    reconfigure: true
    testadapter: 'vm.[4].vnic.[1]'
  PlaceVM4OnVLAN17_VDS2:
    Type: NetAdapter
    portgroup: 'vc.[1].dvportgroup.[8]'
    reconfigure: true
    testadapter: 'vm.[4].vnic.[1]'
  PlaceVM4OnvWire1:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[1]'
    reconfigure: true
    testadapter: 'vm.[4].vnic.[1]'
  PlaceVM4OnvWire2:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[2]'
    reconfigure: true
    testadapter: 'vm.[4].vnic.[1]'
  PlaceVM4OnvWire3:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[3]'
    reconfigure: true
    testadapter: 'vm.[4].vnic.[1]'
  PlaceVM5OnVLAN17_VDS1:
    Type: NetAdapter
    portgroup: 'vc.[1].dvportgroup.[2]'
    reconfigure: true
    testadapter: 'vm.[5].vnic.[1]'
  PlaceVM5OnVLAN18_VDS1:
    Type: NetAdapter
    portgroup: 'vc.[1].dvportgroup.[3]'
    reconfigure: true
    testadapter: 'vm.[5].vnic.[1]'
  PlaceVM5OnvWire1:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[1]'
    reconfigure: true
    testadapter: 'vm.[5].vnic.[1]'
  PlaceVM5OnvWire2:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[2]'
    reconfigure: true
    testadapter: 'vm.[5].vnic.[1]'
  PlaceVM5OnvWire3:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[3]'
    reconfigure: true
    testadapter: 'vm.[5].vnic.[1]'
  PlaceVM6OnVLAN17_VDS1:
    Type: NetAdapter
    portgroup: 'vc.[1].dvportgroup.[2]'
    reconfigure: true
    testadapter: 'vm.[6].vnic.[1]'
  PlaceVM6OnVLAN18_VDS1:
    Type: NetAdapter
    portgroup: 'vc.[1].dvportgroup.[3]'
    reconfigure: true
    testadapter: 'vm.[6].vnic.[1]'
  PlaceVM6OnvWire1:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[1]'
    reconfigure: true
    testadapter: 'vm.[6].vnic.[1]'
  PlaceVM6OnvWire2:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[2]'
    reconfigure: true
    testadapter: 'vm.[6].vnic.[1]'
  PlaceVM6OnvWire3:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[3]'
    reconfigure: true
    testadapter: 'vm.[6].vnic.[1]'
  PlaceVMsOnMgmtdvPG:
    Type: NetAdapter
    portgroup: 'vc.[1].dvportgroup.[4]'
    reconfigure: true
    testadapter: 'vm.[1-3].vnic.[1]'
  PoweroffVM1:
    TestVM: 'vm.[1]'
    Type: VM
    vmstate: poweroff
  PoweroffVM2:
    TestVM: 'vm.[2]'
    Type: VM
    vmstate: poweroff
  PoweroffVM3:
    TestVM: 'vm.[3]'
    Type: VM
    vmstate: poweroff
  PoweroffVM4:
    TestVM: 'vm.[4]'
    Type: VM
    vmstate: poweroff
  PoweroffVM5:
    TestVM: 'vm.[5]'
    Type: VM
    vmstate: poweroff
  PoweroffVM6:
    TestVM: 'vm.[6]'
    Type: VM
    vmstate: poweroff
  PoweronVM1:
    TestVM: 'vm.[1]'
    Type: VM
    vmstate: poweron
  PoweronVM2:
    TestVM: 'vm.[2]'
    Type: VM
    vmstate: poweron
  PoweronVM3:
    TestVM: 'vm.[3]'
    Type: VM
    vmstate: poweron
  PoweronVM4:
    TestVM: 'vm.[4]'
    Type: VM
    vmstate: poweron
  PoweronVM5:
    TestVM: 'vm.[5]'
    Type: VM
    vmstate: poweron
  PoweronVM6:
    TestVM: 'vm.[6]'
    Type: VM
    vmstate: poweron
  PrepClusterSFO:
    TestNSX: 'vsm.[1]'
    Type: NSX
    VDNCluster:
      '[3]':
        cluster: 'vc.[1].datacenter.[1].cluster.[3]'
  ReDeployEdge:
    TestVM: 'vsm.[1].vse.[1]'
    Type: VM
    applianceaction: redeploy
  RebootHost:
    TestHost: 'host.[1]'
    Type: Host
    reboot: yes
  RebootHost2:
    TestHost: 'host.[2]'
    Type: Host
    reboot: yes
  RebootHost3:
    TestHost: 'host.[3]'
    Type: Host
    reboot: yes
  RebootHost4:
    TestHost: 'host.[4]'
    Type: Host
    reboot: yes
  RebootHost5:
    TestHost: 'host.[5]'
    Type: Host
    reboot: yes
  RemoveHosts2and3FromClusterSJC:
    MoveHostsFromCluster: 'host.[2],host.[3]'
    TestCluster: 'vc.[1].datacenter.[1].cluster.[2]'
    Type: Cluster
  RemoveHosts4and5FromClusterSJC:
    MoveHostsFromCluster: 'host.[4],host.[5]'
    TestCluster: 'vc.[1].datacenter.[1].cluster.[2]'
    Type: Cluster
  RemoveHosts4and5FromVDSSFO:
    TestSwitch: 'vc.[1].vds.[2]'
    Type: Switch
    configurehosts: remove
    host: 'host.[4-5]'
  RemoveHosts4and5FromVDSSJC:
    TestSwitch: 'vc.[1].vds.[1]'
    Type: Switch
    configurehosts: remove
    host: 'host.[4-5]'
  RemoveHosts4and5UplinkFromVDSSFO:
    TestSwitch: 'vc.[1].vds.[2]'
    Type: Switch
    configureuplinks: remove
    vmnicadapter: 'host.[4-5].vmnic.[1]'
  RemovevNICFromVM1:
    TestVM: 'vm.[1]'
    Type: VM
    deletevnic: 'vm.[1].vnic.[1]'
  RemovevNICFromVM2:
    TestVM: 'vm.[2]'
    Type: VM
    deletevnic: 'vm.[2].vnic.[1]'
  RemovevNICFromVM3:
    TestVM: 'vm.[3]'
    Type: VM
    deletevnic: 'vm.[3].vnic.[1]'
  RemovevNICFromVM4:
    TestVM: 'vm.[4]'
    Type: VM
    deletevnic: 'vm.[4].vnic.[1]'
  RemovevNICFromVM5:
    TestVM: 'vm.[5]'
    Type: VM
    deletevnic: 'vm.[5].vnic.[1]'
  RemovevNICFromVM6:
    TestVM: 'vm.[6]'
    Type: VM
    deletevnic: 'vm.[6].vnic.[1]'
  SamevWireNetperfTestDifferentCluster:
    MinExpResult: 1
    NoofInbound: 1
    NoofOutbound: 1
    SupportAdapter: 'vm.[3].vnic.[1]'
    TestAdapter: 'vm.[1].vnic.[1]'
    TestDuration: 60
    Type: Traffic
    l3protocol: 'ipv4,ipv6'
    l4protocol: 'tcp,udp'
    maxtimeout: 128000
  Sequence:
    -
      - RemoveHosts4and5FromVDSSFO
    -
      - AddHosts4and5ToVDSSJC
    -
      - AddHosts2and3ToClusterSJC
    -
      - InstallVIBs_ClusterSJC
    -
      - ConfigureVXLAN_ClusterSJC
    -
      - AddHosts4and5ToClusterSJC
    -
      - CreateNetworkScope
    -
      - CreateVirtualWires
    -
      - AddvNICsOn1to6VMs
    -
      - PoweronVM1
      - PoweronVM2
      - PoweronVM3
    -
      - PoweronVM4
      - PoweronVM5
      - PoweronVM6
    -
      - MakeSurevNICConnectedVM1toVM6
    -
      - DeployEdgeOnHost4
    -
      - CreateVLANLIF1
    -
      - CreateVLANLIF2
    -
      - CreateVLANLIF3
    -
      - CreateBridges
    -
      - PlaceVM1OnVLAN16_VDS1
      - PlaceVM2OnVLAN17_VDS1
      - PlaceVM3OnVLAN17_VDS1
      - PlaceVM4OnVLAN17_VDS1
      - PlaceVM5OnVLAN17_VDS1
      - PlaceVM6OnVLAN17_VDS1
    -
      - SetIPVM1VLAN16
      - SetIPVM2VLAN17
      - SetIPVM3VLAN17
      - SetIPVM4VLAN17
      - SetIPVM5VLAN17
      - SetIPVM6VLAN17
    -
      - AddRouteVM1VLAN16
      - AddRouteVM2VLAN17
      - AddRouteVM3VLAN17
      - AddRouteVM4VLAN17
      - AddRouteVM5VLAN17
      - AddRouteVM6VLAN17
    -
      - PingTestVM1ToAllOthers
      - PingTest3VMsToOther3VMs
    -
      - PlaceVM1OnVLAN16_VDS1
      - PlaceVM2OnVLAN16_VDS1
      - PlaceVM3OnVLAN16_VDS1
      - PlaceVM4OnVLAN17_VDS1
      - PlaceVM5OnVLAN17_VDS1
      - PlaceVM6OnVLAN17_VDS1
    -
      - SetIPVM1VLAN16
      - SetIPVM2VLAN16
      - SetIPVM3VLAN16
      - SetIPVM4VLAN17
      - SetIPVM5VLAN17
      - SetIPVM6VLAN17
    -
      - AddRouteVM1VLAN16
      - AddRouteVM2VLAN16
      - AddRouteVM3VLAN16
      - AddRouteVM4VLAN17
      - AddRouteVM5VLAN17
      - AddRouteVM6VLAN17
    -
      - PingTestVM1ToAllOthers
    -
      - PingTest3VMsToOther3VMs
    -
      - PoweroffVM1
      - PoweroffVM2
      - PoweroffVM3
    -
      - PoweroffVM4
      - PoweroffVM5
      - PoweroffVM6
    -
      - PoweronVM1
      - PoweronVM2
      - PoweronVM3
    -
      - PoweronVM4
      - PoweronVM5
      - PoweronVM6
    -
      - PlaceVM1OnVLAN16_VDS1
      - PlaceVM2OnVLAN16_VDS1
      - PlaceVM3OnVLAN17_VDS1
      - PlaceVM4OnVLAN17_VDS1
      - PlaceVM5OnVLAN18_VDS1
      - PlaceVM6OnVLAN18_VDS1
    -
      - SetIPVM1VLAN16
      - SetIPVM2VLAN16
      - SetIPVM3VLAN17
      - SetIPVM4VLAN17
      - SetIPVM5VLAN18
      - SetIPVM6VLAN18
    -
      - AddRouteVM1VLAN16
      - AddRouteVM2VLAN16
      - AddRouteVM3VLAN17
      - AddRouteVM4VLAN17
      - AddRouteVM5VLAN18
      - AddRouteVM6VLAN18
    -
      - PingTestVM1ToAllOthers
      - PingTest3VMsToOther3VMs
    -
      - RemovevNICFromVM1
    -
      - RemovevNICFromVM2
    -
      - RemovevNICFromVM3
    -
      - RemovevNICFromVM4
    -
      - RemovevNICFromVM5
    -
      - RemovevNICFromVM6
    -
      - AddvNICsOn1to6VMsOnVlanPortGroup
    -
      - DeleteEdges
    -
      - DeleteVirtualWires
    -
      - DeleteNetworkScope
    -
      - UnconfigureVXLAN
    -
      - DeployEdgeOnHost4
    -
      - CreateVLANLIF1
    -
      - CreateVLANLIF2
    -
      - CreateVLANLIF3
    -
      - PlaceVM1OnVLAN16_VDS1
      - PlaceVM2OnVLAN16_VDS1
      - PlaceVM3OnVLAN17_VDS1
      - PlaceVM4OnVLAN17_VDS1
      - PlaceVM5OnVLAN18_VDS1
      - PlaceVM6OnVLAN18_VDS1
    -
      - SetIPVM1VLAN16
      - SetIPVM2VLAN16
      - SetIPVM3VLAN17
      - SetIPVM4VLAN17
      - SetIPVM5VLAN18
      - SetIPVM6VLAN18
    -
      - AddRouteVM1VLAN16
      - AddRouteVM2VLAN16
      - AddRouteVM3VLAN17
      - AddRouteVM4VLAN17
      - AddRouteVM5VLAN18
      - AddRouteVM6VLAN18
    -
      - PingTestVM1ToAllOthers
      - PingTest3VMsToOther3VMs
  SetIPVM1VLAN16:
    Testadapter: 'vm.[1].vnic.[1]'
    Type: NetAdapter
    ipv4: dhcp
  SetIPVM1VLAN17:
    Testadapter: 'vm.[1].vnic.[1]'
    Type: NetAdapter
    ipv4: dhcp
  SetIPVM1VLAN18:
    Testadapter: 'vm.[1].vnic.[1]'
    Type: NetAdapter
    ipv4: dhcp
  SetIPVM1VWire1:
    Testadapter: 'vm.[1].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.31.1.15
    netmask: 255.255.0.0
  SetIPVM1VWire2:
    Testadapter: 'vm.[1].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.32.1.15
    netmask: 255.255.0.0
  SetIPVM1VWire3:
    Testadapter: 'vm.[1].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.33.1.15
    netmask: 255.255.0.0
  SetIPVM2VLAN16:
    Testadapter: 'vm.[2].vnic.[1]'
    Type: NetAdapter
    ipv4: dhcp
  SetIPVM2VLAN17:
    Testadapter: 'vm.[2].vnic.[1]'
    Type: NetAdapter
    ipv4: dhcp
  SetIPVM2VLAN18:
    Testadapter: 'vm.[2].vnic.[1]'
    Type: NetAdapter
    ipv4: dhcp
  SetIPVM2VLAN21:
    Testadapter: 'vm.[2].vnic.[1]'
    Type: NetAdapter
    ipv4: dhcp
  SetIPVM2VWire1:
    Testadapter: 'vm.[2].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.31.1.25
    netmask: 255.255.0.0
  SetIPVM2VWire2:
    Testadapter: 'vm.[2].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.32.1.25
    netmask: 255.255.0.0
  SetIPVM2VWire3:
    Testadapter: 'vm.[2].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.33.1.25
    netmask: 255.255.0.0
  SetIPVM3VLAN16:
    Testadapter: 'vm.[3].vnic.[1]'
    Type: NetAdapter
    ipv4: dhcp
  SetIPVM3VLAN17:
    Testadapter: 'vm.[3].vnic.[1]'
    Type: NetAdapter
    ipv4: dhcp
  SetIPVM3VLAN18:
    Testadapter: 'vm.[3].vnic.[1]'
    Type: NetAdapter
    ipv4: dhcp
  SetIPVM3VWire1:
    Testadapter: 'vm.[3].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.31.1.35
    netmask: 255.255.0.0
  SetIPVM3VWire2:
    Testadapter: 'vm.[3].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.32.1.35
    netmask: 255.255.0.0
  SetIPVM3VWire3:
    Testadapter: 'vm.[3].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.33.1.35
    netmask: 255.255.0.0
  SetIPVM4VLAN16:
    Testadapter: 'vm.[4].vnic.[1]'
    Type: NetAdapter
    ipv4: dhcp
  SetIPVM4VLAN17:
    Testadapter: 'vm.[4].vnic.[1]'
    Type: NetAdapter
    ipv4: dhcp
  SetIPVM4VLAN18:
    Testadapter: 'vm.[4].vnic.[1]'
    Type: NetAdapter
    ipv4: dhcp
  SetIPVM4VWire1:
    Testadapter: 'vm.[4].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.31.1.45
    netmask: 255.255.0.0
  SetIPVM4VWire2:
    Testadapter: 'vm.[4].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.32.1.45
    netmask: 255.255.0.0
  SetIPVM4VWire3:
    Testadapter: 'vm.[4].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.33.1.45
    netmask: 255.255.0.0
  SetIPVM5VLAN17:
    Testadapter: 'vm.[5].vnic.[1]'
    Type: NetAdapter
    ipv4: dhcp
  SetIPVM5VLAN18:
    Testadapter: 'vm.[5].vnic.[1]'
    Type: NetAdapter
    ipv4: dhcp
  SetIPVM5VWire1:
    Testadapter: 'vm.[5].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.31.1.55
    netmask: 255.255.0.0
  SetIPVM5VWire2:
    Testadapter: 'vm.[5].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.32.1.55
    netmask: 255.255.0.0
  SetIPVM5VWire3:
    Testadapter: 'vm.[5].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.33.1.55
    netmask: 255.255.0.0
  SetIPVM6VLAN17:
    Testadapter: 'vm.[6].vnic.[1]'
    Type: NetAdapter
    ipv4: dhcp
  SetIPVM6VLAN18:
    Testadapter: 'vm.[6].vnic.[1]'
    Type: NetAdapter
    ipv4: dhcp
  SetIPVM6VWire1:
    Testadapter: 'vm.[6].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.31.1.65
    netmask: 255.255.0.0
  SetIPVM6VWire2:
    Testadapter: 'vm.[6].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.32.1.65
    netmask: 255.255.0.0
  SetIPVM6VWire3:
    Testadapter: 'vm.[6].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.33.1.65
    netmask: 255.255.0.0
  SetMulticastRange:
    Multicastiprange:
      '[1]':
        begin: 239.0.0.101
        end: 239.254.254.254
        name: AutoGenerate
    TestNSX: 'vsm.[1]'
    Type: NSX
  SetSegmentIDRange:
    TestNSX: 'vsm.[1]'
    Type: NSX
    segmentidrange:
      '[1]':
        begin: 5001-10001
        end: 99000
        name: AutoGenerate
  UnconfigureVXLAN:
    Type: Cluster
    testcluster: 'vsm.[1].vdncluster.[1]'
    vxlan: unconfigure
  Uninstall_VDNCluster:
    TestNSX: 'vsm.[1]'
    Type: NSX
    deletevdncluster: 'vsm.[1].vdncluster.[-1]'
  vMotionVM2ToHost3:
    Iterations: 1
    TestVM: 'vm.[3]'
    Type: VM
    dsthost: 'host.[2]'
    vmotion: oneway
---
Category: NSX
Component: network vDR
Summary: Same vwire datapath tests for different control plane modes
Tags: RunOnCAT
TestName: AllHybridAllMulticastAllUnicastAndCombinations1
TestbedSpec:
  host:
    '[1]': {}
    '[2-5]':
      vmnic:
        '[1-2]':
          driver: any
  vc:
    '[1]':
      datacenter:
        '[1]':
          Cluster:
            '[1]':
              host: 'host.[1]'
              name: Controller-Cluster-26724
            '[2]':
              name: Compute-Cluster-SJC-26724
            '[3]':
              name: Compute-Cluster-SFO-26724
          host: 'host.[2-5]'
      dvportgroup:
        '[10]':
          name: dvpg-SFO-vlan19-26724
          vds: 'vc.[1].vds.[2]'
          vlan: 19
          vlantype: access
        '[11]':
          name: dvpg-SFO-vlan21-26724
          vds: 'vc.[1].vds.[2]'
          vlan: 21
          vlantype: access
        '[12]':
          name: dvpg-SFO-vlan22-26724
          vds: 'vc.[1].vds.[2]'
          vlan: 22
          vlantype: access
        '[1]':
          name: dvpg-SJC-vlan16-26724
          vds: 'vc.[1].vds.[1]'
          vlan: 16
          vlantype: access
        '[2]':
          name: dvpg-SJC-vlan17-26724
          vds: 'vc.[1].vds.[1]'
          vlan: 17
          vlantype: access
        '[3]':
          name: dvpg-SJC-vlan18-26724
          vds: 'vc.[1].vds.[1]'
          vlan: 18
          vlantype: access
        '[4]':
          name: dvpg-SJC-mgmt-26724
          vds: 'vc.[1].vds.[1]'
          vlan: 19
          vlantype: access
        '[5]':
          name: dvpg-SJC-vlan21-26724
          vds: 'vc.[1].vds.[1]'
          vlan: 21
          vlantype: access
        '[6]':
          name: dvpg-SJC-vlan22-26724
          vds: 'vc.[1].vds.[1]'
          vlan: 22
          vlantype: access
        '[7]':
          name: dvpg-SFO-vlan16-26724
          vds: 'vc.[1].vds.[2]'
          vlan: 16
          vlantype: access
        '[8]':
          name: dvpg-SFO-vlan17-26724
          vds: 'vc.[1].vds.[2]'
          vlan: 17
          vlantype: access
        '[9]':
          name: dvpg-SFO-vlan18-26724
          vds: 'vc.[1].vds.[2]'
          vlan: 18
          vlantype: access
      vds:
        '[1]':
          configurehosts: add
          datacenter: 'vc.[1].datacenter.[1]'
          host: 'host.[2-3]'
          name: VDS-1-SJC-26724
          numuplinkports: 1
          vmnicadapter: 'host.[2-3].vmnic.[1]'
        '[2]':
          configurehosts: add
          datacenter: 'vc.[1].datacenter.[1]'
          host: 'host.[4-5]'
          name: VDS-2-SFO-26724
          numuplinkports: 1
          vmnicadapter: 'host.[4-5].vmnic.[1]'
  vm:
    '[1]':
      datastoreType: shared
      host: 'host.[2]'
      vmstate: poweroff
    '[2]':
      datastoreType: shared
      host: 'host.[3]'
      vmstate: poweroff
    '[3]':
      datastoreType: shared
      host: 'host.[4]'
      vmstate: poweroff
    '[4]':
      datastoreType: shared
      host: 'host.[5]'
      vmstate: poweroff
    '[5]':
      datastoreType: shared
      host: 'host.[2]'
      vmstate: poweroff
    '[6]':
      datastoreType: shared
      host: 'host.[3]'
      vmstate: poweroff
  vsm:
    '[1]':
      assignrole: enterprise_admin
      ippool:
        '[1]':
          gateway: x.x.x.x
          ipranges:
            - a.a.a.a-b.b.b.b
          name: AutoGenerate
          prefixlength: yy
      multicastiprange:
        '[1]':
          begin: 239.1.1.1
          end: 239.1.1.100
          name: AutoGenerate
      reconfigure: true
      segmentidrange:
        '[1]':
          begin: 10000
          end: 19000
          name: AutoGenerate
      vc: 'vc.[1]'
      vxlancontroller:
        '[1]':
          host: 'host.[1]'
          ippool: 'vsm.[1].ippool.[1]'
          name: AutoGenerate
          resourcepool: 'vc.[1].datacenter.[1].cluster.[1]'
Version: 2
WORKLOADS:
  AddHosts2and3ToClusterSJC:
    MoveHostsToCluster: 'host.[2],host.[3]'
    TestCluster: 'vc.[1].datacenter.[1].cluster.[2]'
    Type: Cluster
  AddHosts4and5ToClusterSFO:
    MoveHostsToCluster: 'host.[4],host.[5]'
    TestCluster: 'vc.[1].datacenter.[1].cluster.[3]'
    Type: Cluster
  AddHosts4and5ToVDSSJC:
    TestSwitch: 'vc.[1].vds.[2]'
    Type: Switch
    configurehosts: add
    host: 'host.[4-5]'
    vmnicadapter: 'host.[4-5].vmnic.[1]'
  AddRouteVM1VWire1:
    Testadapter: 'vm.[1].vnic.[1]'
    Type: NetAdapter
    gateway: 172.31.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM1VWire2:
    Testadapter: 'vm.[1].vnic.[1]'
    Type: NetAdapter
    gateway: 172.32.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM1VWire3:
    Testadapter: 'vm.[1].vnic.[1]'
    Type: NetAdapter
    gateway: 172.33.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM2VWire1:
    Testadapter: 'vm.[2].vnic.[1]'
    Type: NetAdapter
    gateway: 172.31.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM2VWire2:
    Testadapter: 'vm.[2].vnic.[1]'
    Type: NetAdapter
    gateway: 172.32.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM2VWire3:
    Testadapter: 'vm.[2].vnic.[1]'
    Type: NetAdapter
    gateway: 172.33.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM3VWire1:
    Testadapter: 'vm.[3].vnic.[1]'
    Type: NetAdapter
    gateway: 172.31.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM3VWire2:
    Testadapter: 'vm.[3].vnic.[1]'
    Type: NetAdapter
    gateway: 172.32.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM3VWire3:
    Testadapter: 'vm.[3].vnic.[1]'
    Type: NetAdapter
    gateway: 172.33.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM4VWire1:
    Testadapter: 'vm.[4].vnic.[1]'
    Type: NetAdapter
    gateway: 172.31.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM4VWire2:
    Testadapter: 'vm.[4].vnic.[1]'
    Type: NetAdapter
    gateway: 172.32.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM4VWire3:
    Testadapter: 'vm.[4].vnic.[1]'
    Type: NetAdapter
    gateway: 172.33.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM5VWire2:
    Testadapter: 'vm.[5].vnic.[1]'
    Type: NetAdapter
    gateway: 172.32.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM5VWire3:
    Testadapter: 'vm.[5].vnic.[1]'
    Type: NetAdapter
    gateway: 172.33.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM6VWire2:
    Testadapter: 'vm.[6].vnic.[1]'
    Type: NetAdapter
    gateway: 172.32.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM6VWire3:
    Testadapter: 'vm.[6].vnic.[1]'
    Type: NetAdapter
    gateway: 172.33.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddVmotionvmknicsHost2and3:
    TestHost: 'host.[2-3]'
    Type: Host
    vmknic:
      '[1]':
        configurevmotion: enable
        ipv4: dhcp
        portgroup: 'vc.[1].dvportgroup.[1]'
  AddVmotionvmknicsHost4and5:
    TestHost: 'host.[4-5]'
    Type: Host
    vmknic:
      '[1]':
        configurevmotion: enable
        ipv4: dhcp
        portgroup: 'vc.[1].dvportgroup.[6]'
  AddvNICsOn1to4VMs:
    TestVM: 'vm.[5],vm.[6]'
    Type: VM
    vnic:
      '[1]':
        allowguestcontrol: 1
        connected: 1
        driver: vmxnet3
        portgroup: 'vsm.[1].networkscope.[1].virtualwire.[1]'
        startconnected: 1
  AddvNICsOn1to6VMs:
    TestVM: 'vm.[1-6]'
    Type: VM
    vnic:
      '[1]':
        allowguestcontrol: 1
        connected: 1
        driver: vmxnet3
        portgroup: 'vsm.[1].networkscope.[1].virtualwire.[1]'
        startconnected: 1
  ConfigureVXLAN_ClusterSFO:
    TestNSX: 'vsm.[1]'
    Type: NSX
    VDNCluster:
      '[2]':
        cluster: 'vc.[1].datacenter.[1].cluster.[3]'
        mtu: 1600
        switch: 'vc.[1].vds.[2]'
        teaming: FAILOVER_ORDER
        vibs: install
        vlan: 22
        vmkniccount: 1
  CreateBridges:
    TestVM: 'vsm.[1].vse.[2]'
    Type: VM
    bridge:
      '[1]':
        name: bridge-1-26724
        portgroup: 'vc.[1].dvportgroup.[5]'
        virtualwire: 'vsm.[1].networkscope.[1].virtualwire.[4]'
      '[2]':
        name: bridge-2-26724
        portgroup: 'vc.[1].dvportgroup.[6]'
        virtualwire: 'vsm.[1].networkscope.[1].virtualwire.[5]'
  CreateNetworkScope:
    TestNSX: 'vsm.[1]'
    Type: NSX
    networkscope:
      '[1]':
        clusters: 'vc.[1].datacenter.[1].cluster.[2]'
        name: network-scope-1-26724
  CreateNetworkScopeClusterSJCandSFO:
    TestNSX: 'vsm.[1]'
    Type: NSX
    networkscope:
      '[1]':
        clusters: 'vc.[1].datacenter.[1].cluster.[2-3]'
        name: network-scope-1-26724
  CreateNetworkScopeClusterSJCandSFOHybridMode:
    TestNSX: 'vsm.[1]'
    Type: NSX
    networkscope:
      '[1]':
        clusters: 'vc.[1].datacenter.[1].cluster.[2-3]'
        controlplanemode: HYBRID_MODE
        name: network-scope-1-26724
  CreateVXLANLIF1:
    TestVM: 'vsm.[1].vse.[1]'
    Type: VM
    lif:
      '[1]':
        addressgroup:
          - addresstype: primary
            ipv4address: 172.31.1.1
            netmask: 255.255.0.0
        connected: 1
        name: lif-vwire1-26724
        portgroup: 'vsm.[1].networkscope.[1].virtualwire.[1]'
        type: internal
  CreateVXLANLIF2:
    TestVM: 'vsm.[1].vse.[1]'
    Type: VM
    lif:
      '[2]':
        addressgroup:
          - addresstype: primary
            ipv4address: 172.32.1.1
            netmask: 255.255.0.0
        connected: 1
        name: lif-vwire2-26724
        portgroup: 'vsm.[1].networkscope.[1].virtualwire.[2]'
        type: internal
  CreateVXLANLIF3:
    TestVM: 'vsm.[1].vse.[1]'
    Type: VM
    lif:
      '[3]':
        addressgroup:
          - addresstype: primary
            ipv4address: 172.33.1.1
            netmask: 255.255.0.0
        connected: 1
        name: lif-vwire3-26724
        portgroup: 'vsm.[1].networkscope.[1].virtualwire.[3]'
        type: internal
  CreateVirtualWires:
    TestTransportZone: 'vsm.[1].networkscope.[1]'
    Type: TransportZone
    VirtualWire:
      '[1]':
        controlplanemode: HYBRID_MODE
        name: AutoGenerate
        tenantid: AutoGenerate
      '[2]':
        controlplanemode: UNICAST_MODE
        name: AutoGenerate
        tenantid: AutoGenerate
      '[3]':
        controlplanemode: MULTICAST_MODE
        name: AutoGenerate
        tenantid: AutoGenerate
      '[4-8]':
        name: AutoGenerate
        tenantid: AutoGenerate
  Delete2ndController:
    TestNSX: 'vsm.[1]'
    Type: NSX
    deletevxlancontroller: 'vsm.[1].vxlancontroller.[2]'
  DeleteAllVmknics:
    TestHost: 'host.[2-5]'
    Type: Host
    deletevmknic: 'host.[2-5].vmknic.[-1]'
  DeleteController:
    TestNSX: 'vsm.[1]'
    Type: NSX
    deletevxlancontroller: 'vsm.[1].vxlancontroller.[-1]'
  DeleteEdges:
    TestNSX: 'vsm.[1]'
    Type: NSX
    deletevse: 'vsm.[1].vse.[-1]'
  DeleteNetworkScopes:
    TestNSX: 'vsm.[1]'
    Type: NSX
    deletenetworkscope: 'vsm.[1].networkscope.[-1]'
  DeleteVirtualWires: &1
    TestTransportZone: 'vsm.[1].networkscope.[-1]'
    Type: TransportZone
    deletevirtualwire: 'vsm.[1].networkscope.[-1].virtualwire.[-1]'
  Delete_All_VirtualWires: *1
  Deploy2ndController:
    TestNSX: 'vsm.[1]'
    Type: NSX
    vxlancontroller:
      '[2]':
        host: 'host.[1]'
        ippool: 'vsm.[1].ippool.[1]'
        name: AutoGenerate
        resourcepool: 'vc.[1].datacenter.[1].cluster.[1]'
  Deploy3rdController:
    TestNSX: 'vsm.[1]'
    Type: NSX
    vxlancontroller:
      '[3]':
        host: 'host.[1]'
        ippool: 'vsm.[1].ippool.[1]'
        name: AutoGenerate
        resourcepool: 'vc.[1].datacenter.[1].cluster.[1]'
  DeployEdge:
    TestNSX: 'vsm.[1]'
    Type: NSX
    vse:
      '[1]':
        datacenter: 'vc.[1].datacenter.[1]'
        host: 'host.[2]'
        name: Edge-26724
        portgroup: 'vc.[1].dvportgroup.[1]'
        primaryaddress: 10.10.10.15
        resourcepool: 'vc.[1].datacenter.[1].cluster.[2]'
        subnetmask: 255.255.255.0
  DeployEdge2OnHost2:
    TestNSX: 'vsm.[1]'
    Type: NSX
    vse:
      '[2]':
        datacenter: 'vc.[1].datacenter.[1]'
        host: 'host.[2]'
        name: Edge-2
        portgroup: 'vc.[1].dvportgroup.[1]'
        primaryaddress: 10.10.10.35
        resourcepool: 'vc.[1].datacenter.[1].cluster.[2]'
        subnetmask: 255.255.255.0
  DeployEdgeOnHost4:
    TestNSX: 'vsm.[1]'
    Type: NSX
    vse:
      '[1]':
        datacenter: 'vc.[1].datacenter.[1]'
        host: 'host.[4]'
        name: Edge-1
        portgroup: 'vc.[1].dvportgroup.[7]'
        primaryaddress: 10.10.10.36
        resourcepool: 'vc.[1].datacenter.[1].cluster.[3]'
        subnetmask: 255.255.255.0
  DeployFirstController:
    TestNSX: 'vsm.[1]'
    Type: NSX
    vxlancontroller:
      '[1]':
        firstnodeofcluster: true
        host: 'host.[1]'
        ippool: 'vsm.[1].ippool.[1]'
        name: AutoGenerate
        resourcepool: 'vc.[1].datacenter.[1].cluster.[1]'
  ExitSequence:
    -
      - DeleteEdges
    -
      - RemovevNICFromVM1
      - RemovevNICFromVM2
      - RemovevNICFromVM3
      - RemovevNICFromVM4
      - RemovevNICFromVM5
      - RemovevNICFromVM6
    -
      - Delete_All_VirtualWires
    -
      - DeleteNetworkScopes
    -
      - Uninstall_VDNCluster
    -
      - RemoveHosts4and5FromClusterSFO
      - RemoveHosts2and3FromClusterSJC
    -
      - RebootHost2
      - RebootHost3
      - RebootHost4
      - RebootHost5
  InstallVIBs_ClusterSFO:
    TestNSX: 'vsm.[1]'
    Type: NSX
    VDNCluster:
      '[2]':
        cluster: 'vc.[1].datacenter.[1].cluster.[3]'
        vibs: install
  Install_Configure_ClusterSJC:
    TestNSX: 'vsm.[1]'
    Type: NSX
    VDNCluster:
      '[1]':
        cluster: 'vc.[1].datacenter.[1].cluster.[2]'
        mtu: 1600
        switch: 'vc.[1].vds.[1]'
        teaming:
          - LOADBALANCE_SRCMAC
          - LOADBALANCE_SRCID
          - LOADBALANCE_LOADBASED
          - FAILOVER_ORDER
          - ETHER_CHANNEL
        vibs: install
        vlan:
          - 21
        vmkniccount: 1
  MakeSurevNICConnectedVM1toVM6:
    Type: NetAdapter
    connected: 1
    reconfigure: true
    startconnected: 1
    testadapter: 'vm.[1-6].vnic.[1]'
  MoveHostsToClusterSFO:
    MoveHostsToCluster: 'host.[4],host.[5]'
    TestCluster: 'vc.[1].datacenter.[1].cluster.[3]'
    Type: Cluster
  MoveHostsToClusterSJC:
    MoveHostsToCluster: 'host.[2],host.[3]'
    TestCluster: 'vc.[1].datacenter.[1].cluster.[2]'
    Type: Cluster
  NetperfTest2VMsToOther2VMs:
    ExpectedResult: ignore
    L4Protocol: 'tcp,udp'
    LocalSendSocketSize: 131072
    NoofInbound: 1
    NoofOutbound: 1
    ParallelSession: yes
    RemoteSendSocketSize: 131072
    SendMessageSize: '16384,128804'
    SupportAdapter: 'vm.[5-6].vnic.[1]'
    TestAdapter: 'vm.[1-2].vnic.[1]'
    TestDuration: 60
    ToolName: Netperf
    Type: Traffic
    maxtimeout: 128000
  NetperfTest3VMsToOther3VMs:
    ExpectedResult: ignore
    LocalSendSocketSize: 131072
    NoofInbound: 1
    NoofOutbound: 1
    ParallelSession: yes
    RemoteSendSocketSize: 131072
    SendMessageSize: '16384,96684,128804'
    SupportAdapter: 'vm.[4-6].vnic.[1]'
    TestAdapter: 'vm.[1-3].vnic.[1]'
    TestDuration: 60
    ToolName: Netperf
    Type: Traffic
    maxtimeout: 128000
  NetperfTestIgnorethroughput:
    ExpectedResult: ignore
    NoofOutbound: 1
    SupportAdapter: 'vm.[2].vnic.[1]'
    TestAdapter: 'vm.[1].vnic.[1]'
    TestDuration: 60
    ToolName: iperf
    Type: Traffic
  NetperfTestVM1ToAllOthers:
    ExpectedResult: ignore
    NoofInbound: 3
    NoofOutbound: 10
    ParallelSession: yes
    SupportAdapter: 'vm.[2-6].vnic.[1]'
    TestAdapter: 'vm.[1].vnic.[1]'
    TestDuration: 60
    ToolName: 'Netperf,Iperf,Ping'
    Type: Traffic
    maxtimeout: 128000
  PingTest:
    NoofInbound: 1
    NoofOutbound: 1
    SupportAdapter: 'vm.[2].vnic.[1]'
    TestAdapter: 'vm.[1].vnic.[1]'
    TestDuration: 60
    ToolName: Ping
    Type: Traffic
    maxtimeout: 128000
  PingTest2VMsToOther2VMs:
    NoofInbound: 1
    NoofOutbound: 1
    SupportAdapter: 'vm.[5-6].vnic.[1]'
    TestAdapter: 'vm.[1-2].vnic.[1]'
    TestDuration: 60
    ToolName: Ping
    Type: Traffic
    maxtimeout: 128000
  PingTest3VMsToOther3VMs:
    NoofInbound: 1
    NoofOutbound: 1
    SupportAdapter: 'vm.[4-6].vnic.[1]'
    TestAdapter: 'vm.[1-3].vnic.[1]'
    TestDuration: 60
    ToolName: Ping
    Type: Traffic
    maxtimeout: 128000
  PingTestSameCluster1:
    NoofInbound: 1
    NoofOutbound: 1
    SupportAdapter: 'vm.[2].vnic.[1]'
    TestAdapter: 'vm.[1].vnic.[1]'
    TestDuration: 60
    ToolName: Ping
    Type: Traffic
    maxtimeout: 128000
  PingTestSameCluster2:
    NoofInbound: 1
    NoofOutbound: 1
    SupportAdapter: 'vm.[4].vnic.[1]'
    TestAdapter: 'vm.[3].vnic.[1]'
    TestDuration: 60
    ToolName: Ping
    Type: Traffic
    maxtimeout: 128000
  PingTestVM1ToAllOthers:
    NoofInbound: 1
    NoofOutbound: 1
    SupportAdapter: 'vm.[2-6].vnic.[1]'
    TestAdapter: 'vm.[1].vnic.[1]'
    TestDuration: 60
    ToolName: Ping
    Type: Traffic
    maxtimeout: 128000
  PingTestVM1ToVM2:
    NoofInbound: 1
    NoofOutbound: 1
    SupportAdapter: 'vm.[2].vnic.[1]'
    TestAdapter: 'vm.[1].vnic.[1]'
    TestDuration: 60
    ToolName: Ping
    Type: Traffic
    maxtimeout: 128000
  PingTestVM6ToVM5:
    NoofInbound: 1
    NoofOutbound: 1
    SupportAdapter: 'vm.[5].vnic.[1]'
    TestAdapter: 'vm.[6].vnic.[1]'
    TestDuration: 60
    ToolName: Ping
    Type: Traffic
    maxtimeout: 128000
  PlaceVM1OnvWire1:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[1]'
    reconfigure: true
    testadapter: 'vm.[1].vnic.[1]'
  PlaceVM1OnvWire2:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[2]'
    reconfigure: true
    testadapter: 'vm.[1].vnic.[1]'
  PlaceVM1OnvWire3:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[3]'
    reconfigure: true
    testadapter: 'vm.[1].vnic.[1]'
  PlaceVM1OnvWire4:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[4]'
    reconfigure: true
    testadapter: 'vm.[1].vnic.[1]'
  PlaceVM2OnMgmtdvpg:
    Type: NetAdapter
    portgroup: 'vc.[1].dvportgroup.[1]'
    reconfigure: true
    testadapter: 'vm.[2].vnic.[1]'
  PlaceVM2OnVLAN21_VDS1:
    Type: NetAdapter
    portgroup: 'vc.[1].dvportgroup.[5]'
    reconfigure: true
    testadapter: 'vm.[2].vnic.[1]'
  PlaceVM2OnvWire1:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[1]'
    reconfigure: true
    testadapter: 'vm.[2].vnic.[1]'
  PlaceVM2OnvWire2:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[2]'
    reconfigure: true
    testadapter: 'vm.[2].vnic.[1]'
  PlaceVM2OnvWire3:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[3]'
    reconfigure: true
    testadapter: 'vm.[2].vnic.[1]'
  PlaceVM3OnvWire1:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[1]'
    reconfigure: true
    testadapter: 'vm.[3].vnic.[1]'
  PlaceVM3OnvWire2:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[2]'
    reconfigure: true
    testadapter: 'vm.[3].vnic.[1]'
  PlaceVM3OnvWire3:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[3]'
    reconfigure: true
    testadapter: 'vm.[3].vnic.[1]'
  PlaceVM4OnvWire1:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[1]'
    reconfigure: true
    testadapter: 'vm.[4].vnic.[1]'
  PlaceVM4OnvWire2:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[2]'
    reconfigure: true
    testadapter: 'vm.[4].vnic.[1]'
  PlaceVM4OnvWire3:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[3]'
    reconfigure: true
    testadapter: 'vm.[4].vnic.[1]'
  PlaceVM5OnvWire1:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[1]'
    reconfigure: true
    testadapter: 'vm.[5].vnic.[1]'
  PlaceVM5OnvWire2:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[2]'
    reconfigure: true
    testadapter: 'vm.[5].vnic.[1]'
  PlaceVM5OnvWire3:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[3]'
    reconfigure: true
    testadapter: 'vm.[5].vnic.[1]'
  PlaceVM5OnvWire5:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[5]'
    reconfigure: true
    testadapter: 'vm.[5].vnic.[1]'
  PlaceVM6OnVLAN22_VDS1:
    Type: NetAdapter
    portgroup: 'vc.[1].dvportgroup.[6]'
    reconfigure: true
    testadapter: 'vm.[6].vnic.[1]'
  PlaceVM6OnvWire1:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[1]'
    reconfigure: true
    testadapter: 'vm.[6].vnic.[1]'
  PlaceVM6OnvWire2:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[2]'
    reconfigure: true
    testadapter: 'vm.[6].vnic.[1]'
  PlaceVM6OnvWire3:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[3]'
    reconfigure: true
    testadapter: 'vm.[6].vnic.[1]'
  PoweroffVM1:
    TestVM: 'vm.[1]'
    Type: VM
    vmstate: poweroff
  PoweroffVM2:
    TestVM: 'vm.[2]'
    Type: VM
    vmstate: poweroff
  PoweroffVM3:
    TestVM: 'vm.[3]'
    Type: VM
    vmstate: poweroff
  PoweroffVM4:
    TestVM: 'vm.[4]'
    Type: VM
    vmstate: poweroff
  PoweroffVM5:
    TestVM: 'vm.[5]'
    Type: VM
    vmstate: poweroff
  PoweroffVM6:
    TestVM: 'vm.[6]'
    Type: VM
    vmstate: poweroff
  PoweronVM1:
    TestVM: 'vm.[1]'
    Type: VM
    vmstate: poweron
  PoweronVM2:
    TestVM: 'vm.[2]'
    Type: VM
    vmstate: poweron
  PoweronVM3:
    TestVM: 'vm.[3]'
    Type: VM
    vmstate: poweron
  PoweronVM4:
    TestVM: 'vm.[4]'
    Type: VM
    vmstate: poweron
  PoweronVM5:
    TestVM: 'vm.[5]'
    Type: VM
    vmstate: poweron
  PoweronVM6:
    TestVM: 'vm.[6]'
    Type: VM
    vmstate: poweron
  RebootHost:
    TestHost: 'host.[1]'
    Type: Host
    reboot: yes
  RebootHost2:
    TestHost: 'host.[2]'
    Type: Host
    reboot: yes
  RebootHost3:
    TestHost: 'host.[3]'
    Type: Host
    reboot: yes
  RebootHost4:
    TestHost: 'host.[4]'
    Type: Host
    reboot: yes
  RebootHost5:
    TestHost: 'host.[5]'
    Type: Host
    reboot: yes
  RemoveHosts2and3FromClusterSJC:
    MoveHostsFromCluster: 'host.[2],host.[3]'
    TestCluster: 'vc.[1].datacenter.[1].cluster.[2]'
    Type: Cluster
  RemoveHosts4and5FromClusterSFO:
    MoveHostsFromCluster: 'host.[4],host.[5]'
    TestCluster: 'vc.[1].datacenter.[1].cluster.[3]'
    Type: Cluster
  RemovevNICFromVM1:
    TestVM: 'vm.[1]'
    Type: VM
    deletevnic: 'vm.[1].vnic.[1]'
  RemovevNICFromVM2:
    TestVM: 'vm.[2]'
    Type: VM
    deletevnic: 'vm.[2].vnic.[1]'
  RemovevNICFromVM3:
    TestVM: 'vm.[3]'
    Type: VM
    deletevnic: 'vm.[3].vnic.[1]'
  RemovevNICFromVM4:
    TestVM: 'vm.[4]'
    Type: VM
    deletevnic: 'vm.[4].vnic.[1]'
  RemovevNICFromVM5:
    TestVM: 'vm.[5]'
    Type: VM
    deletevnic: 'vm.[5].vnic.[1]'
  RemovevNICFromVM6:
    TestVM: 'vm.[6]'
    Type: VM
    deletevnic: 'vm.[6].vnic.[1]'
  SamevWireNetperfTestDifferentCluster:
    MinExpResult: 1
    NoofInbound: 1
    NoofOutbound: 1
    SupportAdapter: 'vm.[3].vnic.[1]'
    TestAdapter: 'vm.[1].vnic.[1]'
    TestDuration: 60
    Type: Traffic
    l3protocol: 'ipv4,ipv6'
    l4protocol: 'tcp,udp'
    maxtimeout: 128000
  Sequence:
    -
      - AddHosts2and3ToClusterSJC
    -
      - Install_Configure_ClusterSJC
      - InstallVIBs_ClusterSFO
    -
      - ConfigureVXLAN_ClusterSFO
    -
      - CreateNetworkScopeClusterSJCandSFO
    -
      - CreateVirtualWires
    -
      - AddHosts4and5ToClusterSFO
    -
      - AddvNICsOn1to6VMs
    -
      - PoweronVM1
      - PoweronVM2
      - PoweronVM3
    -
      - PoweronVM4
      - PoweronVM5
      - PoweronVM6
    -
      - MakeSurevNICConnectedVM1toVM6
    -
      - PingTestVM1ToAllOthers
      - PingTest3VMsToOther3VMs
    -
      - UpdatevWiresToMulticastMode
    -
      - PingTestVM1ToAllOthers
      - PingTest3VMsToOther3VMs
    -
      - UpdatevWiresToUnicastMode
    -
      - PingTestVM1ToAllOthers
      - PingTest3VMsToOther3VMs
    -
      - PoweroffVM1
      - PoweroffVM2
      - PoweroffVM3
    -
      - PoweroffVM4
      - PoweroffVM5
      - PoweroffVM6
    -
      - PoweronVM1
      - PoweronVM2
      - PoweronVM3
    -
      - PoweronVM4
      - PoweronVM5
      - PoweronVM6
    -
      - UpdatevWiresToHybridMode
    -
      - PingTestVM1ToAllOthers
      - PingTest3VMsToOther3VMs
    -
      - UpdatevWires1and4ToHybridMode
    -
      - UpdatevWires2and5ToMulticastMode
    -
      - UpdatevWires3and6ToUnicastMode
    -
      - PingTestVM1ToAllOthers
      - PingTest3VMsToOther3VMs
  SetIPVM1VWire1:
    Testadapter: 'vm.[1].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.31.1.15
    netmask: 255.255.0.0
  SetIPVM1VWire2:
    Testadapter: 'vm.[1].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.32.1.15
    netmask: 255.255.0.0
  SetIPVM1VWire3:
    Testadapter: 'vm.[1].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.33.1.15
    netmask: 255.255.0.0
  SetIPVM1VWire4:
    Testadapter: 'vm.[1].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.21.1.15
    netmask: 255.255.0.0
  SetIPVM2VLAN21:
    Testadapter: 'vm.[2].vnic.[1]'
    Type: NetAdapter
    ipv4: dhcp
  SetIPVM2VWire1:
    Testadapter: 'vm.[2].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.31.1.25
    netmask: 255.255.0.0
  SetIPVM2VWire2:
    Testadapter: 'vm.[2].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.32.1.25
    netmask: 255.255.0.0
  SetIPVM2VWire3:
    Testadapter: 'vm.[2].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.33.1.25
    netmask: 255.255.0.0
  SetIPVM3VWire1:
    Testadapter: 'vm.[3].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.31.1.35
    netmask: 255.255.0.0
  SetIPVM3VWire2:
    Testadapter: 'vm.[3].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.32.1.35
    netmask: 255.255.0.0
  SetIPVM3VWire3:
    Testadapter: 'vm.[3].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.33.1.35
    netmask: 255.255.0.0
  SetIPVM3VWire4:
    Testadapter: 'vm.[3].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.21.1.35
    netmask: 255.255.0.0
  SetIPVM4VWire1:
    Testadapter: 'vm.[4].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.31.1.45
    netmask: 255.255.0.0
  SetIPVM4VWire2:
    Testadapter: 'vm.[4].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.32.1.45
    netmask: 255.255.0.0
  SetIPVM4VWire3:
    Testadapter: 'vm.[4].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.33.1.45
    netmask: 255.255.0.0
  SetIPVM5VWire1:
    Testadapter: 'vm.[5].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.31.1.55
    netmask: 255.255.0.0
  SetIPVM5VWire2:
    Testadapter: 'vm.[5].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.32.1.55
    netmask: 255.255.0.0
  SetIPVM5VWire3:
    Testadapter: 'vm.[5].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.33.1.55
    netmask: 255.255.0.0
  SetIPVM5VWire5:
    Testadapter: 'vm.[5].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.22.1.55
    netmask: 255.255.0.0
  SetIPVM6VLAN22:
    Testadapter: 'vm.[6].vnic.[1]'
    Type: NetAdapter
    ipv4: dhcp
  SetIPVM6VWire1:
    Testadapter: 'vm.[6].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.31.1.65
    netmask: 255.255.0.0
  SetIPVM6VWire2:
    Testadapter: 'vm.[6].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.32.1.65
    netmask: 255.255.0.0
  SetIPVM6VWire3:
    Testadapter: 'vm.[6].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.33.1.65
    netmask: 255.255.0.0
  SetMulticastRange:
    Multicastiprange:
      '[1]':
        begin: 239.0.0.101
        end: 239.254.254.254
        name: AutoGenerate
    TestNSX: 'vsm.[1]'
    Type: NSX
  SetSegmentIDRange:
    TestNSX: 'vsm.[1]'
    Type: NSX
    segmentidrange:
      '[1]':
        begin: 5001-10001
        end: 99000
        name: AutoGenerate
  Uninstall_VDNCluster:
    TestNSX: 'vsm.[1]'
    Type: NSX
    deletevdncluster: 'vsm.[1].vdncluster.[-1]'
  UpdatevWires1and4ToHybridMode:
    TestSwitch: 'vsm.[1].networkscope.[1].virtualwire.[1],vsm.[1].networkscope.[1].virtualwire.[4]'
    Type: Switch
    controlplanemode: HYBRID_MODE
    name: vWire-Updated-Hybrid
    reconfigure: true
  UpdatevWires2and5ToMulticastMode:
    TestSwitch: 'vsm.[1].networkscope.[1].virtualwire.[2],vsm.[1].networkscope.[1].virtualwire.[5]'
    Type: Switch
    controlplanemode: MULTICAST_MODE
    name: vWire-Updated-Multicast
    reconfigure: true
  UpdatevWires3and6ToUnicastMode:
    TestSwitch: 'vsm.[1].networkscope.[1].virtualwire.[3],vsm.[1].networkscope.[1].virtualwire.[6]'
    Type: Switch
    controlplanemode: UNICAST_MODE
    name: vWire-Updated-Unicast
    reconfigure: true
  UpdatevWiresToHybridMode:
    TestSwitch: 'vsm.[1].networkscope.[1].virtualwire.[1-5]'
    Type: Switch
    controlplanemode: HYBRID_MODE
    name: vWire-Updated-Hybrid
    reconfigure: true
  UpdatevWiresToMulticastMode:
    TestSwitch: 'vsm.[1].networkscope.[1].virtualwire.[1-5]'
    Type: Switch
    controlplanemode: MULTICAST_MODE
    name: vWire-Updated-Multicast
    reconfigure: true
  UpdatevWiresToUnicastMode:
    TestSwitch: 'vsm.[1].networkscope.[1].virtualwire.[1-5]'
    Type: Switch
    controlplanemode: UNICAST_MODE
    name: vWire-Updated-Unicast
    reconfigure: true
  vMotionVM2ToHost3:
    Iterations: 1
    TestVM: 'vm.[3]'
    Type: VM
    dsthost: 'host.[2]'
    vmotion: oneway
---
AutomationLevel: Automated
Category: NSX
Component: network vDR
Developer: adityaj
Duration: ''
FullyAutomatable: Y
PartnerFacing: N
Priority: P0
Procedure: ''
Product: VSM
QCPath: ''
Status: Execution Ready
Summary: 'Check if the data traffic is working properlywhile doing VM operations on Edge VMs '
Tags: vdr
TestName: EdgeVMOperationsTestScenarios
TestbedSpec:
  host:
    '[1]': {}
    '[2-5]':
      vmnic:
        '[1-2]':
          driver: any
  vc:
    '[1]':
      datacenter:
        '[1]':
          Cluster:
            '[1]':
              host: 'host.[1]'
              name: Controller-Cluster-26724
            '[2]':
              host: 'host.[2-3]'
              name: Compute-Cluster-SJC-26724
            '[3]':
              host: 'host.[4]'
              name: Compute-Cluster-SFO-26724
            '[4]':
              host: 'host.[5]'
              name: Compute-Cluster-LAX-26724
      dvportgroup:
        '[10]':
          name: dvpg-VDS2-vlan19-26724
          vds: 'vc.[1].vds.[2]'
          vlan: 19
          vlantype: access
        '[11]':
          name: dvpg-VDS2-vlan21-26724
          vds: 'vc.[1].vds.[2]'
          vlan: 21
          vlantype: access
        '[12]':
          name: dvpg-VDS2-vlan22-26724
          vds: 'vc.[1].vds.[2]'
          vlan: 22
          vlantype: access
        '[1]':
          name: dvpg-VDS1-vlan16-26724
          vds: 'vc.[1].vds.[1]'
          vlan: 16
          vlantype: access
        '[2]':
          name: dvpg-VDS-vlan17-26724
          vds: 'vc.[1].vds.[1]'
          vlan: 17
          vlantype: access
        '[3]':
          name: dvpg-VDS1-vlan18-26724
          vds: 'vc.[1].vds.[1]'
          vlan: 18
          vlantype: access
        '[4]':
          name: dvpg-VDS1-mgmt-26724
          vds: 'vc.[1].vds.[1]'
          vlan: 19
          vlantype: access
        '[5]':
          name: dvpg-VDS1-vlan21-26724
          vds: 'vc.[1].vds.[1]'
          vlan: 21
          vlantype: access
        '[6]':
          name: dvpg-VDS1-vlan22-26724
          vds: 'vc.[1].vds.[1]'
          vlan: 22
          vlantype: access
        '[7]':
          name: dvpg-VDS2-vlan16-26724
          vds: 'vc.[1].vds.[2]'
          vlan: 16
          vlantype: access
        '[8]':
          name: dvpg-VDS2-vlan17-26724
          vds: 'vc.[1].vds.[2]'
          vlan: 17
          vlantype: access
        '[9]':
          name: dvpg-VDS2-vlan18-26724
          vds: 'vc.[1].vds.[2]'
          vlan: 18
          vlantype: access
      vds:
        '[1]':
          configurehosts: add
          datacenter: 'vc.[1].datacenter.[1]'
          host: 'host.[2-4]'
          name: VDS-1-26724
          numuplinkports: 1
          vmnicadapter: 'host.[2-4].vmnic.[1]'
        '[2]':
          configurehosts: add
          datacenter: 'vc.[1].datacenter.[1]'
          host: 'host.[5]'
          name: VDS-2-26724
          numuplinkports: 1
          vmnicadapter: 'host.[5].vmnic.[1]'
  vm:
    '[1]':
      datastoreType: shared
      host: 'host.[2]'
      vmstate: poweroff
    '[2]':
      datastoreType: shared
      host: 'host.[3]'
      vmstate: poweroff
    '[3]':
      datastoreType: shared
      host: 'host.[4]'
      vmstate: poweroff
    '[4]':
      datastoreType: shared
      host: 'host.[5]'
      vmstate: poweroff
    '[5]':
      datastoreType: shared
      host: 'host.[2]'
      vmstate: poweroff
    '[6]':
      datastoreType: shared
      host: 'host.[3]'
      vmstate: poweroff
    '[7]':
      datastoreType: shared
      host: 'host.[4]'
      vmstate: poweroff
  vsm:
    '[1]':
      VDNCluster:
        '[1]':
          cluster: 'vc.[1].datacenter.[1].cluster.[2]'
          mtu: 1600
          switch: 'vc.[1].vds.[1]'
          teaming: &1
            - LOADBALANCE_SRCMAC
            - LOADBALANCE_SRCID
            - LOADBALANCE_LOADBASED
            - FAILOVER_ORDER
            - ETHER_CHANNEL
          vibs: install
          vlan:
            - 18
          vmkniccount: 1
        '[2]':
          cluster: 'vc.[1].datacenter.[1].cluster.[3]'
          mtu: 1600
          switch: 'vc.[1].vds.[1]'
          teaming: FAILOVER_ORDER
          vibs: install
          vlan: 18
          vmkniccount: 1
        '[3]':
          cluster: 'vc.[1].datacenter.[1].cluster.[4]'
          mtu: 1600
          switch: 'vc.[1].vds.[2]'
          teaming: FAILOVER_ORDER
          vibs: install
          vlan: 19
          vmkniccount: 1
      assignrole: enterprise_admin
      ippool:
        '[1]':
          gateway: x.x.x.x
          ipranges:
            - a.a.a.a-b.b.b.b
          name: AutoGenerate
          prefixlength: yy
      multicastiprange:
        '[1]':
          begin: 239.1.1.1
          end: 239.1.1.100
          name: AutoGenerate
      reconfigure: true
      segmentidrange:
        '[1]':
          begin: 10000
          end: 19000
          name: AutoGenerate
      vc: 'vc.[1]'
      vxlancontroller:
        '[1]':
          host: 'host.[1]'
          ippool: 'vsm.[1].ippool.[1]'
          name: AutoGenerate
          resourcepool: 'vc.[1].datacenter.[1].cluster.[1]'
TestcaseLevel: Functional
TestcaseType: Functional
Version: 2
WORKLOADS:
  AddVXLANRouteVM1:
    Testadapter: 'vm.[1].vnic.[1]'
    Type: NetAdapter
    gateway: 172.31.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddVXLANRouteVM2:
    Testadapter: 'vm.[2].vnic.[1]'
    Type: NetAdapter
    gateway: 172.32.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddVXLANRouteVM3:
    Testadapter: 'vm.[3].vnic.[1]'
    Type: NetAdapter
    gateway: 172.33.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddvNICsOnVM1:
    TestVM: 'vm.[1]'
    Type: VM
    vnic:
      '[1]':
        allowguestcontrol: 1
        connected: 1
        driver: vmxnet3
        portgroup: 'vsm.[1].networkscope.[1].virtualwire.[1]'
        startconnected: 1
  AddvNICsOnVM2:
    TestVM: 'vm.[2]'
    Type: VM
    vnic:
      '[1]':
        allowguestcontrol: 1
        connected: 1
        driver: vmxnet3
        portgroup: 'vsm.[1].networkscope.[1].virtualwire.[2]'
        startconnected: 1
  AddvNICsOnVM3:
    TestVM: 'vm.[3]'
    Type: VM
    vnic:
      '[1]':
        allowguestcontrol: 1
        connected: 1
        driver: vmxnet3
        portgroup: 'vsm.[1].networkscope.[1].virtualwire.[3]'
        startconnected: 1
  CreateNetworkScope:
    TestNSX: 'vsm.[1]'
    Type: NSX
    networkscope:
      '[1]':
        clusters: 'vc.[1].datacenter.[1].cluster.[2]'
        name: network-scope-1-26724
  CreateVLANLIF1:
    TestVM: 'vsm.[1].vse.[1]'
    Type: VM
    lif:
      '[1]':
        addressgroup:
          - addresstype: primary
            ipv4address: 172.16.1.1
            netmask: 255.255.0.0
        connected: 1
        name: lif-vlan1-26724
        portgroup: 'vc.[1].dvportgroup.[1]'
        type: internal
  CreateVLANLIF2:
    TestVM: 'vsm.[1].vse.[1]'
    Type: VM
    lif:
      '[2]':
        addressgroup:
          - addresstype: primary
            ipv4address: 172.17.1.1
            netmask: 255.255.0.0
        connected: 1
        name: lif-vlan2-26724
        portgroup: 'vc.[1].dvportgroup.[2]'
        type: internal
  CreateVLANLIF3:
    TestVM: 'vsm.[1].vse.[1]'
    Type: VM
    lif:
      '[3]':
        addressgroup:
          - addresstype: primary
            ipv4address: 172.18.1.1
            netmask: 255.255.0.0
        connected: 1
        name: lif-vlan3-26724
        portgroup: 'vc.[1].dvportgroup.[3]'
        type: internal
  CreateVXLANLIF1:
    TestVM: 'vsm.[1].vse.[1]'
    Type: VM
    lif:
      '[1]':
        addressgroup:
          - addresstype: primary
            ipv4address: 172.31.1.1
            netmask: 255.255.0.0
        connected: 1
        name: lif-vwire1-26724
        portgroup: 'vsm.[1].networkscope.[1].virtualwire.[1]'
        type: internal
  CreateVXLANLIF2:
    TestVM: 'vsm.[1].vse.[1]'
    Type: VM
    lif:
      '[2]':
        addressgroup:
          - addresstype: primary
            ipv4address: 172.32.1.1
            netmask: 255.255.0.0
        connected: 1
        name: lif-vwire2-26724
        portgroup: 'vsm.[1].networkscope.[1].virtualwire.[2]'
        type: internal
  CreateVXLANLIF3:
    TestVM: 'vsm.[1].vse.[1]'
    Type: VM
    lif:
      '[3]':
        addressgroup:
          - addresstype: primary
            ipv4address: 172.33.1.1
            netmask: 255.255.0.0
        connected: 1
        name: lif-vwire3-26724
        portgroup: 'vsm.[1].networkscope.[1].virtualwire.[3]'
        type: internal
  CreateVXLANLIF4:
    TestVM: 'vsm.[1].vse.[1]'
    Type: VM
    lif:
      '[4]':
        addressgroup:
          - addresstype: primary
            ipv4address: 172.34.1.1
            netmask: 255.255.0.0
        connected: 1
        name: lif-vwire4-26724
        portgroup: 'vsm.[1].networkscope.[1].virtualwire.[4]'
        type: internal
  CreateVirtualWires:
    TestTransportZone: 'vsm.[1].networkscope.[1]'
    Type: TransportZone
    VirtualWire:
      '[1]':
        controlplanemode: HYBRID_MODE
        name: AutoGenerate
        tenantid: AutoGenerate
      '[2]':
        controlplanemode: UNICAST_MODE
        name: AutoGenerate
        tenantid: AutoGenerate
      '[3]':
        controlplanemode: MULTICAST_MODE
        name: AutoGenerate
        tenantid: AutoGenerate
      '[4-8]':
        name: AutoGenerate
        tenantid: AutoGenerate
  DeleteAllControllers:
    TestNSX: 'vsm.[1]'
    Type: NSX
    deletevxlancontroller: 'vsm.[1].vxlancontroller.[-1]'
  DeleteEdge:
    TestNSX: 'vsm.[1]'
    Type: NSX
    deletevse: 'vsm.[1].vse.[-1]'
  DeleteNetworkScopes:
    TestNSX: 'vsm.[1]'
    Type: NSX
    deletenetworkscope: 'vsm.[1].networkscope.[-1]'
  Delete_All_VirtualWires:
    TestTransportZone: 'vsm.[1].networkscope.[-1]'
    Type: TransportZone
    deletevirtualwire: 'vsm.[1].networkscope.[-1].virtualwire.[-1]'
  DeployEdge:
    TestNSX: 'vsm.[1]'
    Type: NSX
    vse:
      '[1]':
        datacenter: 'vc.[1].datacenter.[1]'
        host: 'host.[4]'
        name: Edge-26724
        portgroup: 'vc.[1].dvportgroup.[1]'
        primaryaddress: 10.10.10.10
        resourcepool: 'vc.[1].datacenter.[1].cluster.[3]'
        subnetmask: 255.255.255.0
  DeployFirstController:
    TestNSX: 'vsm.[1]'
    Type: NSX
    vxlancontroller:
      '[1]':
        firstnodeofcluster: true
        host: 'host.[1]'
        ippool: 'vsm.[1].ippool.[1]'
        name: AutoGenerate
        resourcepool: 'vc.[1].datacenter.[1].cluster.[1]'
  DeploySecondController:
    TestNSX: 'vsm.[1]'
    Type: NSX
    vxlancontroller:
      '[2]':
        firstnodeofcluster: true
        host: 'host.[1]'
        ippool: 'vsm.[1].ippool.[1]'
        name: AutoGenerate
        resourcepool: 'vc.[1].datacenter.[1].cluster.[1]'
  DeployThirdController:
    TestNSX: 'vsm.[1]'
    Type: NSX
    vxlancontroller:
      '[3]':
        firstnodeofcluster: true
        host: 'host.[1]'
        ippool: 'vsm.[1].ippool.[1]'
        name: AutoGenerate
        resourcepool: 'vc.[1].datacenter.[1].cluster.[1]'
  ExitSequence:
    -
      - DeleteEdge
    -
      - RemovevNICFromVM1
      - RemovevNICFromVM2
      - RemovevNICFromVM3
    -
      - Delete_All_VirtualWires
    -
      - DeleteNetworkScopes
  Expand_TZ:
    TestTransportZone: 'vsm.[1].networkscope.[1]'
    Type: TransportZone
    clusters: 'vc.[1].datacenter.[1].cluster.[3]'
    transportzoneaction: expand
  InstallVibsConfigureVxlanClusterSFOVds1:
    TestNSX: 'vsm.[1]'
    Type: NSX
    VDNCluster:
      '[2]':
        cluster: 'vc.[1].datacenter.[1].cluster.[3]'
        mtu: 1600
        switch: 'vc.[1].vds.[1]'
        teaming: *1
        vibs: install
        vlan: 18
        vmkniccount: 1
  InstallVibsConfigureVxlanClusterSJCVds1:
    TestNSX: 'vsm.[1]'
    Type: NSX
    VDNCluster:
      '[1]':
        cluster: 'vc.[1].datacenter.[1].cluster.[2]'
        mtu: 1600
        switch: 'vc.[1].vds.[1]'
        teaming: *1
        vibs: install
        vlan: 18
        vmkniccount: 1
  MakeSurevNICConnectedVm1andVm2:
    Type: NetAdapter
    connected: 1
    reconfigure: true
    startconnected: 1
    testadapter:
      - 'vm.[1].vnic.[1]'
      - 'vm.[2].vnic.[1]'
  MakeSurevNICConnectedVm1andVm2andVm3:
    Type: NetAdapter
    connected: 1
    reconfigure: true
    startconnected: 1
    testadapter:
      - 'vm.[1].vnic.[1]'
      - 'vm.[2].vnic.[1]'
      - 'vm.[3].vnic.[1]'
  PingAllTest:
    NoofInbound: 1
    NoofOutbound: 1
    SupportAdapter: 'vm.[2].vnic.[1],vm.[3].vnic.[1]'
    TestAdapter: 'vm.[1].vnic.[1]'
    TestDuration: 60
    ToolName: Ping
    Type: Traffic
    maxtimeout: 128000
  PoweroffEdgeVM:
    TestVM: 'vsm.[1].vse.[1]'
    Type: VM
    vmstate: poweroff
  PoweronEdgeVM:
    TestVM: 'vsm.[1].vse.[1]'
    Type: VM
    vmstate: poweron
  PoweronVM1:
    TestVM: 'vm.[1]'
    Type: VM
    vmstate: poweron
  PoweronVM2:
    TestVM: 'vm.[2]'
    Type: VM
    vmstate: poweron
  PoweronVM3:
    TestVM: 'vm.[3]'
    Type: VM
    vmstate: poweron
  RebootEdgeVM:
    TestVM: 'vsm.[1].vse.[1]'
    Type: VM
    vmstate: reboot
  RebootHost:
    TestHost: 'host.[1]'
    Type: Host
    reboot: yes
  RebootHost2:
    TestHost: 'host.[2]'
    Type: Host
    reboot: yes
  RebootHost3:
    TestHost: 'host.[3]'
    Type: Host
    reboot: yes
  RebootHost4:
    TestHost: 'host.[4]'
    Type: Host
    reboot: yes
  RebootHost5:
    TestHost: 'host.[5]'
    Type: Host
    reboot: yes
  RemovevNICFromVM1:
    TestVM: 'vm.[1]'
    Type: VM
    deletevnic: 'vm.[1].vnic.[1]'
  RemovevNICFromVM2:
    TestVM: 'vm.[2]'
    Type: VM
    deletevnic: 'vm.[2].vnic.[1]'
  RemovevNICFromVM3:
    TestVM: 'vm.[3]'
    Type: VM
    deletevnic: 'vm.[3].vnic.[1]'
  ResetEdgeVM:
    TestVM: 'vsm.[1].vse.[1]'
    Type: VM
    vmstate: reset
  ResumeEdgeVM:
    TestVM: 'vsm.[1].vse.[1]'
    Type: VM
    vmstate: resume
  Sequence:
    -
      - CreateNetworkScope
    -
      - CreateVirtualWires
    -
      - DeployEdge
    -
      - CreateVXLANLIF1
    -
      - CreateVXLANLIF2
    -
      - PoweronVM1
      - PoweronVM2
    -
      - AddvNICsOnVM1
    -
      - AddvNICsOnVM2
    -
      - MakeSurevNICConnectedVm1andVm2
    -
      - SetVXLANIPVM1
      - SetVXLANIPVM2DifferentvWire
    -
      - AddVXLANRouteVM1
      - AddVXLANRouteVM2
    -
      - Expand_TZ
    -
      - CreateVXLANLIF3
    -
      - PoweronVM3
    -
      - AddvNICsOnVM3
    -
      - MakeSurevNICConnectedVm1andVm2andVm3
    -
      - SetVXLANIPVM3DifferentvWire
    -
      - AddVXLANRouteVM3
    -
      - PingAllTest
    -
      - RebootEdgeVM
    -
      - PingAllTest
    -
      - ResetEdgeVM
    -
      - PingAllTest
    -
      - PoweroffEdgeVM
    -
      - PingAllTest
    -
      - PoweronEdgeVM
    -
      - PingAllTest
    -
      - SuspendEdgeVM
    -
      - PingAllTest
    -
      - ResumeEdgeVM
    -
      - PingAllTest
    -
      - DeleteEdge
    -
      - DeployEdge
    -
      - CreateVXLANLIF1
    -
      - CreateVXLANLIF2
    -
      - CreateVXLANLIF3
    -
      - PingAllTest
  SetMulticastRange:
    Multicastiprange:
      '[1]':
        begin: 239.0.0.101
        end: 239.254.254.254
        name: AutoGenerate
    TestNSX: 'vsm.[1]'
    Type: NSX
  SetSegmentIDRange:
    TestNSX: 'vsm.[1]'
    Type: NSX
    segmentidrange:
      '[1]':
        begin: 5001-10001
        end: 99000
        name: AutoGenerate
  SetVXLANIPVM1:
    Testadapter: 'vm.[1].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.31.1.5
    netmask: 255.255.0.0
  SetVXLANIPVM2DifferentvWire:
    Testadapter: 'vm.[2].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.32.1.5
    netmask: 255.255.0.0
  SetVXLANIPVM3DifferentvWire:
    Testadapter: 'vm.[3].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.33.1.5
    netmask: 255.255.0.0
  SuspendEdgeVM:
    TestVM: 'vsm.[1].vse.[1]'
    Type: VM
    vmstate: suspend
  Uninstall_VDNCluster:
    TestNSX: 'vsm.[1]'
    Type: NSX
    deletevdncluster: 'vsm.[1].vdncluster.[-1]'
---
Category: NSX
Component: network vDR
Summary: Fast switching of port groups of the VM on different hosts and verify data traffic
Tags: RunOnCAT
TestName: FastSwitchingofVMBackingFloodPing_DifferentHost
TestbedSpec:
  host:
    '[1]': {}
    '[2-4]':
      vmnic:
        '[1-2]':
          driver: any
  vc:
    '[1]':
      datacenter:
        '[1]':
          Cluster:
            '[1]':
              host: 'host.[1]'
              name: Controller-Cluster-26724
            '[2]':
              host: 'host.[2-3]'
              name: Compute-Cluster-26724
            '[3]':
              host: 'host.[4]'
              name: Compute-Cluster2-26724
      dvportgroup:
        '[1]':
          name: dvpg-mgmt-26724
          vds: 'vc.[1].vds.[1]'
        '[2]':
          name: dvpg-vlan16-26724
          vds: 'vc.[1].vds.[1]'
          vlan: 16
          vlantype: access
        '[3]':
          name: dvpg-vlan17-26724
          vds: 'vc.[1].vds.[1]'
          vlan: 17
          vlantype: access
        '[4]':
          name: dvpg-vlan21-26724
          vds: 'vc.[1].vds.[1]'
          vlan: 21
          vlantype: access
      vds:
        '[1]':
          configurehosts: add
          datacenter: 'vc.[1].datacenter.[1]'
          host: 'host.[2-4]'
          numuplinkports: 1
          vmnicadapter: 'host.[2-4].vmnic.[1]'
  vm:
    '[1-2]':
      datastoreType: shared
      host: 'host.[2]'
      vmstate: poweroff
    '[3]':
      datastoreType: shared
      host: 'host.[3]'
      vmstate: poweroff
  vsm:
    '[1]':
      VDNCluster:
        '[1]':
          cluster: 'vc.[1].datacenter.[1].cluster.[2]'
          mtu: 1600
          switch: 'vc.[1].vds.[1]'
          teaming: &1
            - LOADBALANCE_SRCMAC
            - LOADBALANCE_SRCID
            - LOADBALANCE_LOADBASED
            - FAILOVER_ORDER
            - ETHER_CHANNEL
          vibs: install
          vlan:
            - 21
          vmkniccount: 1
      assignrole: enterprise_admin
      ippool:
        '[1]':
          gateway: x.x.x.x
          ipranges:
            - a.a.a.a-b.b.b.b
          name: AutoGenerate
          prefixlength: yy
      multicastiprange:
        '[1]':
          begin: 239.1.1.1
          end: 239.1.1.100
          name: AutoGenerate
      reconfigure: true
      segmentidrange:
        '[1]':
          begin: 10000
          end: 19000
          name: AutoGenerate
      vc: 'vc.[1]'
      vxlancontroller:
        '[1]':
          host: 'host.[1]'
          ippool: 'vsm.[1].ippool.[1]'
          name: AutoGenerate
          resourcepool: 'vc.[1].datacenter.[1].cluster.[1]'
        '[2]':
          host: 'host.[1]'
          ippool: 'vsm.[1].ippool.[1]'
          name: AutoGenerate
          resourcepool: 'vc.[1].datacenter.[1].cluster.[1]'
        '[3]':
          host: 'host.[1]'
          ippool: 'vsm.[1].ippool.[1]'
          name: AutoGenerate
          resourcepool: 'vc.[1].datacenter.[1].cluster.[1]'
Version: 2
WORKLOADS:
  AddVLANRouteVM1:
    Testadapter: 'vm.[1].vnic.[1]'
    Type: NetAdapter
    gateway: 172.16.1.1
    netmask: 255.255.0.0
    network: '172.17.0.0,172.31.0.0,172.32.0.0'
    route: add
  AddVLANRouteVM2:
    Testadapter: 'vm.[2].vnic.[1]'
    Type: NetAdapter
    gateway: 172.17.1.1
    netmask: 255.255.0.0
    network: '172.16.0.0,172.31.0.0,172.32.0.0'
    route: add
  AddVLANRouteVM3:
    Testadapter: 'vm.[3].vnic.[1]'
    Type: NetAdapter
    gateway: 172.17.1.1
    netmask: 255.255.0.0
    network: '172.16.0.0,172.31.0.0,172.32.0.0'
    route: add
  AddVXLANRouteVM1:
    Testadapter: 'vm.[1].vnic.[1]'
    Type: NetAdapter
    gateway: 172.31.1.1
    netmask: 255.255.0.0
    network: '172.32.0.0,172.16.0.0,172.17.0.0'
    route: add
  AddVXLANRouteVM2:
    Testadapter: 'vm.[2].vnic.[1]'
    Type: NetAdapter
    gateway: 172.32.1.1
    netmask: 255.255.0.0
    network: '172.31.0.0,172.16.0.0,172.17.0.0'
    route: add
  AddVXLANRouteVM3:
    Testadapter: 'vm.[3].vnic.[1]'
    Type: NetAdapter
    gateway: 172.32.1.1
    netmask: 255.255.0.0
    network: '172.31.0.0,172.16.0.0,172.17.0.0'
    route: add
  AddvNICsOnVMs:
    TestVM: 'vm.[1],vm.[2],vm.[3]'
    Type: VM
    vnic:
      '[1]':
        allowguestcontrol: 1
        connected: 1
        driver: vmxnet3
        portgroup: 'vsm.[1].networkscope.[1].virtualwire.[1]'
        startconnected: 1
  BridgevWire3ToVLAN21:
    TestVM: 'vsm.[1].vse.[1]'
    Type: VM
    bridge:
      '[1]':
        name: bridge-1-26724
        portgroup: 'vc.[1].dvportgroup.[4]'
        virtualwire: 'vsm.[1].networkscope.[1].virtualwire.[3]'
  CreateNetworkScope:
    TestNSX: 'vsm.[1]'
    Type: NSX
    networkscope:
      '[1]':
        clusters: 'vc.[1].datacenter.[1].cluster.[2]'
        name: network-scope-1-26724
  CreateVLANLIF3:
    TestVM: 'vsm.[1].vse.[1]'
    Type: VM
    lif:
      '[3]':
        addressgroup:
          - addresstype: primary
            ipv4address: 172.16.1.1
            netmask: 255.255.0.0
        connected: 1
        name: lif-16-26724
        portgroup: 'vc.[1].dvportgroup.[2]'
        type: internal
  CreateVLANLIF4:
    TestVM: 'vsm.[1].vse.[1]'
    Type: VM
    lif:
      '[4]':
        addressgroup:
          - addresstype: primary
            ipv4address: 172.17.1.1
            netmask: 255.255.0.0
        connected: 1
        name: lif-17-26724
        portgroup: 'vc.[1].dvportgroup.[3]'
        type: internal
  CreateVXLANLIF1:
    TestVM: 'vsm.[1].vse.[1]'
    Type: VM
    lif:
      '[1]':
        addressgroup:
          - addresstype: primary
            ipv4address: 172.31.1.1
            netmask: 255.255.0.0
        connected: 1
        name: lif-vwire1-26724
        portgroup: 'vsm.[1].networkscope.[1].virtualwire.[1]'
        type: internal
  CreateVXLANLIF2:
    TestVM: 'vsm.[1].vse.[1]'
    Type: VM
    lif:
      '[2]':
        addressgroup:
          - addresstype: primary
            ipv4address: 172.32.1.1
            netmask: 255.255.0.0
        connected: 1
        name: lif-vwire2-26724
        portgroup: 'vsm.[1].networkscope.[1].virtualwire.[2]'
        type: internal
  CreateVirtualWires:
    TestTransportZone: 'vsm.[1].networkscope.[1]'
    Type: TransportZone
    VirtualWire:
      '[1]':
        controlplanemode: HYBRID_MODE
        name: AutoGenerate
        tenantid: AutoGenerate
      '[2]':
        controlplanemode: UNICAST_MODE
        name: AutoGenerate
        tenantid: AutoGenerate
      '[3]':
        controlplanemode: MULTICAST_MODE
        name: AutoGenerate
        tenantid: AutoGenerate
      '[4-8]':
        name: AutoGenerate
        tenantid: AutoGenerate
  DeleteController:
    TestNSX: 'vsm.[1]'
    Type: NSX
    deletevxlancontroller: 'vsm.[1].vxlancontroller.[-1]'
  DeleteEdges:
    TestNSX: 'vsm.[1]'
    Type: NSX
    deletevse: 'vsm.[1].vse.[-1]'
  DeleteIPPool:
    TestNSX: 'vsm.[1]'
    Type: NSX
    deleteippool: 'vsm.[1].ippool.[1]'
    sleepbetweenworkloads: 10
  DeleteNetworkScope: &2
    TestNSX: 'vsm.[1]'
    Type: NSX
    deletenetworkscope: 'vsm.[1].networkscope.[-1]'
  DeleteNetworkScopes: *2
  DeleteVirtualWires:
    TestTransportZone: 'vsm.[1].networkscope.[1]'
    Type: TransportZone
    deletevirtualwire: 'vsm.[1].networkscope.[1].virtualwire.[1-3]'
  Delete_All_VirtualWires:
    TestTransportZone: 'vsm.[1].networkscope.[-1]'
    Type: TransportZone
    deletevirtualwire: 'vsm.[1].networkscope.[-1].virtualwire.[-1]'
  Deploy2ndController:
    TestNSX: 'vsm.[1]'
    Type: NSX
    vxlancontroller:
      '[2]':
        host: 'host.[1]'
        ippool: 'vsm.[1].ippool.[1]'
        name: AutoGenerate
        resourcepool: 'vc.[1].datacenter.[1].cluster.[1]'
  Deploy3rdController:
    TestNSX: 'vsm.[1]'
    Type: NSX
    vxlancontroller:
      '[3]':
        host: 'host.[1]'
        ippool: 'vsm.[1].ippool.[1]'
        name: AutoGenerate
        resourcepool: 'vc.[1].datacenter.[1].cluster.[1]'
  DeployEdge:
    TestNSX: 'vsm.[1]'
    Type: NSX
    vse:
      '[1]':
        datacenter: 'vc.[1].datacenter.[1]'
        host: 'host.[2]'
        name: Edge-26724
        portgroup: 'vc.[1].dvportgroup.[1]'
        primaryaddress: 10.10.10.19
        resourcepool: 'vc.[1].datacenter.[1].cluster.[2]'
        subnetmask: 255.255.255.0
  DeployFirstController:
    TestNSX: 'vsm.[1]'
    Type: NSX
    vxlancontroller:
      '[1]':
        firstnodeofcluster: true
        host: 'host.[1]'
        ippool: 'vsm.[1].ippool.[1]'
        name: AutoGenerate
        resourcepool: 'vc.[1].datacenter.[1].cluster.[1]'
  ExitSequence:
    -
      - DeleteEdges
    -
      - RemovevNICFromVM1
      - RemovevNICFromVM2
      - RemovevNICFromVM3
    -
      - Delete_All_VirtualWires
    -
      - DeleteNetworkScopes
  Install_Configure_ClusterSJC:
    TestNSX: 'vsm.[1]'
    Type: NSX
    VDNCluster:
      '[1]':
        cluster: 'vc.[1].datacenter.[1].cluster.[2]'
        mtu: 1600
        switch: 'vc.[1].vds.[1]'
        teaming: *1
        vibs: install
        vlan:
          - 21
        vmkniccount: 1
  MakeSurevNICConnected:
    Type: NetAdapter
    connected: 1
    reconfigure: true
    startconnected: 1
    testadapter: 'vm.[1-2].vnic.[1]'
  MoveHostsToClusterSFO:
    MoveHostsToCluster: 'host.[4],host.[5]'
    TestCluster: 'vc.[1].datacenter.[1].cluster.[3]'
    Type: Cluster
  PingTest:
    NoofInbound: 1
    NoofOutbound: 1
    ParallelSession: yes
    Routingscheme: flood
    SupportAdapter: 'vm.[2].vnic.[1]'
    TestAdapter: 'vm.[1].vnic.[1]'
    TestDuration: 5
    ToolName: Ping
    Type: Traffic
    connectivitytest: 0
    maxtimeout: 128000
  PingTestDifferentHost:
    NoofInbound: 1
    NoofOutbound: 1
    Routingscheme: 'unicast,flood'
    SupportAdapter: 'vm.[3].vnic.[1]'
    TestAdapter: 'vm.[1].vnic.[1]'
    TestDuration: 6
    ToolName: Ping
    Type: Traffic
    maxtimeout: 128000
  PingTestDifferentHostWhileSwitching:
    ExpectedResult: ignore
    NoofInbound: 1
    NoofOutbound: 1
    ParallelSession: yes
    Routingscheme: 'flood,unicast'
    SupportAdapter: 'vm.[3].vnic.[1]'
    TestAdapter: 'vm.[1].vnic.[1]'
    TestDuration: 6
    ToolName: Ping
    Type: Traffic
    connectivitytest: 0
    maxtimeout: 128000
  PingTestWhileSwitching:
    ExpectedResult: ignore
    NoofInbound: 1
    NoofOutbound: 1
    ParallelSession: yes
    Routingscheme: 'flood,unicast'
    SupportAdapter: 'vm.[2].vnic.[1]'
    TestAdapter: 'vm.[1].vnic.[1]'
    TestDuration: 6
    ToolName: Ping
    Type: Traffic
    connectivitytest: 0
    maxtimeout: 128000
  PlaceVM1OnVLAN16:
    Type: NetAdapter
    portgroup: 'vc.[1].dvportgroup.[2]'
    reconfigure: true
    testadapter: 'vm.[1].vnic.[1]'
  PlaceVM1OnvWire1:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[1]'
    reconfigure: true
    testadapter: 'vm.[1].vnic.[1]'
  PlaceVM1OnvWire3:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[3]'
    reconfigure: true
    testadapter: 'vm.[1].vnic.[1]'
  PlaceVM2OnVLAN17:
    Type: NetAdapter
    portgroup: 'vc.[1].dvportgroup.[3]'
    reconfigure: true
    testadapter: 'vm.[2].vnic.[1]'
  PlaceVM2OnVLAN21:
    Type: NetAdapter
    portgroup: 'vc.[1].dvportgroup.[4]'
    reconfigure: true
    testadapter: 'vm.[2].vnic.[1]'
  PlaceVM2OnvWire2:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[2]'
    reconfigure: true
    testadapter: 'vm.[2].vnic.[1]'
  PlaceVM3OnVLAN17:
    Type: NetAdapter
    portgroup: 'vc.[1].dvportgroup.[3]'
    reconfigure: true
    testadapter: 'vm.[3].vnic.[1]'
  PlaceVM3OnVLAN21:
    Type: NetAdapter
    portgroup: 'vc.[1].dvportgroup.[4]'
    reconfigure: true
    testadapter: 'vm.[3].vnic.[1]'
  PlaceVM3OnvWire1:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[1]'
    reconfigure: true
    testadapter: 'vm.[3].vnic.[1]'
  PlaceVM3OnvWire2:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[2]'
    reconfigure: true
    testadapter: 'vm.[3].vnic.[1]'
  PlaceVM3OnvWire3:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[3]'
    reconfigure: true
    testadapter: 'vm.[3].vnic.[1]'
  PlaceVMsOnMgmtdvPG:
    Type: NetAdapter
    portgroup: 'vc.[1].dvportgroup.[1]'
    reconfigure: true
    testadapter: 'vm.[1-3].vnic.[1]'
  PoweroffVM1:
    TestVM: 'vm.[1]'
    Type: VM
    vmstate: poweroff
  PoweroffVM2:
    TestVM: 'vm.[2]'
    Type: VM
    vmstate: poweroff
  PoweroffVM3:
    TestVM: 'vm.[3]'
    Type: VM
    vmstate: poweroff
  PoweroffVM4:
    TestVM: 'vm.[4]'
    Type: VM
    vmstate: poweroff
  PoweronVM1:
    TestVM: 'vm.[1]'
    Type: VM
    vmstate: poweron
  PoweronVM2:
    TestVM: 'vm.[2]'
    Type: VM
    vmstate: poweron
  PoweronVM3:
    TestVM: 'vm.[3]'
    Type: VM
    vmstate: poweron
  RebootHost:
    TestHost: 'host.[1]'
    Type: Host
    reboot: yes
  RebootHost2:
    TestHost: 'host.[2]'
    Type: Host
    reboot: yes
  RebootHost3:
    TestHost: 'host.[3]'
    Type: Host
    reboot: yes
  RemovevNICFromVM1:
    TestVM: 'vm.[1]'
    Type: VM
    deletevnic: 'vm.[1].vnic.[1]'
  RemovevNICFromVM2:
    TestVM: 'vm.[2]'
    Type: VM
    deletevnic: 'vm.[2].vnic.[1]'
  RemovevNICFromVM3:
    TestVM: 'vm.[3]'
    Type: VM
    deletevnic: 'vm.[3].vnic.[1]'
  Sequence:
    -
      - CreateNetworkScope
    -
      - CreateVirtualWires
    -
      - DeployEdge
    -
      - CreateVXLANLIF1
    -
      - CreateVXLANLIF2
    -
      - CreateVLANLIF3
    -
      - CreateVLANLIF4
    -
      - PoweronVM3
    -
      - PoweronVM1
    -
      - AddvNICsOnVMs
    -
      - PlaceVM1OnvWire1
      - PlaceVM3OnvWire1
    -
      - SetVXLANIPVM1
      - SetVXLANIPVM3SamevWire
    -
      - PingTestDifferentHost
    -
      - PlaceVM1OnvWire1
      - PlaceVM3OnvWire2
    -
      - SetVXLANIPVM1
      - SetVXLANIPVM3
    -
      - AddVXLANRouteVM1
      - AddVXLANRouteVM3
    -
      - PingTestDifferentHostWhileSwitching
      - SwitchVM1BackingVeryFast
    -
      - PoweroffVM1
    -
      - PoweronVM1
    -
      - PlaceVM1OnVLAN16
      - PlaceVM3OnVLAN17
    -
      - SetVLANIPVM1
      - SetVLANIPVM3
    -
      - AddVLANRouteVM1
      - AddVLANRouteVM3
    -
      - PingTestDifferentHostWhileSwitching
      - SwitchVM1BackingVeryFast
    -
      - PoweroffVM1
    -
      - PoweronVM1
    -
      - PlaceVM1OnvWire3
    -
      - PlaceVM3OnVLAN21
    -
      - SetVXLANBridgeIPVM1
      - SetVLANBridgeIPVM3
    -
      - PingTestDifferentHostWhileSwitching
      - SwitchVM1BackingVeryFast
    -
      - PoweroffVM1
    -
      - PoweronVM1
    -
      - PlaceVM1OnvWire1
      - PlaceVM3OnvWire2
    -
      - SetVXLANIPVM1
      - SetVXLANIPVM3
    -
      - AddVXLANRouteVM1
      - AddVXLANRouteVM3
    -
      - PingTestDifferentHost
  SetMulticastRange:
    Multicastiprange:
      '[1]':
        begin: 239.0.0.101
        end: 239.254.254.254
        name: AutoGenerate
    TestNSX: 'vsm.[1]'
    Type: NSX
  SetSegmentIDRange:
    TestNSX: 'vsm.[1]'
    Type: NSX
    segmentidrange:
      '[1]':
        begin: 5001-10001
        end: 99000
        name: AutoGenerate
  SetVLANBridgeIPVM2:
    Testadapter: 'vm.[2].vnic.[1]'
    Type: NetAdapter
    ipv4: dhcp
  SetVLANBridgeIPVM3:
    Testadapter: 'vm.[3].vnic.[1]'
    Type: NetAdapter
    ipv4: dhcp
  SetVLANIPVM1:
    Testadapter: 'vm.[1].vnic.[1]'
    Type: NetAdapter
    ipv4: dhcp
  SetVLANIPVM2:
    Testadapter: 'vm.[2].vnic.[1]'
    Type: NetAdapter
    ipv4: dhcp
  SetVLANIPVM3:
    Testadapter: 'vm.[3].vnic.[1]'
    Type: NetAdapter
    ipv4: dhcp
  SetVXLANBridgeIPVM1:
    Testadapter: 'vm.[1].vnic.[1]'
    Type: NetAdapter
    ipv4: dhcp
  SetVXLANIPVM1:
    Testadapter: 'vm.[1].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.31.1.5
    netmask: 255.255.0.0
  SetVXLANIPVM2:
    Testadapter: 'vm.[2].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.32.1.5
    netmask: 255.255.0.0
  SetVXLANIPVM2SamevWire:
    Testadapter: 'vm.[2].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.31.1.6
    netmask: 255.255.0.0
  SetVXLANIPVM3:
    Testadapter: 'vm.[3].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.32.1.5
    netmask: 255.255.0.0
  SetVXLANIPVM3SamevWire:
    Testadapter: 'vm.[3].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.31.1.15
    netmask: 255.255.0.0
  SwitchVM1BackingVeryFast:
    Iterations: 1
    SleepBetweenCombos: 10
    Type: NetAdapter
    maxtimeout: 12800
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[1],vc.[1].dvportgroup.[4],vsm.[1].networkscope.[1].virtualwire.[1]'
    reconfigure: true
    testadapter: 'vm.[1].vnic.[1]'
  UnconfigureVXLAN:
    Type: Cluster
    testcluster: 'vsm.[1].vdncluster.[1]'
    vxlan: unconfigure
  Uninstall_VDNCluster:
    TestNSX: 'vsm.[1]'
    Type: NSX
    deletevdncluster: 'vsm.[1].vdncluster.[-1]'
---
Category: NSX
Component: network vDR
Summary: 'This is the vdr datapath sanity testcase for different hosts '
Tags: RunOnCAT
TestName: JumboSanityTest_DifferentHost
TestbedSpec:
  host:
    '[1]': {}
    '[2-4]':
      vmnic:
        '[1-2]':
          driver: any
  vc:
    '[1]':
      datacenter:
        '[1]':
          Cluster:
            '[1]':
              host: 'host.[1]'
              name: Controller-Cluster-26724
            '[2]':
              host: 'host.[2-3]'
              name: Compute-Cluster-26724
            '[3]':
              host: 'host.[4]'
              name: Compute-Cluster2-26724
      dvportgroup:
        '[1]':
          name: dvpg-mgmt-26724
          vds: 'vc.[1].vds.[1]'
        '[2]':
          name: dvpg-vlan16-26724
          vds: 'vc.[1].vds.[1]'
          vlan: 16
          vlantype: access
        '[3]':
          name: dvpg-vlan17-26724
          vds: 'vc.[1].vds.[1]'
          vlan: 17
          vlantype: access
        '[4]':
          name: dvpg-vlan21-26724
          vds: 'vc.[1].vds.[1]'
          vlan: 21
          vlantype: access
      vds:
        '[1]':
          configurehosts: add
          datacenter: 'vc.[1].datacenter.[1]'
          host: 'host.[2-4]'
          numuplinkports: 1
          vmnicadapter: 'host.[2-4].vmnic.[1]'
  vm:
    '[1-2]':
      datastoreType: shared
      host: 'host.[2]'
      vmstate: poweroff
    '[3]':
      datastoreType: shared
      host: 'host.[3]'
      vmstate: poweroff
  vsm:
    '[1]':
      VDNCluster:
        '[1]':
          cluster: 'vc.[1].datacenter.[1].cluster.[2]'
          mtu: 1600
          switch: 'vc.[1].vds.[1]'
          teaming: &1
            - LOADBALANCE_SRCMAC
            - LOADBALANCE_SRCID
            - LOADBALANCE_LOADBASED
            - FAILOVER_ORDER
            - ETHER_CHANNEL
          vibs: install
          vlan:
            - 21
          vmkniccount: 1
      assignrole: enterprise_admin
      ippool:
        '[1]':
          gateway: x.x.x.x
          ipranges:
            - a.a.a.a-b.b.b.b
          name: AutoGenerate
          prefixlength: yy
      multicastiprange:
        '[1]':
          begin: 239.1.1.1
          end: 239.1.1.100
          name: AutoGenerate
      reconfigure: true
      segmentidrange:
        '[1]':
          begin: 10000
          end: 19000
          name: AutoGenerate
      vc: 'vc.[1]'
      vxlancontroller:
        '[1]':
          host: 'host.[1]'
          ippool: 'vsm.[1].ippool.[1]'
          name: AutoGenerate
          resourcepool: 'vc.[1].datacenter.[1].cluster.[1]'
        '[2]':
          host: 'host.[1]'
          ippool: 'vsm.[1].ippool.[1]'
          name: AutoGenerate
          resourcepool: 'vc.[1].datacenter.[1].cluster.[1]'
        '[3]':
          host: 'host.[1]'
          ippool: 'vsm.[1].ippool.[1]'
          name: AutoGenerate
          resourcepool: 'vc.[1].datacenter.[1].cluster.[1]'
Version: 2
WORKLOADS:
  AddVLANRouteVM1:
    Testadapter: 'vm.[1].vnic.[1]'
    Type: NetAdapter
    gateway: 172.16.1.1
    netmask: 255.255.0.0
    network: '172.17.0.0,172.31.0.0,172.32.0.0'
    route: add
  AddVLANRouteVM2:
    Testadapter: 'vm.[2].vnic.[1]'
    Type: NetAdapter
    gateway: 172.17.1.1
    netmask: 255.255.0.0
    network: '172.16.0.0,172.31.0.0,172.32.0.0'
    route: add
  AddVLANRouteVM3:
    Testadapter: 'vm.[3].vnic.[1]'
    Type: NetAdapter
    gateway: 172.17.1.1
    netmask: 255.255.0.0
    network: '172.16.0.0,172.31.0.0,172.32.0.0'
    route: add
  AddVXLANRouteVM1:
    Testadapter: 'vm.[1].vnic.[1]'
    Type: NetAdapter
    gateway: 172.31.1.1
    netmask: 255.255.0.0
    network: '172.32.0.0,172.16.0.0,172.17.0.0'
    route: add
  AddVXLANRouteVM2:
    Testadapter: 'vm.[2].vnic.[1]'
    Type: NetAdapter
    gateway: 172.32.1.1
    netmask: 255.255.0.0
    network: '172.31.0.0,172.16.0.0,172.17.0.0'
    route: add
  AddVXLANRouteVM3:
    Testadapter: 'vm.[3].vnic.[1]'
    Type: NetAdapter
    gateway: 172.32.1.1
    netmask: 255.255.0.0
    network: '172.31.0.0,172.16.0.0,172.17.0.0'
    route: add
  AddvNICsOnVMs:
    TestVM: 'vm.[1],vm.[2],vm.[3]'
    Type: VM
    vnic:
      '[1]':
        allowguestcontrol: 1
        connected: 1
        driver: vmxnet3
        portgroup: 'vsm.[1].networkscope.[1].virtualwire.[1]'
        startconnected: 1
  BridgevWire3ToVLAN21:
    TestVM: 'vsm.[1].vse.[1]'
    Type: VM
    bridge:
      '[1]':
        name: bridge-1-26724
        portgroup: 'vc.[1].dvportgroup.[4]'
        virtualwire: 'vsm.[1].networkscope.[1].virtualwire.[3]'
  CreateNetworkScope:
    TestNSX: 'vsm.[1]'
    Type: NSX
    networkscope:
      '[1]':
        clusters: 'vc.[1].datacenter.[1].cluster.[2]'
        name: network-scope-1-26724
  CreateVLANLIF3:
    TestVM: 'vsm.[1].vse.[1]'
    Type: VM
    lif:
      '[3]':
        addressgroup:
          - addresstype: primary
            ipv4address: 172.16.1.1
            netmask: 255.255.0.0
        connected: 1
        name: lif-16-26724
        portgroup: 'vc.[1].dvportgroup.[2]'
        type: internal
  CreateVLANLIF4:
    TestVM: 'vsm.[1].vse.[1]'
    Type: VM
    lif:
      '[4]':
        addressgroup:
          - addresstype: primary
            ipv4address: 172.17.1.1
            netmask: 255.255.0.0
        connected: 1
        name: lif-17-26724
        portgroup: 'vc.[1].dvportgroup.[3]'
        type: internal
  CreateVXLANLIF1:
    TestVM: 'vsm.[1].vse.[1]'
    Type: VM
    lif:
      '[1]':
        addressgroup:
          - addresstype: primary
            ipv4address: 172.31.1.1
            netmask: 255.255.0.0
        connected: 1
        name: lif-vwire1-26724
        portgroup: 'vsm.[1].networkscope.[1].virtualwire.[1]'
        type: internal
  CreateVXLANLIF2:
    TestVM: 'vsm.[1].vse.[1]'
    Type: VM
    lif:
      '[2]':
        addressgroup:
          - addresstype: primary
            ipv4address: 172.32.1.1
            netmask: 255.255.0.0
        connected: 1
        name: lif-vwire2-26724
        portgroup: 'vsm.[1].networkscope.[1].virtualwire.[2]'
        type: internal
  CreateVirtualWires:
    TestTransportZone: 'vsm.[1].networkscope.[1]'
    Type: TransportZone
    VirtualWire:
      '[1]':
        name: AutoGenerate
        tenantid: 1
      '[2]':
        name: AutoGenerate
        tenantid: 2
      '[3]':
        name: AutoGenerate
        tenantid: 3
  DeleteController:
    TestNSX: 'vsm.[1]'
    Type: NSX
    deletevxlancontroller: 'vsm.[1].vxlancontroller.[-1]'
  DeleteEdges:
    TestNSX: 'vsm.[1]'
    Type: NSX
    deletevse: 'vsm.[1].vse.[-1]'
  DeleteNetworkScope:
    TestNSX: 'vsm.[1]'
    Type: NSX
    deletenetworkscope: 'vsm.[1].networkscope.[-1]'
  DeleteVirtualWires:
    TestTransportZone: 'vsm.[1].networkscope.[1]'
    Type: TransportZone
    deletevirtualwire: 'vsm.[1].networkscope.[1].virtualwire.[1-3]'
  Delete_All_VirtualWires:
    TestTransportZone: 'vsm.[1].networkscope.[-1]'
    Type: TransportZone
    deletevirtualwire: 'vsm.[1].networkscope.[-1].virtualwire.[-1]'
  DeployEdge:
    TestNSX: 'vsm.[1]'
    Type: NSX
    vse:
      '[1]':
        datacenter: 'vc.[1].datacenter.[1]'
        host: 'host.[3]'
        name: Edge-26724
        portgroup: 'vc.[1].dvportgroup.[1]'
        primaryaddress: 10.10.10.11
        resourcepool: 'vc.[1].datacenter.[1].cluster.[2]'
        subnetmask: 255.255.255.0
  DeployFirstController:
    TestNSX: 'vsm.[1]'
    Type: NSX
    vxlancontroller:
      '[1]':
        firstnodeofcluster: true
        host: 'host.[1]'
        ippool: 'vsm.[1].ippool.[1]'
        name: AutoGenerate
        resourcepool: 'vc.[1].datacenter.[1].cluster.[1]'
  ExitSequence:
    -
      - DeleteEdges
    -
      - RemovevNICFromVM1
    -
      - RemovevNICFromVM2
    -
      - RemovevNICFromVM3
    -
      - Delete_All_VirtualWires
    -
      - DeleteNetworkScope
  Expand_TZ:
    TestTransportZone: 'vsm.[1].networkscope.[1]'
    Type: TransportZone
    clusters: 'vc.[1].datacenter.[1].cluster.[3]'
    transportzoneaction: expand
  GetVirtualWireID:
    FindType: Switch
    Type: Switch
    testvirtualwire: 'vsm.[1].networkscope.[1].virtualwire.[1]'
  Install_Config_ClusterSJC:
    TestNSX: 'vsm.[1]'
    Type: NSX
    VDNCluster:
      '[1]':
        cluster: 'vc.[1].datacenter.[1].cluster.[2]'
        mtu: 1600
        switch: 'vc.[1].vds.[1]'
        teaming: *1
        vibs: install
        vlan:
          - 21
        vmkniccount: 1
  Install_Config_ClusterSJC2:
    TestNSX: 'vsm.[1]'
    Type: NSX
    VDNCluster:
      '[2]':
        cluster: 'vc.[1].datacenter.[1].cluster.[3]'
        mtu: 1600
        switch: 'vc.[1].vds.[1]'
        teaming: *1
        vibs: install
        vlan:
          - 21
        vmkniccount: 1
  MakeSurevNICConnected:
    Type: NetAdapter
    connected: 1
    reconfigure: true
    startconnected: 1
    testadapter: 'vm.[1-2].vnic.[1]'
  NetperfTestDifferentHostIgnoreThroughput:
    ExpectedResult: ignore
    NoofOutbound: 1
    SupportAdapter: 'vm.[3].vnic.[1]'
    TestAdapter: 'vm.[1].vnic.[1]'
    TestDuration: 60
    ToolName: netperf
    Type: Traffic
  NetperfTestIgnorethroughput:
    ExpectedResult: ignore
    NoofOutbound: 1
    SupportAdapter: 'vm.[2].vnic.[1]'
    TestAdapter: 'vm.[1].vnic.[1]'
    TestDuration: 60
    ToolName: netperf
    Type: Traffic
  PingTest:
    NoofInbound: 1
    NoofOutbound: 1
    SupportAdapter: 'vm.[2].vnic.[1]'
    TestAdapter: 'vm.[1].vnic.[1]'
    TestDuration: 60
    ToolName: Ping
    Type: Traffic
    maxtimeout: 128000
  PingTestDifferentHost:
    NoofInbound: 1
    NoofOutbound: 1
    SupportAdapter: 'vm.[3].vnic.[1]'
    TestAdapter: 'vm.[1].vnic.[1]'
    TestDuration: 60
    ToolName: Ping
    Type: Traffic
    maxtimeout: 128000
  PlaceVM1OnVLAN16:
    Type: NetAdapter
    portgroup: 'vc.[1].dvportgroup.[2]'
    reconfigure: true
    testadapter: 'vm.[1].vnic.[1]'
  PlaceVM1OnvWire1:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[1]'
    reconfigure: true
    testadapter: 'vm.[1].vnic.[1]'
  PlaceVM1OnvWire3:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[3]'
    reconfigure: true
    testadapter: 'vm.[1].vnic.[1]'
  PlaceVM2OnMgmtdvpg:
    Type: NetAdapter
    portgroup: 'vc.[1].dvportgroup.[1]'
    reconfigure: true
    testadapter: 'vm.[2].vnic.[1]'
  PlaceVM2OnVLAN17:
    Type: NetAdapter
    portgroup: 'vc.[1].dvportgroup.[3]'
    reconfigure: true
    testadapter: 'vm.[2].vnic.[1]'
  PlaceVM2OnVLAN21:
    Type: NetAdapter
    portgroup: 'vc.[1].dvportgroup.[4]'
    reconfigure: true
    testadapter: 'vm.[2].vnic.[1]'
  PlaceVM2OnvWire2:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[2]'
    reconfigure: true
    testadapter: 'vm.[2].vnic.[1]'
  PlaceVM3OnVLAN17:
    Type: NetAdapter
    portgroup: 'vc.[1].dvportgroup.[3]'
    reconfigure: true
    testadapter: 'vm.[3].vnic.[1]'
  PlaceVM3OnVLAN21:
    Type: NetAdapter
    portgroup: 'vc.[1].dvportgroup.[4]'
    reconfigure: true
    testadapter: 'vm.[3].vnic.[1]'
  PlaceVM3OnvWire1:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[1]'
    reconfigure: true
    testadapter: 'vm.[3].vnic.[1]'
  PlaceVM3OnvWire2:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[2]'
    reconfigure: true
    testadapter: 'vm.[3].vnic.[1]'
  PlaceVM3OnvWire3:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[3]'
    reconfigure: true
    testadapter: 'vm.[3].vnic.[1]'
  PlaceVMsOnMgmtdvPG:
    Type: NetAdapter
    portgroup: 'vc.[1].dvportgroup.[1]'
    reconfigure: true
    testadapter: 'vm.[1-3].vnic.[1]'
  PoweroffVM1:
    TestVM: 'vm.[1]'
    Type: VM
    vmstate: poweroff
  PoweroffVM2:
    TestVM: 'vm.[2]'
    Type: VM
    vmstate: poweroff
  PoweroffVM3:
    TestVM: 'vm.[3]'
    Type: VM
    vmstate: poweroff
  PoweronVM1:
    TestVM: 'vm.[1]'
    Type: VM
    vmstate: poweron
  PoweronVM2:
    TestVM: 'vm.[2]'
    Type: VM
    vmstate: poweron
  PoweronVM3:
    TestVM: 'vm.[3]'
    Type: VM
    vmstate: poweron
  RebootHost:
    TestHost: 'host.[1]'
    Type: Host
    reboot: yes
  RebootHost2:
    TestHost: 'host.[2]'
    Type: Host
    reboot: yes
  RebootHost3:
    TestHost: 'host.[3]'
    Type: Host
    reboot: yes
  RemovevNICFromVM1:
    TestVM: 'vm.[1]'
    Type: VM
    deletevnic: 'vm.[1].vnic.[1]'
  RemovevNICFromVM2:
    TestVM: 'vm.[2]'
    Type: VM
    deletevnic: 'vm.[2].vnic.[1]'
  RemovevNICFromVM3:
    TestVM: 'vm.[3]'
    Type: VM
    deletevnic: 'vm.[3].vnic.[1]'
  SamevWireNetperfTestDifferentHost:
    MinExpResult: 1
    NoofInbound: 1
    NoofOutbound: 1
    SupportAdapter: 'vm.[3].vnic.[1]'
    TestAdapter: 'vm.[1].vnic.[1]'
    TestDuration: 60
    Type: Traffic
    l3protocol: 'ipv4,ipv6'
    l4protocol: 'tcp,udp'
    maxtimeout: 128000
  Sequence:
    -
      - CreateNetworkScope
    -
      - CreateVirtualWires
    -
      - AddvNICsOnVMs
    -
      - PoweronVM1
      - PoweronVM2
    -
      - MakeSurevNICConnected
    -
      - DeployEdge
    -
      - CreateVXLANLIF1
    -
      - CreateVXLANLIF2
    -
      - CreateVLANLIF3
    -
      - CreateVLANLIF4
    -
      - BridgevWire3ToVLAN21
    -
      - PoweronVM3
    -
      - PlaceVM1OnvWire1
      - PlaceVM3OnvWire1
    -
      - SetVXLANIPVM1
      - SetVXLANIPVM3SamevWire
    -
      - PingTestDifferentHost
    -
      - NetperfTestDifferentHostIgnoreThroughput
    -
      - PlaceVM1OnvWire1
      - PlaceVM3OnvWire2
    -
      - SetVXLANIPVM1
      - SetVXLANIPVM3
    -
      - AddVXLANRouteVM1
      - AddVXLANRouteVM3
    -
      - PingTestDifferentHost
    -
      - NetperfTestDifferentHostIgnoreThroughput
    -
      - PlaceVM1OnVLAN16
      - PlaceVM3OnVLAN17
    -
      - SetVLANIPVM1
      - SetVLANIPVM3
    -
      - AddVLANRouteVM1
      - AddVLANRouteVM3
    -
      - PingTestDifferentHost
    -
      - NetperfTestDifferentHostIgnoreThroughput
    -
      - PlaceVM1OnvWire1
      - PlaceVM3OnVLAN17
    -
      - SetVXLANIPVM1
      - SetVLANIPVM3
    -
      - AddVXLANRouteVM1
      - AddVLANRouteVM3
    -
      - PingTestDifferentHost
    -
      - NetperfTestDifferentHostIgnoreThroughput
    -
      - PlaceVM3OnvWire2
      - PlaceVM1OnVLAN16
    -
      - SetVLANIPVM1
      - SetVXLANIPVM3
    -
      - AddVLANRouteVM1
      - AddVXLANRouteVM3
    -
      - PingTestDifferentHost
    -
      - NetperfTestDifferentHostIgnoreThroughput
    -
      - PlaceVM1OnvWire3
    -
      - PlaceVM3OnVLAN21
    -
      - SetVXLANBridgeIPVM1
      - SetVLANBridgeIPVM3
    -
      - PingTestDifferentHost
    -
      - NetperfTestDifferentHostIgnoreThroughput
  SetMulticastRange:
    Multicastiprange:
      '[1]':
        begin: 239.0.0.101
        end: 239.254.254.254
        name: AutoGenerate
    TestNSX: 'vsm.[1]'
    Type: NSX
  SetSegmentIDRange:
    TestNSX: 'vsm.[1]'
    Type: NSX
    segmentidrange:
      '[1]':
        begin: 5001-10001
        end: 99000
        name: AutoGenerate
  SetVLANBridgeIPVM2:
    Testadapter: 'vm.[2].vnic.[1]'
    Type: NetAdapter
    ipv4: dhcp
  SetVLANBridgeIPVM3:
    Testadapter: 'vm.[3].vnic.[1]'
    Type: NetAdapter
    ipv4: dhcp
  SetVLANIPVM1:
    Testadapter: 'vm.[1].vnic.[1]'
    Type: NetAdapter
    ipv4: dhcp
  SetVLANIPVM2:
    Testadapter: 'vm.[2].vnic.[1]'
    Type: NetAdapter
    ipv4: dhcp
  SetVLANIPVM3:
    Testadapter: 'vm.[3].vnic.[1]'
    Type: NetAdapter
    ipv4: dhcp
  SetVXLANBridgeIPVM1:
    Testadapter: 'vm.[1].vnic.[1]'
    Type: NetAdapter
    ipv4: dhcp
  SetVXLANIPVM1:
    Testadapter: 'vm.[1].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.31.1.5
    netmask: 255.255.0.0
  SetVXLANIPVM2:
    Testadapter: 'vm.[2].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.32.1.5
    netmask: 255.255.0.0
  SetVXLANIPVM2SamevWire:
    Testadapter: 'vm.[2].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.31.1.6
    netmask: 255.255.0.0
  SetVXLANIPVM3:
    Testadapter: 'vm.[3].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.32.1.5
    netmask: 255.255.0.0
  SetVXLANIPVM3SamevWire:
    Testadapter: 'vm.[3].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.31.1.15
    netmask: 255.255.0.0
  UnconfigureVXLAN:
    Type: Cluster
    testcluster: 'vsm.[1].vdncluster.[1]'
    vxlan: unconfigure
  Uninstall_VDNCluster:
    TestNSX: 'vsm.[1]'
    Type: NSX
    deletevdncluster: 'vsm.[1].vdncluster.[-1]'
---
Category: NSX
Component: network vDR
Summary: 'VXLAN routing and VXLAN-VLAN bridging for different vwire control plane modes '
Tags: RunOnCAT
TestName: AllHybridAllMulticastAllUnicastAndCombinations2
TestbedSpec:
  host:
    '[1]': {}
    '[2-5]':
      vmnic:
        '[1-2]':
          driver: any
  vc:
    '[1]':
      datacenter:
        '[1]':
          Cluster:
            '[1]':
              host: 'host.[1]'
              name: Controller-Cluster-26724
            '[2]':
              name: Compute-Cluster-SJC-26724
            '[3]':
              name: Compute-Cluster-SFO-26724
          host: 'host.[2-5]'
      dvportgroup:
        '[10]':
          name: dvpg-SFO-vlan19-26724
          vds: 'vc.[1].vds.[2]'
          vlan: 19
          vlantype: access
        '[11]':
          name: dvpg-SFO-vlan21-26724
          vds: 'vc.[1].vds.[2]'
          vlan: 21
          vlantype: access
        '[12]':
          name: dvpg-SFO-vlan22-26724
          vds: 'vc.[1].vds.[2]'
          vlan: 22
          vlantype: access
        '[1]':
          name: dvpg-SJC-vlan16-26724
          vds: 'vc.[1].vds.[1]'
          vlan: 16
          vlantype: access
        '[2]':
          name: dvpg-SJC-vlan17-26724
          vds: 'vc.[1].vds.[1]'
          vlan: 17
          vlantype: access
        '[3]':
          name: dvpg-SJC-vlan18-26724
          vds: 'vc.[1].vds.[1]'
          vlan: 18
          vlantype: access
        '[4]':
          name: dvpg-SJC-mgmt-26724
          vds: 'vc.[1].vds.[1]'
          vlan: 19
          vlantype: access
        '[5]':
          name: dvpg-SJC-vlan21-26724
          vds: 'vc.[1].vds.[1]'
          vlan: 21
          vlantype: access
        '[6]':
          name: dvpg-SJC-vlan22-26724
          vds: 'vc.[1].vds.[1]'
          vlan: 22
          vlantype: access
        '[7]':
          name: dvpg-SFO-vlan16-26724
          vds: 'vc.[1].vds.[2]'
          vlan: 16
          vlantype: access
        '[8]':
          name: dvpg-SFO-vlan17-26724
          vds: 'vc.[1].vds.[2]'
          vlan: 17
          vlantype: access
        '[9]':
          name: dvpg-SFO-vlan18-26724
          vds: 'vc.[1].vds.[2]'
          vlan: 18
          vlantype: access
      vds:
        '[1]':
          configurehosts: add
          datacenter: 'vc.[1].datacenter.[1]'
          host: 'host.[2-3]'
          name: VDS-1-SJC-26724
          numuplinkports: 1
          vmnicadapter: 'host.[2-3].vmnic.[1]'
        '[2]':
          configurehosts: add
          datacenter: 'vc.[1].datacenter.[1]'
          host: 'host.[4-5]'
          name: VDS-2-SFO-26724
          numuplinkports: 1
          vmnicadapter: 'host.[4-5].vmnic.[1]'
  vm:
    '[1]':
      datastoreType: shared
      host: 'host.[2]'
      vmstate: poweroff
    '[2]':
      datastoreType: shared
      host: 'host.[3]'
      vmstate: poweroff
    '[3]':
      datastoreType: shared
      host: 'host.[4]'
      vmstate: poweroff
    '[4]':
      datastoreType: shared
      host: 'host.[5]'
      vmstate: poweroff
    '[5]':
      datastoreType: shared
      host: 'host.[2]'
      vmstate: poweroff
    '[6]':
      datastoreType: shared
      host: 'host.[3]'
      vmstate: poweroff
  vsm:
    '[1]':
      assignrole: enterprise_admin
      ippool:
        '[1]':
          gateway: x.x.x.x
          ipranges:
            - a.a.a.a-b.b.b.b
          name: AutoGenerate
          prefixlength: yy
      multicastiprange:
        '[1]':
          begin: 239.1.1.1
          end: 239.1.1.100
          name: AutoGenerate
      reconfigure: true
      segmentidrange:
        '[1]':
          begin: 10000
          end: 19000
          name: AutoGenerate
      vc: 'vc.[1]'
      vxlancontroller:
        '[1]':
          host: 'host.[1]'
          ippool: 'vsm.[1].ippool.[1]'
          name: AutoGenerate
          resourcepool: 'vc.[1].datacenter.[1].cluster.[1]'
Version: 2
WORKLOADS:
  AddHosts2and3ToClusterSJC:
    MoveHostsToCluster: 'host.[2],host.[3]'
    TestCluster: 'vc.[1].datacenter.[1].cluster.[2]'
    Type: Cluster
  AddHosts4and5ToClusterSFO:
    MoveHostsToCluster: 'host.[4],host.[5]'
    TestCluster: 'vc.[1].datacenter.[1].cluster.[3]'
    Type: Cluster
  AddHosts4and5ToVDSSJC:
    TestSwitch: 'vc.[1].vds.[2]'
    Type: Switch
    configurehosts: add
    host: 'host.[4-5]'
    vmnicadapter: 'host.[4-5].vmnic.[1]'
  AddRouteVM1VWire1:
    Testadapter: 'vm.[1].vnic.[1]'
    Type: NetAdapter
    gateway: 172.31.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM1VWire2:
    Testadapter: 'vm.[1].vnic.[1]'
    Type: NetAdapter
    gateway: 172.32.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM1VWire3:
    Testadapter: 'vm.[1].vnic.[1]'
    Type: NetAdapter
    gateway: 172.33.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM2VWire1:
    Testadapter: 'vm.[2].vnic.[1]'
    Type: NetAdapter
    gateway: 172.31.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM2VWire2:
    Testadapter: 'vm.[2].vnic.[1]'
    Type: NetAdapter
    gateway: 172.32.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM2VWire3:
    Testadapter: 'vm.[2].vnic.[1]'
    Type: NetAdapter
    gateway: 172.33.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM3VWire1:
    Testadapter: 'vm.[3].vnic.[1]'
    Type: NetAdapter
    gateway: 172.31.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM3VWire2:
    Testadapter: 'vm.[3].vnic.[1]'
    Type: NetAdapter
    gateway: 172.32.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM3VWire3:
    Testadapter: 'vm.[3].vnic.[1]'
    Type: NetAdapter
    gateway: 172.33.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM4VWire1:
    Testadapter: 'vm.[4].vnic.[1]'
    Type: NetAdapter
    gateway: 172.31.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM4VWire2:
    Testadapter: 'vm.[4].vnic.[1]'
    Type: NetAdapter
    gateway: 172.32.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM4VWire3:
    Testadapter: 'vm.[4].vnic.[1]'
    Type: NetAdapter
    gateway: 172.33.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM5VWire2:
    Testadapter: 'vm.[5].vnic.[1]'
    Type: NetAdapter
    gateway: 172.32.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM5VWire3:
    Testadapter: 'vm.[5].vnic.[1]'
    Type: NetAdapter
    gateway: 172.33.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM6VWire2:
    Testadapter: 'vm.[6].vnic.[1]'
    Type: NetAdapter
    gateway: 172.32.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM6VWire3:
    Testadapter: 'vm.[6].vnic.[1]'
    Type: NetAdapter
    gateway: 172.33.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddVmotionvmknicsHost2and3:
    TestHost: 'host.[2-3]'
    Type: Host
    vmknic:
      '[1]':
        configurevmotion: enable
        ipv4: dhcp
        portgroup: 'vc.[1].dvportgroup.[1]'
  AddVmotionvmknicsHost4and5:
    TestHost: 'host.[4-5]'
    Type: Host
    vmknic:
      '[1]':
        configurevmotion: enable
        ipv4: dhcp
        portgroup: 'vc.[1].dvportgroup.[6]'
  AddvNICsOn1to4VMs:
    TestVM: 'vm.[5],vm.[6]'
    Type: VM
    vnic:
      '[1]':
        allowguestcontrol: 1
        connected: 1
        driver: vmxnet3
        portgroup: 'vsm.[1].networkscope.[1].virtualwire.[1]'
        startconnected: 1
  AddvNICsOn1to6VMs:
    TestVM: 'vm.[1-6]'
    Type: VM
    vnic:
      '[1]':
        allowguestcontrol: 1
        connected: 1
        driver: vmxnet3
        portgroup: 'vsm.[1].networkscope.[1].virtualwire.[1]'
        startconnected: 1
  ConfigureVXLAN_ClusterSFO:
    TestNSX: 'vsm.[1]'
    Type: NSX
    VDNCluster:
      '[2]':
        cluster: 'vc.[1].datacenter.[1].cluster.[3]'
        mtu: 1600
        switch: 'vc.[1].vds.[2]'
        teaming: FAILOVER_ORDER
        vibs: install
        vlan: 22
        vmkniccount: 1
  CreateBridges:
    TestVM: 'vsm.[1].vse.[2]'
    Type: VM
    bridge:
      '[1]':
        name: bridge-1-26724
        portgroup: 'vc.[1].dvportgroup.[5]'
        virtualwire: 'vsm.[1].networkscope.[1].virtualwire.[4]'
      '[2]':
        name: bridge-2-26724
        portgroup: 'vc.[1].dvportgroup.[6]'
        virtualwire: 'vsm.[1].networkscope.[1].virtualwire.[5]'
  CreateNetworkScope:
    TestNSX: 'vsm.[1]'
    Type: NSX
    networkscope:
      '[1]':
        clusters: 'vc.[1].datacenter.[1].cluster.[2]'
        name: network-scope-1-26724
  CreateNetworkScopeClusterSJCandSFO:
    TestNSX: 'vsm.[1]'
    Type: NSX
    networkscope:
      '[1]':
        clusters: 'vc.[1].datacenter.[1].cluster.[2-3]'
        name: network-scope-1-26724
  CreateNetworkScopeClusterSJCandSFOHybridMode:
    TestNSX: 'vsm.[1]'
    Type: NSX
    networkscope:
      '[1]':
        clusters: 'vc.[1].datacenter.[1].cluster.[2-3]'
        controlplanemode: HYBRID_MODE
        name: network-scope-1-26724
  CreateVXLANLIF1:
    TestVM: 'vsm.[1].vse.[1]'
    Type: VM
    lif:
      '[1]':
        addressgroup:
          - addresstype: primary
            ipv4address: 172.31.1.1
            netmask: 255.255.0.0
        connected: 1
        name: lif-vwire1-26724
        portgroup: 'vsm.[1].networkscope.[1].virtualwire.[1]'
        type: internal
  CreateVXLANLIF2:
    TestVM: 'vsm.[1].vse.[1]'
    Type: VM
    lif:
      '[2]':
        addressgroup:
          - addresstype: primary
            ipv4address: 172.32.1.1
            netmask: 255.255.0.0
        connected: 1
        name: lif-vwire2-26724
        portgroup: 'vsm.[1].networkscope.[1].virtualwire.[2]'
        type: internal
  CreateVXLANLIF3:
    TestVM: 'vsm.[1].vse.[1]'
    Type: VM
    lif:
      '[3]':
        addressgroup:
          - addresstype: primary
            ipv4address: 172.33.1.1
            netmask: 255.255.0.0
        connected: 1
        name: lif-vwire3-26724
        portgroup: 'vsm.[1].networkscope.[1].virtualwire.[3]'
        type: internal
  CreateVirtualWires:
    TestTransportZone: 'vsm.[1].networkscope.[1]'
    Type: TransportZone
    VirtualWire:
      '[1]':
        controlplanemode: HYBRID_MODE
        name: AutoGenerate
        tenantid: AutoGenerate
      '[2]':
        controlplanemode: UNICAST_MODE
        name: AutoGenerate
        tenantid: AutoGenerate
      '[3]':
        controlplanemode: MULTICAST_MODE
        name: AutoGenerate
        tenantid: AutoGenerate
      '[4-8]':
        name: AutoGenerate
        tenantid: AutoGenerate
  Delete2ndController:
    TestNSX: 'vsm.[1]'
    Type: NSX
    deletevxlancontroller: 'vsm.[1].vxlancontroller.[2]'
  DeleteAllVmknics:
    TestHost: 'host.[2-5]'
    Type: Host
    deletevmknic: 'host.[2-5].vmknic.[-1]'
  DeleteController:
    TestNSX: 'vsm.[1]'
    Type: NSX
    deletevxlancontroller: 'vsm.[1].vxlancontroller.[-1]'
  DeleteEdges:
    TestNSX: 'vsm.[1]'
    Type: NSX
    deletevse: 'vsm.[1].vse.[-1]'
  DeleteNetworkScopes:
    TestNSX: 'vsm.[1]'
    Type: NSX
    deletenetworkscope: 'vsm.[1].networkscope.[-1]'
  DeleteVirtualWires: &1
    TestTransportZone: 'vsm.[1].networkscope.[-1]'
    Type: TransportZone
    deletevirtualwire: 'vsm.[1].networkscope.[-1].virtualwire.[-1]'
  Delete_All_VirtualWires: *1
  Deploy2ndController:
    TestNSX: 'vsm.[1]'
    Type: NSX
    vxlancontroller:
      '[2]':
        host: 'host.[1]'
        ippool: 'vsm.[1].ippool.[1]'
        name: AutoGenerate
        resourcepool: 'vc.[1].datacenter.[1].cluster.[1]'
  Deploy3rdController:
    TestNSX: 'vsm.[1]'
    Type: NSX
    vxlancontroller:
      '[3]':
        host: 'host.[1]'
        ippool: 'vsm.[1].ippool.[1]'
        name: AutoGenerate
        resourcepool: 'vc.[1].datacenter.[1].cluster.[1]'
  DeployEdge:
    TestNSX: 'vsm.[1]'
    Type: NSX
    vse:
      '[1]':
        datacenter: 'vc.[1].datacenter.[1]'
        host: 'host.[2]'
        name: Edge-26724
        portgroup: 'vc.[1].dvportgroup.[1]'
        primaryaddress: 10.10.10.15
        resourcepool: 'vc.[1].datacenter.[1].cluster.[2]'
        subnetmask: 255.255.255.0
  DeployEdge2OnHost2:
    TestNSX: 'vsm.[1]'
    Type: NSX
    vse:
      '[2]':
        datacenter: 'vc.[1].datacenter.[1]'
        host: 'host.[2]'
        name: Edge-2
        portgroup: 'vc.[1].dvportgroup.[1]'
        primaryaddress: 10.10.10.35
        resourcepool: 'vc.[1].datacenter.[1].cluster.[2]'
        subnetmask: 255.255.255.0
  DeployEdgeOnHost4:
    TestNSX: 'vsm.[1]'
    Type: NSX
    vse:
      '[1]':
        datacenter: 'vc.[1].datacenter.[1]'
        host: 'host.[4]'
        name: Edge-1
        portgroup: 'vc.[1].dvportgroup.[7]'
        primaryaddress: 10.10.10.36
        resourcepool: 'vc.[1].datacenter.[1].cluster.[3]'
        subnetmask: 255.255.255.0
  DeployFirstController:
    TestNSX: 'vsm.[1]'
    Type: NSX
    vxlancontroller:
      '[1]':
        firstnodeofcluster: true
        host: 'host.[1]'
        ippool: 'vsm.[1].ippool.[1]'
        name: AutoGenerate
        resourcepool: 'vc.[1].datacenter.[1].cluster.[1]'
  ExitSequence:
    -
      - DeleteEdges
    -
      - RemovevNICFromVM1
      - RemovevNICFromVM2
      - RemovevNICFromVM3
      - RemovevNICFromVM4
      - RemovevNICFromVM5
      - RemovevNICFromVM6
    -
      - Delete_All_VirtualWires
    -
      - DeleteNetworkScopes
    -
      - Uninstall_VDNCluster
    -
      - RemoveHosts4and5FromClusterSFO
      - RemoveHosts2and3FromClusterSJC
    -
      - RebootHost2
      - RebootHost3
      - RebootHost4
      - RebootHost5
  InstallVIBs_ClusterSFO:
    TestNSX: 'vsm.[1]'
    Type: NSX
    VDNCluster:
      '[2]':
        cluster: 'vc.[1].datacenter.[1].cluster.[3]'
        vibs: install
  Install_Configure_ClusterSJC:
    TestNSX: 'vsm.[1]'
    Type: NSX
    VDNCluster:
      '[1]':
        cluster: 'vc.[1].datacenter.[1].cluster.[2]'
        mtu: 1600
        switch: 'vc.[1].vds.[1]'
        teaming:
          - LOADBALANCE_SRCMAC
          - LOADBALANCE_SRCID
          - LOADBALANCE_LOADBASED
          - FAILOVER_ORDER
          - ETHER_CHANNEL
        vibs: install
        vlan:
          - 21
        vmkniccount: 1
  MakeSurevNICConnectedVM1toVM6:
    Type: NetAdapter
    connected: 1
    reconfigure: true
    startconnected: 1
    testadapter: 'vm.[1-6].vnic.[1]'
  MoveHostsToClusterSFO:
    MoveHostsToCluster: 'host.[4],host.[5]'
    TestCluster: 'vc.[1].datacenter.[1].cluster.[3]'
    Type: Cluster
  NetperfTest2VMsToOther2VMs:
    ExpectedResult: ignore
    L4Protocol: 'tcp,udp'
    LocalSendSocketSize: 131072
    NoofInbound: 1
    NoofOutbound: 1
    ParallelSession: yes
    RemoteSendSocketSize: 131072
    SendMessageSize: '16384,128804'
    SupportAdapter: 'vm.[5-6].vnic.[1]'
    TestAdapter: 'vm.[1-2].vnic.[1]'
    TestDuration: 60
    ToolName: Netperf
    Type: Traffic
    maxtimeout: 128000
  NetperfTest3VMsToOther3VMs:
    ExpectedResult: ignore
    LocalSendSocketSize: 131072
    NoofInbound: 1
    NoofOutbound: 1
    ParallelSession: yes
    RemoteSendSocketSize: 131072
    SendMessageSize: '16384,96684,128804'
    SupportAdapter: 'vm.[4-6].vnic.[1]'
    TestAdapter: 'vm.[1-3].vnic.[1]'
    TestDuration: 60
    ToolName: Netperf
    Type: Traffic
    maxtimeout: 128000
  NetperfTestIgnorethroughput:
    ExpectedResult: ignore
    NoofOutbound: 1
    SupportAdapter: 'vm.[2].vnic.[1]'
    TestAdapter: 'vm.[1].vnic.[1]'
    TestDuration: 60
    ToolName: iperf
    Type: Traffic
  NetperfTestVM1ToAllOthers:
    ExpectedResult: ignore
    NoofInbound: 3
    NoofOutbound: 10
    ParallelSession: yes
    SupportAdapter: 'vm.[2-6].vnic.[1]'
    TestAdapter: 'vm.[1].vnic.[1]'
    TestDuration: 60
    ToolName: 'Netperf,Iperf,Ping'
    Type: Traffic
    maxtimeout: 128000
  PingTest:
    NoofInbound: 1
    NoofOutbound: 1
    SupportAdapter: 'vm.[2].vnic.[1]'
    TestAdapter: 'vm.[1].vnic.[1]'
    TestDuration: 60
    ToolName: Ping
    Type: Traffic
    maxtimeout: 128000
  PingTest2VMsToOther2VMs:
    NoofInbound: 1
    NoofOutbound: 1
    SupportAdapter: 'vm.[5-6].vnic.[1]'
    TestAdapter: 'vm.[1-2].vnic.[1]'
    TestDuration: 60
    ToolName: Ping
    Type: Traffic
    maxtimeout: 128000
  PingTest3VMsToOther3VMs:
    NoofInbound: 1
    NoofOutbound: 1
    SupportAdapter: 'vm.[4-6].vnic.[1]'
    TestAdapter: 'vm.[1-3].vnic.[1]'
    TestDuration: 60
    ToolName: Ping
    Type: Traffic
    maxtimeout: 128000
  PingTestSameCluster1:
    NoofInbound: 1
    NoofOutbound: 1
    SupportAdapter: 'vm.[2].vnic.[1]'
    TestAdapter: 'vm.[1].vnic.[1]'
    TestDuration: 60
    ToolName: Ping
    Type: Traffic
    maxtimeout: 128000
  PingTestSameCluster2:
    NoofInbound: 1
    NoofOutbound: 1
    SupportAdapter: 'vm.[4].vnic.[1]'
    TestAdapter: 'vm.[3].vnic.[1]'
    TestDuration: 60
    ToolName: Ping
    Type: Traffic
    maxtimeout: 128000
  PingTestVM1ToAllOthers:
    NoofInbound: 1
    NoofOutbound: 1
    SupportAdapter: 'vm.[2-6].vnic.[1]'
    TestAdapter: 'vm.[1].vnic.[1]'
    TestDuration: 60
    ToolName: Ping
    Type: Traffic
    maxtimeout: 128000
  PingTestVM1ToVM2:
    NoofInbound: 1
    NoofOutbound: 1
    SupportAdapter: 'vm.[2].vnic.[1]'
    TestAdapter: 'vm.[1].vnic.[1]'
    TestDuration: 60
    ToolName: Ping
    Type: Traffic
    maxtimeout: 128000
  PingTestVM6ToVM5:
    NoofInbound: 1
    NoofOutbound: 1
    SupportAdapter: 'vm.[5].vnic.[1]'
    TestAdapter: 'vm.[6].vnic.[1]'
    TestDuration: 60
    ToolName: Ping
    Type: Traffic
    maxtimeout: 128000
  PlaceVM1OnvWire1:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[1]'
    reconfigure: true
    testadapter: 'vm.[1].vnic.[1]'
  PlaceVM1OnvWire2:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[2]'
    reconfigure: true
    testadapter: 'vm.[1].vnic.[1]'
  PlaceVM1OnvWire3:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[3]'
    reconfigure: true
    testadapter: 'vm.[1].vnic.[1]'
  PlaceVM1OnvWire4:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[4]'
    reconfigure: true
    testadapter: 'vm.[1].vnic.[1]'
  PlaceVM2OnMgmtdvpg:
    Type: NetAdapter
    portgroup: 'vc.[1].dvportgroup.[1]'
    reconfigure: true
    testadapter: 'vm.[2].vnic.[1]'
  PlaceVM2OnVLAN21_VDS1:
    Type: NetAdapter
    portgroup: 'vc.[1].dvportgroup.[5]'
    reconfigure: true
    testadapter: 'vm.[2].vnic.[1]'
  PlaceVM2OnvWire1:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[1]'
    reconfigure: true
    testadapter: 'vm.[2].vnic.[1]'
  PlaceVM2OnvWire2:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[2]'
    reconfigure: true
    testadapter: 'vm.[2].vnic.[1]'
  PlaceVM2OnvWire3:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[3]'
    reconfigure: true
    testadapter: 'vm.[2].vnic.[1]'
  PlaceVM3OnvWire1:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[1]'
    reconfigure: true
    testadapter: 'vm.[3].vnic.[1]'
  PlaceVM3OnvWire2:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[2]'
    reconfigure: true
    testadapter: 'vm.[3].vnic.[1]'
  PlaceVM3OnvWire3:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[3]'
    reconfigure: true
    testadapter: 'vm.[3].vnic.[1]'
  PlaceVM4OnvWire1:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[1]'
    reconfigure: true
    testadapter: 'vm.[4].vnic.[1]'
  PlaceVM4OnvWire2:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[2]'
    reconfigure: true
    testadapter: 'vm.[4].vnic.[1]'
  PlaceVM4OnvWire3:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[3]'
    reconfigure: true
    testadapter: 'vm.[4].vnic.[1]'
  PlaceVM5OnvWire1:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[1]'
    reconfigure: true
    testadapter: 'vm.[5].vnic.[1]'
  PlaceVM5OnvWire2:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[2]'
    reconfigure: true
    testadapter: 'vm.[5].vnic.[1]'
  PlaceVM5OnvWire3:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[3]'
    reconfigure: true
    testadapter: 'vm.[5].vnic.[1]'
  PlaceVM5OnvWire5:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[5]'
    reconfigure: true
    testadapter: 'vm.[5].vnic.[1]'
  PlaceVM6OnVLAN22_VDS1:
    Type: NetAdapter
    portgroup: 'vc.[1].dvportgroup.[6]'
    reconfigure: true
    testadapter: 'vm.[6].vnic.[1]'
  PlaceVM6OnvWire1:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[1]'
    reconfigure: true
    testadapter: 'vm.[6].vnic.[1]'
  PlaceVM6OnvWire2:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[2]'
    reconfigure: true
    testadapter: 'vm.[6].vnic.[1]'
  PlaceVM6OnvWire3:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[3]'
    reconfigure: true
    testadapter: 'vm.[6].vnic.[1]'
  PoweroffVM1:
    TestVM: 'vm.[1]'
    Type: VM
    vmstate: poweroff
  PoweroffVM2:
    TestVM: 'vm.[2]'
    Type: VM
    vmstate: poweroff
  PoweroffVM3:
    TestVM: 'vm.[3]'
    Type: VM
    vmstate: poweroff
  PoweroffVM4:
    TestVM: 'vm.[4]'
    Type: VM
    vmstate: poweroff
  PoweroffVM5:
    TestVM: 'vm.[5]'
    Type: VM
    vmstate: poweroff
  PoweroffVM6:
    TestVM: 'vm.[6]'
    Type: VM
    vmstate: poweroff
  PoweronVM1:
    TestVM: 'vm.[1]'
    Type: VM
    vmstate: poweron
  PoweronVM2:
    TestVM: 'vm.[2]'
    Type: VM
    vmstate: poweron
  PoweronVM3:
    TestVM: 'vm.[3]'
    Type: VM
    vmstate: poweron
  PoweronVM4:
    TestVM: 'vm.[4]'
    Type: VM
    vmstate: poweron
  PoweronVM5:
    TestVM: 'vm.[5]'
    Type: VM
    vmstate: poweron
  PoweronVM6:
    TestVM: 'vm.[6]'
    Type: VM
    vmstate: poweron
  RebootHost:
    TestHost: 'host.[1]'
    Type: Host
    reboot: yes
  RebootHost2:
    TestHost: 'host.[2]'
    Type: Host
    reboot: yes
  RebootHost3:
    TestHost: 'host.[3]'
    Type: Host
    reboot: yes
  RebootHost4:
    TestHost: 'host.[4]'
    Type: Host
    reboot: yes
  RebootHost5:
    TestHost: 'host.[5]'
    Type: Host
    reboot: yes
  RemoveHosts2and3FromClusterSJC:
    MoveHostsFromCluster: 'host.[2],host.[3]'
    TestCluster: 'vc.[1].datacenter.[1].cluster.[2]'
    Type: Cluster
  RemoveHosts4and5FromClusterSFO:
    MoveHostsFromCluster: 'host.[4],host.[5]'
    TestCluster: 'vc.[1].datacenter.[1].cluster.[3]'
    Type: Cluster
  RemovevNICFromVM1:
    TestVM: 'vm.[1]'
    Type: VM
    deletevnic: 'vm.[1].vnic.[1]'
  RemovevNICFromVM2:
    TestVM: 'vm.[2]'
    Type: VM
    deletevnic: 'vm.[2].vnic.[1]'
  RemovevNICFromVM3:
    TestVM: 'vm.[3]'
    Type: VM
    deletevnic: 'vm.[3].vnic.[1]'
  RemovevNICFromVM4:
    TestVM: 'vm.[4]'
    Type: VM
    deletevnic: 'vm.[4].vnic.[1]'
  RemovevNICFromVM5:
    TestVM: 'vm.[5]'
    Type: VM
    deletevnic: 'vm.[5].vnic.[1]'
  RemovevNICFromVM6:
    TestVM: 'vm.[6]'
    Type: VM
    deletevnic: 'vm.[6].vnic.[1]'
  SamevWireNetperfTestDifferentCluster:
    MinExpResult: 1
    NoofInbound: 1
    NoofOutbound: 1
    SupportAdapter: 'vm.[3].vnic.[1]'
    TestAdapter: 'vm.[1].vnic.[1]'
    TestDuration: 60
    Type: Traffic
    l3protocol: 'ipv4,ipv6'
    l4protocol: 'tcp,udp'
    maxtimeout: 128000
  Sequence:
    -
      - AddHosts2and3ToClusterSJC
    -
      - Install_Configure_ClusterSJC
      - InstallVIBs_ClusterSFO
    -
      - ConfigureVXLAN_ClusterSFO
    -
      - CreateNetworkScopeClusterSJCandSFO
    -
      - CreateVirtualWires
    -
      - AddHosts4and5ToClusterSFO
    -
      - AddvNICsOn1to6VMs
    -
      - PoweronVM1
      - PoweronVM2
      - PoweronVM3
    -
      - PoweronVM4
      - PoweronVM5
      - PoweronVM6
    -
      - MakeSurevNICConnectedVM1toVM6
    -
      - DeployEdgeOnHost4
    -
      - CreateVXLANLIF1
    -
      - CreateVXLANLIF2
    -
      - CreateVXLANLIF3
    -
      - DeployEdge2OnHost2
    -
      - CreateBridges
    -
      - UpdatevWiresToUnicastMode
    -
      - PlaceVM1OnvWire1
      - PlaceVM2OnvWire1
      - PlaceVM3OnvWire1
      - PlaceVM4OnvWire2
      - PlaceVM5OnvWire2
      - PlaceVM6OnvWire2
    -
      - SetIPVM1VWire1
      - SetIPVM2VWire1
      - SetIPVM3VWire1
      - SetIPVM4VWire2
      - SetIPVM5VWire2
      - SetIPVM6VWire2
    -
      - AddRouteVM1VWire1
      - AddRouteVM2VWire1
      - AddRouteVM3VWire1
      - AddRouteVM4VWire2
      - AddRouteVM5VWire2
      - AddRouteVM6VWire2
    -
      - PingTestVM1ToAllOthers
    -
      - PingTest3VMsToOther3VMs
    -
      - PlaceVM1OnvWire4
      - PlaceVM2OnVLAN21_VDS1
      - PlaceVM5OnvWire5
      - PlaceVM6OnVLAN22_VDS1
    -
      - SetIPVM1VWire4
      - SetIPVM2VLAN21
      - SetIPVM5VWire5
      - SetIPVM6VLAN22
    -
      - PingTestVM1ToVM2
    -
      - PingTestVM6ToVM5
    -
      - UpdatevWires1and4ToHybridMode
    -
      - UpdatevWires2and5ToMulticastMode
    -
      - UpdatevWires3and6ToUnicastMode
    -
      - PlaceVM1OnvWire1
      - PlaceVM2OnvWire1
      - PlaceVM3OnvWire2
      - PlaceVM4OnvWire2
      - PlaceVM5OnvWire3
      - PlaceVM6OnvWire3
    -
      - SetIPVM1VWire1
      - SetIPVM2VWire1
      - SetIPVM3VWire2
      - SetIPVM4VWire2
      - SetIPVM5VWire3
      - SetIPVM6VWire3
    -
      - AddRouteVM1VWire1
      - AddRouteVM2VWire1
      - AddRouteVM3VWire2
      - AddRouteVM4VWire2
      - AddRouteVM5VWire3
      - AddRouteVM6VWire3
    -
      - PingTestVM1ToAllOthers
      - PingTest3VMsToOther3VMs
    -
      - PlaceVM1OnvWire4
      - PlaceVM2OnVLAN21_VDS1
      - PlaceVM5OnvWire5
      - PlaceVM6OnVLAN22_VDS1
    -
      - SetIPVM1VWire4
      - SetIPVM2VLAN21
      - SetIPVM5VWire5
      - SetIPVM6VLAN22
    -
      - PingTestVM1ToVM2
    -
      - PingTestVM6ToVM5
  SetIPVM1VWire1:
    Testadapter: 'vm.[1].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.31.1.15
    netmask: 255.255.0.0
  SetIPVM1VWire2:
    Testadapter: 'vm.[1].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.32.1.15
    netmask: 255.255.0.0
  SetIPVM1VWire3:
    Testadapter: 'vm.[1].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.33.1.15
    netmask: 255.255.0.0
  SetIPVM1VWire4:
    Testadapter: 'vm.[1].vnic.[1]'
    Type: NetAdapter
    ipv4: dhcp
  SetIPVM2VLAN21:
    Testadapter: 'vm.[2].vnic.[1]'
    Type: NetAdapter
    ipv4: dhcp
  SetIPVM2VWire1:
    Testadapter: 'vm.[2].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.31.1.25
    netmask: 255.255.0.0
  SetIPVM2VWire2:
    Testadapter: 'vm.[2].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.32.1.25
    netmask: 255.255.0.0
  SetIPVM2VWire3:
    Testadapter: 'vm.[2].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.33.1.25
    netmask: 255.255.0.0
  SetIPVM3VWire1:
    Testadapter: 'vm.[3].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.31.1.35
    netmask: 255.255.0.0
  SetIPVM3VWire2:
    Testadapter: 'vm.[3].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.32.1.35
    netmask: 255.255.0.0
  SetIPVM3VWire3:
    Testadapter: 'vm.[3].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.33.1.35
    netmask: 255.255.0.0
  SetIPVM3VWire4:
    Testadapter: 'vm.[3].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.21.1.35
    netmask: 255.255.0.0
  SetIPVM4VWire1:
    Testadapter: 'vm.[4].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.31.1.45
    netmask: 255.255.0.0
  SetIPVM4VWire2:
    Testadapter: 'vm.[4].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.32.1.45
    netmask: 255.255.0.0
  SetIPVM4VWire3:
    Testadapter: 'vm.[4].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.33.1.45
    netmask: 255.255.0.0
  SetIPVM5VWire1:
    Testadapter: 'vm.[5].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.31.1.55
    netmask: 255.255.0.0
  SetIPVM5VWire2:
    Testadapter: 'vm.[5].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.32.1.55
    netmask: 255.255.0.0
  SetIPVM5VWire3:
    Testadapter: 'vm.[5].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.33.1.55
    netmask: 255.255.0.0
  SetIPVM5VWire5:
    Testadapter: 'vm.[5].vnic.[1]'
    Type: NetAdapter
    ipv4: dhcp
  SetIPVM6VLAN22:
    Testadapter: 'vm.[6].vnic.[1]'
    Type: NetAdapter
    ipv4: dhcp
  SetIPVM6VWire1:
    Testadapter: 'vm.[6].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.31.1.65
    netmask: 255.255.0.0
  SetIPVM6VWire2:
    Testadapter: 'vm.[6].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.32.1.65
    netmask: 255.255.0.0
  SetIPVM6VWire3:
    Testadapter: 'vm.[6].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.33.1.65
    netmask: 255.255.0.0
  SetMulticastRange:
    Multicastiprange:
      '[1]':
        begin: 239.0.0.101
        end: 239.254.254.254
        name: AutoGenerate
    TestNSX: 'vsm.[1]'
    Type: NSX
  SetSegmentIDRange:
    TestNSX: 'vsm.[1]'
    Type: NSX
    segmentidrange:
      '[1]':
        begin: 5001-10001
        end: 99000
        name: AutoGenerate
  Uninstall_VDNCluster:
    TestNSX: 'vsm.[1]'
    Type: NSX
    deletevdncluster: 'vsm.[1].vdncluster.[-1]'
  UpdatevWires1and4ToHybridMode:
    TestSwitch: 'vsm.[1].networkscope.[1].virtualwire.[1],vsm.[1].networkscope.[1].virtualwire.[4]'
    Type: Switch
    controlplanemode: HYBRID_MODE
    name: vWire-Updated-Hybrid
    reconfigure: true
  UpdatevWires2and5ToMulticastMode:
    TestSwitch: 'vsm.[1].networkscope.[1].virtualwire.[2],vsm.[1].networkscope.[1].virtualwire.[5]'
    Type: Switch
    controlplanemode: MULTICAST_MODE
    name: vWire-Updated-Multicast
    reconfigure: true
  UpdatevWires3and6ToUnicastMode:
    TestSwitch: 'vsm.[1].networkscope.[1].virtualwire.[3],vsm.[1].networkscope.[1].virtualwire.[6]'
    Type: Switch
    controlplanemode: UNICAST_MODE
    name: vWire-Updated-Unicast
    reconfigure: true
  UpdatevWiresToHybridMode:
    TestSwitch: 'vsm.[1].networkscope.[1].virtualwire.[1-5]'
    Type: Switch
    controlplanemode: HYBRID_MODE
    name: vWire-Updated-Hybrid
    reconfigure: true
  UpdatevWiresToMulticastMode:
    TestSwitch: 'vsm.[1].networkscope.[1].virtualwire.[1-5]'
    Type: Switch
    controlplanemode: MULTICAST_MODE
    name: vWire-Updated-Multicast
    reconfigure: true
  UpdatevWiresToUnicastMode:
    TestSwitch: 'vsm.[1].networkscope.[1].virtualwire.[1-5]'
    Type: Switch
    controlplanemode: UNICAST_MODE
    name: vWire-Updated-Unicast
    reconfigure: true
  vMotionVM2ToHost3:
    Iterations: 1
    TestVM: 'vm.[3]'
    Type: VM
    dsthost: 'host.[2]'
    vmotion: oneway
---
Category: NSX
Component: network vDR
Summary: Verify data traffic after redeploying vdr edge
Tags: RunOnCAT
TestName: EdgeActionsRedeployForceSyncRebootHA
TestbedSpec:
  host:
    '[1]': {}
    '[2-5]':
      vmnic:
        '[1-2]':
          driver: any
  vc:
    '[1]':
      datacenter:
        '[1]':
          Cluster:
            '[1]':
              host: 'host.[1]'
              name: Controller-Cluster-26724
            '[2]':
              name: Compute-Cluster-SJC-26724
            '[3]':
              name: Compute-Cluster-SFO-26724
          host: 'host.[2-5]'
      dvportgroup:
        '[10]':
          name: dvpg-SFO-vlan19-26724
          vds: 'vc.[1].vds.[2]'
          vlan: 19
          vlantype: access
        '[11]':
          name: dvpg-SFO-vlan21-26724
          vds: 'vc.[1].vds.[2]'
          vlan: 21
          vlantype: access
        '[12]':
          name: dvpg-SFO-vlan22-26724
          vds: 'vc.[1].vds.[2]'
          vlan: 22
          vlantype: access
        '[1]':
          name: dvpg-SJC-vlan16-26724
          vds: 'vc.[1].vds.[1]'
          vlan: 16
          vlantype: access
        '[2]':
          name: dvpg-SJC-vlan17-26724
          vds: 'vc.[1].vds.[1]'
          vlan: 17
          vlantype: access
        '[3]':
          name: dvpg-SJC-vlan18-26724
          vds: 'vc.[1].vds.[1]'
          vlan: 18
          vlantype: access
        '[4]':
          name: dvpg-SJC-mgmt-26724
          vds: 'vc.[1].vds.[1]'
          vlan: 19
          vlantype: access
        '[5]':
          name: dvpg-SJC-vlan21-26724
          vds: 'vc.[1].vds.[1]'
          vlan: 21
          vlantype: access
        '[6]':
          name: dvpg-SJC-vlan22-26724
          vds: 'vc.[1].vds.[1]'
          vlan: 22
          vlantype: access
        '[7]':
          name: dvpg-SFO-vlan16-26724
          vds: 'vc.[1].vds.[2]'
          vlan: 16
          vlantype: access
        '[8]':
          name: dvpg-SFO-vlan17-26724
          vds: 'vc.[1].vds.[2]'
          vlan: 17
          vlantype: access
        '[9]':
          name: dvpg-SFO-vlan18-26724
          vds: 'vc.[1].vds.[2]'
          vlan: 18
          vlantype: access
      vds:
        '[1]':
          configurehosts: add
          datacenter: 'vc.[1].datacenter.[1]'
          host: 'host.[2-3]'
          name: VDS-1-SJC-26724
          numuplinkports: 1
          vmnicadapter: 'host.[2-3].vmnic.[1]'
        '[2]':
          configurehosts: add
          datacenter: 'vc.[1].datacenter.[1]'
          host: 'host.[4-5]'
          name: VDS-2-SFO-26724
          numuplinkports: 1
          vmnicadapter: 'host.[4-5].vmnic.[1]'
  vm:
    '[1]':
      datastoreType: shared
      host: 'host.[2]'
      vmstate: poweroff
    '[2]':
      datastoreType: shared
      host: 'host.[3]'
      vmstate: poweroff
    '[3]':
      datastoreType: shared
      host: 'host.[4]'
      vmstate: poweroff
    '[4]':
      datastoreType: shared
      host: 'host.[5]'
      vmstate: poweroff
    '[5]':
      datastoreType: shared
      host: 'host.[2]'
      vmstate: poweroff
    '[6]':
      datastoreType: shared
      host: 'host.[3]'
      vmstate: poweroff
  vsm:
    '[1]':
      assignrole: enterprise_admin
      ippool:
        '[1]':
          gateway: x.x.x.x
          ipranges:
            - a.a.a.a-b.b.b.b
          name: AutoGenerate
          prefixlength: yy
      multicastiprange:
        '[1]':
          begin: 239.1.1.1
          end: 239.1.1.100
          name: AutoGenerate
      reconfigure: true
      segmentidrange:
        '[1]':
          begin: 10000
          end: 19000
          name: AutoGenerate
      vc: 'vc.[1]'
      vxlancontroller:
        '[1]':
          host: 'host.[1]'
          ippool: 'vsm.[1].ippool.[1]'
          name: AutoGenerate
          resourcepool: 'vc.[1].datacenter.[1].cluster.[1]'
Version: 2
WORKLOADS:
  AddRouteVM1VLAN16:
    Testadapter: 'vm.[1].vnic.[1]'
    Type: NetAdapter
    gateway: 172.16.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM1VLAN17:
    Testadapter: 'vm.[1].vnic.[1]'
    Type: NetAdapter
    gateway: 172.17.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM1VLAN18:
    Testadapter: 'vm.[1].vnic.[1]'
    Type: NetAdapter
    gateway: 172.18.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM1VWire1:
    Testadapter: 'vm.[1].vnic.[1]'
    Type: NetAdapter
    gateway: 172.31.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM1VWire2:
    Testadapter: 'vm.[1].vnic.[1]'
    Type: NetAdapter
    gateway: 172.32.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM1VWire3:
    Testadapter: 'vm.[1].vnic.[1]'
    Type: NetAdapter
    gateway: 172.33.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM2VLAN16:
    Testadapter: 'vm.[2].vnic.[1]'
    Type: NetAdapter
    gateway: 172.16.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM2VLAN17:
    Testadapter: 'vm.[2].vnic.[1]'
    Type: NetAdapter
    gateway: 172.17.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM2VLAN18:
    Testadapter: 'vm.[2].vnic.[1]'
    Type: NetAdapter
    gateway: 172.18.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM2VWire1:
    Testadapter: 'vm.[2].vnic.[1]'
    Type: NetAdapter
    gateway: 172.31.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM2VWire2:
    Testadapter: 'vm.[2].vnic.[1]'
    Type: NetAdapter
    gateway: 172.32.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM2VWire3:
    Testadapter: 'vm.[2].vnic.[1]'
    Type: NetAdapter
    gateway: 172.33.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM3VLAN16:
    Testadapter: 'vm.[3].vnic.[1]'
    Type: NetAdapter
    gateway: 172.16.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM3VLAN17:
    Testadapter: 'vm.[3].vnic.[1]'
    Type: NetAdapter
    gateway: 172.17.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM3VLAN18:
    Testadapter: 'vm.[3].vnic.[1]'
    Type: NetAdapter
    gateway: 172.18.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM3VWire1:
    Testadapter: 'vm.[3].vnic.[1]'
    Type: NetAdapter
    gateway: 172.31.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM3VWire2:
    Testadapter: 'vm.[3].vnic.[1]'
    Type: NetAdapter
    gateway: 172.32.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM3VWire3:
    Testadapter: 'vm.[3].vnic.[1]'
    Type: NetAdapter
    gateway: 172.33.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM4VLAN16:
    Testadapter: 'vm.[4].vnic.[1]'
    Type: NetAdapter
    gateway: 172.16.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM4VLAN17:
    Testadapter: 'vm.[4].vnic.[1]'
    Type: NetAdapter
    gateway: 172.17.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM4VLAN18:
    Testadapter: 'vm.[4].vnic.[1]'
    Type: NetAdapter
    gateway: 172.18.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM4VWire1:
    Testadapter: 'vm.[4].vnic.[1]'
    Type: NetAdapter
    gateway: 172.31.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM4VWire2:
    Testadapter: 'vm.[4].vnic.[1]'
    Type: NetAdapter
    gateway: 172.32.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM4VWire3:
    Testadapter: 'vm.[4].vnic.[1]'
    Type: NetAdapter
    gateway: 172.33.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM5VLAN18:
    Testadapter: 'vm.[5].vnic.[1]'
    Type: NetAdapter
    gateway: 172.18.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM5VWire2:
    Testadapter: 'vm.[5].vnic.[1]'
    Type: NetAdapter
    gateway: 172.32.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM5VWire3:
    Testadapter: 'vm.[5].vnic.[1]'
    Type: NetAdapter
    gateway: 172.33.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM6VLAN18:
    Testadapter: 'vm.[6].vnic.[1]'
    Type: NetAdapter
    gateway: 172.18.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM6VWire2:
    Testadapter: 'vm.[6].vnic.[1]'
    Type: NetAdapter
    gateway: 172.32.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteVM6VWire3:
    Testadapter: 'vm.[6].vnic.[1]'
    Type: NetAdapter
    gateway: 172.33.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddVmotionvmknicsHost2and3:
    TestHost: 'host.[2-3]'
    Type: Host
    vmknic:
      '[1]':
        configurevmotion: enable
        ipv4: dhcp
        portgroup: 'vc.[1].dvportgroup.[1]'
  AddVmotionvmknicsHost4and5:
    TestHost: 'host.[4-5]'
    Type: Host
    vmknic:
      '[1]':
        configurevmotion: enable
        ipv4: dhcp
        portgroup: 'vc.[1].dvportgroup.[6]'
  AddvNICsOn1to3VMs:
    TestVM: 'vm.[1],vm.[2],vm.[3]'
    Type: VM
    vnic:
      '[1]':
        allowguestcontrol: 1
        connected: 1
        driver: vmxnet3
        portgroup: 'vsm.[1].networkscope.[1].virtualwire.[1]'
        startconnected: 1
  AddvNICsOn1to4VMs:
    TestVM: 'vm.[5],vm.[6]'
    Type: VM
    vnic:
      '[1]':
        allowguestcontrol: 1
        connected: 1
        driver: vmxnet3
        portgroup: 'vsm.[1].networkscope.[1].virtualwire.[1]'
        startconnected: 1
  AddvNICsOn4to6VMs:
    TestVM: 'vm.[4],vm.[5],vm.[6]'
    Type: VM
    vnic:
      '[1]':
        allowguestcontrol: 1
        connected: 1
        driver: vmxnet3
        portgroup: 'vsm.[1].networkscope.[1].virtualwire.[1]'
        startconnected: 1
  CreateBridges:
    TestVM: 'vsm.[1].vse.[1]'
    Type: VM
    bridge:
      '[1]':
        name: bridge-1-26724
        portgroup: 'vc.[1].dvportgroup.[5]'
        virtualwire: 'vsm.[1].networkscope.[1].virtualwire.[4]'
      '[2]':
        name: bridge-2-26724
        portgroup: 'vc.[1].dvportgroup.[6]'
        virtualwire: 'vsm.[1].networkscope.[1].virtualwire.[5]'
  CreateNetworkScopeClusterSJCandSFO:
    TestNSX: 'vsm.[1]'
    Type: NSX
    networkscope:
      '[1]':
        clusters: 'vc.[1].datacenter.[1].cluster.[2-3]'
        name: network-scope-1-26724
  CreateVLANLIF1:
    TestVM: 'vsm.[1].vse.[1]'
    Type: VM
    lif:
      '[1]':
        addressgroup:
          - addresstype: primary
            ipv4address: 172.16.1.1
            netmask: 255.255.0.0
        connected: 1
        name: lif-vlan1-26724
        portgroup: 'vc.[1].dvportgroup.[1]'
        type: internal
  CreateVLANLIF2:
    TestVM: 'vsm.[1].vse.[1]'
    Type: VM
    lif:
      '[2]':
        addressgroup:
          - addresstype: primary
            ipv4address: 172.17.1.1
            netmask: 255.255.0.0
        connected: 1
        name: lif-vlan2-26724
        portgroup: 'vc.[1].dvportgroup.[2]'
        type: internal
  CreateVXLANLIF1:
    TestVM: 'vsm.[1].vse.[1]'
    Type: VM
    lif:
      '[1]':
        addressgroup:
          - addresstype: primary
            ipv4address: 172.31.1.1
            netmask: 255.255.0.0
        connected: 1
        name: lif-vwire1-26724
        portgroup: 'vsm.[1].networkscope.[1].virtualwire.[1]'
        type: internal
  CreateVXLANLIF2:
    TestVM: 'vsm.[1].vse.[1]'
    Type: VM
    lif:
      '[2]':
        addressgroup:
          - addresstype: primary
            ipv4address: 172.32.1.1
            netmask: 255.255.0.0
        connected: 1
        name: lif-vwire2-26724
        portgroup: 'vsm.[1].networkscope.[1].virtualwire.[2]'
        type: internal
  CreateVXLANLIF3:
    TestVM: 'vsm.[1].vse.[1]'
    Type: VM
    lif:
      '[3]':
        addressgroup:
          - addresstype: primary
            ipv4address: 172.33.1.1
            netmask: 255.255.0.0
        connected: 1
        name: lif-vwire3-26724
        portgroup: 'vsm.[1].networkscope.[1].virtualwire.[3]'
        type: internal
  CreateVirtualWires:
    TestTransportZone: 'vsm.[1].networkscope.[1]'
    Type: TransportZone
    VirtualWire:
      '[1]':
        controlplanemode: HYBRID_MODE
        name: AutoGenerate
        tenantid: AutoGenerate
      '[2]':
        controlplanemode: UNICAST_MODE
        name: AutoGenerate
        tenantid: AutoGenerate
      '[3]':
        controlplanemode: MULTICAST_MODE
        name: AutoGenerate
        tenantid: AutoGenerate
      '[4-8]':
        name: AutoGenerate
        tenantid: AutoGenerate
  DeleteAllVmknics:
    TestHost: 'host.[2-5]'
    Type: Host
    deletevmknic: 'host.[2-5].vmknic.[-1]'
  DeleteController:
    TestNSX: 'vsm.[1]'
    Type: NSX
    deletevxlancontroller: 'vsm.[1].vxlancontroller.[-1]'
  DeleteEdges:
    TestNSX: 'vsm.[1]'
    Type: NSX
    deletevse: 'vsm.[1].vse.[-1]'
  DeleteNetworkScopes:
    TestNSX: 'vsm.[1]'
    Type: NSX
    deletenetworkscope: 'vsm.[1].networkscope.[-1]'
  DeleteVirtualWires: &1
    TestTransportZone: 'vsm.[1].networkscope.[-1]'
    Type: TransportZone
    deletevirtualwire: 'vsm.[1].networkscope.[-1].virtualwire.[-1]'
  Delete_All_VirtualWires: *1
  Deploy2ndController:
    TestNSX: 'vsm.[1]'
    Type: NSX
    vxlancontroller:
      '[2]':
        host: 'host.[1]'
        ippool: 'vsm.[1].ippool.[1]'
        name: AutoGenerate
        resourcepool: 'vc.[1].datacenter.[1].cluster.[1]'
  Deploy3rdController:
    TestNSX: 'vsm.[1]'
    Type: NSX
    vxlancontroller:
      '[3]':
        host: 'host.[1]'
        ippool: 'vsm.[1].ippool.[1]'
        name: AutoGenerate
        resourcepool: 'vc.[1].datacenter.[1].cluster.[1]'
  DeployEdge:
    TestNSX: 'vsm.[1]'
    Type: NSX
    vse:
      '[1]':
        datacenter: 'vc.[1].datacenter.[1]'
        host: 'host.[2]'
        name: Edge-26724
        portgroup: 'vc.[1].dvportgroup.[1]'
        primaryaddress: 10.10.10.13
        resourcepool: 'vc.[1].datacenter.[1].cluster.[2]'
        subnetmask: 255.255.255.0
  DeployFirstController:
    TestNSX: 'vsm.[1]'
    Type: NSX
    vxlancontroller:
      '[1]':
        firstnodeofcluster: true
        host: 'host.[1]'
        ippool: 'vsm.[1].ippool.[1]'
        name: AutoGenerate
        resourcepool: 'vc.[1].datacenter.[1].cluster.[1]'
  EnableHAandDRSOnClusterSJCandSFO:
    DRS: 1
    EditCluster: edit
    HA: 1
    TestCluster: 'vc.[1].datacenter.[1].cluster.[2-3]'
    Type: Cluster
  ExitSequence:
    -
      - DeleteEdges
    -
      - RemovevNICFromVM1
      - RemovevNICFromVM2
      - RemovevNICFromVM3
      - RemovevNICFromVM4
      - RemovevNICFromVM5
      - RemovevNICFromVM6
    -
      - Delete_All_VirtualWires
    -
      - DeleteNetworkScopes
    -
      - Uninstall_VDNCluster
    -
      - RemoveHostsFromClusterSJC
      - RemoveHostsFromClusterSFO
    -
      - RebootHost2
      - RebootHost3
      - RebootHost4
      - RebootHost5
  Install_Configure_ClusterSFO:
    TestNSX: 'vsm.[1]'
    Type: NSX
    VDNCluster:
      '[2]':
        cluster: 'vc.[1].datacenter.[1].cluster.[3]'
        mtu: 1600
        switch: 'vc.[1].vds.[2]'
        teaming: FAILOVER_ORDER
        vibs: install
        vlan: 22
        vmkniccount: 1
  Install_Configure_ClusterSJC:
    TestNSX: 'vsm.[1]'
    Type: NSX
    VDNCluster:
      '[1]':
        cluster: 'vc.[1].datacenter.[1].cluster.[2]'
        mtu: 1600
        switch: 'vc.[1].vds.[1]'
        teaming:
          - LOADBALANCE_SRCMAC
          - LOADBALANCE_SRCID
          - LOADBALANCE_LOADBASED
          - FAILOVER_ORDER
          - ETHER_CHANNEL
        vibs: install
        vlan:
          - 21
        vmkniccount: 1
  MakeSurevNICConnectedVM1andVM2:
    Type: NetAdapter
    connected: 1
    reconfigure: true
    startconnected: 1
    testadapter: 'vm.[1-2].vnic.[1]'
  MoveHostsToClusterSFO:
    MoveHostsToCluster: 'host.[4],host.[5]'
    TestCluster: 'vc.[1].datacenter.[1].cluster.[3]'
    Type: Cluster
  MoveHostsToClusterSJC:
    MoveHostsToCluster: 'host.[2],host.[3]'
    TestCluster: 'vc.[1].datacenter.[1].cluster.[2]'
    Type: Cluster
  NetperfTest2VMsToOther2VMs:
    ExpectedResult: ignore
    L4Protocol: 'tcp,udp'
    LocalSendSocketSize: 131072
    NoofInbound: 1
    NoofOutbound: 1
    ParallelSession: yes
    RemoteSendSocketSize: 131072
    SendMessageSize: '16384,128804'
    SupportAdapter: 'vm.[5-6].vnic.[1]'
    TestAdapter: 'vm.[1-2].vnic.[1]'
    TestDuration: 60
    ToolName: Netperf
    Type: Traffic
    maxtimeout: 128000
  NetperfTest3VMsToOther3VMs:
    ExpectedResult: ignore
    LocalSendSocketSize: 131072
    NoofInbound: 1
    NoofOutbound: 1
    ParallelSession: yes
    RemoteSendSocketSize: 131072
    SendMessageSize: '16384,96684,128804'
    SupportAdapter: 'vm.[4-6].vnic.[1]'
    TestAdapter: 'vm.[1-3].vnic.[1]'
    TestDuration: 60
    ToolName: Netperf
    Type: Traffic
    maxtimeout: 128000
  NetperfTestIgnorethroughput:
    ExpectedResult: ignore
    NoofOutbound: 1
    SupportAdapter: 'vm.[2].vnic.[1]'
    TestAdapter: 'vm.[1].vnic.[1]'
    TestDuration: 60
    ToolName: iperf
    Type: Traffic
  NetperfTestVM1ToAllOthers:
    ExpectedResult: ignore
    NoofInbound: 3
    NoofOutbound: 10
    ParallelSession: yes
    SupportAdapter: 'vm.[2-6].vnic.[1]'
    TestAdapter: 'vm.[1].vnic.[1]'
    TestDuration: 60
    ToolName: 'Netperf,Iperf,Ping'
    Type: Traffic
    maxtimeout: 128000
  PingTest:
    NoofInbound: 1
    NoofOutbound: 1
    ParallelSession: yes
    SupportAdapter: 'vm.[2].vnic.[1]'
    TestAdapter: 'vm.[1].vnic.[1]'
    TestDuration: 60
    ToolName: Ping
    Type: Traffic
    maxtimeout: 128000
  PingTest2VMsToOther2VMs:
    NoofInbound: 1
    NoofOutbound: 1
    SupportAdapter: 'vm.[5-6].vnic.[1]'
    TestAdapter: 'vm.[1-2].vnic.[1]'
    TestDuration: 60
    ToolName: Ping
    Type: Traffic
    maxtimeout: 128000
  PingTest3VMsToOther3VMs:
    NoofInbound: 1
    NoofOutbound: 1
    SupportAdapter: 'vm.[4-6].vnic.[1]'
    TestAdapter: 'vm.[1-3].vnic.[1]'
    TestDuration: 60
    ToolName: Ping
    Type: Traffic
    maxtimeout: 128000
  PingTestSameCluster1:
    NoofInbound: 1
    NoofOutbound: 1
    SupportAdapter: 'vm.[2].vnic.[1]'
    TestAdapter: 'vm.[1].vnic.[1]'
    TestDuration: 60
    ToolName: Ping
    Type: Traffic
    maxtimeout: 128000
  PingTestSameCluster2:
    NoofInbound: 1
    NoofOutbound: 1
    SupportAdapter: 'vm.[4].vnic.[1]'
    TestAdapter: 'vm.[3].vnic.[1]'
    TestDuration: 60
    ToolName: Ping
    Type: Traffic
    maxtimeout: 128000
  PingTestVM1ToAllOthers:
    NoofInbound: 1
    NoofOutbound: 1
    ParallelSession: yes
    SupportAdapter: 'vm.[2-6].vnic.[1]'
    TestAdapter: 'vm.[1].vnic.[1]'
    TestDuration: 60
    ToolName: Ping
    Type: Traffic
    maxtimeout: 128000
  PlaceVM1OnVLAN16_VDS1:
    Type: NetAdapter
    portgroup: 'vc.[1].dvportgroup.[1]'
    reconfigure: true
    testadapter: 'vm.[1].vnic.[1]'
  PlaceVM1OnvWire1:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[1]'
    reconfigure: true
    testadapter: 'vm.[1].vnic.[1]'
  PlaceVM1OnvWire2:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[2]'
    reconfigure: true
    testadapter: 'vm.[1].vnic.[1]'
  PlaceVM1OnvWire3:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[3]'
    reconfigure: true
    testadapter: 'vm.[1].vnic.[1]'
  PlaceVM1OnvWire4:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[4]'
    reconfigure: true
    testadapter: 'vm.[1].vnic.[1]'
  PlaceVM2OnMgmtdvpg:
    Type: NetAdapter
    portgroup: 'vc.[1].dvportgroup.[1]'
    reconfigure: true
    testadapter: 'vm.[2].vnic.[1]'
  PlaceVM2OnVLAN17_VDS1:
    Type: NetAdapter
    portgroup: 'vc.[1].dvportgroup.[2]'
    reconfigure: true
    testadapter: 'vm.[2].vnic.[1]'
  PlaceVM2OnVLAN21_VDS1:
    Type: NetAdapter
    portgroup: 'vc.[1].dvportgroup.[5]'
    reconfigure: true
    testadapter: 'vm.[2].vnic.[1]'
  PlaceVM2OnvWire1:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[1]'
    reconfigure: true
    testadapter: 'vm.[2].vnic.[1]'
  PlaceVM2OnvWire2:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[2]'
    reconfigure: true
    testadapter: 'vm.[2].vnic.[1]'
  PlaceVM2OnvWire3:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[3]'
    reconfigure: true
    testadapter: 'vm.[2].vnic.[1]'
  PlaceVM3OnVLAN16_VDS2:
    Type: NetAdapter
    portgroup: 'vc.[1].dvportgroup.[7]'
    reconfigure: true
    testadapter: 'vm.[3].vnic.[1]'
  PlaceVM3OnVLAN21_VDS2:
    Type: NetAdapter
    portgroup: 'vc.[1].dvportgroup.[5]'
    reconfigure: true
    testadapter: 'vm.[3].vnic.[1]'
  PlaceVM3OnvWire1:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[1]'
    reconfigure: true
    testadapter: 'vm.[3].vnic.[1]'
  PlaceVM3OnvWire2:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[2]'
    reconfigure: true
    testadapter: 'vm.[3].vnic.[1]'
  PlaceVM3OnvWire3:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[3]'
    reconfigure: true
    testadapter: 'vm.[3].vnic.[1]'
  PlaceVM4OnVLAN17_VDS2:
    Type: NetAdapter
    portgroup: 'vc.[1].dvportgroup.[8]'
    reconfigure: true
    testadapter: 'vm.[3].vnic.[1]'
  PlaceVM4OnvWire1:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[1]'
    reconfigure: true
    testadapter: 'vm.[4].vnic.[1]'
  PlaceVM4OnvWire2:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[2]'
    reconfigure: true
    testadapter: 'vm.[4].vnic.[1]'
  PlaceVM4OnvWire3:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[3]'
    reconfigure: true
    testadapter: 'vm.[4].vnic.[1]'
  PlaceVM5OnvWire1:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[1]'
    reconfigure: true
    testadapter: 'vm.[5].vnic.[1]'
  PlaceVM5OnvWire2:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[2]'
    reconfigure: true
    testadapter: 'vm.[5].vnic.[1]'
  PlaceVM5OnvWire3:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[3]'
    reconfigure: true
    testadapter: 'vm.[5].vnic.[1]'
  PlaceVM6OnVLAN18_VDS1:
    Type: NetAdapter
    portgroup: 'vc.[1].dvportgroup.[3]'
    reconfigure: true
    testadapter: 'vm.[6].vnic.[1]'
  PlaceVM6OnvWire1:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[1]'
    reconfigure: true
    testadapter: 'vm.[6].vnic.[1]'
  PlaceVM6OnvWire2:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[2]'
    reconfigure: true
    testadapter: 'vm.[6].vnic.[1]'
  PlaceVM6OnvWire3:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[3]'
    reconfigure: true
    testadapter: 'vm.[6].vnic.[1]'
  PlaceVMsOnMgmtdvPG:
    Type: NetAdapter
    portgroup: 'vc.[1].dvportgroup.[4]'
    reconfigure: true
    testadapter: 'vm.[1-3].vnic.[1]'
  PoweroffVM1:
    TestVM: 'vm.[1]'
    Type: VM
    vmstate: poweroff
  PoweroffVM2:
    TestVM: 'vm.[2]'
    Type: VM
    vmstate: poweroff
  PoweroffVM3:
    TestVM: 'vm.[3]'
    Type: VM
    vmstate: poweroff
  PoweronVM1:
    TestVM: 'vm.[1]'
    Type: VM
    vmstate: poweron
  PoweronVM2:
    TestVM: 'vm.[2]'
    Type: VM
    vmstate: poweron
  PoweronVM3:
    TestVM: 'vm.[3]'
    Type: VM
    vmstate: poweron
  PoweronVM4:
    TestVM: 'vm.[4]'
    Type: VM
    vmstate: poweron
  PoweronVM5:
    TestVM: 'vm.[5]'
    Type: VM
    vmstate: poweron
  PoweronVM6:
    TestVM: 'vm.[6]'
    Type: VM
    vmstate: poweron
  PrepClusterSFO:
    TestNSX: 'vsm.[1]'
    Type: NSX
    VDNCluster:
      '[3]':
        cluster: 'vc.[1].datacenter.[1].cluster.[3]'
  ReDeployEdge:
    TestVM: 'vsm.[1].vse.[1]'
    Type: VM
    applianceaction: redeploy
  RebootHost:
    TestHost: 'host.[1]'
    Type: Host
    reboot: yes
  RebootHost2:
    TestHost: 'host.[2]'
    Type: Host
    reboot: yes
  RebootHost3:
    TestHost: 'host.[3]'
    Type: Host
    reboot: yes
  RebootHost4:
    TestHost: 'host.[4]'
    Type: Host
    reboot: yes
  RebootHost5:
    TestHost: 'host.[5]'
    Type: Host
    reboot: yes
  RemoveHostsFromClusterSFO:
    MoveHostsFromCluster: 'host.[4],host.[5]'
    TestCluster: 'vc.[1].datacenter.[1].cluster.[3]'
    Type: Cluster
  RemoveHostsFromClusterSJC:
    MoveHostsFromCluster: 'host.[2],host.[3]'
    TestCluster: 'vc.[1].datacenter.[1].cluster.[2]'
    Type: Cluster
  RemovevNICFromVM1:
    TestVM: 'vm.[1]'
    Type: VM
    deletevnic: 'vm.[1].vnic.[1]'
  RemovevNICFromVM1To3:
    TestVM: 'vm.[1-3]'
    Type: VM
    deletevnic: 'vm.[x].vnic.[1]'
  RemovevNICFromVM2:
    TestVM: 'vm.[2]'
    Type: VM
    deletevnic: 'vm.[2].vnic.[1]'
  RemovevNICFromVM3:
    TestVM: 'vm.[3]'
    Type: VM
    deletevnic: 'vm.[3].vnic.[1]'
  RemovevNICFromVM4:
    TestVM: 'vm.[4]'
    Type: VM
    deletevnic: 'vm.[4].vnic.[1]'
  RemovevNICFromVM4To6:
    TestVM: 'vm.[4-6]'
    Type: VM
    deletevnic: 'vm.[x].vnic.[1]'
  RemovevNICFromVM5:
    TestVM: 'vm.[5]'
    Type: VM
    deletevnic: 'vm.[5].vnic.[1]'
  RemovevNICFromVM6:
    TestVM: 'vm.[6]'
    Type: VM
    deletevnic: 'vm.[6].vnic.[1]'
  ResetMulticast:
    TestNSX: 'vsm.[1]'
    Type: NSX
    deletemulticastiprange: 'vsm.[1].multicastiprange.[-1]'
  ResetSegmentID:
    TestNSX: 'vsm.[1]'
    Type: NSX
    deletesegmentidrange: 'vsm.[1].segmentidrange.[-1]'
  SamevWireNetperfTestDifferentCluster:
    MinExpResult: 1
    NoofInbound: 1
    NoofOutbound: 1
    SupportAdapter: 'vm.[3].vnic.[1]'
    TestAdapter: 'vm.[1].vnic.[1]'
    TestDuration: 60
    Type: Traffic
    l3protocol: 'ipv4,ipv6'
    l4protocol: 'tcp,udp'
    maxtimeout: 128000
  Sequence:
    -
      - MoveHostsToClusterSJC
    -
      - MoveHostsToClusterSFO
    -
      - Install_Configure_ClusterSJC
      - Install_Configure_ClusterSFO
    -
      - CreateNetworkScopeClusterSJCandSFO
    -
      - CreateVirtualWires
    -
      - AddvNICsOn1to3VMs
      - AddvNICsOn4to6VMs
    -
      - PoweronVM1
      - PoweronVM2
    -
      - MakeSurevNICConnectedVM1andVM2
    -
      - SetIPVM1VWire1
      - SetIPVM2VWire1
    -
      - PingTest
    -
      - DeployEdge
    -
      - CreateVXLANLIF1
    -
      - CreateVXLANLIF2
    -
      - CreateVXLANLIF3
    -
      - CreateBridges
    -
      - PlaceVM1OnvWire1
      - PlaceVM2OnvWire2
    -
      - SetIPVM1VWire1
      - SetIPVM2VWire2
    -
      - AddRouteVM1VWire1
      - AddRouteVM2VWire2
    -
      - PingTest
    -
      - PlaceVM1OnvWire4
      - PlaceVM2OnVLAN21_VDS1
    -
      - SetIPVM1VWire4
      - SetIPVM2VLAN21
    -
      - PingTest
    -
      - PoweronVM3
      - PoweronVM4
      - PoweronVM5
      - PoweronVM6
    -
      - PlaceVM1OnvWire1
      - PlaceVM2OnvWire1
      - PlaceVM3OnvWire1
      - PlaceVM4OnvWire1
      - PlaceVM5OnvWire1
      - PlaceVM6OnvWire1
    -
      - SetIPVM1VWire1
      - SetIPVM2VWire1
      - SetIPVM3VWire1
      - SetIPVM4VWire1
      - SetIPVM5VWire1
      - SetIPVM6VWire1
    -
      - PingTestVM1ToAllOthers
    -
      - PingTest3VMsToOther3VMs
    -
      - PlaceVM1OnvWire1
      - PlaceVM2OnvWire1
      - PlaceVM3OnvWire2
      - PlaceVM4OnvWire2
      - PlaceVM5OnvWire3
      - PlaceVM6OnvWire3
    -
      - SetIPVM1VWire1
      - SetIPVM2VWire1
      - SetIPVM3VWire2
      - SetIPVM4VWire2
      - SetIPVM5VWire3
      - SetIPVM6VWire3
    -
      - AddRouteVM1VWire1
      - AddRouteVM2VWire1
      - AddRouteVM3VWire2
      - AddRouteVM4VWire2
      - AddRouteVM5VWire3
      - AddRouteVM6VWire3
    -
      - PingTestVM1ToAllOthers
    -
      - ReDeployEdge
    -
      - PlaceVM1OnvWire1
      - PlaceVM2OnvWire1
      - PlaceVM3OnvWire2
      - PlaceVM4OnvWire2
      - PlaceVM5OnvWire3
      - PlaceVM6OnvWire3
    -
      - SetIPVM1VWire1
      - SetIPVM2VWire1
      - SetIPVM3VWire2
      - SetIPVM4VWire2
      - SetIPVM5VWire3
      - SetIPVM6VWire3
    -
      - AddRouteVM1VWire1
      - AddRouteVM2VWire1
      - AddRouteVM3VWire2
      - AddRouteVM4VWire2
      - AddRouteVM5VWire3
      - AddRouteVM6VWire3
    -
      - PingTestVM1ToAllOthers
  SetIPVM1VLAN16:
    Testadapter: 'vm.[1].vnic.[1]'
    Type: NetAdapter
    ipv4: dhcp
  SetIPVM1VLAN17:
    Testadapter: 'vm.[1].vnic.[1]'
    Type: NetAdapter
    ipv4: dhcp
  SetIPVM1VLAN18:
    Testadapter: 'vm.[1].vnic.[1]'
    Type: NetAdapter
    ipv4: dhcp
  SetIPVM1VWire1:
    Testadapter: 'vm.[1].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.31.1.15
    netmask: 255.255.0.0
  SetIPVM1VWire2:
    Testadapter: 'vm.[1].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.32.1.15
    netmask: 255.255.0.0
  SetIPVM1VWire3:
    Testadapter: 'vm.[1].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.33.1.15
    netmask: 255.255.0.0
  SetIPVM1VWire4:
    Testadapter: 'vm.[1].vnic.[1]'
    Type: NetAdapter
    ipv4: dhcp
  SetIPVM2VLAN16:
    Testadapter: 'vm.[2].vnic.[1]'
    Type: NetAdapter
    ipv4: dhcp
  SetIPVM2VLAN17:
    Testadapter: 'vm.[2].vnic.[1]'
    Type: NetAdapter
    ipv4: dhcp
  SetIPVM2VLAN18:
    Testadapter: 'vm.[2].vnic.[1]'
    Type: NetAdapter
    ipv4: dhcp
  SetIPVM2VLAN21:
    Testadapter: 'vm.[2].vnic.[1]'
    Type: NetAdapter
    ipv4: dhcp
  SetIPVM2VWire1:
    Testadapter: 'vm.[2].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.31.1.25
    netmask: 255.255.0.0
  SetIPVM2VWire2:
    Testadapter: 'vm.[2].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.32.1.25
    netmask: 255.255.0.0
  SetIPVM2VWire3:
    Testadapter: 'vm.[2].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.33.1.25
    netmask: 255.255.0.0
  SetIPVM3VLAN16:
    Testadapter: 'vm.[3].vnic.[1]'
    Type: NetAdapter
    ipv4: dhcp
  SetIPVM3VLAN17:
    Testadapter: 'vm.[3].vnic.[1]'
    Type: NetAdapter
    ipv4: dhcp
  SetIPVM3VLAN18:
    Testadapter: 'vm.[3].vnic.[1]'
    Type: NetAdapter
    ipv4: dhcp
  SetIPVM3VWire1:
    Testadapter: 'vm.[3].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.31.1.35
    netmask: 255.255.0.0
  SetIPVM3VWire2:
    Testadapter: 'vm.[3].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.32.1.35
    netmask: 255.255.0.0
  SetIPVM3VWire3:
    Testadapter: 'vm.[3].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.33.1.35
    netmask: 255.255.0.0
  SetIPVM4VLAN16:
    Testadapter: 'vm.[4].vnic.[1]'
    Type: NetAdapter
    ipv4: dhcp
  SetIPVM4VLAN17:
    Testadapter: 'vm.[4].vnic.[1]'
    Type: NetAdapter
    ipv4: dhcp
  SetIPVM4VLAN18:
    Testadapter: 'vm.[4].vnic.[1]'
    Type: NetAdapter
    ipv4: dhcp
  SetIPVM4VWire1:
    Testadapter: 'vm.[4].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.31.1.45
    netmask: 255.255.0.0
  SetIPVM4VWire2:
    Testadapter: 'vm.[4].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.32.1.45
    netmask: 255.255.0.0
  SetIPVM4VWire3:
    Testadapter: 'vm.[4].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.33.1.45
    netmask: 255.255.0.0
  SetIPVM5VLAN18:
    Testadapter: 'vm.[5].vnic.[1]'
    Type: NetAdapter
    ipv4: dhcp
  SetIPVM5VWire1:
    Testadapter: 'vm.[5].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.31.1.55
    netmask: 255.255.0.0
  SetIPVM5VWire2:
    Testadapter: 'vm.[5].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.32.1.55
    netmask: 255.255.0.0
  SetIPVM5VWire3:
    Testadapter: 'vm.[5].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.33.1.55
    netmask: 255.255.0.0
  SetIPVM6VLAN18:
    Testadapter: 'vm.[6].vnic.[1]'
    Type: NetAdapter
    ipv4: dhcp
  SetIPVM6VWire1:
    Testadapter: 'vm.[6].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.31.1.65
    netmask: 255.255.0.0
  SetIPVM6VWire2:
    Testadapter: 'vm.[6].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.32.1.65
    netmask: 255.255.0.0
  SetIPVM6VWire3:
    Testadapter: 'vm.[6].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.33.1.65
    netmask: 255.255.0.0
  SetMulticastRange:
    Multicastiprange:
      '[1]':
        begin: 239.0.0.101
        end: 239.254.254.254
        name: AutoGenerate
    TestNSX: 'vsm.[1]'
    Type: NSX
  SetSegmentIDRange:
    TestNSX: 'vsm.[1]'
    Type: NSX
    segmentidrange:
      '[1]':
        begin: 5001-10001
        end: 99000
        name: AutoGenerate
  Uninstall_VDNCluster:
    TestNSX: 'vsm.[1]'
    Type: NSX
    deletevdncluster: 'vsm.[1].vdncluster.[-1]'
  vMotionVM2ToHost3:
    Iterations: 1
    TestVM: 'vm.[3]'
    Type: VM
    dsthost: 'host.[2]'
    vmotion: oneway
---
Category: NSX
Component: network vDR
Summary: 'Add/Remove uplinks of the VDS in a loop and verify data traffic '
Tags: RunOnCAT
TestName: ChangingUplinks
TestbedSpec:
  host:
    '[1]': {}
    '[2-4]':
      vmnic:
        '[1-2]':
          driver: any
  vc:
    '[1]':
      datacenter:
        '[1]':
          Cluster:
            '[1]':
              host: 'host.[1]'
              name: Controller-Cluster-26724
            '[2]':
              host: 'host.[2-3]'
              name: Compute-Cluster-26724
            '[3]':
              host: 'host.[4]'
              name: Compute-Cluster2-26724
      dvportgroup:
        '[1]':
          name: dvpg-mgmt-26724
          vds: 'vc.[1].vds.[1]'
        '[2]':
          name: dvpg-vlan16-26724
          vds: 'vc.[1].vds.[1]'
          vlan: 16
          vlantype: access
        '[3]':
          name: dvpg-vlan17-26724
          vds: 'vc.[1].vds.[1]'
          vlan: 17
          vlantype: access
        '[4]':
          name: dvpg-vlan21-26724
          vds: 'vc.[1].vds.[1]'
          vlan: 21
          vlantype: access
      vds:
        '[1]':
          configurehosts: add
          datacenter: 'vc.[1].datacenter.[1]'
          host: 'host.[2-4]'
          numuplinkports: 1
          vmnicadapter: 'host.[2-4].vmnic.[1]'
  vm:
    '[1-2]':
      datastoreType: shared
      host: 'host.[2]'
      vmstate: poweroff
    '[3]':
      datastoreType: shared
      host: 'host.[3]'
      vmstate: poweroff
  vsm:
    '[1]':
      VDNCluster:
        '[1]':
          cluster: 'vc.[1].datacenter.[1].cluster.[2]'
          mtu: 1600
          switch: 'vc.[1].vds.[1]'
          teaming: &1
            - LOADBALANCE_SRCMAC
            - LOADBALANCE_SRCID
            - LOADBALANCE_LOADBASED
            - FAILOVER_ORDER
            - ETHER_CHANNEL
          vibs: install
          vlan:
            - 21
          vmkniccount: 1
      assignrole: enterprise_admin
      ippool:
        '[1]':
          gateway: x.x.x.x
          ipranges:
            - a.a.a.a-b.b.b.b
          name: AutoGenerate
          prefixlength: yy
      multicastiprange:
        '[1]':
          begin: 239.1.1.1
          end: 239.1.1.100
          name: AutoGenerate
      reconfigure: true
      segmentidrange:
        '[1]':
          begin: 10000
          end: 19000
          name: AutoGenerate
      vc: 'vc.[1]'
      vxlancontroller:
        '[1]':
          host: 'host.[1]'
          ippool: 'vsm.[1].ippool.[1]'
          name: AutoGenerate
          resourcepool: 'vc.[1].datacenter.[1].cluster.[1]'
        '[2]':
          host: 'host.[1]'
          ippool: 'vsm.[1].ippool.[1]'
          name: AutoGenerate
          resourcepool: 'vc.[1].datacenter.[1].cluster.[1]'
        '[3]':
          host: 'host.[1]'
          ippool: 'vsm.[1].ippool.[1]'
          name: AutoGenerate
          resourcepool: 'vc.[1].datacenter.[1].cluster.[1]'
Version: 2
WORKLOADS:
  AddVLANRouteVM1:
    Testadapter: 'vm.[1].vnic.[1]'
    Type: NetAdapter
    gateway: 172.16.1.1
    netmask: 255.255.0.0
    network: '172.17.0.0,172.31.0.0,172.32.0.0'
    route: add
  AddVLANRouteVM2:
    Testadapter: 'vm.[2].vnic.[1]'
    Type: NetAdapter
    gateway: 172.17.1.1
    netmask: 255.255.0.0
    network: '172.16.0.0,172.31.0.0,172.32.0.0'
    route: add
  AddVLANRouteVM3:
    Testadapter: 'vm.[3].vnic.[1]'
    Type: NetAdapter
    gateway: 172.17.1.1
    netmask: 255.255.0.0
    network: '172.16.0.0,172.31.0.0,172.32.0.0'
    route: add
  AddVXLANRouteVM1:
    Testadapter: 'vm.[1].vnic.[1]'
    Type: NetAdapter
    gateway: 172.31.1.1
    netmask: 255.255.0.0
    network: '172.32.0.0,172.16.0.0,172.17.0.0'
    route: add
  AddVXLANRouteVM2:
    Testadapter: 'vm.[2].vnic.[1]'
    Type: NetAdapter
    gateway: 172.32.1.1
    netmask: 255.255.0.0
    network: '172.31.0.0,172.16.0.0,172.17.0.0'
    route: add
  AddVXLANRouteVM3:
    Testadapter: 'vm.[3].vnic.[1]'
    Type: NetAdapter
    gateway: 172.32.1.1
    netmask: 255.255.0.0
    network: '172.31.0.0,172.16.0.0,172.17.0.0'
    route: add
  AddvNICForvMotion:
    TestVM: 'vm.[1],vm.[2]'
    Type: VM
    vnic:
      '[2]':
        allowguestcontrol: 1
        connected: 1
        driver: vmxnet3
        portgroup: 'vc.[1].dvportgroup.[1]'
        startconnected: 1
  AddvNICsOnVMs:
    TestVM: 'vm.[1],vm.[2],vm.[3]'
    Type: VM
    vnic:
      '[1]':
        allowguestcontrol: 1
        connected: 1
        driver: vmxnet3
        portgroup: 'vsm.[1].networkscope.[1].virtualwire.[1]'
        startconnected: 1
  BridgevWire3ToVLAN21:
    TestVM: 'vsm.[1].vse.[1]'
    Type: VM
    bridge:
      '[1]':
        name: bridge-1-26724
        portgroup: 'vc.[1].dvportgroup.[4]'
        virtualwire: 'vsm.[1].networkscope.[1].virtualwire.[3]'
  CreateNetworkScope:
    TestNSX: 'vsm.[1]'
    Type: NSX
    networkscope:
      '[1]':
        clusters: 'vc.[1].datacenter.[1].cluster.[2]'
        name: network-scope-1-26724
  CreateVLANLIF3:
    TestVM: 'vsm.[1].vse.[1]'
    Type: VM
    lif:
      '[3]':
        addressgroup:
          - addresstype: primary
            ipv4address: 172.16.1.1
            netmask: 255.255.0.0
        connected: 1
        name: lif-16-26724
        portgroup: 'vc.[1].dvportgroup.[2]'
        type: internal
  CreateVLANLIF4:
    TestVM: 'vsm.[1].vse.[1]'
    Type: VM
    lif:
      '[4]':
        addressgroup:
          - addresstype: primary
            ipv4address: 172.17.1.1
            netmask: 255.255.0.0
        connected: 1
        name: lif-17-26724
        portgroup: 'vc.[1].dvportgroup.[3]'
        type: internal
  CreateVXLANLIF1:
    TestVM: 'vsm.[1].vse.[1]'
    Type: VM
    lif:
      '[1]':
        addressgroup:
          - addresstype: primary
            ipv4address: 172.31.1.1
            netmask: 255.255.0.0
        connected: 1
        name: lif-vwire1-26724
        portgroup: 'vsm.[1].networkscope.[1].virtualwire.[1]'
        type: internal
  CreateVXLANLIF2:
    TestVM: 'vsm.[1].vse.[1]'
    Type: VM
    lif:
      '[2]':
        addressgroup:
          - addresstype: primary
            ipv4address: 172.32.1.1
            netmask: 255.255.0.0
        connected: 1
        name: lif-vwire2-26724
        portgroup: 'vsm.[1].networkscope.[1].virtualwire.[2]'
        type: internal
  CreateVirtualWires:
    TestTransportZone: 'vsm.[1].networkscope.[1]'
    Type: TransportZone
    VirtualWire:
      '[1]':
        name: AutoGenerate
        tenantid: 1
      '[2]':
        name: AutoGenerate
        tenantid: 2
      '[3]':
        name: AutoGenerate
        tenantid: 3
  DeleteController:
    TestNSX: 'vsm.[1]'
    Type: NSX
    deletevxlancontroller: 'vsm.[1].vxlancontroller.[-1]'
  DeleteEdges:
    TestNSX: 'vsm.[1]'
    Type: NSX
    deletevse: 'vsm.[1].vse.[-1]'
  DeleteIPPool:
    TestNSX: 'vsm.[1]'
    Type: NSX
    deleteippool: 'vsm.[1].ippool.[1]'
    sleepbetweenworkloads: 10
  DeleteNetworkScope: &2
    TestNSX: 'vsm.[1]'
    Type: NSX
    deletenetworkscope: 'vsm.[1].networkscope.[-1]'
  DeleteNetworkScopes: *2
  DeleteVirtualWires:
    TestTransportZone: 'vsm.[1].networkscope.[1]'
    Type: TransportZone
    deletevirtualwire: 'vsm.[1].networkscope.[1].virtualwire.[1-3]'
  Delete_All_VirtualWires:
    TestTransportZone: 'vsm.[1].networkscope.[-1]'
    Type: TransportZone
    deletevirtualwire: 'vsm.[1].networkscope.[-1].virtualwire.[-1]'
  Deploy2ndController:
    TestNSX: 'vsm.[1]'
    Type: NSX
    vxlancontroller:
      '[2]':
        host: 'host.[1]'
        ippool: 'vsm.[1].ippool.[1]'
        name: AutoGenerate
        resourcepool: 'vc.[1].datacenter.[1].cluster.[1]'
  Deploy3rdController:
    TestNSX: 'vsm.[1]'
    Type: NSX
    vxlancontroller:
      '[3]':
        host: 'host.[1]'
        ippool: 'vsm.[1].ippool.[1]'
        name: AutoGenerate
        resourcepool: 'vc.[1].datacenter.[1].cluster.[1]'
  DeployEdge:
    TestNSX: 'vsm.[1]'
    Type: NSX
    vse:
      '[1]':
        datacenter: 'vc.[1].datacenter.[1]'
        host: 'host.[2]'
        name: Edge-26724
        portgroup: 'vc.[1].dvportgroup.[1]'
        primaryaddress: 10.10.10.30
        resourcepool: 'vc.[1].datacenter.[1].cluster.[2]'
        subnetmask: 255.255.255.0
  DeployFirstController:
    TestNSX: 'vsm.[1]'
    Type: NSX
    vxlancontroller:
      '[1]':
        firstnodeofcluster: true
        host: 'host.[1]'
        ippool: 'vsm.[1].ippool.[1]'
        name: AutoGenerate
        resourcepool: 'vc.[1].datacenter.[1].cluster.[1]'
  ExitSequence:
    -
      - DeleteEdges
    -
      - RemovevNICFromVM1
      - RemovevNICFromVM2
      - RemovevNICFromVM3
    -
      - Delete_All_VirtualWires
    -
      - DeleteNetworkScopes
  GetVirtualWireID:
    FindType: Switch
    Type: Switch
    testvirtualwire: 'vsm.[1].networkscope.[1].virtualwire.[1]'
  Install_Configure_ClusterSJC:
    TestNSX: 'vsm.[1]'
    Type: NSX
    VDNCluster:
      '[1]':
        cluster: 'vc.[1].datacenter.[1].cluster.[2]'
        mtu: 1600
        switch: 'vc.[1].vds.[1]'
        teaming: *1
        vibs: install
        vlan:
          - 21
        vmkniccount: 1
  MakeSurevNICConnected:
    Type: NetAdapter
    connected: 1
    reconfigure: true
    startconnected: 1
    testadapter: 'vm.[1-2].vnic.[1]'
  MoveHostsToClusterSFO:
    MoveHostsToCluster: 'host.[4],host.[5]'
    TestCluster: 'vc.[1].datacenter.[1].cluster.[3]'
    Type: Cluster
  NetperfTestDifferentHostIgnoreThroughput:
    ExpectedResult: ignore
    NoofOutbound: 1
    SupportAdapter: 'vm.[3].vnic.[1]'
    TestAdapter: 'vm.[1].vnic.[1]'
    TestDuration: 10
    Type: Traffic
    l4protocol: udp
  PingTest:
    NoofInbound: 1
    NoofOutbound: 1
    SupportAdapter: 'vm.[2].vnic.[1]'
    TestAdapter: 'vm.[1].vnic.[1]'
    TestDuration: 6
    ToolName: Ping
    Type: Traffic
    maxtimeout: 128000
  PingTestDifferentHost:
    NoofInbound: 1
    NoofOutbound: 1
    SupportAdapter: 'vm.[3].vnic.[1]'
    TestAdapter: 'vm.[1].vnic.[1]'
    TestDuration: 6
    ToolName: Ping
    Type: Traffic
    maxtimeout: 128000
  PlaceVM1OnVLAN16:
    Type: NetAdapter
    portgroup: 'vc.[1].dvportgroup.[2]'
    reconfigure: true
    testadapter: 'vm.[1].vnic.[1]'
  PlaceVM1OnvWire1:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[1]'
    reconfigure: true
    testadapter: 'vm.[1].vnic.[1]'
  PlaceVM1OnvWire3:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[3]'
    reconfigure: true
    testadapter: 'vm.[1].vnic.[1]'
  PlaceVM2OnMgmtdvpg:
    Type: NetAdapter
    portgroup: 'vc.[1].dvportgroup.[1]'
    reconfigure: true
    testadapter: 'vm.[2].vnic.[1]'
  PlaceVM2OnVLAN17:
    Type: NetAdapter
    portgroup: 'vc.[1].dvportgroup.[3]'
    reconfigure: true
    testadapter: 'vm.[2].vnic.[1]'
  PlaceVM2OnVLAN21:
    Type: NetAdapter
    portgroup: 'vc.[1].dvportgroup.[4]'
    reconfigure: true
    testadapter: 'vm.[2].vnic.[1]'
  PlaceVM2OnvWire2:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[2]'
    reconfigure: true
    testadapter: 'vm.[2].vnic.[1]'
  PlaceVM3OnVLAN17:
    Type: NetAdapter
    portgroup: 'vc.[1].dvportgroup.[3]'
    reconfigure: true
    testadapter: 'vm.[3].vnic.[1]'
  PlaceVM3OnVLAN21:
    Type: NetAdapter
    portgroup: 'vc.[1].dvportgroup.[4]'
    reconfigure: true
    testadapter: 'vm.[3].vnic.[1]'
  PlaceVM3OnvWire1:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[1]'
    reconfigure: true
    testadapter: 'vm.[3].vnic.[1]'
  PlaceVM3OnvWire2:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[2]'
    reconfigure: true
    testadapter: 'vm.[3].vnic.[1]'
  PlaceVM3OnvWire3:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[3]'
    reconfigure: true
    testadapter: 'vm.[3].vnic.[1]'
  PlaceVMsOnMgmtdvPG:
    Type: NetAdapter
    portgroup: 'vc.[1].dvportgroup.[1]'
    reconfigure: true
    testadapter: 'vm.[1-3].vnic.[1]'
  PoweroffVM1:
    TestVM: 'vm.[1]'
    Type: VM
    vmstate: poweroff
  PoweroffVM2:
    TestVM: 'vm.[2]'
    Type: VM
    vmstate: poweroff
  PoweroffVM3:
    TestVM: 'vm.[3]'
    Type: VM
    vmstate: poweroff
  PoweroffVM4:
    TestVM: 'vm.[4]'
    Type: VM
    vmstate: poweroff
  PoweronVM1:
    TestVM: 'vm.[1]'
    Type: VM
    vmstate: poweron
  PoweronVM2:
    TestVM: 'vm.[2]'
    Type: VM
    vmstate: poweron
  PoweronVM3:
    TestVM: 'vm.[3]'
    Type: VM
    vmstate: poweron
  RebootHost:
    TestHost: 'host.[1]'
    Type: Host
    reboot: yes
  RebootHost2:
    TestHost: 'host.[2]'
    Type: Host
    reboot: yes
  RebootHost3:
    TestHost: 'host.[3]'
    Type: Host
    reboot: yes
  RemoveAddUplink1InLoop:
    ConfigureUplinks: 'remove,add'
    Iterations: 1
    SleepBetweenCombos: 20
    TestSwitch: 'vc.[1].vds.[1]'
    Type: Switch
    vmnicadapter: 'host.[2-3].vmnic.[1]'
  RemoveAddUplink2InLoop:
    ConfigureUplinks: 'add,remove,add'
    Iterations: 1
    SleepBetweenCombos: 10
    TestSwitch: 'vc.[1].vds.[1]'
    Type: Switch
    vmnicadapter: 'host.[2-3].vmnic.[2]'
  RemoveUplink1:
    ConfigureUplinks: remove
    TestSwitch: 'vc.[1].vds.[1]'
    Type: Switch
    vmnicadapter: 'host.[2-3].vmnic.[1]'
  RemovevNICFromVM1:
    TestVM: 'vm.[1]'
    Type: VM
    deletevnic: 'vm.[1].vnic.[1]'
  RemovevNICFromVM2:
    TestVM: 'vm.[2]'
    Type: VM
    deletevnic: 'vm.[2].vnic.[1]'
  RemovevNICFromVM3:
    TestVM: 'vm.[3]'
    Type: VM
    deletevnic: 'vm.[3].vnic.[1]'
  ResetMulticast:
    TestNSX: 'vsm.[1]'
    Type: NSX
    deletemulticastiprange: 'vsm.[1].multicastiprange.[-1]'
  ResetSegmentID:
    TestNSX: 'vsm.[1]'
    Type: NSX
    deletesegmentidrange: 'vsm.[1].segmentidrange.[-1]'
  SamevWireNetperfTestDifferentHost:
    MinExpResult: 1
    NoofInbound: 1
    NoofOutbound: 1
    SupportAdapter: 'vm.[3].vnic.[1]'
    TestAdapter: 'vm.[1].vnic.[1]'
    TestDuration: 6
    Type: Traffic
    l3protocol: 'ipv4,ipv6'
    l4protocol: 'tcp,udp'
    maxtimeout: 128000
  Sequence:
    -
      - CreateNetworkScope
    -
      - CreateVirtualWires
    -
      - AddvNICsOnVMs
    -
      - PoweronVM1
      - PoweronVM2
    -
      - MakeSurevNICConnected
    -
      - SetVXLANIPVM1
      - SetVXLANIPVM2SamevWire
    -
      - PingTest
    -
      - DeployEdge
    -
      - CreateVXLANLIF1
    -
      - CreateVXLANLIF2
    -
      - CreateVLANLIF3
    -
      - CreateVLANLIF4
    -
      - BridgevWire3ToVLAN21
    -
      - PoweronVM3
    -
      - PlaceVM1OnvWire1
      - PlaceVM3OnvWire1
    -
      - SetVXLANIPVM1
      - SetVXLANIPVM3SamevWire
    -
      - PingTestDifferentHost
    -
      - NetperfTestDifferentHostIgnoreThroughput
      - RemoveAddUplink1InLoop
    -
      - PingTestDifferentHost
    -
      - PlaceVM1OnvWire1
      - PlaceVM3OnvWire2
    -
      - SetVXLANIPVM1
      - SetVXLANIPVM3
    -
      - AddVXLANRouteVM1
      - AddVXLANRouteVM3
    -
      - NetperfTestDifferentHostIgnoreThroughput
      - RemoveAddUplink1InLoop
    -
      - PingTestDifferentHost
    -
      - PlaceVM1OnVLAN16
      - PlaceVM3OnVLAN17
    -
      - SetVLANIPVM1
      - SetVLANIPVM3
    -
      - AddVLANRouteVM1
      - AddVLANRouteVM3
    -
      - NetperfTestDifferentHostIgnoreThroughput
      - RemoveAddUplink1InLoop
    -
      - PingTestDifferentHost
    -
      - PlaceVM1OnvWire1
      - PlaceVM3OnVLAN17
    -
      - SetVXLANIPVM1
      - SetVLANIPVM3
    -
      - AddVXLANRouteVM1
      - AddVLANRouteVM3
    -
      - NetperfTestDifferentHostIgnoreThroughput
      - RemoveAddUplink1InLoop
    -
      - PingTestDifferentHost
    -
      - PlaceVM3OnvWire2
      - PlaceVM1OnVLAN16
    -
      - SetVLANIPVM1
      - SetVXLANIPVM3
    -
      - AddVLANRouteVM1
      - AddVXLANRouteVM3
    -
      - NetperfTestDifferentHostIgnoreThroughput
      - RemoveAddUplink1InLoop
    -
      - PingTestDifferentHost
    -
      - PlaceVM1OnvWire3
    -
      - PlaceVM3OnVLAN21
    -
      - SetVXLANBridgeIPVM1
      - SetVLANBridgeIPVM3
    -
      - NetperfTestDifferentHostIgnoreThroughput
      - RemoveAddUplink1InLoop
    -
      - PingTestDifferentHost
  SetMulticastRange:
    Multicastiprange:
      '[1]':
        begin: 239.0.0.101
        end: 239.254.254.254
        name: AutoGenerate
    TestNSX: 'vsm.[1]'
    Type: NSX
  SetSegmentIDRange:
    TestNSX: 'vsm.[1]'
    Type: NSX
    segmentidrange:
      '[1]':
        begin: 5001-10001
        end: 99000
        name: AutoGenerate
  SetVLANBridgeIPVM2:
    Testadapter: 'vm.[2].vnic.[1]'
    Type: NetAdapter
    ipv4: dhcp
  SetVLANBridgeIPVM3:
    Testadapter: 'vm.[3].vnic.[1]'
    Type: NetAdapter
    ipv4: dhcp
  SetVLANIPVM1:
    Testadapter: 'vm.[1].vnic.[1]'
    Type: NetAdapter
    ipv4: dhcp
  SetVLANIPVM2:
    Testadapter: 'vm.[2].vnic.[1]'
    Type: NetAdapter
    ipv4: dhcp
  SetVLANIPVM3:
    Testadapter: 'vm.[3].vnic.[1]'
    Type: NetAdapter
    ipv4: dhcp
  SetVXLANBridgeIPVM1:
    Testadapter: 'vm.[1].vnic.[1]'
    Type: NetAdapter
    ipv4: dhcp
  SetVXLANIPVM1:
    Testadapter: 'vm.[1].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.31.1.5
    netmask: 255.255.0.0
  SetVXLANIPVM2:
    Testadapter: 'vm.[2].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.32.1.5
    netmask: 255.255.0.0
  SetVXLANIPVM2SamevWire:
    Testadapter: 'vm.[2].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.31.1.6
    netmask: 255.255.0.0
  SetVXLANIPVM3:
    Testadapter: 'vm.[3].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.32.1.5
    netmask: 255.255.0.0
  SetVXLANIPVM3SamevWire:
    Testadapter: 'vm.[3].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.31.1.15
    netmask: 255.255.0.0
  UnconfigureVXLAN:
    Type: Cluster
    testcluster: 'vsm.[1].vdncluster.[1]'
    vxlan: unconfigure
  Uninstall_VDNCluster:
    TestNSX: 'vsm.[1]'
    Type: NSX
    deletevdncluster: 'vsm.[1].vdncluster.[-1]'
---
Category: NSX
Component: network vDR
Summary: Verify different vMotion combinations work and verify data traffic
Tags: RunOnCAT
TestName: TestAllVmotionCombos
TestbedSpec:
  host:
    '[1]': {}
    '[2-4]':
      vmnic:
        '[1-2]':
          driver: any
  vc:
    '[1]':
      datacenter:
        '[1]':
          Cluster:
            '[1]':
              host: 'host.[1]'
              name: Controller-Cluster-26724
            '[2]':
              host: 'host.[2-3]'
              name: Compute-Cluster-26724
            '[3]':
              host: 'host.[4]'
              name: Compute-Cluster2-26724
      dvportgroup:
        '[1]':
          name: dvpg-mgmt-26724
          vds: 'vc.[1].vds.[1]'
        '[2]':
          name: dvpg-vlan16-26724
          vds: 'vc.[1].vds.[1]'
          vlan: 16
          vlantype: access
        '[3]':
          name: dvpg-vlan17-26724
          vds: 'vc.[1].vds.[1]'
          vlan: 17
          vlantype: access
        '[4]':
          name: dvpg-vlan21-26724
          vds: 'vc.[1].vds.[1]'
          vlan: 21
          vlantype: access
      vds:
        '[1]':
          configurehosts: add
          datacenter: 'vc.[1].datacenter.[1]'
          host: 'host.[2-4]'
          numuplinkports: 1
          vmnicadapter: 'host.[2-4].vmnic.[1]'
  vm:
    '[1-2]':
      datastoreType: shared
      host: 'host.[2]'
      vmstate: poweroff
    '[3]':
      datastoreType: shared
      host: 'host.[3]'
      vmstate: poweroff
  vsm:
    '[1]':
      VDNCluster:
        '[1]':
          cluster: 'vc.[1].datacenter.[1].cluster.[2]'
          mtu: 1600
          switch: 'vc.[1].vds.[1]'
          teaming: &1
            - LOADBALANCE_SRCMAC
            - LOADBALANCE_SRCID
            - LOADBALANCE_LOADBASED
            - FAILOVER_ORDER
            - ETHER_CHANNEL
          vibs: install
          vlan:
            - 21
          vmkniccount: 1
      assignrole: enterprise_admin
      ippool:
        '[1]':
          gateway: x.x.x.x
          ipranges:
            - a.a.a.a-b.b.b.b
          name: AutoGenerate
          prefixlength: yy
      multicastiprange:
        '[1]':
          begin: 239.1.1.1
          end: 239.1.1.100
          name: AutoGenerate
      reconfigure: true
      segmentidrange:
        '[1]':
          begin: 10000
          end: 19000
          name: AutoGenerate
      vc: 'vc.[1]'
      vxlancontroller:
        '[1]':
          host: 'host.[1]'
          ippool: 'vsm.[1].ippool.[1]'
          name: AutoGenerate
          resourcepool: 'vc.[1].datacenter.[1].cluster.[1]'
        '[2]':
          host: 'host.[1]'
          ippool: 'vsm.[1].ippool.[1]'
          name: AutoGenerate
          resourcepool: 'vc.[1].datacenter.[1].cluster.[1]'
        '[3]':
          host: 'host.[1]'
          ippool: 'vsm.[1].ippool.[1]'
          name: AutoGenerate
          resourcepool: 'vc.[1].datacenter.[1].cluster.[1]'
Version: 2
WORKLOADS:
  AddRouteHost2VLAN16:
    Testadapter: 'host.[2].vmknic.[3]'
    Type: NetAdapter
    gateway: 172.16.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteHost2VLAN17:
    Testadapter: 'host.[2].vmknic.[4]'
    Type: NetAdapter
    gateway: 172.17.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteHost2vWire1:
    Testadapter: 'host.[2].vmknic.[1]'
    Type: NetAdapter
    gateway: 172.31.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteHost2vWire2:
    Testadapter: 'host.[2].vmknic.[2]'
    Type: NetAdapter
    gateway: 172.32.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteHost3VLAN16:
    Testadapter: 'host.[3].vmknic.[3]'
    Type: NetAdapter
    gateway: 172.16.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteHost3VLAN17:
    Testadapter: 'host.[3].vmknic.[4]'
    Type: NetAdapter
    gateway: 172.17.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddRouteHost3vWire2:
    Testadapter: 'host.[3].vmknic.[2]'
    Type: NetAdapter
    gateway: 172.32.1.1
    netmask: 255.0.0.0
    network: 172.0.0.0
    route: add
  AddVLANRouteVM1:
    Testadapter: 'vm.[1].vnic.[1]'
    Type: NetAdapter
    gateway: 172.16.1.1
    netmask: 255.255.0.0
    network: '172.17.0.0,172.31.0.0,172.32.0.0'
    route: add
  AddVLANRouteVM2:
    Testadapter: 'vm.[2].vnic.[1]'
    Type: NetAdapter
    gateway: 172.17.1.1
    netmask: 255.255.0.0
    network: '172.16.0.0,172.31.0.0,172.32.0.0'
    route: add
  AddVLANRouteVM3:
    Testadapter: 'vm.[3].vnic.[1]'
    Type: NetAdapter
    gateway: 172.17.1.1
    netmask: 255.255.0.0
    network: '172.16.0.0,172.31.0.0,172.32.0.0'
    route: add
  AddVXLANRouteVM1:
    Testadapter: 'vm.[1].vnic.[1]'
    Type: NetAdapter
    gateway: 172.31.1.1
    netmask: 255.255.0.0
    network: '172.32.0.0,172.16.0.0,172.17.0.0'
    route: add
  AddVXLANRouteVM2:
    Testadapter: 'vm.[2].vnic.[1]'
    Type: NetAdapter
    gateway: 172.32.1.1
    netmask: 255.255.0.0
    network: '172.31.0.0,172.16.0.0,172.17.0.0'
    route: add
  AddVXLANRouteVM3:
    Testadapter: 'vm.[3].vnic.[1]'
    Type: NetAdapter
    gateway: 172.32.1.1
    netmask: 255.255.0.0
    network: '172.31.0.0,172.16.0.0,172.17.0.0'
    route: add
  AddVmotionvmknics:
    TestHost: 'host.[2-3]'
    Type: Host
    vmknic:
      '[1]':
        configurevmotion: enable
        ipv4: dhcp
        portgroup: 'vc.[1].dvportgroup.[1]'
  AddvNICForvMotion:
    TestVM: 'vm.[1],vm.[2]'
    Type: VM
    vnic:
      '[2]':
        allowguestcontrol: 1
        connected: 1
        driver: vmxnet3
        portgroup: 'vc.[1].dvportgroup.[1]'
        startconnected: 1
  AddvNICsOnVMs:
    TestVM: 'vm.[1],vm.[2],vm.[3]'
    Type: VM
    vnic:
      '[1]':
        allowguestcontrol: 1
        connected: 1
        driver: vmxnet3
        portgroup: 'vsm.[1].networkscope.[1].virtualwire.[1]'
        startconnected: 1
  AddvmknicHost2VLAN16:
    TestHost: 'host.[2]'
    Type: Host
    vmknic:
      '[3]':
        configurevmotion: enable
        ipv4address: dhcp
        portgroup: 'vc.[1].dvportgroup.[2]'
  AddvmknicHost2VLAN17:
    TestHost: 'host.[2]'
    Type: Host
    vmknic:
      '[4]':
        configurevmotion: enable
        ipv4address: dhcp
        portgroup: 'vc.[1].dvportgroup.[3]'
  AddvmknicHost2VirtualWire1:
    TestHost: 'host.[2]'
    Type: Host
    vmknic:
      '[1]':
        configurevmotion: enable
        ipv4address: 172.31.1.9
        netmask: 255.255.0.0
        portgroup: 'vsm.[1].networkscope.[1].virtualwire.[1]'
  AddvmknicHost2VirtualWire2:
    TestHost: 'host.[2]'
    Type: Host
    vmknic:
      '[2]':
        configurevmotion: enable
        ipv4address: 172.32.1.9
        netmask: 255.255.0.0
        portgroup: 'vsm.[1].networkscope.[1].virtualwire.[2]'
  AddvmknicHost2VirtualWire3:
    TestHost: 'host.[2]'
    Type: Host
    vmknic:
      '[5]':
        configurevmotion: enable
        ipv4address: 172.21.1.9
        netmask: 255.255.0.0
        portgroup: 'vsm.[1].networkscope.[1].virtualwire.[3]'
  AddvmknicHost3VLAN16:
    TestHost: 'host.[3]'
    Type: Host
    vmknic:
      '[3]':
        configurevmotion: enable
        ipv4address: dhcp
        portgroup: 'vc.[1].dvportgroup.[2]'
  AddvmknicHost3VLAN17:
    TestHost: 'host.[3]'
    Type: Host
    vmknic:
      '[4]':
        configurevmotion: enable
        ipv4address: dhcp
        portgroup: 'vc.[1].dvportgroup.[3]'
  AddvmknicHost3VLAN21:
    TestHost: 'host.[3]'
    Type: Host
    vmknic:
      '[5]':
        configurevmotion: enable
        ipv4address: dhcp
        portgroup: 'vc.[1].dvportgroup.[4]'
  AddvmknicHost3VirtualWire1:
    TestHost: 'host.[3]'
    Type: Host
    vmknic:
      '[1]':
        configurevmotion: enable
        ipv4address: 172.31.1.19
        netmask: 255.255.0.0
        portgroup: 'vsm.[1].networkscope.[1].virtualwire.[1]'
  AddvmknicHost3VirtualWire2:
    TestHost: 'host.[3]'
    Type: Host
    vmknic:
      '[2]':
        configurevmotion: enable
        ipv4address: 172.32.1.19
        netmask: 255.255.0.0
        portgroup: 'vsm.[1].networkscope.[1].virtualwire.[2]'
  BridgevWire3ToVLAN21:
    TestVM: 'vsm.[1].vse.[1]'
    Type: VM
    bridge:
      '[1]':
        name: bridge-1-26724
        portgroup: 'vc.[1].dvportgroup.[4]'
        virtualwire: 'vsm.[1].networkscope.[1].virtualwire.[3]'
  CreateNetworkScope:
    TestNSX: 'vsm.[1]'
    Type: NSX
    networkscope:
      '[1]':
        clusters: 'vc.[1].datacenter.[1].cluster.[2]'
        name: network-scope-1-26724
  CreateVLANLIF3:
    TestVM: 'vsm.[1].vse.[1]'
    Type: VM
    lif:
      '[3]':
        addressgroup:
          - addresstype: primary
            ipv4address: 172.16.1.1
            netmask: 255.255.0.0
        connected: 1
        name: lif-16-26724
        portgroup: 'vc.[1].dvportgroup.[2]'
        type: internal
  CreateVLANLIF4:
    TestVM: 'vsm.[1].vse.[1]'
    Type: VM
    lif:
      '[4]':
        addressgroup:
          - addresstype: primary
            ipv4address: 172.17.1.1
            netmask: 255.255.0.0
        connected: 1
        name: lif-17-26724
        portgroup: 'vc.[1].dvportgroup.[3]'
        type: internal
  CreateVXLANLIF1:
    TestVM: 'vsm.[1].vse.[1]'
    Type: VM
    lif:
      '[1]':
        addressgroup:
          - addresstype: primary
            ipv4address: 172.31.1.1
            netmask: 255.255.0.0
        connected: 1
        name: lif-vwire1-26724
        portgroup: 'vsm.[1].networkscope.[1].virtualwire.[1]'
        type: internal
  CreateVXLANLIF2:
    TestVM: 'vsm.[1].vse.[1]'
    Type: VM
    lif:
      '[2]':
        addressgroup:
          - addresstype: primary
            ipv4address: 172.32.1.1
            netmask: 255.255.0.0
        connected: 1
        name: lif-vwire2-26724
        portgroup: 'vsm.[1].networkscope.[1].virtualwire.[2]'
        type: internal
  CreateVirtualWires:
    TestTransportZone: 'vsm.[1].networkscope.[1]'
    Type: TransportZone
    VirtualWire:
      '[1]':
        name: AutoGenerate
        tenantid: 1
      '[2]':
        name: AutoGenerate
        tenantid: 2
      '[3]':
        name: AutoGenerate
        tenantid: 3
  DeleteAllVmknicsHost2:
    TestHost: 'host.[2]'
    Type: Host
    deletevmknic: 'host.[2].vmknic.[-1]'
  DeleteAllVmknicsHost3:
    TestHost: 'host.[3]'
    Type: Host
    deletevmknic: 'host.[3].vmknic.[-1]'
  DeleteController:
    TestNSX: 'vsm.[1]'
    Type: NSX
    deletevxlancontroller: 'vsm.[1].vxlancontroller.[-1]'
  DeleteEdges:
    TestNSX: 'vsm.[1]'
    Type: NSX
    deletevse: 'vsm.[1].vse.[-1]'
  DeleteIPPool:
    TestNSX: 'vsm.[1]'
    Type: NSX
    deleteippool: 'vsm.[1].ippool.[1]'
    sleepbetweenworkloads: 10
  DeleteNetworkScope: &2
    TestNSX: 'vsm.[1]'
    Type: NSX
    deletenetworkscope: 'vsm.[1].networkscope.[-1]'
  DeleteNetworkScopes: *2
  DeleteVirtualWires:
    TestTransportZone: 'vsm.[1].networkscope.[1]'
    Type: TransportZone
    deletevirtualwire: 'vsm.[1].networkscope.[1].virtualwire.[1-3]'
  Delete_All_VirtualWires:
    TestTransportZone: 'vsm.[1].networkscope.[-1]'
    Type: TransportZone
    deletevirtualwire: 'vsm.[1].networkscope.[-1].virtualwire.[-1]'
  DeployEdge:
    TestNSX: 'vsm.[1]'
    Type: NSX
    vse:
      '[1]':
        datacenter: 'vc.[1].datacenter.[1]'
        host: 'host.[2]'
        name: Edge-26724
        portgroup: 'vc.[1].dvportgroup.[1]'
        primaryaddress: 10.10.10.33
        resourcepool: 'vc.[1].datacenter.[1].cluster.[2]'
        subnetmask: 255.255.255.0
  DeployFirstController:
    TestNSX: 'vsm.[1]'
    Type: NSX
    vxlancontroller:
      '[1]':
        firstnodeofcluster: true
        host: 'host.[1]'
        ippool: 'vsm.[1].ippool.[1]'
        name: AutoGenerate
        resourcepool: 'vc.[1].datacenter.[1].cluster.[1]'
  ExitSequence:
    -
      - DeleteAllVmknicsHost2
      - DeleteAllVmknicsHost3
    -
      - DeleteEdges
    -
      - RemovevNICFromVM1
      - RemovevNICFromVM2
      - RemovevNICFromVM3
    -
      - Delete_All_VirtualWires
    -
      - DeleteNetworkScopes
  GetVirtualWireID:
    FindType: Switch
    Type: Switch
    testvirtualwire: 'vsm.[1].networkscope.[1].virtualwire.[1]'
  Install_Configure_ClusterSJC:
    TestNSX: 'vsm.[1]'
    Type: NSX
    VDNCluster:
      '[1]':
        cluster: 'vc.[1].datacenter.[1].cluster.[2]'
        mtu: 1600
        switch: 'vc.[1].vds.[1]'
        teaming: *1
        vibs: install
        vlan:
          - 21
        vmkniccount: 1
  MakeSurevNICConnected:
    Type: NetAdapter
    connected: 1
    reconfigure: true
    startconnected: 1
    testadapter: 'vm.[1-2].vnic.[1]'
  MoveHostsToClusterSFO:
    MoveHostsToCluster: 'host.[4],host.[5]'
    TestCluster: 'vc.[1].datacenter.[1].cluster.[3]'
    Type: Cluster
  NetperfTestDifferentHostIgnoreThroughput:
    ExpectedResult: ignore
    NoofOutbound: 1
    SupportAdapter: 'vm.[3].vnic.[1]'
    TestAdapter: 'vm.[1].vnic.[1]'
    TestDuration: 60
    ToolName: Ping
    Type: Traffic
  NetperfTestIgnorethroughput:
    ExpectedResult: ignore
    NoofOutbound: 1
    SupportAdapter: 'vm.[2].vnic.[1]'
    TestAdapter: 'vm.[1].vnic.[1]'
    TestDuration: 60
    ToolName: netperf
    Type: Traffic
  PingTest:
    NoofInbound: 1
    NoofOutbound: 1
    SupportAdapter: 'vm.[2].vnic.[1]'
    TestAdapter: 'vm.[1].vnic.[1]'
    TestDuration: 60
    ToolName: Ping
    Type: Traffic
    maxtimeout: 128000
  PingTestDifferentHost:
    NoofInbound: 1
    NoofOutbound: 1
    SupportAdapter: 'vm.[3].vnic.[1]'
    TestAdapter: 'vm.[1].vnic.[1]'
    TestDuration: 60
    ToolName: Ping
    Type: Traffic
    maxtimeout: 128000
  PlaceVM1OnVLAN16:
    Type: NetAdapter
    portgroup: 'vc.[1].dvportgroup.[2]'
    reconfigure: true
    testadapter: 'vm.[1].vnic.[1]'
  PlaceVM1OnvWire1:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[1]'
    reconfigure: true
    testadapter: 'vm.[1].vnic.[1]'
  PlaceVM1OnvWire3:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[3]'
    reconfigure: true
    testadapter: 'vm.[1].vnic.[1]'
  PlaceVM2OnMgmtdvpg:
    Type: NetAdapter
    portgroup: 'vc.[1].dvportgroup.[1]'
    reconfigure: true
    testadapter: 'vm.[2].vnic.[1]'
  PlaceVM2OnVLAN17:
    Type: NetAdapter
    portgroup: 'vc.[1].dvportgroup.[3]'
    reconfigure: true
    testadapter: 'vm.[2].vnic.[1]'
  PlaceVM2OnVLAN21:
    Type: NetAdapter
    portgroup: 'vc.[1].dvportgroup.[4]'
    reconfigure: true
    testadapter: 'vm.[2].vnic.[1]'
  PlaceVM2OnvWire2:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[2]'
    reconfigure: true
    testadapter: 'vm.[2].vnic.[1]'
  PlaceVM3OnVLAN17:
    Type: NetAdapter
    portgroup: 'vc.[1].dvportgroup.[3]'
    reconfigure: true
    testadapter: 'vm.[3].vnic.[1]'
  PlaceVM3OnVLAN21:
    Type: NetAdapter
    portgroup: 'vc.[1].dvportgroup.[4]'
    reconfigure: true
    testadapter: 'vm.[3].vnic.[1]'
  PlaceVM3OnvWire1:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[1]'
    reconfigure: true
    testadapter: 'vm.[3].vnic.[1]'
  PlaceVM3OnvWire2:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[2]'
    reconfigure: true
    testadapter: 'vm.[3].vnic.[1]'
  PlaceVM3OnvWire3:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[3]'
    reconfigure: true
    testadapter: 'vm.[3].vnic.[1]'
  PlaceVMsOnMgmtdvPG:
    Type: NetAdapter
    portgroup: 'vc.[1].dvportgroup.[1]'
    reconfigure: true
    testadapter: 'vm.[1-3].vnic.[1]'
  PoweroffVM1:
    TestVM: 'vm.[1]'
    Type: VM
    vmstate: poweroff
  PoweroffVM2:
    TestVM: 'vm.[2]'
    Type: VM
    vmstate: poweroff
  PoweroffVM3:
    TestVM: 'vm.[3]'
    Type: VM
    vmstate: poweroff
  PoweronVM1:
    TestVM: 'vm.[1]'
    Type: VM
    vmstate: poweron
  PoweronVM2:
    TestVM: 'vm.[2]'
    Type: VM
    vmstate: poweron
  PoweronVM3:
    TestVM: 'vm.[3]'
    Type: VM
    vmstate: poweron
  PrepClusterSFO:
    TestNSX: 'vsm.[1]'
    Type: NSX
    VDNCluster:
      '[3]':
        cluster: 'vc.[1].datacenter.[1].cluster.[3]'
  RebootHost:
    TestHost: 'host.[1]'
    Type: Host
    reboot: yes
  RebootHost2:
    TestHost: 'host.[2]'
    Type: Host
    reboot: yes
  RebootHost3:
    TestHost: 'host.[3]'
    Type: Host
    reboot: yes
  RemovevNICFromVM1:
    TestVM: 'vm.[1]'
    Type: VM
    deletevnic: 'vm.[1].vnic.[1]'
  RemovevNICFromVM2:
    TestVM: 'vm.[2]'
    Type: VM
    deletevnic: 'vm.[2].vnic.[1]'
  RemovevNICFromVM3:
    TestVM: 'vm.[3]'
    Type: VM
    deletevnic: 'vm.[3].vnic.[1]'
  ResetMulticast:
    TestNSX: 'vsm.[1]'
    Type: NSX
    deletemulticastiprange: 'vsm.[1].multicastiprange.[-1]'
  ResetSegmentID:
    TestNSX: 'vsm.[1]'
    Type: NSX
    deletesegmentidrange: 'vsm.[1].segmentidrange.[-1]'
  SamevWireNetperfTestDifferentHost:
    MinExpResult: 1
    NoofInbound: 1
    NoofOutbound: 1
    SupportAdapter: 'vm.[3].vnic.[1]'
    TestAdapter: 'vm.[1].vnic.[1]'
    TestDuration: 60
    Type: Traffic
    l3protocol: 'ipv4,ipv6'
    l4protocol: 'tcp,udp'
    maxtimeout: 128000
  Sequence:
    -
      - CreateNetworkScope
    -
      - CreateVirtualWires
    -
      - DeployEdge
    -
      - CreateVXLANLIF1
    -
      - CreateVXLANLIF2
    -
      - CreateVLANLIF3
    -
      - CreateVLANLIF4
    -
      - BridgevWire3ToVLAN21
    -
      - AddvNICsOnVMs
    -
      - PoweronVM1
      - PoweronVM2
    -
      - MakeSurevNICConnected
    -
      - SetVXLANIPVM1
      - SetVXLANIPVM2SamevWire
    -
      - PingTest
    -
      - NetperfTestIgnorethroughput
    -
      - AddvmknicHost2VLAN16
      - AddvmknicHost3VLAN16
    -
      - NetperfTestIgnorethroughput
      - vMotionVM2ToHost3
    -
      - PingTest
    -
      - DeleteAllVmknicsHost2
      - DeleteAllVmknicsHost3
    -
      - AddvmknicHost2VirtualWire1
      - AddvmknicHost3VirtualWire1
    -
      - NetperfTestIgnorethroughput
      - vMotionVM2ToHost3
    -
      - PingTest
    -
      - PlaceVM1OnVLAN16
      - PlaceVM2OnVLAN17
    -
      - SetVLANIPVM1
      - SetVLANIPVM2
    -
      - AddVLANRouteVM1
      - AddVLANRouteVM2
    -
      - PingTest
    -
      - DeleteAllVmknicsHost2
      - DeleteAllVmknicsHost3
    -
      - AddvmknicHost2VLAN16
      - AddvmknicHost3VLAN17
    -
      - AddRouteHost2VLAN16
      - AddRouteHost3VLAN17
    -
      - NetperfTestIgnorethroughput
      - vMotionVM1ToHost3
    -
      - PingTest
    -
      - PlaceVM1OnvWire1
      - PlaceVM2OnvWire2
    -
      - SetVXLANIPVM1
      - SetVXLANIPVM2
    -
      - AddVXLANRouteVM1
      - AddVXLANRouteVM2
    -
      - PingTest
    -
      - DeleteAllVmknicsHost2
      - DeleteAllVmknicsHost3
    -
      - AddvmknicHost2VirtualWire1
      - AddvmknicHost3VirtualWire2
    -
      - AddRouteHost2vWire1
      - AddRouteHost3vWire2
    -
      - NetperfTestIgnorethroughput
      - vMotionVM1ToHost2
    -
      - PingTest
    -
      - PlaceVM1OnvWire1
      - PlaceVM2OnVLAN17
    -
      - SetVXLANIPVM1
      - SetVLANIPVM2
    -
      - AddVXLANRouteVM1
      - AddVLANRouteVM2
    -
      - PingTest
    -
      - DeleteAllVmknicsHost2
      - DeleteAllVmknicsHost3
    -
      - AddvmknicHost2VirtualWire1
      - AddvmknicHost3VLAN17
    -
      - AddRouteHost2vWire1
      - AddRouteHost3VLAN17
    -
      - NetperfTestIgnorethroughput
      - vMotionVM2ToHost2
    -
      - PingTest
    -
      - PlaceVM2OnvWire2
      - PlaceVM1OnVLAN16
    -
      - SetVLANIPVM1
      - SetVXLANIPVM2
    -
      - AddVLANRouteVM1
      - AddVXLANRouteVM2
    -
      - PingTest
    -
      - DeleteAllVmknicsHost2
      - DeleteAllVmknicsHost3
    -
      - AddvmknicHost2VirtualWire2
      - AddvmknicHost3VLAN16
    -
      - AddRouteHost2vWire2
      - AddRouteHost3VLAN16
    -
      - NetperfTestIgnorethroughput
      - vMotionVM2ToHost3
    -
      - PingTest
    -
      - PlaceVM1OnvWire3
      - PlaceVM2OnVLAN21
    -
      - SetVXLANBridgeIPVM1
      - SetVLANBridgeIPVM2
    -
      - PingTest
    -
      - DeleteAllVmknicsHost2
      - DeleteAllVmknicsHost3
    -
      - AddvmknicHost2VirtualWire3
      - AddvmknicHost3VLAN21
    -
      - NetperfTestIgnorethroughput
      - vMotionVM2ToHost2
    -
      - PingTest
  SetMulticastRange:
    Multicastiprange:
      '[1]':
        begin: 239.0.0.101
        end: 239.254.254.254
        name: AutoGenerate
    TestNSX: 'vsm.[1]'
    Type: NSX
  SetSegmentIDRange:
    TestNSX: 'vsm.[1]'
    Type: NSX
    segmentidrange:
      '[1]':
        begin: 5001-10001
        end: 99000
        name: AutoGenerate
  SetVLANBridgeIPVM2:
    Testadapter: 'vm.[2].vnic.[1]'
    Type: NetAdapter
    ipv4: dhcp
  SetVLANBridgeIPVM3:
    Testadapter: 'vm.[3].vnic.[1]'
    Type: NetAdapter
    ipv4: dhcp
  SetVLANIPVM1:
    Testadapter: 'vm.[1].vnic.[1]'
    Type: NetAdapter
    ipv4: dhcp
  SetVLANIPVM2:
    Testadapter: 'vm.[2].vnic.[1]'
    Type: NetAdapter
    ipv4: dhcp
  SetVLANIPVM3:
    Testadapter: 'vm.[3].vnic.[1]'
    Type: NetAdapter
    ipv4: dhcp
  SetVXLANBridgeIPVM1:
    Testadapter: 'vm.[1].vnic.[1]'
    Type: NetAdapter
    ipv4: dhcp
  SetVXLANIPVM1:
    Testadapter: 'vm.[1].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.31.1.5
    netmask: 255.255.0.0
  SetVXLANIPVM2:
    Testadapter: 'vm.[2].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.32.1.5
    netmask: 255.255.0.0
  SetVXLANIPVM2SamevWire:
    Testadapter: 'vm.[2].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.31.1.6
    netmask: 255.255.0.0
  SetVXLANIPVM3:
    Testadapter: 'vm.[3].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.32.1.5
    netmask: 255.255.0.0
  SetVXLANIPVM3SamevWire:
    Testadapter: 'vm.[3].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.31.1.15
    netmask: 255.255.0.0
  UnconfigureVXLAN:
    Type: Cluster
    testcluster: 'vsm.[1].vdncluster.[1]'
    vxlan: unconfigure
  Uninstall_VDNCluster:
    TestNSX: 'vsm.[1]'
    Type: NSX
    deletevdncluster: 'vsm.[1].vdncluster.[-1]'
  vMotionVM1ToHost2:
    Iterations: 1
    TestVM: 'vm.[1]'
    Type: VM
    dsthost: 'host.[2]'
    vmotion: oneway
  vMotionVM1ToHost3:
    Iterations: 1
    TestVM: 'vm.[1]'
    Type: VM
    dsthost: 'host.[3]'
    vmotion: oneway
  vMotionVM2ToHost2:
    Iterations: 1
    TestVM: 'vm.[2]'
    Type: VM
    dsthost: 'host.[2]'
    vmotion: oneway
  vMotionVM2ToHost3:
    Iterations: 1
    TestVM: 'vm.[2]'
    Type: VM
    dsthost: 'host.[3]'
    vmotion: oneway
  vMotionVM3ToHost3:
    Iterations: 1
    TestVM: 'vm.[3]'
    Type: VM
    dsthost: 'host.[3]'
    vmotion: roundtrip
---
Category: NSX
Component: network vDR
Summary: Fast switching of port groups of VMs  on same host and making sure data traffic works fine
Tags: RunOnCAT
TestName: FastSwitchingofVMBackingFloodPing_SameHost
TestbedSpec:
  host:
    '[1]': {}
    '[2-4]':
      vmnic:
        '[1-2]':
          driver: any
  vc:
    '[1]':
      datacenter:
        '[1]':
          Cluster:
            '[1]':
              host: 'host.[1]'
              name: Controller-Cluster-26724
            '[2]':
              host: 'host.[2-3]'
              name: Compute-Cluster-26724
            '[3]':
              host: 'host.[4]'
              name: Compute-Cluster2-26724
      dvportgroup:
        '[1]':
          name: dvpg-mgmt-26724
          vds: 'vc.[1].vds.[1]'
        '[2]':
          name: dvpg-vlan16-26724
          vds: 'vc.[1].vds.[1]'
          vlan: 16
          vlantype: access
        '[3]':
          name: dvpg-vlan17-26724
          vds: 'vc.[1].vds.[1]'
          vlan: 17
          vlantype: access
        '[4]':
          name: dvpg-vlan21-26724
          vds: 'vc.[1].vds.[1]'
          vlan: 21
          vlantype: access
      vds:
        '[1]':
          configurehosts: add
          datacenter: 'vc.[1].datacenter.[1]'
          host: 'host.[2-4]'
          numuplinkports: 1
          vmnicadapter: 'host.[2-4].vmnic.[1]'
  vm:
    '[1-2]':
      datastoreType: shared
      host: 'host.[2]'
      vmstate: poweroff
    '[3]':
      datastoreType: shared
      host: 'host.[3]'
      vmstate: poweroff
  vsm:
    '[1]':
      VDNCluster:
        '[1]':
          cluster: 'vc.[1].datacenter.[1].cluster.[2]'
          mtu: 1600
          switch: 'vc.[1].vds.[1]'
          teaming: &1
            - LOADBALANCE_SRCMAC
            - LOADBALANCE_SRCID
            - LOADBALANCE_LOADBASED
            - FAILOVER_ORDER
            - ETHER_CHANNEL
          vibs: install
          vlan:
            - 21
          vmkniccount: 1
      assignrole: enterprise_admin
      ippool:
        '[1]':
          gateway: x.x.x.x
          ipranges:
            - a.a.a.a-b.b.b.b
          name: AutoGenerate
          prefixlength: yy
      multicastiprange:
        '[1]':
          begin: 239.1.1.1
          end: 239.1.1.100
          name: AutoGenerate
      reconfigure: true
      segmentidrange:
        '[1]':
          begin: 10000
          end: 19000
          name: AutoGenerate
      vc: 'vc.[1]'
      vxlancontroller:
        '[1]':
          host: 'host.[1]'
          ippool: 'vsm.[1].ippool.[1]'
          name: AutoGenerate
          resourcepool: 'vc.[1].datacenter.[1].cluster.[1]'
        '[2]':
          host: 'host.[1]'
          ippool: 'vsm.[1].ippool.[1]'
          name: AutoGenerate
          resourcepool: 'vc.[1].datacenter.[1].cluster.[1]'
        '[3]':
          host: 'host.[1]'
          ippool: 'vsm.[1].ippool.[1]'
          name: AutoGenerate
          resourcepool: 'vc.[1].datacenter.[1].cluster.[1]'
Version: 2
WORKLOADS:
  AddVLANRouteVM1:
    Testadapter: 'vm.[1].vnic.[1]'
    Type: NetAdapter
    gateway: 172.16.1.1
    netmask: 255.255.0.0
    network: '172.17.0.0,172.31.0.0,172.32.0.0'
    route: add
  AddVLANRouteVM2:
    Testadapter: 'vm.[2].vnic.[1]'
    Type: NetAdapter
    gateway: 172.17.1.1
    netmask: 255.255.0.0
    network: '172.16.0.0,172.31.0.0,172.32.0.0'
    route: add
  AddVLANRouteVM3:
    Testadapter: 'vm.[3].vnic.[1]'
    Type: NetAdapter
    gateway: 172.17.1.1
    netmask: 255.255.0.0
    network: '172.16.0.0,172.31.0.0,172.32.0.0'
    route: add
  AddVXLANRouteVM1:
    Testadapter: 'vm.[1].vnic.[1]'
    Type: NetAdapter
    gateway: 172.31.1.1
    netmask: 255.255.0.0
    network: '172.32.0.0,172.16.0.0,172.17.0.0'
    route: add
  AddVXLANRouteVM2:
    Testadapter: 'vm.[2].vnic.[1]'
    Type: NetAdapter
    gateway: 172.32.1.1
    netmask: 255.255.0.0
    network: '172.31.0.0,172.16.0.0,172.17.0.0'
    route: add
  AddVXLANRouteVM3:
    Testadapter: 'vm.[3].vnic.[1]'
    Type: NetAdapter
    gateway: 172.32.1.1
    netmask: 255.255.0.0
    network: '172.31.0.0,172.16.0.0,172.17.0.0'
    route: add
  AddvNICsOnVMs:
    TestVM: 'vm.[1],vm.[2],vm.[3]'
    Type: VM
    vnic:
      '[1]':
        allowguestcontrol: 1
        connected: 1
        driver: vmxnet3
        portgroup: 'vsm.[1].networkscope.[1].virtualwire.[1]'
        startconnected: 1
  BridgevWire3ToVLAN21:
    TestVM: 'vsm.[1].vse.[1]'
    Type: VM
    bridge:
      '[1]':
        name: bridge-1-26724
        portgroup: 'vc.[1].dvportgroup.[4]'
        virtualwire: 'vsm.[1].networkscope.[1].virtualwire.[3]'
  CreateNetworkScope:
    TestNSX: 'vsm.[1]'
    Type: NSX
    networkscope:
      '[1]':
        clusters: 'vc.[1].datacenter.[1].cluster.[2]'
        name: network-scope-1-26724
  CreateVLANLIF3:
    TestVM: 'vsm.[1].vse.[1]'
    Type: VM
    lif:
      '[3]':
        addressgroup:
          - addresstype: primary
            ipv4address: 172.16.1.1
            netmask: 255.255.0.0
        connected: 1
        name: lif-16-26724
        portgroup: 'vc.[1].dvportgroup.[2]'
        type: internal
  CreateVLANLIF4:
    TestVM: 'vsm.[1].vse.[1]'
    Type: VM
    lif:
      '[4]':
        addressgroup:
          - addresstype: primary
            ipv4address: 172.17.1.1
            netmask: 255.255.0.0
        connected: 1
        name: lif-17-26724
        portgroup: 'vc.[1].dvportgroup.[3]'
        type: internal
  CreateVXLANLIF1:
    TestVM: 'vsm.[1].vse.[1]'
    Type: VM
    lif:
      '[1]':
        addressgroup:
          - addresstype: primary
            ipv4address: 172.31.1.1
            netmask: 255.255.0.0
        connected: 1
        name: lif-vwire1-26724
        portgroup: 'vsm.[1].networkscope.[1].virtualwire.[1]'
        type: internal
  CreateVXLANLIF2:
    TestVM: 'vsm.[1].vse.[1]'
    Type: VM
    lif:
      '[2]':
        addressgroup:
          - addresstype: primary
            ipv4address: 172.32.1.1
            netmask: 255.255.0.0
        connected: 1
        name: lif-vwire2-26724
        portgroup: 'vsm.[1].networkscope.[1].virtualwire.[2]'
        type: internal
  CreateVirtualWires:
    TestTransportZone: 'vsm.[1].networkscope.[1]'
    Type: TransportZone
    VirtualWire:
      '[1]':
        controlplanemode: HYBRID_MODE
        name: AutoGenerate
        tenantid: AutoGenerate
      '[2]':
        controlplanemode: UNICAST_MODE
        name: AutoGenerate
        tenantid: AutoGenerate
      '[3]':
        controlplanemode: MULTICAST_MODE
        name: AutoGenerate
        tenantid: AutoGenerate
      '[4-8]':
        name: AutoGenerate
        tenantid: AutoGenerate
  DeleteController:
    TestNSX: 'vsm.[1]'
    Type: NSX
    deletevxlancontroller: 'vsm.[1].vxlancontroller.[-1]'
  DeleteEdges:
    TestNSX: 'vsm.[1]'
    Type: NSX
    deletevse: 'vsm.[1].vse.[-1]'
  DeleteIPPool:
    TestNSX: 'vsm.[1]'
    Type: NSX
    deleteippool: 'vsm.[1].ippool.[1]'
    sleepbetweenworkloads: 10
  DeleteNetworkScope: &2
    TestNSX: 'vsm.[1]'
    Type: NSX
    deletenetworkscope: 'vsm.[1].networkscope.[-1]'
  DeleteNetworkScopes: *2
  DeleteVirtualWires:
    TestTransportZone: 'vsm.[1].networkscope.[1]'
    Type: TransportZone
    deletevirtualwire: 'vsm.[1].networkscope.[1].virtualwire.[1-3]'
  Delete_All_VirtualWires:
    TestTransportZone: 'vsm.[1].networkscope.[-1]'
    Type: TransportZone
    deletevirtualwire: 'vsm.[1].networkscope.[-1].virtualwire.[-1]'
  Deploy2ndController:
    TestNSX: 'vsm.[1]'
    Type: NSX
    vxlancontroller:
      '[2]':
        host: 'host.[1]'
        ippool: 'vsm.[1].ippool.[1]'
        name: AutoGenerate
        resourcepool: 'vc.[1].datacenter.[1].cluster.[1]'
  Deploy3rdController:
    TestNSX: 'vsm.[1]'
    Type: NSX
    vxlancontroller:
      '[3]':
        host: 'host.[1]'
        ippool: 'vsm.[1].ippool.[1]'
        name: AutoGenerate
        resourcepool: 'vc.[1].datacenter.[1].cluster.[1]'
  DeployEdge:
    TestNSX: 'vsm.[1]'
    Type: NSX
    vse:
      '[1]':
        datacenter: 'vc.[1].datacenter.[1]'
        host: 'host.[2]'
        name: Edge-26724
        portgroup: 'vc.[1].dvportgroup.[1]'
        primaryaddress: 10.10.10.19
        resourcepool: 'vc.[1].datacenter.[1].cluster.[2]'
        subnetmask: 255.255.255.0
  DeployFirstController:
    TestNSX: 'vsm.[1]'
    Type: NSX
    vxlancontroller:
      '[1]':
        firstnodeofcluster: true
        host: 'host.[1]'
        ippool: 'vsm.[1].ippool.[1]'
        name: AutoGenerate
        resourcepool: 'vc.[1].datacenter.[1].cluster.[1]'
  ExitSequence:
    -
      - DeleteEdges
    -
      - RemovevNICFromVM1
      - RemovevNICFromVM2
      - RemovevNICFromVM3
    -
      - Delete_All_VirtualWires
    -
      - DeleteNetworkScopes
  Install_Configure_ClusterSJC:
    TestNSX: 'vsm.[1]'
    Type: NSX
    VDNCluster:
      '[1]':
        cluster: 'vc.[1].datacenter.[1].cluster.[2]'
        mtu: 1600
        switch: 'vc.[1].vds.[1]'
        teaming: *1
        vibs: install
        vlan:
          - 21
        vmkniccount: 1
  MakeSurevNICConnected:
    Type: NetAdapter
    connected: 1
    reconfigure: true
    startconnected: 1
    testadapter: 'vm.[1-2].vnic.[1]'
  MoveHostsToClusterSFO:
    MoveHostsToCluster: 'host.[4],host.[5]'
    TestCluster: 'vc.[1].datacenter.[1].cluster.[3]'
    Type: Cluster
  PingTest:
    NoofInbound: 1
    NoofOutbound: 1
    Routingscheme: unicast
    SupportAdapter: 'vm.[2].vnic.[1]'
    TestAdapter: 'vm.[1].vnic.[1]'
    TestDuration: 6
    ToolName: Ping
    Type: Traffic
    maxtimeout: 128000
  PingTestDifferentHost:
    NoofInbound: 1
    NoofOutbound: 1
    Routingscheme: 'unicast,flood'
    SupportAdapter: 'vm.[3].vnic.[1]'
    TestAdapter: 'vm.[1].vnic.[1]'
    TestDuration: 6
    ToolName: Ping
    Type: Traffic
    maxtimeout: 128000
  PingTestDifferentHostWhileSwitching:
    ExpectedResult: ignore
    NoofInbound: 1
    NoofOutbound: 1
    ParallelSession: yes
    Routingscheme: 'flood,broadcast'
    SupportAdapter: 'vm.[3].vnic.[1]'
    TestAdapter: 'vm.[1].vnic.[1]'
    TestDuration: 6
    ToolName: Ping
    Type: Traffic
    connectivitytest: 0
    maxtimeout: 128000
  PingTestWhileSwitching:
    ExpectedResult: ignore
    NoofInbound: 1
    NoofOutbound: 1
    ParallelSession: yes
    Routingscheme: 'flood,unicast'
    SupportAdapter: 'vm.[2].vnic.[1]'
    TestAdapter: 'vm.[1].vnic.[1]'
    TestDuration: 6
    ToolName: Ping
    Type: Traffic
    connectivitytest: 0
    maxtimeout: 128000
  PlaceVM1OnVLAN16:
    Type: NetAdapter
    portgroup: 'vc.[1].dvportgroup.[2]'
    reconfigure: true
    testadapter: 'vm.[1].vnic.[1]'
  PlaceVM1OnvWire1:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[1]'
    reconfigure: true
    testadapter: 'vm.[1].vnic.[1]'
  PlaceVM1OnvWire3:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[3]'
    reconfigure: true
    testadapter: 'vm.[1].vnic.[1]'
  PlaceVM2OnVLAN17:
    Type: NetAdapter
    portgroup: 'vc.[1].dvportgroup.[3]'
    reconfigure: true
    testadapter: 'vm.[2].vnic.[1]'
  PlaceVM2OnVLAN21:
    Type: NetAdapter
    portgroup: 'vc.[1].dvportgroup.[4]'
    reconfigure: true
    testadapter: 'vm.[2].vnic.[1]'
  PlaceVM2OnvWire2:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[2]'
    reconfigure: true
    testadapter: 'vm.[2].vnic.[1]'
  PlaceVM3OnVLAN17:
    Type: NetAdapter
    portgroup: 'vc.[1].dvportgroup.[3]'
    reconfigure: true
    testadapter: 'vm.[3].vnic.[1]'
  PlaceVM3OnVLAN21:
    Type: NetAdapter
    portgroup: 'vc.[1].dvportgroup.[4]'
    reconfigure: true
    testadapter: 'vm.[3].vnic.[1]'
  PlaceVM3OnvWire1:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[1]'
    reconfigure: true
    testadapter: 'vm.[3].vnic.[1]'
  PlaceVM3OnvWire2:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[2]'
    reconfigure: true
    testadapter: 'vm.[3].vnic.[1]'
  PlaceVM3OnvWire3:
    Type: NetAdapter
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[3]'
    reconfigure: true
    testadapter: 'vm.[3].vnic.[1]'
  PlaceVMsOnMgmtdvPG:
    Type: NetAdapter
    portgroup: 'vc.[1].dvportgroup.[1]'
    reconfigure: true
    testadapter: 'vm.[1-3].vnic.[1]'
  PoweroffVM1:
    TestVM: 'vm.[1]'
    Type: VM
    vmstate: poweroff
  PoweroffVM2:
    TestVM: 'vm.[2]'
    Type: VM
    vmstate: poweroff
  PoweroffVM3:
    TestVM: 'vm.[3]'
    Type: VM
    vmstate: poweroff
  PoweroffVM4:
    TestVM: 'vm.[4]'
    Type: VM
    vmstate: poweroff
  PoweronVM1:
    TestVM: 'vm.[1]'
    Type: VM
    vmstate: poweron
  PoweronVM2:
    TestVM: 'vm.[2]'
    Type: VM
    vmstate: poweron
  PoweronVM3:
    TestVM: 'vm.[3]'
    Type: VM
    vmstate: poweron
  RebootHost:
    TestHost: 'host.[1]'
    Type: Host
    reboot: yes
  RebootHost2:
    TestHost: 'host.[2]'
    Type: Host
    reboot: yes
  RebootHost3:
    TestHost: 'host.[3]'
    Type: Host
    reboot: yes
  RebootHost4:
    TestHost: 'host.[4]'
    Type: Host
    reboot: yes
  RebootHost5:
    TestHost: 'host.[5]'
    Type: Host
    reboot: yes
  RemovevNICFromVM1:
    TestVM: 'vm.[1]'
    Type: VM
    deletevnic: 'vm.[1].vnic.[1]'
  RemovevNICFromVM2:
    TestVM: 'vm.[2]'
    Type: VM
    deletevnic: 'vm.[2].vnic.[1]'
  RemovevNICFromVM3:
    TestVM: 'vm.[3]'
    Type: VM
    deletevnic: 'vm.[3].vnic.[1]'
  RemovevNICFromVM4:
    TestVM: 'vm.[4]'
    Type: VM
    deletevnic: 'vm.[4].vnic.[1]'
  RemovevNICFromVM5:
    TestVM: 'vm.[5]'
    Type: VM
    deletevnic: 'vm.[5].vnic.[1]'
  RemovevNICFromVM6:
    TestVM: 'vm.[6]'
    Type: VM
    deletevnic: 'vm.[6].vnic.[1]'
  Sequence:
    -
      - CreateNetworkScope
    -
      - CreateVirtualWires
    -
      - DeployEdge
    -
      - CreateVXLANLIF1
    -
      - CreateVXLANLIF2
    -
      - CreateVLANLIF3
    -
      - CreateVLANLIF4
    -
      - BridgevWire3ToVLAN21
    -
      - PoweronVM1
      - PoweronVM2
    -
      - AddvNICsOnVMs
    -
      - MakeSurevNICConnected
    -
      - SetVXLANIPVM1
      - SetVXLANIPVM2SamevWire
    -
      - PingTest
    -
      - PlaceVM1OnvWire1
      - PlaceVM2OnvWire2
    -
      - SetVXLANIPVM1
      - SetVXLANIPVM2
    -
      - AddVXLANRouteVM1
      - AddVXLANRouteVM2
    -
      - PingTestWhileSwitching
      - SwitchVM1BackingVeryFast
    -
      - PoweroffVM1
    -
      - PoweronVM1
    -
      - PlaceVM1OnVLAN16
      - PlaceVM2OnVLAN17
    -
      - SetVLANIPVM1
      - SetVLANIPVM2
    -
      - AddVLANRouteVM1
      - AddVLANRouteVM2
    -
      - PingTestWhileSwitching
      - SwitchVM1BackingVeryFast
    -
      - PoweroffVM1
    -
      - PoweronVM1
    -
      - PlaceVM1OnvWire3
      - PlaceVM2OnVLAN21
    -
      - SetVXLANBridgeIPVM1
      - SetVLANBridgeIPVM2
    -
      - PingTestWhileSwitching
      - SwitchVM1BackingVeryFast
    -
      - PoweroffVM1
    -
      - PoweronVM1
    -
      - PlaceVM1OnvWire1
      - PlaceVM2OnvWire2
    -
      - SetVXLANIPVM1
      - SetVXLANIPVM2
    -
      - AddVXLANRouteVM1
      - AddVXLANRouteVM2
    -
      - PingTest
  SetMulticastRange:
    Multicastiprange:
      '[1]':
        begin: 239.0.0.101
        end: 239.254.254.254
        name: AutoGenerate
    TestNSX: 'vsm.[1]'
    Type: NSX
  SetSegmentIDRange:
    TestNSX: 'vsm.[1]'
    Type: NSX
    segmentidrange:
      '[1]':
        begin: 5001-10001
        end: 99000
        name: AutoGenerate
  SetVLANBridgeIPVM2:
    Testadapter: 'vm.[2].vnic.[1]'
    Type: NetAdapter
    ipv4: dhcp
  SetVLANBridgeIPVM3:
    Testadapter: 'vm.[3].vnic.[1]'
    Type: NetAdapter
    ipv4: dhcp
  SetVLANIPVM1:
    Testadapter: 'vm.[1].vnic.[1]'
    Type: NetAdapter
    ipv4: dhcp
  SetVLANIPVM2:
    Testadapter: 'vm.[2].vnic.[1]'
    Type: NetAdapter
    ipv4: dhcp
  SetVLANIPVM3:
    Testadapter: 'vm.[3].vnic.[1]'
    Type: NetAdapter
    ipv4: dhcp
  SetVXLANBridgeIPVM1:
    Testadapter: 'vm.[1].vnic.[1]'
    Type: NetAdapter
    ipv4: dhcp
  SetVXLANIPVM1:
    Testadapter: 'vm.[1].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.31.1.5
    netmask: 255.255.0.0
  SetVXLANIPVM2:
    Testadapter: 'vm.[2].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.32.1.5
    netmask: 255.255.0.0
  SetVXLANIPVM2SamevWire:
    Testadapter: 'vm.[2].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.31.1.6
    netmask: 255.255.0.0
  SetVXLANIPVM3:
    Testadapter: 'vm.[3].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.32.1.5
    netmask: 255.255.0.0
  SetVXLANIPVM3SamevWire:
    Testadapter: 'vm.[3].vnic.[1]'
    Type: NetAdapter
    ipv4: 172.31.1.15
    netmask: 255.255.0.0
  SwitchVM1BackingVeryFast:
    Iterations: 1
    SleepBetweenCombos: 10
    Type: NetAdapter
    maxtimeout: 12800
    portgroup: 'vsm.[1].networkscope.[1].virtualwire.[1],vc.[1].dvportgroup.[4],vsm.[1].networkscope.[1].virtualwire.[1]'
    reconfigure: true
    testadapter: 'vm.[1].vnic.[1]'
  UnconfigureVXLAN:
    Type: Cluster
    testcluster: 'vsm.[1].vdncluster.[1]'
    vxlan: unconfigure
  Uninstall_VDNCluster:
    TestNSX: 'vsm.[1]'
    Type: NSX
    deletevdncluster: 'vsm.[1].vdncluster.[-1]'
